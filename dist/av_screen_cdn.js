/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "/dist";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./test/av_screen_cdn/js/main.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./lib/tttwebsdk.js":
/*!**************************!*\
  !*** ./lib/tttwebsdk.js ***!
  \**************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("!function(e,t){ true?module.exports=t():undefined}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,\"a\",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p=\"\",r(r.s=119)}([function(e,t,r){\"use strict\";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}},function(e,t,r){\"use strict\";t.__esModule=!0;var n,a=r(123),i=(n=a)&&n.__esModule?n:{default:n};t.default=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),(0,i.default)(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}()},function(e,t,r){e.exports={default:r(121),__esModule:!0}},function(e,t,r){\"use strict\";t.__esModule=!0;var n,a=r(26),i=(n=a)&&n.__esModule?n:{default:n};t.default=function(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!==(void 0===t?\"undefined\":(0,i.default)(t))&&\"function\"!=typeof t?e:t}},function(e,t,r){\"use strict\";t.__esModule=!0;var n=o(r(142)),a=o(r(146)),i=o(r(26));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+(void 0===t?\"undefined\":(0,i.default)(t)));e.prototype=(0,a.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(n.default?(0,n.default)(e,t):e.__proto__=t)}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=o(r(0)),a=o(r(1)),i=o(r(106));function o(e){return e&&e.__esModule?e:{default:e}}var s=\"mediasoup-client\",c=function(){function e(t){(0,n.default)(this,e),t?(this._debug=(0,i.default)(s+\":\"+t),this._warn=(0,i.default)(s+\":WARN:\"+t),this._error=(0,i.default)(s+\":ERROR:\"+t)):(this._debug=(0,i.default)(s),this._warn=(0,i.default)(s+\":WARN\"),this._error=(0,i.default)(s+\":ERROR\")),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}return(0,a.default)(e,[{key:\"debug\",get:function(){return this._debug}},{key:\"warn\",get:function(){return this._warn}},{key:\"error\",get:function(){return this._error}}]),e}();t.default=c},function(e,t,r){e.exports={default:r(152),__esModule:!0}},function(e,t){var r=e.exports={version:\"2.6.11\"};\"number\"==typeof __e&&(__e=r)},function(e,t,r){e.exports={default:r(163),__esModule:!0}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=a(r(24));function a(e){return e&&e.__esModule?e:{default:e}}t.randomNumber=function(){return i()},t.clone=function(e){return JSON.parse((0,n.default)(e))};var i=a(r(113)).default.generator({min:1e7,max:99999999,integer:!0})},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=l(r(6)),a=l(r(2)),i=l(r(0)),o=l(r(1)),s=l(r(3)),c=l(r(4)),u=r(29),d=l(r(5));function l(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(e){(0,i.default)(this,t);var r=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return r.setMaxListeners(1/0),r._logger=e||new d.default(\"<EnhancedEventEmitter>\"),r}return(0,c.default)(t,e),(0,o.default)(t,[{key:\"safeEmit\",value:function(e){try{for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.emit.apply(this,[e].concat(r))}catch(t){this._logger.error(\"safeEmit() | event listener threw an error [event:%s]:%o\",e,t)}}},{key:\"safeEmitAsPromise\",value:function(e){for(var t=this,r=arguments.length,a=Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];return new n.default((function(r,n){t.safeEmit.apply(t,[e].concat(a,[function(e){r(e)},function(r){t._logger.error(\"safeEmitAsPromise() | errback called [event:%s]:%o\",e,r),n(r)}]))}))}}]),t}(u.EventEmitter);t.default=p},function(e,t,r){var n=r(13),a=r(7),i=r(27),o=r(28),s=r(32),c=function(e,t,r){var u,d,l,p=e&c.F,f=e&c.G,m=e&c.S,h=e&c.P,v=e&c.B,_=e&c.W,g=f?a:a[t]||(a[t]={}),y=g.prototype,b=f?n:m?n[t]:(n[t]||{}).prototype;for(u in f&&(r=t),r)(d=!p&&b&&void 0!==b[u])&&s(g,u)||(l=d?b[u]:r[u],g[u]=f&&\"function\"!=typeof b[u]?r[u]:v&&d?i(l,n):_&&b[u]==l?function(e){var t=function(t,r,n){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,r)}return new e(t,r,n)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(l):h&&\"function\"==typeof l?i(Function.call,l):l,h&&((g.virtual||(g.virtual={}))[u]=l,e&c.R&&y&&!y[u]&&o(y,u,l)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},function(e,t,r){\"use strict\";var n=r(189),a=r(190);t.write=a,t.parse=n.parse,t.parseFmtpConfig=n.parseFmtpConfig,t.parseParams=n.parseParams,t.parsePayloads=n.parsePayloads,t.parseRemoteCandidates=n.parseRemoteCandidates,t.parseImageAttributes=n.parseImageAttributes,t.parseSimulcastStreamList=n.parseSimulcastStreamList},function(e,t){var r=e.exports=\"undefined\"!=typeof window&&window.Math==Math?window:\"undefined\"!=typeof self&&self.Math==Math?self:Function(\"return this\")();\"number\"==typeof __g&&(__g=r)},function(e,t,r){var n=r(64)(\"wks\"),a=r(53),i=r(13).Symbol,o=\"function\"==typeof i;(e.exports=function(e){return n[e]||(n[e]=o&&i[e]||(o?i:a)(\"Symbol.\"+e))}).store=n},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n,a=r(17),i=(n=a)&&n.__esModule?n:{default:n};function o(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var s,c=function(){var e=s.value,n=(t.rtcpFeedback||[]).find((function(t){return t.type===e.type&&t.parameter===e.parameter}));n&&r.push(n)},u=(0,i.default)(e.rtcpFeedback||[]);!(n=(s=u.next()).done);n=!0)c()}catch(e){a=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(a)throw o}}return r}t.getExtendedRtpCapabilities=function(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=!0,a=!1,s=void 0;try{for(var c,u=function(){var t=c.value;if(\"rtx\"===t.name)return\"continue\";var n=(e.codecs||[]).find((function(e){return function(e,t){var r=e.mimeType.toLowerCase(),n=t.mimeType.toLowerCase();if(r!==n)return!1;if(e.clockRate!==t.clockRate)return!1;if(e.channels!==t.channels)return!1;if(\"video/h264\"===r){var a=(e.parameters||{})[\"packetization-mode\"]||0,i=(t.parameters||{})[\"packetization-mode\"]||0;if(a!==i)return!1}return!0}(e,t)}));if(n){var a={name:t.name,mimeType:t.mimeType,kind:t.kind,clockRate:t.clockRate,sendPayloadType:n.preferredPayloadType,sendRtxPayloadType:null,recvPayloadType:t.preferredPayloadType,recvRtxPayloadType:null,channels:t.channels,rtcpFeedback:o(n,t),parameters:t.parameters};a.channels||delete a.channels,r.codecs.push(a)}},d=(0,i.default)(t.codecs||[]);!(n=(c=d.next()).done);n=!0)u()}catch(e){a=!0,s=e}finally{try{!n&&d.return&&d.return()}finally{if(a)throw s}}var l=!0,p=!1,f=void 0;try{for(var m,h=function(){var r=m.value,n=(e.codecs||[]).find((function(e){return\"rtx\"===e.name&&e.parameters.apt===r.sendPayloadType})),a=(t.codecs||[]).find((function(e){return\"rtx\"===e.name&&e.parameters.apt===r.recvPayloadType}));n&&a&&(r.sendRtxPayloadType=n.preferredPayloadType,r.recvRtxPayloadType=a.preferredPayloadType)},v=(0,i.default)(r.codecs||[]);!(l=(m=v.next()).done);l=!0)h()}catch(e){p=!0,f=e}finally{try{!l&&v.return&&v.return()}finally{if(p)throw f}}var _=!0,g=!1,y=void 0;try{for(var b,k=function(){var t=b.value,n=(e.headerExtensions||[]).find((function(e){return n=t,!((r=e).kind&&n.kind&&r.kind!==n.kind||r.uri!==n.uri);var r,n}));if(n){var a={kind:t.kind,uri:t.uri,sendId:n.preferredId,recvId:t.preferredId};r.headerExtensions.push(a)}},w=(0,i.default)(t.headerExtensions||[]);!(_=(b=w.next()).done);_=!0)k()}catch(e){g=!0,y=e}finally{try{!_&&w.return&&w.return()}finally{if(g)throw y}}return r},t.getRtpCapabilities=function(e){var t={codecs:[],headerExtensions:[],fecMechanisms:[]},r=!0,n=!1,a=void 0;try{for(var o,s=(0,i.default)(e.codecs);!(r=(o=s.next()).done);r=!0){var c=o.value,u={name:c.name,mimeType:c.mimeType,kind:c.kind,clockRate:c.clockRate,preferredPayloadType:c.recvPayloadType,channels:c.channels,rtcpFeedback:c.rtcpFeedback,parameters:c.parameters};if(u.channels||delete u.channels,t.codecs.push(u),c.recvRtxPayloadType){var d={name:\"rtx\",mimeType:c.kind+\"/rtx\",kind:c.kind,clockRate:c.clockRate,preferredPayloadType:c.recvRtxPayloadType,parameters:{apt:c.recvPayloadType}};t.codecs.push(d)}}}catch(e){n=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw a}}var l=!0,p=!1,f=void 0;try{for(var m,h=(0,i.default)(e.headerExtensions);!(l=(m=h.next()).done);l=!0){var v=m.value,_={kind:v.kind,uri:v.uri,preferredId:v.recvId};t.headerExtensions.push(_)}}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}return t.fecMechanisms=e.fecMechanisms,t},t.getUnsupportedCodecs=function(e,t,r){if(!Array.isArray(t))return[];var n=[],a=e.codecs,o=r.codecs,s=!0,c=!1,u=void 0;try{for(var d,l=function(){var e=d.value;if(!o.some((function(t){return t.recvPayloadType===e}))){var t=a.find((function(t){return t.preferredPayloadType===e}));if(!t)throw new Error(\"mandatory codec PT \"+e+\" not found in remote codecs\");n.push(t)}},p=(0,i.default)(t);!(s=(d=p.next()).done);s=!0)l()}catch(e){c=!0,u=e}finally{try{!s&&p.return&&p.return()}finally{if(c)throw u}}return n},t.canSend=function(e,t){return t.codecs.some((function(t){return t.kind===e}))},t.canReceive=function(e,t){if(0===e.codecs.length)return!1;var r=e.codecs[0];return t.codecs.some((function(e){return e.recvPayloadType===r.payloadType}))},t.getSendingRtpParameters=function(e,t){var r={muxId:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},n=!0,a=!1,o=void 0;try{for(var s,c=(0,i.default)(t.codecs);!(n=(s=c.next()).done);n=!0){var u=s.value;if(u.kind===e){var d={name:u.name,mimeType:u.mimeType,clockRate:u.clockRate,payloadType:u.sendPayloadType,channels:u.channels,rtcpFeedback:u.rtcpFeedback,parameters:u.parameters};if(d.channels||delete d.channels,r.codecs.push(d),u.sendRtxPayloadType){var l={name:\"rtx\",mimeType:u.kind+\"/rtx\",clockRate:u.clockRate,payloadType:u.sendRtxPayloadType,parameters:{apt:u.sendPayloadType}};r.codecs.push(l)}}}}catch(e){a=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw o}}var p=!0,f=!1,m=void 0;try{for(var h,v=(0,i.default)(t.headerExtensions);!(p=(h=v.next()).done);p=!0){var _=h.value;if(!_.kind||_.kind===e){var g={uri:_.uri,id:_.sendId};r.headerExtensions.push(g)}}}catch(e){f=!0,m=e}finally{try{!p&&v.return&&v.return()}finally{if(f)throw m}}return r},t.getReceivingFullRtpParameters=function(e,t){var r={muxId:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},n=!0,a=!1,o=void 0;try{for(var s,c=(0,i.default)(t.codecs);!(n=(s=c.next()).done);n=!0){var u=s.value;if(u.kind===e){var d={name:u.name,mimeType:u.mimeType,clockRate:u.clockRate,payloadType:u.recvPayloadType,channels:u.channels,rtcpFeedback:u.rtcpFeedback,parameters:u.parameters};if(d.channels||delete d.channels,r.codecs.push(d),u.recvRtxPayloadType){var l={name:\"rtx\",mimeType:u.kind+\"/rtx\",clockRate:u.clockRate,payloadType:u.recvRtxPayloadType,parameters:{apt:u.recvPayloadType}};r.codecs.push(l)}}}}catch(e){a=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw o}}var p=!0,f=!1,m=void 0;try{for(var h,v=(0,i.default)(t.headerExtensions);!(p=(h=v.next()).done);p=!0){var _=h.value;if(!_.kind||_.kind===e){var g={uri:_.uri,id:_.recvId};r.headerExtensions.push(g)}}}catch(e){f=!0,m=e}finally{try{!p&&v.return&&v.return()}finally{if(f)throw m}}return r}},function(e,t,r){e.exports={default:r(181),__esModule:!0}},function(e,t,r){e.exports={default:r(161),__esModule:!0}},function(e,t){e.exports=function(e){return\"object\"==typeof e?null!==e:\"function\"==typeof e}},function(e,t,r){e.exports={default:r(184),__esModule:!0}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=s(r(17)),a=s(r(16)),i=s(r(8));t.extractRtpCapabilities=function(e){var t=new i.default,r=[],s=!1,c=!1,u=!0,d=!1,l=void 0;try{for(var p,f=(0,n.default)(e.media);!(u=(p=f.next()).done);u=!0){var m=p.value,h=m.type;switch(h){case\"audio\":if(s)continue;s=!0;break;case\"video\":if(c)continue;c=!0;break;default:continue}var v=!0,_=!1,g=void 0;try{for(var y,b=(0,n.default)(m.rtp);!(v=(y=b.next()).done);v=!0){var k=y.value,w={name:k.codec,mimeType:h+\"/\"+k.codec,kind:h,clockRate:k.rate,preferredPayloadType:k.payload,channels:k.encoding,rtcpFeedback:[],parameters:{}};\"audio\"!==w.kind?delete w.channels:w.channels||(w.channels=1),t.set(w.preferredPayloadType,w)}}catch(e){_=!0,g=e}finally{try{!v&&b.return&&b.return()}finally{if(_)throw g}}var P=!0,S=!1,I=void 0;try{for(var T,C=(0,n.default)(m.fmtp||[]);!(P=(T=C.next()).done);P=!0){var R=T.value,x=o.default.parseFmtpConfig(R.config),A=t.get(R.payload);A&&(A.parameters=x)}}catch(e){S=!0,I=e}finally{try{!P&&C.return&&C.return()}finally{if(S)throw I}}var E=!0,D=!1,O=void 0;try{for(var L,j=(0,n.default)(m.rtcpFb||[]);!(E=(L=j.next()).done);E=!0){var M=L.value,B=t.get(M.payload);if(B){var V={type:M.type,parameter:M.subtype};V.parameter||delete V.parameter,B.rtcpFeedback.push(V)}}}catch(e){D=!0,O=e}finally{try{!E&&j.return&&j.return()}finally{if(D)throw O}}var N=!0,F=!1,U=void 0;try{for(var G,W=(0,n.default)(m.ext||[]);!(N=(G=W.next()).done);N=!0){var K=G.value,z={kind:h,uri:K.uri,preferredId:K.value};r.push(z)}}catch(e){F=!0,U=e}finally{try{!N&&W.return&&W.return()}finally{if(F)throw U}}}}catch(e){d=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(d)throw l}}return{codecs:(0,a.default)(t.values()),headerExtensions:r,fecMechanisms:[]}},t.extractDtlsParameters=function(e){var t=function(e){return(e.media||[]).find((function(e){return e.iceUfrag&&0!==e.port}))}(e),r=t.fingerprint||e.fingerprint,n=void 0;switch(t.setup){case\"active\":n=\"client\";break;case\"passive\":n=\"server\";break;case\"actpass\":n=\"auto\"}return{role:n,fingerprints:[{algorithm:r.type,value:r.hash}]}};var o=s(r(12));function s(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){var n=r(25),a=r(83),i=r(67),o=Object.defineProperty;t.f=r(22)?Object.defineProperty:function(e,t,r){if(n(e),t=i(t,!0),n(r),a)try{return o(e,t,r)}catch(e){}if(\"get\"in r||\"set\"in r)throw TypeError(\"Accessors not supported!\");return\"value\"in r&&(e[t]=r.value),e}},function(e,t,r){e.exports=!r(33)((function(){return 7!=Object.defineProperty({},\"a\",{get:function(){return 7}}).a}))},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=i(r(5)),a=i(r(12));function i(e){return e&&e.__esModule?e:{default:e}}new n.default(\"<BandwidthHandler>\");function o(e,t,r){return s(e,0,-1,t,r)}function s(e,t,r,n,a){for(var i=-1!==r?r:e.length,o=t;o<i;++o)if(0===e[o].indexOf(n)&&(!a||-1!==e[o].toLowerCase().indexOf(a.toLowerCase())))return o;return null}function c(e){var t=new RegExp(\"a=rtpmap:(\\\\d+) \\\\w+\\\\/\\\\d+\"),r=e.match(t);return r&&2===r.length?r[1]:null}t.default={setBAS:function(e,t,r){return navigator.mozGetUserMedia||!t||(r&&(t.screen?t.screen<300&&console.warn(\"It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail.\"):console.warn(\"It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.\")),t.screen&&r&&(e=(e=e.replace(/b=AS([^\\r\\n]+\\r\\n)/g,\"\")).replace(/a=mid:video\\r\\n/g,\"a=mid:video\\r\\nb=AS:\"+t.screen+\"\\r\\n\")),(t.audio||t.video||t.data)&&(e=e.replace(/b=AS([^\\r\\n]+\\r\\n)/g,\"\")),t.audio&&(e=e.replace(/a=mid:audio\\r\\n/g,\"a=mid:audio\\r\\nb=AS:\"+t.audio+\"\\r\\n\")),t.video&&(e=e.replace(/a=mid:video\\r\\n/g,\"a=mid:video\\r\\nb=AS:\"+(r?t.screen:t.video)+\"\\r\\n\"))),e},setVideoBitrates:function(e,t){if(null==t)return e;if(void 0===t.videoGoogleMinBitrate||void 0===t.videoGoogleMaxBitrate)return e;var r,n=(t=t||{}).videoGoogleMinBitrate,a=t.videoGoogleMaxBitrate,i=t.videoGoogleStartBitrate,u=e.split(\"\\r\\n\"),d=o(u,\"a=rtpmap\",\"H264/90000\");if(d&&(r=c(u[d])),!r)return e;for(var l=\"\",p=void 0,f=0;null!==f&&(null!==(f=s(u,f,-1,\"a=fmtp\",\"profile-level-id=42001f\"))&&(l=\"\",-1===u[f].indexOf(\"x-google-min-bitrate=\")?l+=\";x-google-min-bitrate=\"+(n||\"228\"):(p=new RegExp(\"x-google-min-bitrate=(\\\\d+)\"),u[f]=u[f].replace(p,\"x-google-min-bitrate=\"+(n||\"228\"))),-1===u[f].indexOf(\"x-google-max-bitrate=\")?l+=\";x-google-max-bitrate=\"+(a||\"228\"):(p=new RegExp(\"x-google-max-bitrate=(\\\\d+)\"),u[f]=u[f].replace(p,\"x-google-max-bitrate=\"+(a||\"228\"))),-1===u[f].indexOf(\"x-google-start-bitrate=\")?l+=\";x-google-start-bitrate=\"+(i||\"228\"):(p=new RegExp(\"x-google-start-bitrate=(\\\\d+)\"),u[f]=u[f].replace(p,\"x-google-start-bitrate=\"+(i||\"228\"))),u[f]=u[f].concat(l),e=u.join(\"\\r\\n\")),null!==f);)f+=1;for(f=0;null!==f&&(null!==(f=s(u,f,-1,\"a=fmtp\",\"profile-level-id=42e01f\"))&&(l=\"\",-1===u[f].indexOf(\"x-google-min-bitrate=\")?l+=\";x-google-min-bitrate=\"+(n||\"228\"):(p=new RegExp(\"x-google-min-bitrate=(\\\\d+)\"),u[f]=u[f].replace(p,\"x-google-min-bitrate=\"+(n||\"228\"))),-1===u[f].indexOf(\"x-google-max-bitrate=\")?l+=\";x-google-max-bitrate=\"+(a||\"228\"):(p=new RegExp(\"x-google-max-bitrate=(\\\\d+)\"),u[f]=u[f].replace(p,\"x-google-max-bitrate=\"+(a||\"228\"))),-1===u[f].indexOf(\"x-google-start-bitrate=\")?l+=\";x-google-start-bitrate=\"+(i||\"228\"):(p=new RegExp(\"x-google-start-bitrate=(\\\\d+)\"),u[f]=u[f].replace(p,\"x-google-start-bitrate=\"+(i||\"228\"))),u[f]=u[f].concat(l),e=u.join(\"\\r\\n\")),null!==f);)f+=1;return e=e.replace(/a=mid:video\\r\\n/g,\"a=mid:video\\r\\nb=AS:\"+(a||\"500\")+\"\\r\\n\")},setOpusAttributes:function(e,t){t=t||{};var r,n=e.split(\"\\r\\n\"),a=o(n,\"a=rtpmap\",\"opus/48000\");if(a&&(r=c(n[a])),!r)return e;var i=o(n,\"a=fmtp:\"+r.toString());if(null===i)return e;var s=\"\",u=void 0;return void 0!==t.stereo&&(-1===n[i].indexOf(\"stereo=\")?s+=\";stereo=\"+t.stereo:(u=new RegExp(\"stereo=(\\\\d)\"),n[i]=n[i].replace(u,\"stereo=\"+t.stereo))),void 0!==t[\"sprop-stereo\"]&&(-1===n[i].indexOf(\"sprop-stereo=\")?s+=\";sprop-stereo=\"+t[\"sprop-stereo\"]:(u=new RegExp(\"sprop-stereo=(\\\\d)\"),n[i]=n[i].replace(u,\"sprop-stereo=\"+t[\"sprop-stereo\"]))),void 0!==t.maxaveragebitrate&&(-1==n[i].indexOf(\"maxaveragebitrate=\")?s+=\";maxaveragebitrate=\"+(t.maxaveragebitrate||1048576):(u=new RegExp(\"maxaveragebitrate=(\\\\d+)\"),n[i]=n[i].replace(u,\"maxaveragebitrate=\"+(t.maxaveragebitrate||1048576)))),void 0!==t.maxplaybackrate&&(-1===n[i].indexOf(\"maxplaybackrate=\")?s+=\";maxplaybackrate=\"+(t.maxplaybackrate||48e3):(u=new RegExp(\"maxplaybackrate=(\\\\d+)\"),n[i]=n[i].replace(u,\"maxplaybackrate=\"+(t.maxplaybackrate||48e3)))),void 0!==t.cbr&&(-1===n[i].indexOf(\"cbr=\")?s+=\";cbr=\"+t.cbr:(u=new RegExp(\"cbr=(\\\\d+)\"),n[i]=n[i].replace(u,\"cbr=\"+t.cbr))),void 0!==t.useinbandfec&&(-1===n[i].indexOf(\"useinbandfec=\")?s+=\";useinbandfec=\"+t.useinbandfec:(u=new RegExp(\"useinbandfec=(\\\\d)\"),n[i]=n[i].replace(u,\"useinbandfec=\"+t.useinbandfec))),void 0!==t.usedtx&&(-1===n[i].indexOf(\"usedtx=\")?s+=\";usedtx=\"+t.usedtx:(u=new RegExp(\"usedtx=(\\\\d)\"),n[i]=n[i].replace(u,\"usedtx=\"+t.usedtx))),void 0!==t.maxptime&&(s+=\"\\r\\na=maxptime:\"+t.maxptime),n[i]=n[i].concat(s),e=n.join(\"\\r\\n\")},setSpecialAudioCodec:function(e,t){var r=a.default.parse(e);return r?(r.media.forEach((function(e,n){if(\"audio\"===e.type&&e.rtp){r.media[n].rtp=e.rtp.filter((function(e){return e.codec.toLowerCase()==t||\"CN\"==e.codec||\"telephone-event\"==e.codec}));var a=-1;e.rtp.forEach((function(e,r){e.codec==t&&(a=e.payload)})),r.media[n].payloads=e.rtp.map((function(e){return e.payload})).join(\" \"),e.fmtp&&(r.media[n].fmtp=e.fmtp.filter((function(e){return e.payload==a}))),e.rtcpFb&&(r.media[n].rtcpFb=e.rtcpFb.filter((function(e){return e.payload==a})))}})),e=a.default.write(r)):e}}},function(e,t,r){e.exports={default:r(120),__esModule:!0}},function(e,t,r){var n=r(18);e.exports=function(e){if(!n(e))throw TypeError(e+\" is not an object!\");return e}},function(e,t,r){\"use strict\";t.__esModule=!0;var n=o(r(126)),a=o(r(135)),i=\"function\"==typeof a.default&&\"symbol\"==typeof n.default?function(e){return typeof e}:function(e){return e&&\"function\"==typeof a.default&&e.constructor===a.default&&e!==a.default.prototype?\"symbol\":typeof e};function o(e){return e&&e.__esModule?e:{default:e}}t.default=\"function\"==typeof a.default&&\"symbol\"===i(n.default)?function(e){return void 0===e?\"undefined\":i(e)}:function(e){return e&&\"function\"==typeof a.default&&e.constructor===a.default&&e!==a.default.prototype?\"symbol\":void 0===e?\"undefined\":i(e)}},function(e,t,r){var n=r(45);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,a){return e.call(t,r,n,a)}}return function(){return e.apply(t,arguments)}}},function(e,t,r){var n=r(21),a=r(46);e.exports=r(22)?function(e,t,r){return n.f(e,t,a(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){\"use strict\";var n,a=\"object\"==typeof Reflect?Reflect:null,i=a&&\"function\"==typeof a.apply?a.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};n=a&&\"function\"==typeof a.ownKeys?a.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var c=10;function u(e){if(\"function\"!=typeof e)throw new TypeError('The \"listener\" argument must be of type Function. Received type '+typeof e)}function d(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function l(e,t,r,n){var a,i,o,s;if(u(r),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit(\"newListener\",t,r.listener?r.listener:r),i=e._events),o=i[t]),void 0===o)o=i[t]=r,++e._eventsCount;else if(\"function\"==typeof o?o=i[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),(a=d(e))>0&&o.length>a&&!o.warned){o.warned=!0;var c=new Error(\"Possible EventEmitter memory leak detected. \"+o.length+\" \"+String(t)+\" listeners added. Use emitter.setMaxListeners() to increase limit\");c.name=\"MaxListenersExceededWarning\",c.emitter=e,c.type=t,c.count=o.length,s=c,console&&console.warn&&console.warn(s)}return e}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},a=p.bind(n);return a.listener=r,n.wrapFn=a,a}function m(e,t,r){var n=e._events;if(void 0===n)return[];var a=n[t];return void 0===a?[]:\"function\"==typeof a?r?[a.listener||a]:[a]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(a):v(a,a.length)}function h(e){var t=this._events;if(void 0!==t){var r=t[e];if(\"function\"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function v(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}Object.defineProperty(s,\"defaultMaxListeners\",{enumerable:!0,get:function(){return c},set:function(e){if(\"number\"!=typeof e||e<0||o(e))throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received '+e+\".\");c=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if(\"number\"!=typeof e||e<0||o(e))throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received '+e+\".\");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return d(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n=\"error\"===e,a=this._events;if(void 0!==a)n=n&&void 0===a.error;else if(!n)return!1;if(n){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error(\"Unhandled error.\"+(o?\" (\"+o.message+\")\":\"\"));throw s.context=o,s}var c=a[e];if(void 0===c)return!1;if(\"function\"==typeof c)i(c,this,t);else{var u=c.length,d=v(c,u);for(r=0;r<u;++r)i(d[r],this,t)}return!0},s.prototype.addListener=function(e,t){return l(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return l(this,e,t,!0)},s.prototype.once=function(e,t){return u(t),this.on(e,f(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,f(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,n,a,i,o;if(u(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit(\"removeListener\",e,r.listener||t));else if(\"function\"!=typeof r){for(a=-1,i=r.length-1;i>=0;i--)if(r[i]===t||r[i].listener===t){o=r[i].listener,a=i;break}if(a<0)return this;0===a?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,a),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit(\"removeListener\",e,o||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var a,i=Object.keys(r);for(n=0;n<i.length;++n)\"removeListener\"!==(a=i[n])&&this.removeAllListeners(a);return this.removeAllListeners(\"removeListener\"),this._events=Object.create(null),this._eventsCount=0,this}if(\"function\"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},s.prototype.listeners=function(e){return m(this,e,!0)},s.prototype.rawListeners=function(e){return m(this,e,!1)},s.listenerCount=function(e,t){return\"function\"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},s.prototype.listenerCount=h,s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t,r){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0});var n=u(r(24)),a=u(r(26)),i=u(r(0)),o=u(r(1)),s=u(r(106)),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(51));function u(e){return e&&e.__esModule?e:{default:e}}var d=c.logLevel,l=\"tttwebsdk\",p=d.LOG_TRACE,f=!0,m=!1,h=function(){function t(e){(0,i.default)(this,t),this._userAgent=navigator.userAgent,this._isMobile=/mobile/i.test(this._userAgent),e?(this._prefix=\"tttwebsdk \"+e,this._debug=(0,s.default)(\"tttwebsdk:\"+e),this._warn=(0,s.default)(\"tttwebsdk:WARN:\"+e),this._error=(0,s.default)(\"tttwebsdk:ERROR:\"+e)):(this._prefix=\"tttwebsdk\",this._debug=(0,s.default)(l),this._warn=(0,s.default)(\"tttwebsdk:WARN\"),this._error=(0,s.default)(\"tttwebsdk:ERROR\")),this._debug=this._log_debug.bind(this),this._warn=this._log_warn.bind(this),this._error=this._log_error.bind(this)}return(0,o.default)(t,[{key:\"setLoggerLevel\",value:function(e){t.logLevel=e}},{key:\"_log_debug\",value:function(){for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];if(t.logLevel<=d.LOG_INFO){var o=\"[\"+this._prefix+\"]\";[].slice.apply(r).forEach((function(e){\"object\"===(void 0===e?\"undefined\":(0,a.default)(e))?o+=\" \"+(0,n.default)(e):o+=\" \"+e})),console.log(o)}this._log.apply(this,r)}},{key:\"_log_error\",value:function(){for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];if(t.logLevel<=d.LOG_ERROR){var o=\"[\"+this._prefix+\"]\";[].slice.apply(r).forEach((function(e){\"object\"===(void 0===e?\"undefined\":(0,a.default)(e))?o+=\" \"+(0,n.default)(e):o+=\" \"+e})),console.error(o)}this._log.apply(this,r)}},{key:\"_log_warn\",value:function(){for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];if(t.logLevel<=d.LOG_WARN){var o=\"[\"+this._prefix+\"]\";[].slice.apply(r).forEach((function(e){\"object\"===(void 0===e?\"undefined\":(0,a.default)(e))?o+=\" \"+(0,n.default)(e):o+=\" \"+e})),console.warn(o)}this._log.apply(this,r)}},{key:\"_log\",value:function(){if(t.logSubmit){for(var r=this._isMobile?\"web_mobile\":\"web\",i=\"appid=\"+e.g_appid+\", roomid=\"+e.g_roomid+\", userid=\"+e.g_userid+\" server=\"+e.g_server+\" dev=\"+r+\" ua=\"+this._userAgent+\" time=\"+new Date,o=arguments.length,s=Array(o),u=0;u<o;u++)s[u]=arguments[u];[].slice.apply(s).forEach((function(e){\"object\"===(void 0===e?\"undefined\":(0,a.default)(e))?i+=\" \"+(0,n.default)(e):i+=\" \"+e})),fetch(c.logserver_url,{method:\"POST\",mode:\"no-cors\",cache:\"no-cache\",headers:{\"Content-Type\":\"text/plain; charset=utf-8\"},redirect:\"follow\",referrer:\"no-referrer\",body:\"event=\"+this._prefix+\" \"+i}).catch((function(e){return console.warn(\"Error:\",e)})).then((function(e){return(0,n.default)(e)}))}}},{key:\"debug\",get:function(){return this._debug}},{key:\"warn\",get:function(){return this._warn}},{key:\"error\",get:function(){return this._error}}],[{key:\"privateCloud\",get:function(){return m},set:function(e){m=Boolean(e)}},{key:\"logSubmit\",get:function(){return f},set:function(e){f=Boolean(e)}},{key:\"logLevel\",get:function(){return p},set:function(e){switch(e){case\"LOG_NONE\":p=d.LOG_NONE;break;case\"LOG_ERROR\":p=d.LOG_ERROR;break;case\"LOG_WARN\":p=d.LOG_WARN;break;case\"LOG_INFO\":p=d.LOG_INFO;break;case\"LOG_DEBUG\":p=d.LOG_DEBUG;break;case\"LOG_TRACE\":p=d.LOG_TRACE;break;default:throw TypeError(\"parameter error. must be: LOG_NONE, LOG_ERROR, LOG_WARN, LOG_INFO, LOG_DEBUG, LOG_TRACE\")}}}]),t}();t.default=h}).call(this,r(43))},function(e,t,r){var n=r(62);e.exports=function(e){return Object(n(e))}},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,r){\"use strict\";var n=r(128)(!0);r(69)(String,\"String\",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=n(t,r),this._i+=e.length,{value:e,done:!1})}))},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=s(r(114)),a=s(r(8)),i=s(r(19)),o=s(r(17));function s(e){return e&&e.__esModule?e:{default:e}}function c(e,t,r){var n=void 0;if(null!=r){if(r=String(r),!(n=(e.media||[]).find((function(e){return String(e.mid)===r}))))throw new Error(\"SDP section with mid=\"+r+\" not found\")}else if(!(n=(e.media||[]).find((function(e){return e.type===t.kind&&e.msid&&e.msid.split(\" \")[1]===t.id}))))throw new Error(\"SDP section with a=msid containing track.id=\"+t.id+\" not found\");return n}t.fillRtpParametersForTrack=function(e,t,r){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},u=s.mid,d=void 0===u?null:u,l=s.planBSimulcast,p=void 0!==l&&l,f=c(t,r,d);null!=d&&(e.muxId=String(d));e.rtcp={cname:null,reducedSize:!0,mux:!0};var m=(f.ssrcs||[]).find((function(e){return\"cname\"===e.attribute}));if(!m)throw new Error(\"CNAME value not found\");if(e.rtcp.cname=m.value,p){var h=void 0,v=new i.default,_=!0,g=!1,y=void 0;try{for(var b,k=(0,o.default)(f.ssrcs||[]);!(_=(b=k.next()).done);_=!0){var w=b.value;if(\"msid\"===w.attribute){var P=w.id;v.add(P),h||(h=P)}}}catch(e){g=!0,y=e}finally{try{!_&&k.return&&k.return()}finally{if(g)throw y}}if(0===v.size)throw new Error(\"no a=ssrc lines found\");var S=new a.default,I=!0,T=!1,C=void 0;try{for(var R,x=(0,o.default)(f.ssrcGroups||[]);!(I=(R=x.next()).done);I=!0){var A=R.value;if(\"FID\"===A.semantics){var E=A.ssrcs.split(/\\s+/),D=(0,n.default)(E,2),O=D[0],L=D[1];O=Number(O),L=Number(L),v.has(O)&&(v.delete(O),v.delete(L),S.set(O,L))}}}catch(e){T=!0,C=e}finally{try{!I&&x.return&&x.return()}finally{if(T)throw C}}var j=!0,M=!1,B=void 0;try{for(var V,N=(0,o.default)(v);!(j=(V=N.next()).done);j=!0){var F=V.value;S.set(F,null)}}catch(e){M=!0,B=e}finally{try{!j&&N.return&&N.return()}finally{if(M)throw B}}e.encodings=[];var U=S.size>1,G=[\"low\",\"medium\",\"high\"],W=!0,K=!1,z=void 0;try{for(var q,H=(0,o.default)(S);!(W=(q=H.next()).done);W=!0){var J=(0,n.default)(q.value,2),Q=J[0],Y=(L=J[1],{ssrc:Q});L&&(Y.rtx={ssrc:L}),U&&(Y.profile=G.shift()),e.encodings.push(Y)}}catch(e){K=!0,z=e}finally{try{!W&&H.return&&H.return()}finally{if(K)throw z}}}else{var $=m.id,X=[],Z=!0,ee=!1,te=void 0;try{for(var re,ne=(0,o.default)(f.rids||[]);!(Z=(re=ne.next()).done);Z=!0){var ae=re.value;\"send\"===ae.direction&&(/^low/.test(ae.id)?X.push({rid:ae.id,profile:\"low\"}):/^medium/.test(ae.id)&&X.push({rid:ae.id,profile:\"medium\"}),/^high/.test(ae.id)&&X.push({rid:ae.id,profile:\"high\"}))}}catch(e){ee=!0,te=e}finally{try{!Z&&ne.return&&ne.return()}finally{if(ee)throw te}}if(e.encodings=[],0===X.length){var ie={ssrc:$};e.encodings.push(ie)}else{var oe=!0,se=!1,ce=void 0;try{for(var ue,de=(0,o.default)(X);!(oe=(ue=de.next()).done);oe=!0){var le=ue.value,pe={encodingId:le.rid,profile:le.profile};e.encodings.push(pe)}}catch(e){se=!0,ce=e}finally{try{!oe&&de.return&&de.return()}finally{if(se)throw ce}}}}},t.addPlanBSimulcast=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.mid,a=void 0===n?null:n,i=c(e,t,a),o=(i.ssrcs||[]).find((function(e){return\"msid\"===e.attribute}));if(!o)throw new Error(\"a=ssrc line with msid information not found\");var s=o.id,u=o.value.split(\" \")[0],d=void 0;(i.ssrcGroups||[]).some((function(e){if(\"FID\"===e.semantics){var t=e.ssrcs.split(/\\s+/);return Number(t[0])===s?(d=Number(t[1]),!0):void 0}}));var l=i.ssrcs.find((function(e){return\"cname\"===e.attribute&&e.id===s}));if(!l)throw new Error(\"CNAME line not found\");var p=l.value,f=s+1,m=s+2;if(i.ssrcGroups=[],i.ssrcs=[],i.ssrcGroups.push({semantics:\"SIM\",ssrcs:s+\" \"+f+\" \"+m}),i.ssrcs.push({id:s,attribute:\"cname\",value:p}),i.ssrcs.push({id:s,attribute:\"msid\",value:u+\" \"+t.id}),i.ssrcs.push({id:f,attribute:\"cname\",value:p}),i.ssrcs.push({id:f,attribute:\"msid\",value:u+\" \"+t.id}),i.ssrcs.push({id:m,attribute:\"cname\",value:p}),i.ssrcs.push({id:m,attribute:\"msid\",value:u+\" \"+t.id}),d){var h=d+1,v=d+2;i.ssrcGroups.push({semantics:\"FID\",ssrcs:s+\" \"+d}),i.ssrcs.push({id:d,attribute:\"cname\",value:p}),i.ssrcs.push({id:d,attribute:\"msid\",value:u+\" \"+t.id}),i.ssrcGroups.push({semantics:\"FID\",ssrcs:f+\" \"+h}),i.ssrcs.push({id:h,attribute:\"cname\",value:p}),i.ssrcs.push({id:h,attribute:\"msid\",value:u+\" \"+t.id}),i.ssrcGroups.push({semantics:\"FID\",ssrcs:m+\" \"+v}),i.ssrcs.push({id:v,attribute:\"cname\",value:p}),i.ssrcs.push({id:v,attribute:\"msid\",value:u+\" \"+t.id})}}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=f(r(40)),a=f(r(17)),i=f(r(2)),o=f(r(3)),s=f(r(4)),c=f(r(0)),u=f(r(1)),d=f(r(12)),l=f(r(5)),p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(9));function f(e){return e&&e.__esModule?e:{default:e}}var m=new l.default(\"<RemoteUnifiedPlanSdp>\"),h=function(){function e(t){(0,c.default)(this,e),this._rtpParametersByKind=t,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:p.randomNumber(),version:0}}return(0,u.default)(e,[{key:\"setTransportLocalParameters\",value:function(e){m.debug(\"setTransportLocalParameters() [transportLocalParameters:%o]\",e),this._transportLocalParameters=e}},{key:\"setTransportRemoteParameters\",value:function(e){m.debug(\"setTransportRemoteParameters() [transportRemoteParameters:%o]\",e),this._transportRemoteParameters=e}},{key:\"updateTransportRemoteIceParameters\",value:function(e){m.debug(\"updateTransportRemoteIceParameters() [remoteIceParameters:%o]\",e),this._transportRemoteParameters.iceParameters=e}}]),e}(),v=function(e){function t(e){return(0,c.default)(this,t),(0,o.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,u.default)(t,[{key:\"createAnswerSdp\",value:function(e){if(m.debug(\"createAnswerSdp()\"),!this._transportLocalParameters)throw new Error(\"no transport local parameters\");if(!this._transportRemoteParameters)throw new Error(\"no transport remote parameters\");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,i=this._transportRemoteParameters.dtlsParameters,o={},s=(e.media||[]).filter((function(e){return e.hasOwnProperty(\"mid\")})).map((function(e){return String(e.mid)}));this._sdpGlobalFields.version++,o.version=0,o.origin={address:\"0.0.0.0\",ipVer:4,netType:\"IN\",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:\"mediasoup-client\"},o.name=\"-\",o.timing={start:0,stop:0},o.icelite=t.iceLite?\"ice-lite\":null,o.msidSemantic={semantic:\"WMS\",token:\"*\"},s.length>0&&(o.groups=[{type:\"BUNDLE\",mids:s.join(\" \")}]),o.media=[];var c=i.fingerprints.length;o.fingerprint={type:i.fingerprints[c-1].algorithm,hash:i.fingerprints[c-1].value};var u=!0,l=!1,p=void 0;try{for(var f,h=(0,a.default)(e.media||[]);!(u=(f=h.next()).done);u=!0){var v=f.value,_=\"inactive\"===v.direction,g=v.type,y=this._rtpParametersByKind[g].codecs,b=this._rtpParametersByKind[g].headerExtensions,k={};k.type=v.type,k.port=7,k.protocol=\"RTP/SAVPF\",k.connection={ip:\"127.0.0.1\",version:4},k.mid=v.mid,k.iceUfrag=t.usernameFragment,k.icePwd=t.password,k.candidates=[];var w=!0,P=!1,S=void 0;try{for(var I,T=(0,a.default)(r);!(w=(I=T.next()).done);w=!0){var C=I.value,R={component:1};R.foundation=C.foundation,R.ip=C.ip,R.port=C.port,R.priority=C.priority,R.transport=C.protocol,R.type=C.type,C.tcpType&&(R.tcptype=C.tcpType),k.candidates.push(R)}}catch(e){P=!0,S=e}finally{try{!w&&T.return&&T.return()}finally{if(P)throw S}}switch(k.endOfCandidates=\"end-of-candidates\",k.iceOptions=\"renomination\",i.role){case\"client\":k.setup=\"active\";break;case\"server\":k.setup=\"passive\"}switch(v.direction){case\"sendrecv\":case\"sendonly\":k.direction=\"recvonly\";break;case\"recvonly\":case\"inactive\":k.direction=\"inactive\"}k.rtp=[],k.rtcpFb=[],k.fmtp=[];var x=!0,A=!1,E=void 0;try{for(var D,O=(0,a.default)(y);!(x=(D=O.next()).done);x=!0){var L=D.value,j={payload:L.payloadType,codec:L.name,rate:L.clockRate};if(L.channels>1&&(j.encoding=L.channels),k.rtp.push(j),L.parameters){var M={payload:L.payloadType,config:\"\"},B=!0,V=!1,N=void 0;try{for(var F,U=(0,a.default)((0,n.default)(L.parameters));!(B=(F=U.next()).done);B=!0){var G=F.value;M.config&&(M.config+=\";\"),M.config+=G+\"=\"+L.parameters[G]}}catch(e){V=!0,N=e}finally{try{!B&&U.return&&U.return()}finally{if(V)throw N}}M.config&&k.fmtp.push(M)}if(L.rtcpFeedback){var W=!0,K=!1,z=void 0;try{for(var q,H=(0,a.default)(L.rtcpFeedback);!(W=(q=H.next()).done);W=!0){var J=q.value;k.rtcpFb.push({payload:L.payloadType,type:J.type,subtype:J.parameter||\"\"})}}catch(e){K=!0,z=e}finally{try{!W&&H.return&&H.return()}finally{if(K)throw z}}}}}catch(e){A=!0,E=e}finally{try{!x&&O.return&&O.return()}finally{if(A)throw E}}if(k.payloads=y.map((function(e){return e.payloadType})).join(\" \"),!_){k.ext=[];var Q=!0,Y=!1,$=void 0;try{for(var X,Z=function(){var e=X.value;if(!(v.ext||[]).find((function(t){return t.uri===e.uri})))return\"continue\";k.ext.push({uri:e.uri,value:e.id})},ee=(0,a.default)(b);!(Q=(X=ee.next()).done);Q=!0)Z()}catch(e){Y=!0,$=e}finally{try{!Q&&ee.return&&ee.return()}finally{if(Y)throw $}}}if(v.simulcast){k.simulcast={dir1:\"recv\",list1:v.simulcast.list1},k.rids=[];var te=!0,re=!1,ne=void 0;try{for(var ae,ie=(0,a.default)(v.rids||[]);!(te=(ae=ie.next()).done);te=!0){var oe=ae.value;\"send\"===oe.direction&&k.rids.push({id:oe.id,direction:\"recv\"})}}catch(e){re=!0,ne=e}finally{try{!te&&ie.return&&ie.return()}finally{if(re)throw ne}}}else if(v.simulcast_03){k.simulcast_03={value:v.simulcast_03.value.replace(/send/g,\"recv\")},k.rids=[];var se=!0,ce=!1,ue=void 0;try{for(var de,le=(0,a.default)(v.rids||[]);!(se=(de=le.next()).done);se=!0){var pe=de.value;\"send\"===pe.direction&&k.rids.push({id:pe.id,direction:\"recv\"})}}catch(e){ce=!0,ue=e}finally{try{!se&&le.return&&le.return()}finally{if(ce)throw ue}}}k.rtcpMux=\"rtcp-mux\",k.rtcpRsize=\"rtcp-rsize\",o.media.push(k)}}catch(e){l=!0,p=e}finally{try{!u&&h.return&&h.return()}finally{if(l)throw p}}return d.default.write(o)}}]),t}(h),_=function(e){function t(e){return(0,c.default)(this,t),(0,o.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,u.default)(t,[{key:\"createOfferSdp\",value:function(e){if(m.debug(\"createOfferSdp()\"),!this._transportRemoteParameters)throw new Error(\"no transport remote parameters\");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,i=this._transportRemoteParameters.dtlsParameters,o={},s=e.map((function(e){return String(e.mid)}));this._sdpGlobalFields.version++,o.version=0,o.origin={address:\"0.0.0.0\",ipVer:4,netType:\"IN\",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:\"mediasoup-client\"},o.name=\"-\",o.timing={start:0,stop:0},o.icelite=t.iceLite?\"ice-lite\":null,o.msidSemantic={semantic:\"WMS\",token:\"*\"},s.length>0&&(o.groups=[{type:\"BUNDLE\",mids:s.join(\" \")}]),o.media=[];var c=i.fingerprints.length;o.fingerprint={type:i.fingerprints[c-1].algorithm,hash:i.fingerprints[c-1].value};var u=!0,l=!1,p=void 0;try{for(var f,h=(0,a.default)(e);!(u=(f=h.next()).done);u=!0){var v=f.value,_=v.closed,g=v.kind,y=void 0,b=void 0;\"application\"!==v.kind&&(y=this._rtpParametersByKind[g].codecs,b=this._rtpParametersByKind[g].headerExtensions);var k={};\"application\"!==v.kind?(k.type=g,k.port=7,k.protocol=\"RTP/SAVPF\",k.connection={ip:\"127.0.0.1\",version:4},k.mid=v.mid,k.msid=v.streamId+\" \"+v.trackId):(k.type=g,k.port=9,k.protocol=\"DTLS/SCTP\",k.connection={ip:\"127.0.0.1\",version:4},k.mid=v.mid),k.iceUfrag=t.usernameFragment,k.icePwd=t.password,k.candidates=[];var w=!0,P=!1,S=void 0;try{for(var I,T=(0,a.default)(r);!(w=(I=T.next()).done);w=!0){var C=I.value,R={component:1};R.foundation=C.foundation,R.ip=C.ip,R.port=C.port,R.priority=C.priority,R.transport=C.protocol,R.type=C.type,C.tcpType&&(R.tcptype=C.tcpType),k.candidates.push(R)}}catch(e){P=!0,S=e}finally{try{!w&&T.return&&T.return()}finally{if(P)throw S}}if(k.endOfCandidates=\"end-of-candidates\",k.iceOptions=\"renomination\",k.setup=\"actpass\",\"application\"!==v.kind){k.direction=_?\"inactive\":\"sendonly\",k.rtp=[],k.rtcpFb=[],k.fmtp=[];var x=!0,A=!1,E=void 0;try{for(var D,O=(0,a.default)(y);!(x=(D=O.next()).done);x=!0){var L=D.value,j={payload:L.payloadType,codec:L.name,rate:L.clockRate};if(L.channels>1&&(j.encoding=L.channels),k.rtp.push(j),L.parameters){var M={payload:L.payloadType,config:\"\"},B=!0,V=!1,N=void 0;try{for(var F,U=(0,a.default)((0,n.default)(L.parameters));!(B=(F=U.next()).done);B=!0){var G=F.value;M.config&&(M.config+=\";\"),M.config+=G+\"=\"+L.parameters[G]}}catch(e){V=!0,N=e}finally{try{!B&&U.return&&U.return()}finally{if(V)throw N}}M.config&&k.fmtp.push(M)}if(L.rtcpFeedback){var W=!0,K=!1,z=void 0;try{for(var q,H=(0,a.default)(L.rtcpFeedback);!(W=(q=H.next()).done);W=!0){var J=q.value;k.rtcpFb.push({payload:L.payloadType,type:J.type,subtype:J.parameter||\"\"})}}catch(e){K=!0,z=e}finally{try{!W&&H.return&&H.return()}finally{if(K)throw z}}}}}catch(e){A=!0,E=e}finally{try{!x&&O.return&&O.return()}finally{if(A)throw E}}if(k.payloads=y.map((function(e){return e.payloadType})).join(\" \"),!_){k.ext=[];var Q=!0,Y=!1,$=void 0;try{for(var X,Z=(0,a.default)(b);!(Q=(X=Z.next()).done);Q=!0){var ee=X.value;\"urn:ietf:params:rtp-hdrext:sdes:mid\"!==ee.uri&&k.ext.push({uri:ee.uri,value:ee.id})}}catch(e){Y=!0,$=e}finally{try{!Q&&Z.return&&Z.return()}finally{if(Y)throw $}}}k.rtcpMux=\"rtcp-mux\",k.rtcpRsize=\"rtcp-rsize\",_||(k.ssrcs=[],k.ssrcGroups=[],k.ssrcs.push({id:v.ssrc,attribute:\"cname\",value:v.cname}),v.rtxSsrc&&(k.ssrcs.push({id:v.rtxSsrc,attribute:\"cname\",value:v.cname}),k.ssrcGroups.push({semantics:\"FID\",ssrcs:v.ssrc+\" \"+v.rtxSsrc})))}else k.payloads=5e3,k.sctpmap={app:\"webrtc-datachannel\",maxMessageSize:256,sctpmapNumber:5e3};o.media.push(k)}}catch(e){l=!0,p=e}finally{try{!u&&h.return&&h.return()}finally{if(l)throw p}}return d.default.write(o)}}]),t}(h);t.default=function e(t,r){switch((0,c.default)(this,e),m.debug(\"constructor() [direction:%s, rtpParametersByKind:%o]\",t,r),t){case\"send\":return new v(r);case\"recv\":return new _(r)}}},function(e,t){e.exports={}},function(e,t,r){var n=r(70),a=r(62);e.exports=function(e){return n(a(e))}},function(e,t,r){r(133);for(var n=r(13),a=r(28),i=r(37),o=r(14)(\"toStringTag\"),s=\"CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList\".split(\",\"),c=0;c<s.length;c++){var u=s[c],d=n[u],l=d&&d.prototype;l&&!l[o]&&a(l,o,u),i[u]=i.Array}},function(e,t,r){e.exports={default:r(150),__esModule:!0}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=s(r(114)),a=s(r(17)),i=s(r(8)),o=s(r(19));function s(e){return e&&e.__esModule?e:{default:e}}t.fillRtpParametersForTrack=function(e,t,r){var s=r.kind,c={cname:null,reducedSize:!0,mux:!0},u=(t.media||[]).find((function(e){return e.type===s}));if(!u)throw new Error(\"m=\"+s+\" section not found\");var d=void 0,l=new o.default,p=!0,f=!1,m=void 0;try{for(var h,v=(0,a.default)(u.ssrcs||[]);!(p=(h=v.next()).done);p=!0){var _=h.value;if(\"msid\"===_.attribute)if(_.value.split(\" \")[1]===r.id){var g=_.id;l.add(g),d||(d=g)}}}catch(e){f=!0,m=e}finally{try{!p&&v.return&&v.return()}finally{if(f)throw m}}if(0===l.size)throw new Error(\"a=ssrc line not found for local track [track.id:\"+r.id+\"]\");var y=new i.default,b=!0,k=!1,w=void 0;try{for(var P,S=(0,a.default)(u.ssrcGroups||[]);!(b=(P=S.next()).done);b=!0){var I=P.value;if(\"FID\"===I.semantics){var T=I.ssrcs.split(/\\s+/),C=(0,n.default)(T,2),R=C[0],x=C[1];R=Number(R),x=Number(x),l.has(R)&&(l.delete(R),l.delete(x),y.set(R,x))}}}catch(e){k=!0,w=e}finally{try{!b&&S.return&&S.return()}finally{if(k)throw w}}var A=!0,E=!1,D=void 0;try{for(var O,L=(0,a.default)(l);!(A=(O=L.next()).done);A=!0){var j=O.value;y.set(j,null)}}catch(e){E=!0,D=e}finally{try{!A&&L.return&&L.return()}finally{if(E)throw D}}var M=u.ssrcs.find((function(e){return\"cname\"===e.attribute&&e.id===d}));M&&(c.cname=M.value);e.rtcp=c,e.encodings=[];var B=y.size>1,V=[\"low\",\"medium\",\"high\"],N=!0,F=!1,U=void 0;try{for(var G,W=(0,a.default)(y);!(N=(G=W.next()).done);N=!0){var K=(0,n.default)(G.value,2),z=K[0],q=(x=K[1],{ssrc:z});x&&(q.rtx={ssrc:x}),B&&(q.profile=V.shift()),e.encodings.push(q)}}catch(e){F=!0,U=e}finally{try{!N&&W.return&&W.return()}finally{if(F)throw U}}},t.addSimulcastForTrack=function(e,t){var r=t.kind,n=(e.media||[]).find((function(e){return e.type===r}));if(!n)throw new Error(\"m=\"+r+\" section not found\");var a=void 0,i=void 0,o=void 0;if(!(n.ssrcs||[]).find((function(e){return\"msid\"===e.attribute&&(e.value.split(\" \")[1]===t.id?(a=e.id,o=e.value.split(\" \")[0],!0):void 0)})))throw new Error(\"a=ssrc line not found for local track [track.id:\"+t.id+\"]\");(n.ssrcGroups||[]).some((function(e){if(\"FID\"===e.semantics){var t=e.ssrcs.split(/\\s+/);return Number(t[0])===a?(i=Number(t[1]),!0):void 0}}));var s=n.ssrcs.find((function(e){return\"cname\"===e.attribute&&e.id===a}));if(!s)throw new Error(\"CNAME line not found for local track [track.id:\"+t.id+\"]\");var c=s.value,u=a+1,d=a+2;if(n.ssrcGroups=n.ssrcGroups||[],n.ssrcGroups.push({semantics:\"SIM\",ssrcs:a+\" \"+u+\" \"+d}),n.ssrcs.push({id:u,attribute:\"cname\",value:c}),n.ssrcs.push({id:u,attribute:\"msid\",value:o+\" \"+t.id}),n.ssrcs.push({id:d,attribute:\"cname\",value:c}),n.ssrcs.push({id:d,attribute:\"msid\",value:o+\" \"+t.id}),i){var l=i+1,p=i+2;n.ssrcGroups.push({semantics:\"FID\",ssrcs:u+\" \"+l}),n.ssrcs.push({id:l,attribute:\"cname\",value:c}),n.ssrcs.push({id:l,attribute:\"msid\",value:o+\" \"+t.id}),n.ssrcGroups.push({semantics:\"FID\",ssrcs:d+\" \"+p}),n.ssrcs.push({id:p,attribute:\"cname\",value:c}),n.ssrcs.push({id:p,attribute:\"msid\",value:o+\" \"+t.id})}}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=f(r(40)),a=f(r(17)),i=f(r(2)),o=f(r(3)),s=f(r(4)),c=f(r(0)),u=f(r(1)),d=f(r(12)),l=f(r(5)),p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(9));function f(e){return e&&e.__esModule?e:{default:e}}var m=new l.default(\"<RemotePlanBSdp>\"),h=function(){function e(t){(0,c.default)(this,e),this._rtpParametersByKind=t,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:p.randomNumber(),version:0}}return(0,u.default)(e,[{key:\"setTransportLocalParameters\",value:function(e){m.debug(\"setTransportLocalParameters() [transportLocalParameters:%o]\",e),this._transportLocalParameters=e}},{key:\"setTransportRemoteParameters\",value:function(e){m.debug(\"setTransportRemoteParameters() [transportRemoteParameters:%o]\",e),this._transportRemoteParameters=e}},{key:\"updateTransportRemoteIceParameters\",value:function(e){m.debug(\"updateTransportRemoteIceParameters() [remoteIceParameters:%o]\",e),this._transportRemoteParameters.iceParameters=e}}]),e}(),v=function(e){function t(e){return(0,c.default)(this,t),(0,o.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,u.default)(t,[{key:\"createAnswerSdp\",value:function(e){if(m.debug(\"createAnswerSdp()\"),!this._transportLocalParameters)throw new Error(\"no transport local parameters\");if(!this._transportRemoteParameters)throw new Error(\"no transport remote parameters\");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,i=this._transportRemoteParameters.dtlsParameters,o={},s=(e.media||[]).map((function(e){return String(e.mid)}));this._sdpGlobalFields.version++,o.version=0,o.origin={address:\"0.0.0.0\",ipVer:4,netType:\"IN\",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:\"mediasoup-client\"},o.name=\"-\",o.timing={start:0,stop:0},o.icelite=t.iceLite?\"ice-lite\":null,o.msidSemantic={semantic:\"WMS\",token:\"*\"},o.groups=[{type:\"BUNDLE\",mids:s.join(\" \")}],o.media=[];var c=i.fingerprints.length;o.fingerprint={type:i.fingerprints[c-1].algorithm,hash:i.fingerprints[c-1].value};var u=!0,l=!1,p=void 0;try{for(var f,h=(0,a.default)(e.media||[]);!(u=(f=h.next()).done);u=!0){var v=f.value,_=v.type,g=this._rtpParametersByKind[_].codecs,y=this._rtpParametersByKind[_].headerExtensions,b={};b.type=v.type,b.port=7,b.protocol=\"RTP/SAVPF\",b.connection={ip:\"127.0.0.1\",version:4},b.mid=v.mid,b.iceUfrag=t.usernameFragment,b.icePwd=t.password,b.candidates=[];var k=!0,w=!1,P=void 0;try{for(var S,I=(0,a.default)(r);!(k=(S=I.next()).done);k=!0){var T=S.value,C={component:1};C.foundation=T.foundation,C.ip=T.ip,C.port=T.port,C.priority=T.priority,C.transport=T.protocol,C.type=T.type,T.tcpType&&(C.tcptype=T.tcpType),b.candidates.push(C)}}catch(e){w=!0,P=e}finally{try{!k&&I.return&&I.return()}finally{if(w)throw P}}switch(b.endOfCandidates=\"end-of-candidates\",b.iceOptions=\"renomination\",i.role){case\"client\":b.setup=\"active\";break;case\"server\":b.setup=\"passive\"}switch(v.direction){case\"sendrecv\":case\"sendonly\":b.direction=\"recvonly\";break;case\"recvonly\":case\"inactive\":b.direction=\"inactive\"}\"video\"===_&&(b.xGoogleFlag=\"conference\"),b.rtp=[],b.rtcpFb=[],b.fmtp=[];var R=!0,x=!1,A=void 0;try{for(var E,D=(0,a.default)(g);!(R=(E=D.next()).done);R=!0){var O=E.value,L={payload:O.payloadType,codec:O.name,rate:O.clockRate};if(O.channels>1&&(L.encoding=O.channels),b.rtp.push(L),O.parameters){var j={payload:O.payloadType,config:\"\"},M=!0,B=!1,V=void 0;try{for(var N,F=(0,a.default)((0,n.default)(O.parameters));!(M=(N=F.next()).done);M=!0){var U=N.value;j.config&&(j.config+=\";\"),j.config+=U+\"=\"+O.parameters[U]}}catch(e){B=!0,V=e}finally{try{!M&&F.return&&F.return()}finally{if(B)throw V}}j.config&&b.fmtp.push(j)}if(O.rtcpFeedback){var G=!0,W=!1,K=void 0;try{for(var z,q=(0,a.default)(O.rtcpFeedback);!(G=(z=q.next()).done);G=!0){var H=z.value;b.rtcpFb.push({payload:O.payloadType,type:H.type,subtype:H.parameter||\"\"})}}catch(e){W=!0,K=e}finally{try{!G&&q.return&&q.return()}finally{if(W)throw K}}}}}catch(e){x=!0,A=e}finally{try{!R&&D.return&&D.return()}finally{if(x)throw A}}b.payloads=g.map((function(e){return e.payloadType})).join(\" \"),b.ext=[];var J=!0,Q=!1,Y=void 0;try{for(var $,X=function(){var e=$.value;if(!(v.ext||[]).find((function(t){return t.uri===e.uri})))return\"continue\";b.ext.push({uri:e.uri,value:e.id})},Z=(0,a.default)(y);!(J=($=Z.next()).done);J=!0)X()}catch(e){Q=!0,Y=e}finally{try{!J&&Z.return&&Z.return()}finally{if(Q)throw Y}}b.rtcpMux=\"rtcp-mux\",b.rtcpRsize=\"rtcp-rsize\",o.media.push(b)}}catch(e){l=!0,p=e}finally{try{!u&&h.return&&h.return()}finally{if(l)throw p}}return d.default.write(o)}}]),t}(h),_=function(e){function t(e){return(0,c.default)(this,t),(0,o.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,u.default)(t,[{key:\"createOfferSdp\",value:function(e,t){var r=this;if(m.debug(\"createOfferSdp()\"),!this._transportRemoteParameters)throw new Error(\"no transport remote parameters\");var i=this._transportRemoteParameters.iceParameters,o=this._transportRemoteParameters.iceCandidates,s=this._transportRemoteParameters.dtlsParameters,c={},u=e;this._sdpGlobalFields.version++,c.version=0,c.origin={address:\"0.0.0.0\",ipVer:4,netType:\"IN\",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:\"mediasoup-client\"},c.name=\"-\",c.timing={start:0,stop:0},c.icelite=i.iceLite?\"ice-lite\":null,c.msidSemantic={semantic:\"WMS\",token:\"*\"},c.groups=[{type:\"BUNDLE\",mids:u.join(\" \")}],c.media=[];var l=s.fingerprints.length;c.fingerprint={type:s.fingerprints[l-1].algorithm,hash:s.fingerprints[l-1].value};var p=!0,f=!1,h=void 0;try{for(var v,_=function(){var e=v.value,s=r._rtpParametersByKind[e].codecs,u=r._rtpParametersByKind[e].headerExtensions,d={};d.type=e,d.port=7,d.protocol=\"RTP/SAVPF\",d.connection={ip:\"127.0.0.1\",version:4},d.mid=e,d.iceUfrag=i.usernameFragment,d.icePwd=i.password,d.candidates=[];var l=!0,p=!1,f=void 0;try{for(var m,h=(0,a.default)(o);!(l=(m=h.next()).done);l=!0){var _=m.value,g={component:1};g.foundation=_.foundation,g.ip=_.ip,g.port=_.port,g.priority=_.priority,g.transport=_.protocol,g.type=_.type,_.tcpType&&(g.tcptype=_.tcpType),d.candidates.push(g)}}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}d.endOfCandidates=\"end-of-candidates\",d.iceOptions=\"renomination\",d.setup=\"actpass\",t.some((function(t){return t.kind===e}))?d.direction=\"sendonly\":d.direction=\"inactive\",d.rtp=[],d.rtcpFb=[],d.fmtp=[];var y=!0,b=!1,k=void 0;try{for(var w,P=(0,a.default)(s);!(y=(w=P.next()).done);y=!0){var S=w.value,I={payload:S.payloadType,codec:S.name,rate:S.clockRate};if(S.channels>1&&(I.encoding=S.channels),d.rtp.push(I),S.parameters){var T={payload:S.payloadType,config:\"\"},C=!0,R=!1,x=void 0;try{for(var A,E=(0,a.default)((0,n.default)(S.parameters));!(C=(A=E.next()).done);C=!0){var D=A.value;T.config&&(T.config+=\";\"),T.config+=D+\"=\"+S.parameters[D]}}catch(e){R=!0,x=e}finally{try{!C&&E.return&&E.return()}finally{if(R)throw x}}T.config&&d.fmtp.push(T)}if(S.rtcpFeedback){var O=!0,L=!1,j=void 0;try{for(var M,B=(0,a.default)(S.rtcpFeedback);!(O=(M=B.next()).done);O=!0){var V=M.value;d.rtcpFb.push({payload:S.payloadType,type:V.type,subtype:V.parameter||\"\"})}}catch(e){L=!0,j=e}finally{try{!O&&B.return&&B.return()}finally{if(L)throw j}}}}}catch(e){b=!0,k=e}finally{try{!y&&P.return&&P.return()}finally{if(b)throw k}}d.payloads=s.map((function(e){return e.payloadType})).join(\" \"),d.ext=[];var N=!0,F=!1,U=void 0;try{for(var G,W=(0,a.default)(u);!(N=(G=W.next()).done);N=!0){var K=G.value;\"urn:ietf:params:rtp-hdrext:sdes:mid\"!==K.uri&&d.ext.push({uri:K.uri,value:K.id})}}catch(e){F=!0,U=e}finally{try{!N&&W.return&&W.return()}finally{if(F)throw U}}d.rtcpMux=\"rtcp-mux\",d.rtcpRsize=\"rtcp-rsize\",d.ssrcs=[],d.ssrcGroups=[];var z=!0,q=!1,H=void 0;try{for(var J,Q=(0,a.default)(t);!(z=(J=Q.next()).done);z=!0){var Y=J.value;Y.kind===e&&(d.ssrcs.push({id:Y.ssrc,attribute:\"msid\",value:Y.streamId+\" \"+Y.trackId}),d.ssrcs.push({id:Y.ssrc,attribute:\"mslabel\",value:Y.streamId}),d.ssrcs.push({id:Y.ssrc,attribute:\"label\",value:Y.trackId}),d.ssrcs.push({id:Y.ssrc,attribute:\"cname\",value:Y.cname}),Y.rtxSsrc&&(d.ssrcs.push({id:Y.rtxSsrc,attribute:\"msid\",value:Y.streamId+\" \"+Y.trackId}),d.ssrcs.push({id:Y.rtxSsrc,attribute:\"mslabel\",value:Y.streamId}),d.ssrcs.push({id:Y.rtxSsrc,attribute:\"label\",value:Y.trackId}),d.ssrcs.push({id:Y.rtxSsrc,attribute:\"cname\",value:Y.cname}),d.ssrcGroups.push({semantics:\"FID\",ssrcs:Y.ssrc+\" \"+Y.rtxSsrc})))}}catch(e){q=!0,H=e}finally{try{!z&&Q.return&&Q.return()}finally{if(q)throw H}}c.media.push(d)},g=(0,a.default)(e);!(p=(v=g.next()).done);p=!0)_()}catch(e){f=!0,h=e}finally{try{!p&&g.return&&g.return()}finally{if(f)throw h}}return d.default.write(c)}}]),t}(h);t.default=function e(t,r){switch((0,c.default)(this,e),m.debug(\"constructor() [direction:%s, rtpParametersByKind:%o]\",t,r),t){case\"send\":return new v(r);case\"recv\":return new _(r)}}},function(e,t){var r;r=function(){return this}();try{r=r||new Function(\"return this\")()}catch(e){\"object\"==typeof window&&(r=window)}e.exports=r},function(e,t){e.exports=!0},function(e,t){e.exports=function(e){if(\"function\"!=typeof e)throw TypeError(e+\" is not a function!\");return e}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){var n=r(85),a=r(71);e.exports=Object.keys||function(e){return n(e,a)}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,r){var n=r(21).f,a=r(32),i=r(14)(\"toStringTag\");e.exports=function(e,t,r){e&&!a(e=r?e:e.prototype,i)&&n(e,i,{configurable:!0,value:t})}},function(e,t,r){var n=r(27),a=r(91),i=r(92),o=r(25),s=r(55),c=r(76),u={},d={};(t=e.exports=function(e,t,r,l,p){var f,m,h,v,_=p?function(){return e}:c(e),g=n(r,l,t?2:1),y=0;if(\"function\"!=typeof _)throw TypeError(e+\" is not iterable!\");if(i(_)){for(f=s(e.length);f>y;y++)if((v=t?g(o(m=e[y])[0],m[1]):g(e[y]))===u||v===d)return v}else for(h=_.call(e);!(m=h.next()).done;)if((v=a(h,g,m.value,t))===u||v===d)return v}).BREAK=u,t.RETURN=d},function(e,t,r){\"use strict\";var n,a=r(8),i=(n=a)&&n.__esModule?n:{default:n};var o=new i.default([[1,{reason:\"success\"}],[2,{reason:\"auth lock dog - noresource\"}],[4,{reason:\"already in channel\"}],[5,{reason:\"param invalid\"}],[6,{reason:\"no server available\"}],[9,{reason:\"already login\"}],[10,{reason:\"overmax\"}],[11,{reason:\"audio timeout\"}],[12,{reason:\"video timeout\"}],[13,{reason:\"live not start\"}],[14,{reason:\"timeout\"}],[15,{reason:\"update user media message\"}],[16,{reason:\"no-chair\"}],[17,{reason:\"user non-exist\"}],[18,{reason:\"record error\"}],[19,{reason:\"audiomixer error\"}],[20,{reason:\"dboper error\"}],[21,{reason:\"chair password error\"}],[22,{reason:\"password error\"}],[23,{reason:\"no password\"}],[24,{reason:\"channel is not exist\"}],[25,{reason:\"invalid appid\"}],[26,{reason:\"rtmp connect\"}],[27,{reason:\"authentication\"}],[30,{reason:\"connect timeout\"}]]),s=new i.default([[\"80p\",{width:110,height:80,bps:{ideal:55e3,min:3e4,max:6e4}}],[\"120p\",{width:160,height:120,bps:{ideal:65e3,min:4e4,max:7e4}}],[\"160p\",{width:210,height:160,bps:{ideal:12e4,min:5e4,max:15e4}}],[\"200p\",{width:270,height:200,bps:{ideal:14e4,min:6e4,max:2e5}}],[\"240p\",{width:320,height:240,bps:{ideal:2e5,min:8e4,max:26e4}}],[\"320p\",{width:420,height:320,bps:{ideal:25e4,min:1e5,max:32e4}}],[\"360p\",{width:480,height:360,bps:{ideal:25e4,min:12e4,max:32e4}}],[\"480p\",{width:640,height:480,bps:{ideal:3e5,min:12e4,max:5e5}}],[\"540p\",{width:720,height:540,bps:{ideal:6e5,min:3e5,max:7e5}}],[\"720p\",{width:1280,height:720,bps:{ideal:113e4,min:5e5,max:14e5}}],[\"1080p\",{width:1920,height:1080,bps:{ideal:2e6,min:1e6,max:24e5}}],[\"3840p\",{width:3840,height:2160,bps:{ideal:8e6,min:7e6,max:15e6}}],[\"7680p\",{width:7680,height:4320,bps:{ideal:2e7,min:15e6,max:25e6}}]]),c=new i.default([[720,{width:1280,height:720,bps:{ideal:1e6,min:8e5,max:15e5}}],[1080,{width:1920,height:1080,bps:{ideal:18e5,min:15e5,max:2e6}}],[2160,{width:3840,height:2160,bps:{ideal:25e5,min:2e6,max:3e6}}],[4320,{width:7680,height:4320,bps:{ideal:3e6,min:25e5,max:4e6}}]]),u=new i.default([[\"isac32\",{codec:\"isac\",maxplaybackrate:32e3,stereo:0,maxaveragebitrate:40960}],[\"speech_low_quality\",{codec:\"opus\",maxplaybackrate:16e3,stereo:0,maxaveragebitrate:24576}],[\"speech_standard\",{codec:\"opus\",maxplaybackrate:32e3,stereo:0,maxaveragebitrate:24576}],[\"music_standard\",{codec:\"opus\",maxplaybackrate:48e3,stereo:0,maxaveragebitrate:40960}],[\"standard_stereo\",{codec:\"opus\",maxplaybackrate:48e3,stereo:1,maxaveragebitrate:65536}],[\"high_quality\",{codec:\"opus\",maxplaybackrate:48e3,stereo:0,maxaveragebitrate:131072}],[\"high_quality_stereo\",{codec:\"opus\",maxplaybackrate:48e3,stereo:1,maxaveragebitrate:196608}]]);e.exports={clientConfig:{mode:\"live\",codec:\"vp8\",proxyServer:\"YOUR NGINX PROXY SERVER IP\",turnServer:{turnServerURL:\"turn:114.116.84.241\",username:\"ttt\",password:\"123456\",udpport:\"THE UDP PORT YOU WANT TO ADD\",tcpport:\"THE TCP PORT YOU WANT TO ADD\",iceTransportPolicy:\"all\"},svcRootUrl:\"119_3_245_117.3ttech.cn\",role:\"2\",publish_rtmp_url:\"rtmp://push.3ttech.cn/sdk/?\",subcribe_rtmp_url:\"rtmp://pull.3ttech.cn/sdk/?\"},logLevel:{LOG_NONE:6,LOG_ERROR:5,LOG_WARN:4,LOG_INFO:3,LOG_DEBUG:2,LOG_TRACE:1},audioProfileSpec:u,videoProfile:{Profile_80p:\"80p\",Profile_120p:\"120p\",Profile_160p:\"160p\",Profile_200p:\"200p\",Profile_240p:\"240p\",Profile_320p:\"320p\",Profile_360p:\"360p\",Profile_480p:\"480p\",Profile_540p:\"540p\",Profile_720p:\"720p\",Profile_1080p:\"1080p\",Profile_3840p:\"3840p\",Profile_7680p:\"7680p\"},audioSpec:{sampleRate:{min:4e3,max:48e3,ideal:8e3},channelCount:{min:1,max:2,ideal:1}},videoSpec:{width:{min:80,ideal:640,max:1920},height:{min:60,ideal:480,max:1080},bitrate:{min:80,ideal:400,max:2e3},frameRate:{min:10,ideal:15,max:30},aspectRatio:4/3},mediaServerAddress:\"\",PUBLISH_STATE:{IDLE:0,PUBLISHING:1,PUBLISHED:2},tttErrMsg:o,logserver_url:\"https://logst.3ttech.cn:15200\",iplocationAddress:\"webdispatch.3ttech.cn\",iplocationPort:443,videoResolution:s,screenResolution:c,videoAttributes:{sif:[320,240],vga:[640,480],hd720p:[1280,720]},screenSpec:{s_frameRate:15,s_720p:{maxWidth:1280,maxHeight:720,maxAspectRatio:1.77},s_1080p:{maxWidth:1920,maxHeight:1080,maxAspectRatio:1.77},s_2k:{maxWidth:2048,maxHeight:1080,maxAspectRatio:1.77},s_4k:{maxWidth:3840,maxHeight:2160,maxAspectRatio:1.77},s_8k:{maxWidth:7680,maxHeight:4320,maxAspectRatio:1.77}}}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.UnsupportedError=t.TimeoutError=t.InvalidStateError=void 0;var n=s(r(2)),a=s(r(0)),i=s(r(3)),o=s(r(4));function s(e){return e&&e.__esModule?e:{default:e}}t.InvalidStateError=function(e){function t(e){(0,a.default)(this,t);var r=(0,i.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e));return r.name=\"InvalidStateError\",Error.hasOwnProperty(\"captureStackTrace\")?Error.captureStackTrace(r,t):r.stack=new Error(e).stack,r}return(0,o.default)(t,e),t}(Error),t.TimeoutError=function(e){function t(e){(0,a.default)(this,t);var r=(0,i.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e));return r.name=\"TimeoutError\",Error.hasOwnProperty(\"captureStackTrace\")?Error.captureStackTrace(r,t):r.stack=new Error(e).stack,r}return(0,o.default)(t,e),t}(Error),t.UnsupportedError=function(e){function t(e,r){(0,a.default)(this,t);var o=(0,i.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e));return o.name=\"UnsupportedError\",Error.hasOwnProperty(\"captureStackTrace\")?Error.captureStackTrace(o,t):o.stack=new Error(e).stack,o.data=r,o}return(0,o.default)(t,e),t}(Error)},function(e,t){var r=0,n=Math.random();e.exports=function(e){return\"Symbol(\".concat(void 0===e?\"\":e,\")_\",(++r+n).toString(36))}},function(e,t,r){var n=r(25),a=r(130),i=r(71),o=r(63)(\"IE_PROTO\"),s=function(){},c=function(){var e,t=r(66)(\"iframe\"),n=i.length;for(t.style.display=\"none\",r(86).appendChild(t),t.src=\"javascript:\",(e=t.contentWindow.document).open(),e.write(\"<script>document.F=Object<\\/script>\"),e.close(),c=e.F;n--;)delete c.prototype[i[n]];return c()};e.exports=Object.create||function(e,t){var r;return null!==e?(s.prototype=n(e),r=new s,s.prototype=null,r[o]=e):r=c(),void 0===t?r:a(r,t)}},function(e,t,r){var n=r(68),a=Math.min;e.exports=function(e){return e>0?a(n(e),9007199254740991):0}},function(e,t,r){var n=r(53)(\"meta\"),a=r(18),i=r(32),o=r(21).f,s=0,c=Object.isExtensible||function(){return!0},u=!r(33)((function(){return c(Object.preventExtensions({}))})),d=function(e){o(e,n,{value:{i:\"O\"+ ++s,w:{}}})},l=e.exports={KEY:n,NEED:!1,fastKey:function(e,t){if(!a(e))return\"symbol\"==typeof e?e:(\"string\"==typeof e?\"S\":\"P\")+e;if(!i(e,n)){if(!c(e))return\"F\";if(!t)return\"E\";d(e)}return e[n].i},getWeak:function(e,t){if(!i(e,n)){if(!c(e))return!0;if(!t)return!1;d(e)}return e[n].w},onFreeze:function(e){return u&&l.NEED&&c(e)&&!i(e,n)&&d(e),e}}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t){},function(e,t,r){var n=r(48),a=r(14)(\"toStringTag\"),i=\"Arguments\"==n(function(){return arguments}());e.exports=function(e){var t,r,o;return void 0===e?\"Undefined\":null===e?\"Null\":\"string\"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),a))?r:i?n(t):\"Object\"==(o=n(t))&&\"function\"==typeof t.callee?\"Arguments\":o}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n,a=r(26),i=(n=a)&&n.__esModule?n:{default:n};t.getProtooUrl=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:\"\",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:\"\",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3443,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:\"\",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:\"isac32\",s=\"\";s=\"\"===i.length?\"wss://\"+n+\":\"+a+\"/?peerName=\"+e+\"&roomId=\"+t+\"_\"+r+\"&audioPt=\"+o:\"wss://\"+n+\":\"+a+i+\"/?peerName=\"+e+\"&roomId=\"+t+\"_\"+r+\"&audioPt=\"+o;return s},t.uuid=function(){for(var e=[],t=0;t<36;t++)e[t]=\"0123456789abcdef\".substr(Math.floor(16*Math.random()),1);return e[14]=\"4\",e[19]=\"0123456789abcdef\".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]=\"-\",e.join(\"\")},t.clone=function e(t){if(null==t||\"object\"!==(void 0===t?\"undefined\":(0,i.default)(t)))return t;if(t instanceof Date){var r=new Date;return r.setTime(t.getTime()),r}if(t instanceof Array){for(var n=[],a=t.length,o=0;o<a;++o)n[o]=e(t[o]);return n}if(t instanceof Object){var s={};for(var c in t)t.hasOwnProperty(c)&&(s[c]=e(t[c]));return s}throw new Error(\"Unable to copy obj! Its type isn't supported.\")}},function(e,t,r){e.exports={default:r(201),__esModule:!0}},function(e,t){e.exports=function(e){if(null==e)throw TypeError(\"Can't call method on  \"+e);return e}},function(e,t,r){var n=r(64)(\"keys\"),a=r(53);e.exports=function(e){return n[e]||(n[e]=a(e))}},function(e,t,r){var n=r(7),a=r(13),i=a[\"__core-js_shared__\"]||(a[\"__core-js_shared__\"]={});(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})(\"versions\",[]).push({version:n.version,mode:r(44)?\"pure\":\"global\",copyright:\" 2019 Denis Pushkarev (zloirock.ru)\"})},function(e,t,r){var n=r(11),a=r(7),i=r(33);e.exports=function(e,t){var r=(a.Object||{})[e]||Object[e],o={};o[e]=t(r),n(n.S+n.F*i((function(){r(1)})),\"Object\",o)}},function(e,t,r){var n=r(18),a=r(13).document,i=n(a)&&n(a.createElement);e.exports=function(e){return i?a.createElement(e):{}}},function(e,t,r){var n=r(18);e.exports=function(e,t){if(!n(e))return e;var r,a;if(t&&\"function\"==typeof(r=e.toString)&&!n(a=r.call(e)))return a;if(\"function\"==typeof(r=e.valueOf)&&!n(a=r.call(e)))return a;if(!t&&\"function\"==typeof(r=e.toString)&&!n(a=r.call(e)))return a;throw TypeError(\"Can't convert object to primitive value\")}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:r)(e)}},function(e,t,r){\"use strict\";var n=r(44),a=r(11),i=r(84),o=r(28),s=r(37),c=r(129),u=r(49),d=r(82),l=r(14)(\"iterator\"),p=!([].keys&&\"next\"in[].keys()),f=function(){return this};e.exports=function(e,t,r,m,h,v,_){c(r,t,m);var g,y,b,k=function(e){if(!p&&e in I)return I[e];switch(e){case\"keys\":case\"values\":return function(){return new r(this,e)}}return function(){return new r(this,e)}},w=t+\" Iterator\",P=\"values\"==h,S=!1,I=e.prototype,T=I[l]||I[\"@@iterator\"]||h&&I[h],C=T||k(h),R=h?P?k(\"entries\"):C:void 0,x=\"Array\"==t&&I.entries||T;if(x&&(b=d(x.call(new e)))!==Object.prototype&&b.next&&(u(b,w,!0),n||\"function\"==typeof b[l]||o(b,l,f)),P&&T&&\"values\"!==T.name&&(S=!0,C=function(){return T.call(this)}),n&&!_||!p&&!S&&I[l]||o(I,l,C),s[t]=C,s[w]=f,h)if(g={values:P?C:k(\"values\"),keys:v?C:k(\"keys\"),entries:R},_)for(y in g)y in I||i(I,y,g[y]);else a(a.P+a.F*(p||S),t,g);return g}},function(e,t,r){var n=r(48);e.exports=Object(\"z\").propertyIsEnumerable(0)?Object:function(e){return\"String\"==n(e)?e.split(\"\"):Object(e)}},function(e,t){e.exports=\"constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf\".split(\",\")},function(e,t,r){t.f=r(14)},function(e,t,r){var n=r(13),a=r(7),i=r(44),o=r(72),s=r(21).f;e.exports=function(e){var t=a.Symbol||(a.Symbol=i?{}:n.Symbol||{});\"_\"==e.charAt(0)||e in t||s(t,e,{value:o.f(e)})}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t){e.exports=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+\": incorrect invocation!\");return e}},function(e,t,r){var n=r(59),a=r(14)(\"iterator\"),i=r(37);e.exports=r(7).getIteratorMethod=function(e){if(null!=e)return e[a]||e[\"@@iterator\"]||i[n(e)]}},function(e,t,r){\"use strict\";var n=r(45);function a(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError(\"Bad Promise constructor\");t=e,r=n})),this.resolve=n(t),this.reject=n(r)}e.exports.f=function(e){return new a(e)}},function(e,t,r){var n=r(28);e.exports=function(e,t,r){for(var a in t)r&&e[a]?e[a]=t[a]:n(e,a,t[a]);return e}},function(e,t,r){var n=r(18);e.exports=function(e,t){if(!n(e)||e._t!==t)throw TypeError(\"Incompatible receiver, \"+t+\" required!\");return e}},function(e,t,r){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0});var n=g(r(0)),a=g(r(1)),i=g(r(110)),o=g(r(5)),s=g(r(180)),c=g(r(194)),u=g(r(195)),d=g(r(196)),l=(g(r(197)),g(r(198))),p=g(r(199)),f=g(r(200)),m=g(r(204)),h=g(r(205)),v=g(r(206)),_=g(r(208));function g(e){return e&&e.__esModule?e:{default:e}}var y=new o.default(\"Device\"),b=function(){function t(){(0,n.default)(this,t)}return(0,a.default)(t,null,[{key:\"setHandler\",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t._detected=!0,t._handlerClass=e,t._flag=r.flag,t._name=r.name,t._version=r.version,t._bowser=r.bowser||{}}},{key:\"getFlag\",value:function(){return t._detected||t._detect(),t._flag}},{key:\"getName\",value:function(){return t._detected||t._detect(),t._name}},{key:\"getVersion\",value:function(){return t._detected||t._detect(),t._version}},{key:\"getBowser\",value:function(){return t._detected||t._detect(),t._bowser}},{key:\"isSupported\",value:function(){return t._detected||t._detect(),Boolean(t._handlerClass)}},{key:\"_detect\",value:function(){if(t._detected=!0,e.navigator&&\"ReactNative\"===e.navigator.product)t._flag=\"react-native\",t._name=\"ReactNative\",t._version=void 0,t._bowser={},t._handlerClass=_.default;else if(e.navigator&&\"string\"==typeof e.navigator.userAgent){var r=e.navigator.userAgent,n=i.default.detect(r);if(t._flag=void 0,t._name=n.name||void 0,t._version=n.version||void 0,t._bowser=n,t._handlerClass=null,i.default.check({chrome:\"70\",chromium:\"70\"},!0,r))t._flag=\"chrome\",t._handlerClass=s.default;else if(i.default.check({chrome:\"69\",chromium:\"69\"},!0,r))t._flag=\"chrome\",t._handlerClass=c.default;else if(i.default.check({chrome:\"67\",chromium:\"67\"},!0,r))t._flag=\"chrome\",t._handlerClass=u.default;else if(i.default.check({chrome:\"55\",chromium:\"55\"},!0,r))t._flag=\"chrome\",t._handlerClass=d.default;else if(i.default.check({chrome:\"49\",chromium:\"49\"},!0,r)&&e.adapter)t._flag=\"chrome\",t._handlerClass=d.default;else if(i.default.check({firefox:\"65\"},!0,r))t._flag=\"firefox\",t._handlerClass=f.default;else if(i.default.check({firefox:\"59\"},!0,r))t._flag=\"firefox\",t._handlerClass=m.default;else if(i.default.check({firefox:\"50\"},!0,r))t._flag=\"firefox\",t._handlerClass=h.default;else if(i.default.check({safari:\"12.1\"},!0,r)&&\"undefined\"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty(\"currentDirection\"))t._flag=\"safari\",t._handlerClass=l.default;else if(i.default.check({safari:\"11\"},!0,r))t._flag=\"safari\",t._handlerClass=p.default;else if(i.default.check({msedge:\"11\"},!0,r))t._flag=\"msedge\",t._handlerClass=v.default;else if(i.default.check({opera:\"57\"},!0,r))t._flag=\"opera\",t._handlerClass=s.default;else if(i.default.check({opera:\"44\"},!0,r))t._flag=\"opera\",t._handlerClass=d.default;else if(n.chromium||n.blink||n.webkit){y.debug('best effort Chrome based browser detection [name:\"%s\"]',n.name),t._flag=\"chrome\";var a=r.match(/(?:(?:Chrome|Chromium))[ /](\\w+)/i);if(a){var o=Number(a[1]);t._handlerClass=o>=70?s.default:o>=69?c.default:o>=67?u.default:d.default}else t._handlerClass=s.default}t.isSupported()?y.debug('browser supported [flag:%s, name:\"%s\", version:%s, handler:%s]',t._flag,t._name,t._version,t._handlerClass.tag):y.warn(\"browser not supported [name:%s, version:%s]\",t._name,t._version)}else y.warn(\"device not supported\")}},{key:\"Handler\",get:function(){return t._detected||t._detect(),t._handlerClass}}]),t}();t.default=b,b._detected=!1,b._flag=void 0,b._name=void 0,b._version=void 0,b._bowser=void 0,b._handlerClass=null}).call(this,r(43))},function(e,t,r){\"use strict\";t.__esModule=!0;var n,a=r(61),i=(n=a)&&n.__esModule?n:{default:n};t.default=i.default||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}},function(e,t,r){var n=r(32),a=r(31),i=r(63)(\"IE_PROTO\"),o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=a(e),n(e,i)?e[i]:\"function\"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},function(e,t,r){e.exports=!r(22)&&!r(33)((function(){return 7!=Object.defineProperty(r(66)(\"div\"),\"a\",{get:function(){return 7}}).a}))},function(e,t,r){e.exports=r(28)},function(e,t,r){var n=r(32),a=r(38),i=r(131)(!1),o=r(63)(\"IE_PROTO\");e.exports=function(e,t){var r,s=a(e),c=0,u=[];for(r in s)r!=o&&n(s,r)&&u.push(r);for(;t.length>c;)n(s,r=t[c++])&&(~i(u,r)||u.push(r));return u}},function(e,t,r){var n=r(13).document;e.exports=n&&n.documentElement},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,r){var n=r(48);e.exports=Array.isArray||function(e){return\"Array\"==n(e)}},function(e,t,r){var n=r(85),a=r(71).concat(\"length\",\"prototype\");t.f=Object.getOwnPropertyNames||function(e){return n(e,a)}},function(e,t,r){var n=r(57),a=r(46),i=r(38),o=r(67),s=r(32),c=r(83),u=Object.getOwnPropertyDescriptor;t.f=r(22)?u:function(e,t){if(e=i(e),t=o(t,!0),c)try{return u(e,t)}catch(e){}if(s(e,t))return a(!n.f.call(e,t),e[t])}},function(e,t,r){var n=r(25);e.exports=function(e,t,r,a){try{return a?t(n(r)[0],r[1]):t(r)}catch(t){var i=e.return;throw void 0!==i&&n(i.call(e)),t}}},function(e,t,r){var n=r(37),a=r(14)(\"iterator\"),i=Array.prototype;e.exports=function(e){return void 0!==e&&(n.Array===e||i[a]===e)}},function(e,t,r){var n=r(25),a=r(45),i=r(14)(\"species\");e.exports=function(e,t){var r,o=n(e).constructor;return void 0===o||null==(r=n(o)[i])?t:a(r)}},function(e,t,r){var n,a,i,o=r(27),s=r(154),c=r(86),u=r(66),d=r(13),l=d.process,p=d.setImmediate,f=d.clearImmediate,m=d.MessageChannel,h=d.Dispatch,v=0,_={},g=function(){var e=+this;if(_.hasOwnProperty(e)){var t=_[e];delete _[e],t()}},y=function(e){g.call(e.data)};p&&f||(p=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return _[++v]=function(){s(\"function\"==typeof e?e:Function(e),t)},n(v),v},f=function(e){delete _[e]},\"process\"==r(48)(l)?n=function(e){l.nextTick(o(g,e,1))}:h&&h.now?n=function(e){h.now(o(g,e,1))}:m?(i=(a=new m).port2,a.port1.onmessage=y,n=o(i.postMessage,i,1)):d.addEventListener&&\"function\"==typeof postMessage&&!d.importScripts?(n=function(e){d.postMessage(e+\"\",\"*\")},d.addEventListener(\"message\",y,!1)):n=\"onreadystatechange\"in u(\"script\")?function(e){c.appendChild(u(\"script\")).onreadystatechange=function(){c.removeChild(this),g.call(e)}}:function(e){setTimeout(o(g,e,1),0)}),e.exports={set:p,clear:f}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,r){var n=r(25),a=r(18),i=r(77);e.exports=function(e,t){if(n(e),a(t)&&t.constructor===e)return t;var r=i.f(e);return(0,r.resolve)(t),r.promise}},function(e,t,r){\"use strict\";var n=r(13),a=r(7),i=r(21),o=r(22),s=r(14)(\"species\");e.exports=function(e){var t=\"function\"==typeof a[e]?a[e]:n[e];o&&t&&!t[s]&&i.f(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,r){var n=r(14)(\"iterator\"),a=!1;try{var i=[7][n]();i.return=function(){a=!0},Array.from(i,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!a)return!1;var r=!1;try{var i=[7],o=i[n]();o.next=function(){return{done:r=!0}},i[n]=function(){return o},e(i)}catch(e){}return r}},function(e,t,r){e.exports=r(159)},function(e,t,r){\"use strict\";t.__esModule=!0;var n,a=r(6),i=(n=a)&&n.__esModule?n:{default:n};t.default=function(e){return function(){var t=e.apply(this,arguments);return new i.default((function(e,r){return function n(a,o){try{var s=t[a](o),c=s.value}catch(e){return void r(e)}if(!s.done)return i.default.resolve(c).then((function(e){n(\"next\",e)}),(function(e){n(\"throw\",e)}));e(c)}(\"next\")}))}}},function(e,t,r){\"use strict\";var n=r(21).f,a=r(54),i=r(78),o=r(27),s=r(75),c=r(50),u=r(69),d=r(87),l=r(97),p=r(22),f=r(56).fastKey,m=r(79),h=p?\"_s\":\"size\",v=function(e,t){var r,n=f(t);if(\"F\"!==n)return e._i[n];for(r=e._f;r;r=r.n)if(r.k==t)return r};e.exports={getConstructor:function(e,t,r,u){var d=e((function(e,n){s(e,d,t,\"_i\"),e._t=t,e._i=a(null),e._f=void 0,e._l=void 0,e[h]=0,null!=n&&c(n,r,e[u],e)}));return i(d.prototype,{clear:function(){for(var e=m(this,t),r=e._i,n=e._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete r[n.i];e._f=e._l=void 0,e[h]=0},delete:function(e){var r=m(this,t),n=v(r,e);if(n){var a=n.n,i=n.p;delete r._i[n.i],n.r=!0,i&&(i.n=a),a&&(a.p=i),r._f==n&&(r._f=a),r._l==n&&(r._l=i),r[h]--}return!!n},forEach:function(e){m(this,t);for(var r,n=o(e,arguments.length>1?arguments[1]:void 0,3);r=r?r.n:this._f;)for(n(r.v,r.k,this);r&&r.r;)r=r.p},has:function(e){return!!v(m(this,t),e)}}),p&&n(d.prototype,\"size\",{get:function(){return m(this,t)[h]}}),d},def:function(e,t,r){var n,a,i=v(e,t);return i?i.v=r:(e._l=i={i:a=f(t,!0),k:t,v:r,p:n=e._l,n:void 0,r:!1},e._f||(e._f=i),n&&(n.n=i),e[h]++,\"F\"!==a&&(e._i[a]=i)),e},getEntry:v,setStrong:function(e,t,r){u(e,t,(function(e,r){this._t=m(e,t),this._k=r,this._l=void 0}),(function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?d(0,\"keys\"==e?t.k:\"values\"==e?t.v:[t.k,t.v]):(this._t=void 0,d(1))}),r?\"entries\":\"values\",!r,!0),l(t)}}},function(e,t,r){\"use strict\";var n=r(13),a=r(11),i=r(56),o=r(33),s=r(28),c=r(78),u=r(50),d=r(75),l=r(18),p=r(49),f=r(21).f,m=r(165)(0),h=r(22);e.exports=function(e,t,r,v,_,g){var y=n[e],b=y,k=_?\"set\":\"add\",w=b&&b.prototype,P={};return h&&\"function\"==typeof b&&(g||w.forEach&&!o((function(){(new b).entries().next()})))?(b=t((function(t,r){d(t,b,e,\"_c\"),t._c=new y,null!=r&&u(r,_,t[k],t)})),m(\"add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON\".split(\",\"),(function(e){var t=\"add\"==e||\"set\"==e;e in w&&(!g||\"clear\"!=e)&&s(b.prototype,e,(function(r,n){if(d(this,b,e),!t&&g&&!l(r))return\"get\"==e&&void 0;var a=this._c[e](0===r?0:r,n);return t?this:a}))})),g||f(b.prototype,\"size\",{get:function(){return this._c.size}})):(b=v.getConstructor(t,e,_,k),c(b.prototype,r),i.NEED=!0),p(b,e),P[e]=b,a(a.G+a.W+a.F,P),g||v.setStrong(b,e,_),b}},function(e,t,r){var n=r(59),a=r(169);e.exports=function(e){return function(){if(n(this)!=e)throw TypeError(e+\"#toJSON isn't generic\");return a(this)}}},function(e,t,r){\"use strict\";var n=r(11);e.exports=function(e){n(n.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},function(e,t,r){\"use strict\";var n=r(11),a=r(45),i=r(27),o=r(50);e.exports=function(e){n(n.S,e,{from:function(e){var t,r,n,s,c=arguments[1];return a(this),(t=void 0!==c)&&a(c),null==e?new this:(r=[],t?(n=0,s=i(c,arguments[2],2),o(e,!1,(function(e){r.push(s(e,n++))}))):o(e,!1,r.push,r),new this(r))}})}},function(e,t,r){(function(n){t.log=function(...e){return\"object\"==typeof console&&console.log&&console.log(...e)},t.formatArgs=function(t){if(t[0]=(this.useColors?\"%c\":\"\")+this.namespace+(this.useColors?\" %c\":\" \")+t[0]+(this.useColors?\"%c \":\" \")+\"+\"+e.exports.humanize(this.diff),!this.useColors)return;const r=\"color: \"+this.color;t.splice(1,0,r,\"color: inherit\");let n=0,a=0;t[0].replace(/%[a-zA-Z%]/g,e=>{\"%%\"!==e&&(n++,\"%c\"===e&&(a=n))}),t.splice(a,0,r)},t.save=function(e){try{e?t.storage.setItem(\"debug\",e):t.storage.removeItem(\"debug\")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem(\"debug\")}catch(e){}!e&&void 0!==n&&\"env\"in n&&(e=n.env.DEBUG);return e},t.useColors=function(){if(\"undefined\"!=typeof window&&window.process&&(\"renderer\"===window.process.type||window.process.__nwjs))return!0;if(\"undefined\"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\\/(\\d+)/))return!1;return\"undefined\"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||\"undefined\"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||\"undefined\"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/)&&parseInt(RegExp.$1,10)>=31||\"undefined\"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=[\"#0000CC\",\"#0000FF\",\"#0033CC\",\"#0033FF\",\"#0066CC\",\"#0066FF\",\"#0099CC\",\"#0099FF\",\"#00CC00\",\"#00CC33\",\"#00CC66\",\"#00CC99\",\"#00CCCC\",\"#00CCFF\",\"#3300CC\",\"#3300FF\",\"#3333CC\",\"#3333FF\",\"#3366CC\",\"#3366FF\",\"#3399CC\",\"#3399FF\",\"#33CC00\",\"#33CC33\",\"#33CC66\",\"#33CC99\",\"#33CCCC\",\"#33CCFF\",\"#6600CC\",\"#6600FF\",\"#6633CC\",\"#6633FF\",\"#66CC00\",\"#66CC33\",\"#9900CC\",\"#9900FF\",\"#9933CC\",\"#9933FF\",\"#99CC00\",\"#99CC33\",\"#CC0000\",\"#CC0033\",\"#CC0066\",\"#CC0099\",\"#CC00CC\",\"#CC00FF\",\"#CC3300\",\"#CC3333\",\"#CC3366\",\"#CC3399\",\"#CC33CC\",\"#CC33FF\",\"#CC6600\",\"#CC6633\",\"#CC9900\",\"#CC9933\",\"#CCCC00\",\"#CCCC33\",\"#FF0000\",\"#FF0033\",\"#FF0066\",\"#FF0099\",\"#FF00CC\",\"#FF00FF\",\"#FF3300\",\"#FF3333\",\"#FF3366\",\"#FF3399\",\"#FF33CC\",\"#FF33FF\",\"#FF6600\",\"#FF6633\",\"#FF9900\",\"#FF9933\",\"#FFCC00\",\"#FFCC33\"],e.exports=r(173)(t);const{formatters:a}=e.exports;a.j=function(e){try{return JSON.stringify(e)}catch(e){return\"[UnexpectedJSONParseError]: \"+e.message}}}).call(this,r(172))},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=m(r(24)),a=m(r(2)),i=m(r(0)),o=m(r(1)),s=m(r(3)),c=m(r(4)),u=r(29),d=f(r(60)),l=m(r(30)),p=f(r(51));function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function m(e){return e&&e.__esModule?e:{default:e}}var h=new l.default(\"<IPLocation>\"),v=null,_=p.iplocationPort,g=p.mediaServerAddress,y=!1,b=r(108),k=b.operation({retries:4,factor:2,minTimeout:1e3,maxTimeout:2e3,randomize:!0}),w=function(e){function t(e,r,n,o){(0,i.default)(this,t);var c=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).call(this)),u=\"\";return\"\"===(u=t.privateCloud?v?v.trim():\"\":p.iplocationAddress.trim())?(o(\"INVALID iplocation address - need set IplocationAddress\"),(0,s.default)(c)):(c.appId=e,c.connectId=d.uuid(),c._url=\"wss://\"+u+\":\"+_+\"/iplocation/\",h.debug(\"constructor: \"+c._url),c._wsjson={eType:1,sSEQID:\"111111111\",mProtocolMsg:{sVersion:\"Test_4.2.0.777\",bLoadBalance:!1,bReConnect:!1,bVipUser:!1,sIDentify:\"7B4FCDBC0914E7182B8EC357F07498F1\",sSecret:\"c052cd055acfabc5\",sVerifyCode:\"abcd\",sAppID:e,nUserID:+r,sClientVer:\"web_1.0\",sConnectID:c.connectId,mIpAddrMsg:{bFec:!1,sIp:u,nPort:0}}},c._ws=null,c._closed=!1,c._successcb=n,c._failcb=o,c.reconnectTimes=1,c.firstConnectTime=Date.now(),c.connectedTime=0,c._hasSolve=!1,c._sendRetry={retry:5,timer:0},c._setWebSocket(),c)}return(0,c.default)(t,e),(0,o.default)(t,[{key:\"getIpLocationVar\",value:function(){return this.svcHost}},{key:\"close\",value:function(){this._closed=!0,null!==this._ws&&(this._ws.close(),this._ws=null)}},{key:\"_setWebSocket\",value:function(){var e=this,t=b.operation(k),r=!1;t.attempt((function(a){e._closed?t.stop():(h.debug(\"_setWebSocket() connecting... [currentAttempt: \"+a),e._ws=new WebSocket(e._url),e._ws.onopen=function(){e._closed||(r=!0,e.connectedTime=Date.now(),e._ws.send((0,n.default)(e._wsjson)),e._sendRetry.timer=setInterval((function(){e._hasSolve||(0===e._sendRetry.retry&&(e._ws.close(),t.retry(!0),clearInterval(e._sendRetry.timer)),e._ws.send((0,n.default)(e._wsjson)),--e._sendRetry.retry)}),500),h.debug(\"WebSocket event [open]\"))},e._ws.onclose=function(a){if(!e._closed)if(h.warn(\"WebSocket event [close] -- \"+(0,n.default)(a)),4e3===a.code)e._closed=!0;else{if(r){if(t.stop(),e._closed)return;return void e._setWebSocket()}if(e._closed)return;t.retry(!0)&&++e.reconnectTimes}},e._ws.onerror=function(t){e._closed||h.error(\"WebSocket event [error] - error \"+t.toString()+\" - nothing todo.\")},e._ws.onmessage=function(t){if(!e._closed){var r=JSON.parse(t.data);if(1!==r.eResult){var n=p.tttErrMsg.get(r.eResult);return e._failcb(\"msg.eResult: \"+r.eResult+\" - \"+n.reason),void e.close()}var a=r.mProtocolMsg.mIpAddrMsg;e.svcHost={ip:a.sIp,domain:a.sDomain,port:a.nPort},\"\"!==g&&(e.svcHost={ip:a.sIp,domain:g,port:a.nPort}),e._sendRetry.timer&&(clearInterval(e._sendRetry.timer),e._sendRetry.timer=0),e._hasSolve=!0,e._successcb(e.svcHost,r.mProtocolMsg.mGWIpAddrMsgList),e.close()}})}))}},{key:\"privateCloud\",get:function(){return y},set:function(e){y=Boolean(e)}}],[{key:\"IplocationAddress\",set:function(e){h.debug(\"set IplocationAddress: \"+e),v=e},get:function(){return v}},{key:\"IplocationPort\",set:function(e){h.debug(\"set IplocationPort: \"+e),/^[1-9][0-9]{2,4}$/.test(e)&&(_=e)},get:function(){return _}},{key:\"MediaServerAddress\",set:function(e){g=e},get:function(){return g}}]),t}(u.EventEmitter);t.default=w},function(e,t,r){e.exports=r(175)},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=g(r(6)),a=g(r(99)),i=g(r(100)),o=g(r(24)),s=g(r(2)),c=g(r(0)),u=g(r(1)),d=g(r(3)),l=g(r(4)),p=g(r(8)),f=g(r(30)),m=r(29),h=_(r(51)),v=_(r(60));function _(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function g(e){return e&&e.__esModule?e:{default:e}}var y=r(110),b=r(178),k=new f.default(\"<Stream>\"),w=new p.default,P=function(e){function t(e){(0,c.default)(this,t);var r=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this)),n=\"\";e.userId?(e.userId=e.userId+\"\",n=e.userId.trim()):e.userID?(e.userID=e.userID+\"\",n=e.userID.trim()):n=\"\",e.userId=n;var a=\"\";return e.streamId?(e.streamId=e.streamId+\"\",a=e.streamId.trim()):e.streamID?(e.streamID=e.streamID+\"\",a=e.streamID.trim()):a=\"\",e.streamId=a,r._spec=e,k.debug(\"constructor() -- spec: \"+(0,o.default)(e)),r._streamObj=null,r._streamType=\"\",r._spec.streamType&&(r._streamType=e.streamType),r._uuid=v.uuid(),r._innerStreamID=\"\",r._customStreamID=a,r._userId=n,r._volume=0,r._isLocalStream=!1,r._webcamProducer=null,r._micProducer=null,r._audio=null,r._video=null,r._isMicClosed=!1,r._isVideoTrackClosed=!1,r._mediaSourceAudio=!1,r._mediaSourceVideo=!1,r._audioSource=null,r._spec.audioSource&&(r._audioSource=r._spec.audioSource,r._mediaSourceAudio=!0,r._spec.audio=!1),r._videoSource=null,r._spec.videoSource&&(r._videoSource=r._spec.videoSource,r._mediaSourceVideo=!0,r._spec.video=!1,r._spec.screen=!1),r._enableMic=r._spec.audio,r._enableCamera=r._spec.video,r._source=r._spec.source,r._subscribed=!1,r._closed=!1,r._isSubStream=!!r._spec.subStream&&r._spec.subStream,r._keyResolution=\"480p\",r._isMobile=/mobile/i.test(navigator.userAgent),r._published=!1,r._publishState=h.PUBLISH_STATE.IDLE,r._videoType=-1,void 0!==r._spec.videoType&&(r._videoType=r._spec.videoType),r._needUpdateVideoStreamBitrate=!1,r._updateConstraints={},r._gainNode=null,r._videoSpec=null,r._specialCameraId=\"\",r._specialMicId=\"\",r._audioProfile=null,r._audioCtx=null,r}var r,p,f,m,_,g;return(0,l.default)(t,e),(0,u.default)(t,[{key:\"init\",value:(g=(0,i.default)(a.default.mark((function e(r,n){var s,c,u,d,l,p,f=this;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k.debug(\"API init() -- this._userId: \"+this._userId+\" this._spec: \"+(0,o.default)(this._spec)),\"function\"==typeof r){e.next=4;break}throw k.warn(\"API init() error - onSuccess have to be a function.\"),TypeError(\"onSuccess have to be a function.\");case 4:if(\"function\"==typeof n){e.next=7;break}throw k.warn(\"API init() error - onFailure have to be a function.\"),TypeError(\"onFailure have to be a function.\");case 7:if(this._streamType=\"producer\",s=null,c=Boolean(this._spec.video),u=Boolean(this._spec.screen),!(+c+ +u>1)){e.next=16;break}return k.warn(\"API init() error - video/screen: only one can be set as true\"),n(\"video/screen: only one can be set as true\"),e.abrupt(\"return\");case 16:if((this._spec.video||this._spec.screen)&&(this._enableVideoTrack=!0),this._videoType=-1,this._spec.video?this._videoType=0:this._spec.screen?this._videoType=1:this._mediaSourceVideo&&(this._videoType=2),this._videoSpec={width:{min:h.videoSpec.width.min,ideal:h.videoSpec.width.ideal,max:h.videoSpec.width.max},height:{min:h.videoSpec.height.min,ideal:h.videoSpec.height.ideal,max:h.videoSpec.height.max},frameRate:{min:h.videoSpec.frameRate.min,ideal:h.videoSpec.frameRate.ideal,max:h.videoSpec.frameRate.max}},this._isMobile&&(this._videoSpec.facingMode=this._spec.useBackCam?{exact:\"environment\"}:\"user\"),this._spec.attributes&&(this._spec.attributes.resolution&&(\"HD720P\"===this._spec.attributes.resolution.toUpperCase()&&(this._videoSpec.width.ideal=h.videoAttributes.hd720p[0],this._videoSpec.height.ideal=h.videoAttributes.hd720p[1]),\"VGA\"===this._spec.attributes.resolution.toUpperCase()&&(this._videoSpec.width.ideal=h.videoAttributes.vga[0],this._videoSpec.height.ideal=h.videoAttributes.vga[1]),\"SIF\"===this._spec.attributes.resolution.toUpperCase()&&(this._videoSpec.width.ideal=h.videoAttributes.sif[0],this._videoSpec.height.ideal=h.videoAttributes.sif[1]),void 0!==this._spec.attributes.width&&void 0!==this._spec.attributes.height&&(this._videoSpec.width.ideal=this._spec.attributes.width,this._videoSpec.height.ideal=this._spec.attributes.height)),this._spec.attributes.minFrameRate&&this._spec.attributes.maxFrameRate&&(this._videoSpec.frameRate.min=this._spec.attributes.minFrameRate,this._videoSpec.frameRate.max=this._spec.attributes.maxFrameRate,void 0!==this._spec.attributes.idealFrameRate?this._videoSpec.frameRate.ideal=this._spec.attributes.idealFrameRate:this._videoSpec.frameRate.ideal=Math.floor((this._spec.attributes.maxFrameRate-this._spec.attributes.minFrameRate)/2+this._spec.attributes.minFrameRate)),this._spec.attributes.videoProfile&&(d=this._getResolutionByVideoProfile(this._spec.attributes.videoProfile),this._videoSpec.width.ideal=d.width,this._videoSpec.height.ideal=d.height)),!this._spec.video||!this._spec.audio){e.next=28;break}s={video:this._videoSpec},this._spec.microphoneId&&\"\"!==this._spec.microphoneId.trim()?(s.audio={deviceId:{exact:this._spec.microphoneId.trim()},sampleRate:h.audioSpec.sampleRate,channelCount:h.audioSpec.channelCount},this._specialMicId=this._spec.microphoneId.trim()):s.audio=!0,this._spec.cameraId&&\"\"!==this._spec.cameraId.trim()&&(s.video.deviceId={exact:this._spec.cameraId.trim()},this._specialCameraId=this._spec.cameraId.trim()),e.next=47;break;case 28:if(!this._spec.audio||this._spec.screen||this._spec.video){e.next=33;break}s={video:!1},this._spec.microphoneId&&\"\"!==this._spec.microphoneId.trim()?(s.audio={deviceId:{exact:this._spec.microphoneId.trim()},sampleRate:h.audioSpec.sampleRate,channelCount:h.audioSpec.channelCount},this._specialMicId=this._spec.microphoneId.trim()):s.audio=!0,e.next=47;break;case 33:if(!this._spec.video||this._spec.audio||this._spec.screen){e.next=38;break}s={audio:!1,video:this._videoSpec},this._spec.cameraId&&\"\"!==this._spec.cameraId.trim()&&(s.video.deviceId={exact:this._spec.cameraId.trim()},this._specialCameraId=this._spec.cameraId.trim()),e.next=47;break;case 38:if(!this._spec.screen){e.next=47;break}if(l=!1,\"chrome\"!==y.name.toLowerCase()){e.next=45;break}if(!(parseInt(y.version,10)>=72)){e.next=45;break}return l=!0,e.next=45,this._startScreenCapture().then(function(){var e=(0,i.default)(a.default.mark((function e(i){var s;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f._isLocalStream=!0,f.streamObj=i,f._screenStreamEnded(i),f._innerStreamID=t._getInnerStreamID(f.userID,f.userID,0,f,f._isSubStream),!f._spec.audio){e.next=16;break}return e.prev=5,e.next=8,f._createAudioTrack(f._spec.microphoneId);case 8:s=e.sent,f.audioTracks=s,e.next=16;break;case 12:e.prev=12,e.t0=e.catch(5),k.error(\"API init() _startScreenCapture() error - _createAudioTrack fail. error: \"+(0,o.default)(e.t0)),n(e.t0);case 16:k.debug(\"API init() _startScreenCapture() success - this.userID: \"+f.userID+\" this._innerStreamID: \"+f._innerStreamID),r();case 18:case\"end\":return e.stop()}}),e,f,[[5,12]])})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){return k.error(\"API init() _startScreenCapture() error - \"+e.name+\" \"+e.message),n(e.name+\" \"+e.message)}));case 45:return l||getScreenId((function(e,s,c){if(\"firefox\"!==s){if(c={video:{mandatory:{chromeMediaSource:\"screen\",maxWidth:1920,maxHeight:1080,minAspectRatio:1.77}}},\"permission-denied\"===e)return alert(\"Permission is denied.\");if(\"not-chrome\"===e)return alert(\"Please use chrome.\");!e&&s&&(c.video.mandatory.chromeMediaSource=\"desktop\",c.video.mandatory.chromeMediaSourceId=s)}var u;navigator.getUserMedia=navigator.mozGetUserMedia||navigator.webkitGetUserMedia,navigator.getUserMedia(c,(u=(0,i.default)(a.default.mark((function e(i){var s,u,d;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f._isLocalStream=!0,f.streamObj=i,f._innerStreamID=t._getInnerStreamID(f.userID,f.userID,0,f,f._isSubStream),!f._spec.audio){e.next=15;break}return e.prev=4,e.next=7,f._createAudioTrack(f._spec.microphoneId);case 7:s=e.sent,f.audioTracks=s,e.next=15;break;case 11:e.prev=11,e.t0=e.catch(4),k.error(\"API init() getScreenId() error - stream of screen init failed for obtain audio track. error: \"+e.t0.toString()),n(e.t0);case 15:(u=i.getVideoTracks())&&u.length>0&&(d=u[0])&&(d.onended=function(e){k.debug(\"videoTrack.onended - streamId: \"+f.getId()+\" videoTrack.id: \"+d.id+\" - \"+e.toString())}),k.debug(\"API init() getScreenId() success - this.userID: \"+f.userID+\" this._innerStreamID: \"+f._innerStreamID+\" screen_constraints: \"+(0,o.default)(c)),r();case 19:case\"end\":return e.stop()}}),e,f,[[4,11]])}))),function(e){return u.apply(this,arguments)}),(function(e){k.error(\"API init() getScreenId() fail - \"+e.name+\" \"+e.message+\" -- constraints: \"+(0,o.default)(c)),n(\"getScreenId() fail - \"+e.name+\" \"+e.message)}))}),this._spec.audio),e.abrupt(\"return\");case 47:if(!this._spec.video&&!this._spec.audio){e.next=53;break}return k.debug(\"API init() this.userID: \"+this.userID+\" this._innerStreamID: \"+this._innerStreamID+\" this._videoType: \"+this._videoType+\" constraints: \"+(0,o.default)(s)),navigator.mediaDevices.getUserMedia(s).then((function(e){f._isLocalStream=!0;var n=e.getVideoTracks();if(e.getAudioTracks().length>0){if(!f._audioCtx){var a=window.AudioContext||window.webkitAudioContext;f._audioCtx=new a}if(f._audioCtx&&!f._gainNode&&(f._gainNode=f._audioCtx.createGain(),f._gainNode.gain.value=1),f._audioCtx&&f._gainNode){var i=f._audioCtx.createMediaStreamSource(e);f.target=f._audioCtx.createMediaStreamDestination(),i.connect(f._gainNode),f._gainNode.connect(f.target),n.length>0&&f.target.stream.addTrack(n[0]),f.streamObj=f.target.stream}else f.streamObj=e}else f.streamObj=e;var c=f.streamObj.getVideoTracks();if(c&&c.length>0){var u=c[0];u&&(u.onended=function(e){k.debug(\"videoTrack.onended - streamId: \"+f.getId()+\" videoTrack.id: \"+u.id+\" - \"+e.toString())})}f._innerStreamID=t._getInnerStreamID(f.userID,f.userID,0,f,f._isSubStream),k.debug(\"API init() getUserMedia() success - this.userID: \"+f.userID+\" this._innerStreamID: \"+f._innerStreamID+\" constraints: \"+(0,o.default)(s)),r()})).catch((function(e){k.error(\"API init() getUserMedia fail - \"+e.name+\" \"+e.message+\" -- constraints: \"+(0,o.default)(s)),n(\"getUserMedia fail - \"+e.name+\" \"+e.message)})),e.abrupt(\"return\");case 53:if(!this._mediaSourceAudio&&!this._mediaSourceVideo){e.next=57;break}return p={audio:!0,video:!1},navigator.mediaDevices.getUserMedia(p).then((function(e){f._isLocalStream=!0;var n=e.getVideoTracks();if(n.length>0){var a=n[0];a&&(a.onended=function(e){k.debug(\"videoTrack.onended - streamId: \"+f.getId()+\" videoTrack.id: \"+a.id+\" - \"+e.toString())})}var i=e.getAudioTracks(),s=null;i.length>0&&(s=i[0],e.removeTrack(s)),f._audioSource&&e.addTrack(f._audioSource),f._videoSource&&e.addTrack(f._videoSource),f.streamObj=e,f._innerStreamID=t._getInnerStreamID(f.userID,f.userID,0,f,f._isSubStream),k.debug(\"API init() getUserMedia() for [mediasource] success - this.userID: \"+f.userID+\" this._innerStreamID: \"+f._innerStreamID+\" constraints: \"+(0,o.default)(p)),r()})).catch((function(e){k.error(\"API init() getUserMedia() for [mediasource] fail - getUserMedia fail - \"+e.name+\" \"+e.message+\" -- constraints: \"+(0,o.default)(p)),n(\"getUserMedia for [mediasource] fail - \"+e.name+\" \"+e.message)})),e.abrupt(\"return\");case 57:case\"end\":return e.stop()}}),e,this)}))),function(e,t){return g.apply(this,arguments)})},{key:\"_createAudioTrack\",value:function(e){var t=this;if(!this._isLocalStream)return n.default.reject(\"_createAudioTrack - non-localStream\");k.debug(\"_createAudioTrack() - microphoneId: \"+e+\" this._userId: \"+this._userId+\" streamId: \"+this.getId());var r={video:!1};return e&&\"\"!==e.trim()?(this._spec.microphoneId=e.trim(),r.audio={deviceId:{exact:this._spec.microphoneId},sampleRate:h.audioSpec.sampleRate,channelCount:h.audioSpec.channelCount},this._specialMicId=this._spec.microphoneId):r.audio=!0,navigator.getUserMedia=navigator.mozGetUserMedia||navigator.webkitGetUserMedia,new n.default((function(e,n){navigator.mediaDevices.getUserMedia(r).then((function(r){if(!t._audioCtx){var n=window.AudioContext||window.webkitAudioContext;t._audioCtx=new n}if(t._audioCtx&&!t._gainNode&&(t._gainNode=t._audioCtx.createGain(),t._gainNode.gain.value=1),t._audioCtx&&t._gainNode){var a=t._audioCtx.createMediaStreamSource(r);t.target=t._audioCtx.createMediaStreamDestination(),a.connect(t._gainNode),t._gainNode.connect(t.target);var i=t.target.stream.getAudioTracks()[0];e(i)}else{var o=r.getAudioTracks()[0];e(o)}})).catch((function(e){k.warn(\"_createAudioTrack() getUserMedia fail - \"+e.name+\" \"+e.message+\" -- constraints: \"+(0,o.default)(r)),n(\"getUserMedia fail - \"+e.name+\" \"+e.message)}))}))}},{key:\"_createScreenVideoTrack\",value:function(){}},{key:\"_createCameraVideoTrack\",value:function(e){var t=this;if(!this._isLocalStream)return n.default.reject(\"non-localStream\");k.debug(\"_createCameraVideoTrack() - cameraId: \"+e+\" this._userId: \"+this._userId+\" this._innerStreamID: \"+this._innerStreamID);var r={audio:!1,video:this._videoSpec};return e&&\"\"!==e.trim()&&(this._spec.cameraId=e.trim(),r.video.deviceId={exact:this._spec.cameraId},this._specialCameraId=this._spec.cameraId),navigator.getUserMedia=navigator.mozGetUserMedia||navigator.webkitGetUserMedia,new n.default((function(e,n){navigator.mediaDevices.getUserMedia(r).then((function(r){var a=r.getVideoTracks();if(a&&a.length>0){var i=a[0];i?(i.onended=function(e){k.debug(\"videoTrack.onended - streamId: \"+t.getId()+\" videoTrack.id: \"+i.id+\" - \"+e.toString())},e(i)):n(\"no video track\")}else n(\"no video track\")})).catch((function(e){k.warn(\"_createCameraVideoTrack() getUserMedia fail - \"+e.name+\" \"+e.message+\" -- constraints: \"+(0,o.default)(r)),n(\"getUserMedia fail - \"+e.name+\" \"+e.message)}))}))}},{key:\"_speechEvents\",value:function(e){var t=this;if(!this._audioCtx){var r=window.AudioContext||window.webkitAudioContext;this._audioCtx=new r}this._audioCtx&&(this._speach=new b(e,{threshold:-65,audioContext:this._audioCtx}),this._speach.on(\"volume_change\",(function(e,r){e<r?t._volume=0:(t._volume=Math.round(-100*(e-r)/r),t._volume>100&&(t._volume=100)),t.emit(\"volume-change\",{userID:t.userID,volume:t._volume})})),this._speach.on(\"speaking\",(function(){t.emit(\"speaking\",{userID:t.userID})})),this._speach.on(\"stopped_speaking\",(function(){t._volume=0,t.emit(\"stopped-speaking\",{userID:t.userID})})))}},{key:\"attachAudioTracks\",value:function(e){var t=e.track,r=e.autoPlay;if(!t)return k.error(\"API attachAudioTracks() error - parameter track is NULL\"),new TypeError(\"track\");if(\"audio\"!==t.kind)return k.error(\"API attachAudioTracks() error - parameter track.kind is node audio\"),new TypeError(\"track is not audio kind\");if(k.debug(\"API attachAudioTracks() - autoPlay: \"+r+\" this._userId: \"+this._userId+\" streamId: \"+this.getId()),null===this._streamObj)throw k.error(\"API attachAudioTracks() error - this._streamObj is NULL\"),new Error(\"stream object is null.\");var n=this._streamObj.getAudioTracks();if(n&&n.length>0){var a=n[0];this._streamObj.removeTrack(a)}this._streamObj.addTrack(t),this._speechEvents(this._streamObj),this._video&&(this._video.srcObject=this._streamObj)}},{key:\"getId\",value:function(){return this._isLocalStream?this._innerStreamID:this._customStreamID}},{key:\"getAttributes\",value:function(){}},{key:\"getAudioLevel\",value:function(){return this._volume}},{key:\"hasVideo\",value:function(){return null!==this._streamObj&&this._streamObj.getVideoTracks().length>0}},{key:\"hasAudio\",value:function(){return null!==this._streamObj&&this._streamObj.getAudioTracks().length>0}},{key:\"attachWebcamProducer\",value:function(e){this._isLocalStream?this._webcamProducer=e:k.warn(\"API attachWebcamProducer() error - this is not local stream\")}},{key:\"detachWebcamProducer\",value:function(e){this._isLocalStream?this._webcamProducer=null:k.warn(\"API detachWebcamProducer() error - this is not local stream\")}},{key:\"attachMicProducer\",value:function(e){this._isLocalStream?this._micProducer=e:k.warn(\"API attachMicProducer() error - this is not local stream\")}},{key:\"detachMicProducer\",value:function(e){this._isLocalStream?this._micProducer=null:k.warn(\"API detachMicProducer() error - this is not local stream\")}},{key:\"switchDevice\",value:function(e,t,r,n){var a=this;if(k.debug(\"API switchDevice() type: \"+e+\" deviceId: \"+t),\"function\"!=typeof r)throw k.warn(\"API switchDevice() error - onSuccess have to be a function.\"),TypeError(\"onSuccess have to be a function.\");if(\"function\"!=typeof n)throw k.warn(\"API switchDevice() error - onFailure have to be a function.\"),TypeError(\"onFailure have to be a function.\");if(!this._isLocalStream)return k.warn(\"API switchDevice() error - this is not local stream\"),void n(\"non-localStream\");if(!t||\"\"==t.trim())return k.warn(\"API switchDevice() error - deviceId is invalid\"),void n(\"parameter deviceId is invalid\");if(\"audio\"!==e&&\"video\"!==e)return k.warn(\"API switchDevice() error - type must be [audio|video]\"),void n(\"parameter type is invalid\");var i=t.trim();\"audio\"===e?this._closeMic().then((function(){return a._openMic(i)})).then((function(){k.debug(\"API switchDevice() succ - type: \"+e+\" devId: \"+i),r()})).catch((function(t){k.warn(\"API switchDevice() fail - type: \"+e+\" devId: \"+i+\" - \"+t.toString()),n(t.toString())})):\"video\"===e?this._closeCamera().then((function(){return a._openCamera(i)})).then((function(){k.debug(\"API switchDevice() succ - type: \"+e+\" devId: \"+i),r()})).catch((function(t){k.warn(\"API switchDevice() fail - type: \"+e+\" devId: \"+i+\" - \"+t.toString()),n(t.toString())})):n(\"invalid type: \"+e)}},{key:\"_openCamera\",value:function(e){var t=this;return 0!==this.videoType?n.default.resolve():this.isVideoTrackClosed?this._isLocalStream?n.default.resolve().then((0,i.default)(a.default.mark((function r(){var i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=null,0!==t.videoType){r.next=7;break}return r.next=4,t._createCameraVideoTrack(e&&\"\"!==e.trim()?e:t._spec.cameraId);case 4:i=r.sent,r.next=11;break;case 7:if(1!==t.videoType){r.next=11;break}return r.next=10,t._createScreenVideoTrack();case 10:i=r.sent;case 11:if(t.videoTracks=i,t._isVideoTrackClosed=!1,k.debug(\"_openCamera() localStream - streamId: \"+t.getId()),!t._webcamProducer){r.next=17;break}return r.next=17,t._webcamProducer.replaceTrack(i);case 17:return r.abrupt(\"return\",n.default.resolve(i));case 18:case\"end\":return r.stop()}}),r,t)})))).catch((function(e){return k.warn(\"_openCamera() fail - \"+e.toString()),n.default.reject(e)})):(k.warn(\"_openCamera() error - non-localStream\"),n.default.reject(new Error(\"non-localStream\"))):(k.debug(\"_openCamera() - lack the conditions - this.isVideoTrackClosed: \"+this.isVideoTrackClosed),n.default.resolve())}},{key:\"_closeCamera\",value:function(){var e=this;return 0!==this.videoType?n.default.resolve():this._isLocalStream?null===this._streamObj?n.default.reject(new Error(\"stream._streamObj is null\")):n.default.resolve().then((function(){return e._streamObj&&e._streamObj.getVideoTracks().forEach((function(t){k.debug(\"_closeCamera() track.stop - streamId: \"+e.getId()+\" kind: \"+t.kind+\" id: \"+t.id),t.stop(),e._streamObj.removeTrack(t)})),e._isVideoTrackClosed=!0,k.debug(\"_closeCamera() localStream - streamId: \"+e.getId()),e._webcamProducer&&e._webcamProducer.stopTrack(),n.default.resolve()})).catch((function(e){return n.default.reject(e)})):(k.warn(\"_closeCamera() error - non-localStream\"),n.default.reject(new Error(\"non-localStream\")))}},{key:\"_openMic\",value:function(e){var t=this;return this._spec.audio?this.isMicClosed?this._isLocalStream?n.default.resolve().then((0,i.default)(a.default.mark((function r(){var i;return a.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t._createAudioTrack(e&&\"\"!==e.trim()?e:t._spec.microphoneId);case 2:if(i=r.sent,t.audioTracks=i,t._isMicClosed=!1,k.debug(\"_openMic() localStream - streamId: \"+t.getId()),!t._micProducer){r.next=9;break}return r.next=9,t._micProducer.replaceTrack(i);case 9:return r.abrupt(\"return\",n.default.resolve(i));case 10:case\"end\":return r.stop()}}),r,t)})))).catch((function(e){return n.default.reject(e)})):(k.warn(\"_openMic() error - non-localStream\"),n.default.reject(new Error(\"non-localStream\"))):(k.warn(\"_openMic() error - lack the conditions - this.isMicClosed: \"+this.isMicClosed),n.default.reject(new Error(\"lack the conditions\"))):(k.warn(\"_openMic() error - not mic stream\"),n.default.reject(new Error(\"not mic stream\")))}},{key:\"_closeMic\",value:function(){var e=this;return this._spec.audio?this._isLocalStream?null===this._streamObj?n.default.reject(new Error(\"stream._streamObj is null\")):n.default.resolve().then((function(){return e._streamObj&&e._streamObj.getAudioTracks().forEach((function(t){k.debug(\"_closeMic() track.stop - streamId: \"+e.getId()+\" kind: \"+t.kind+\" id: \"+t.id),t.stop(),e._streamObj.removeTrack(t)})),e._isMicClosed=!0,k.debug(\"_closeMic() localStream - streamId: \"+e.getId()),e._micProducer&&e._micProducer.stopTrack(),n.default.resolve()})).catch((function(e){return n.default.reject(e)})):(k.warn(\"_closeMic() error - non-localStream\"),n.default.reject(new Error(\"non-localStream\"))):(k.warn(\"_closeMic() error - not mic stream\"),n.default.reject(new Error(\"not mic stream\")))}},{key:\"enableVideo\",value:(_=(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._isLocalStream){e.next=3;break}return k.warn(\"API enableVideo() error - non-localStream\"),e.abrupt(\"return\");case 3:if(k.debug(\"API enableVideo() - this._userId: \"+this._userId+\" streamId: \"+this.getId()),this._published&&this.emit(\"resume-video\",{stream:this}),!this._video){e.next=14;break}return e.prev=6,e.next=9,this._video.play();case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(6),k.warn(\"API enableVideo() this._video.play() fail - \"+e.t0.toString()+\" - this._userId: \"+this._userId+\" streamId: \"+this.getId());case 14:case\"end\":return e.stop()}}),e,this,[[6,11]])}))),function(){return _.apply(this,arguments)})},{key:\"disableVideo\",value:function(){this._isLocalStream?(this._published&&(k.debug(\"API disableVideo() - this._userId: \"+this._userId+\" streamId: \"+this.getId()),this.emit(\"pause-video\",{stream:this})),this._video&&this._video.pause()):k.warn(\"API disableVideo() error - non-localStream\")}},{key:\"enableAudio\",value:function(){this._isLocalStream?(k.debug(\"API enableAudio() - this._userId: \"+this._userId+\" streamId: \"+this.getId()),this._published&&this.emit(\"resume-audio\",{stream:this})):k.warn(\"API enableAudio() error - non-localStream\")}},{key:\"disableAudio\",value:function(){this._isLocalStream?(k.debug(\"API disableAudio() - this._userId: \"+this._userId+\" streamId: \"+this.getId()+\" this._published: \"+this._published),this._published&&this.emit(\"pause-audio\",{stream:this})):k.warn(\"API disableAudio() error - non-localStream\")}},{key:\"enableVideoAndAudio\",value:(m=(0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._isLocalStream){e.next=3;break}return k.warn(\"API enableVideoAndAudio() error - non-localStream\"),e.abrupt(\"return\");case 3:if(k.debug(\"API enableVideoAndAudio() - this._userId: \"+this._userId+\" streamId: \"+this.getId()),this._published&&(this.emit(\"resume-audio\",{stream:this}),this.emit(\"resume-video\",{stream:this})),!this._video){e.next=14;break}return e.prev=6,e.next=9,this._video.play();case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(6),k.warn(\"API enableVideoAndAudio() this._video.play() fail - \"+e.t0.toString()+\" - this._userId: \"+this._userId+\" streamId: \"+this.getId());case 14:case\"end\":return e.stop()}}),e,this,[[6,11]])}))),function(){return m.apply(this,arguments)})},{key:\"disableVideoAndAudio\",value:function(){this._isLocalStream?(k.debug(\"API disableVideoAndAudio() - this._userId: \"+this._userId+\" streamId: \"+this.getId()),this._published&&(this.emit(\"pause-audio\",{stream:this}),this.emit(\"pause-video\",{stream:this})),this._video&&this._video.pause()):k.warn(\"API disableVideoAndAudio() error - non-localStream\")}},{key:\"setAudioProfile\",value:function(e){/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&\"isac32\"===e&&(e=\"music_standard\");var t=h.audioProfileSpec.get(e);this._audioProfile=t||null,k.debug(\"API setAudioProfile() profile: \"+e+\" \"+(0,o.default)(this._audioProfile))}},{key:\"getAudioProfile\",value:function(){return this._audioProfile}},{key:\"setVideoProfile\",value:function(e,t,r){var n=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(\"function\"!=typeof t)throw k.warn(\"API setVideoProfile() error - onSuccess have to be a function.\"),TypeError(\"onSuccess have to be a function.\");if(\"function\"!=typeof r)throw k.warn(\"API setVideoProfile() error - onFailure have to be a function.\"),TypeError(\"onFailure have to be a function.\");if(!this._isLocalStream)return k.warn(\"API setVideoProfile() error - non-localStream\"),void r(\"only local stream can set video profile.\");if(k.debug(\"API setVideoProfile() - this._userId: \"+this._userId+\" videoProfile: \"+e+\" streamId: \"+this.getId()),null===this._streamObj)return k.warn(\"API setVideoProfile() error - stream is null, please init it at first.\"),void r(\"stream is null, please init it at first.\");var c=this._streamObj.getVideoTracks();if(c.length<=0)return k.warn(\"API setVideoProfile() error - no video track.\"),void r(\"no video track.\");if(s){if(!s.minBandwidth||!s.maxBandwidth||!s.startBitrate)throw k.wanr(\"API setVideoProfile() error - codecOptions parameters invalid.\"),TypeError(s);if(\"number\"!=typeof s.minBandwidth||\"number\"!=typeof s.maxBandwidth||\"number\"!=typeof s.startBitrate)throw k.warn(\"API setVideoProfile() error - codecOptions parameters invalid.\"),TypeError(s);if(s.minBandwidth>=s.maxBandwidth)throw k.warn(\"API setVideoProfile() error - codecOptions parameters invalid.\"),TypeError(\"minBandwidth > = maxBandwidth\");this._spec.codecOptions=s}var u=c[0],d=void 0,l=this._getResolutionByVideoProfile(e),p=l.width,f=l.height;d={width:p,height:f},u.applyConstraints(d).then((0,i.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k.debug(\"API setVideoProfile() track.applyConstraints ok -- constraints: \"+(0,o.default)(d)),n._videoSetting=u.getSettings(),n._setKeyResolution(u),!n._published){e.next=9;break}if(!n._webcamProducer){e.next=7;break}return e.next=7,n._webcamProducer.updateTrack(u,d,{idealBandwidth:n.idealBandwidth,maxBandwidth:n.maxBandwidth,minBandwidth:n.minBandwidth});case 7:e.next=11;break;case 9:n._updateConstraints=d,n._needUpdateVideoStreamBitrate=!0;case 11:t(\"applyConstraint success\");case 12:case\"end\":return e.stop()}}),e,n)})))).catch((function(e){k.warn(\"API setVideoProfile() error - track.applyConstraints failed - \"+e.toString()),r(e)}))}},{key:\"getVideoProfile\",value:function(){if(!this._streamObj)return k.error(\"API getVideoProfile() error - this._streamObj is NULL\"),{};var e=this._streamObj.getVideoTracks();if(e.length<=0)return k.error(\"API getVideoProfile() error - getVideoProfile: no video track\"),{};var t=e[0].getSettings(),r={width:t.width,height:t.height};return k.debug(\"API getVideoProfile() - this._userId: \"+this._userId+\" streamId: \"+this.getId()+\" resoultion: \"+(0,o.default)(r)),r}},{key:\"setScreenProfile\",value:function(){}},{key:\"setAudioOutput\",value:function(e,t,r){if(k.debug(\"API setAudioOutput() deviceId: \"+e),\"function\"!=typeof t)throw k.warn(\"API setAudioOutput() error - onSuccess have to be a function.\"),TypeError(\"onSuccess have to be a function.\");if(\"function\"!=typeof r)throw k.warn(\"API setAudioOutput() error - onFailure have to be a function.\"),TypeError(\"onFailure have to be a function.\");if(e&&\"\"!=e.trim()){var n=e.trim();if(\"audio\"===this.type){if(!this._audio)return k.debug(\"API setAudioOutput() fail - no audio tag\"),void r(\"no audio tag\");this._audio.setSinkId(n).then((function(){k.debug(\"Audio output device attached: \"+n),t(\"Audio output device attached: \"+n)})).catch((function(e){k.debug(\"Audio output device attached fail - \"+e.toString()),r(\"Audio output device attached faile - \"+e.toString())}))}else{if(!this._video)return k.debug(\"API setAudioOutput() fail - no video tag\"),void r(\"no video tag\");this._video.setSinkId(n).then((function(){k.debug(\"Audio output device attached: \"+n),t(\"Audio output device attached: \"+n)})).catch((function(e){k.debug(\"Audio output device attached faile - \"+e.toString()),r(\"Audio output device attached faile - \"+e.toString())}))}}else r(\"parameter deviceId is invalid\")}},{key:\"play\",value:function(e,t,r){var n=this;if(k.debug(\"API play() - this._userId: \"+this._userId+\" streamId: \"+this.getId()+\" this.type: \"+this.type),!this._streamObj)throw k.error(\"API play() error - stream is NULL.\"),Error(\"stream is null, please init it at first.\");if(\"audio\"===this.type){if(!this._audio){if(this._audio=new Audio,!this._isLocalStream){if(!this._audioCtx){var o=window.AudioContext||window.webkitAudioContext;this._audioCtx=new o}this._audioCtx&&!this._gainNode&&(this._gainNode=this._audioCtx.createGain(),this._gainNode.gain.value=1),this._audio.onloadedmetadata=(0,i.default)(a.default.mark((function e(){var t;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k.debug(\"API play() - this._audio.onloadedmetadata. will connect to GainNode - this._userId: \"+n._userId+\" streamId: \"+n.getId()),!n._audioCtx||!n._gainNode){e.next=14;break}return t=n._audioCtx.createMediaStreamSource(n._streamObj),e.prev=3,e.next=6,n._audio.play();case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(3),k.warn(\"API play() this._audio.play() fail - \"+e.t0.toString()+\" - this._userId: \"+n._userId+\" streamId: \"+n.getId()+\" this.type: \"+n.type);case 11:n._audio.muted=!0,t.connect(n._gainNode),n._gainNode.connect(n._audioCtx.destination);case 14:case\"end\":return e.stop()}}),e,n,[[3,8]])})))}this._audio.srcObject=this._streamObj}}else{if(this._video=document.getElementById(e),!this._video)throw k.error(\"API play() error - Not found video -- id: \"+e+\".\"),Error(\"video id can not find \"+e);this._streamObj.active||k.debug(\"API play() - stream active is false\"),this._video.muted=Boolean(this._isLocalStream)||Boolean(this._audio),this._video.autoplay=!0,this._video.controls=!!t,this._video.playsinline=!0,this._video.srcObject=this._streamObj}}},{key:\"stopPlay\",value:function(e){if(\"audio\"===this.type){if(!this._audio)return;this._audio.muted=!0,this._audio.pause()}else{if(this._video=document.getElementById(e),!this._video)throw k.error(\"API stopPlay() error - Not found video -- id: \"+e+\".\"),Error(\"video id can not find \"+e);this._video.muted=!0,this._video.pause()}}},{key:\"close\",value:function(){k.debug(\"API close() - this._userId: \"+this._userId+\" streamId: \"+this.getId()),this._closed||(this._streamObj?(this._webcamProducer&&this._webcamProducer.close(),this._micProducer&&this._micProducer.pause(),this._streamObj.getTracks().forEach((function(e){return e.stop()})),this._streamObj=null,this.removeAllListeners(),this._closed=!0,this._video&&(this._video.srcObject=null),this._gainNode=null):k.error(\"API close() error - stream is null, please init it at first.\"))}},{key:\"_startScreenCapture\",value:function(){var e={video:{aspectRatio:h.screenSpec.s_1080p.maxAspectRatio,frameRate:h.screenSpec.s_frameRate,height:h.screenSpec.s_1080p.maxHeight,resizeMode:\"crop-and-scale\",width:h.screenSpec.s_1080p.maxWidth,cursor:\"always\"}};return navigator.getDisplayMedia?navigator.getDisplayMedia(e):navigator.mediaDevices.getDisplayMedia?navigator.mediaDevices.getDisplayMedia(e):navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({video:{mediaSource:\"screen\"}}):(navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.getUserMedia,new n.default((function(e,t){navigator.getUserMedia?navigator.getUserMedia({video:{mandatory:{chromeMediaSource:\"screen\"}}},(function(t){e(t)}),(function(e){t(\"_startScreenCapture fail - \"+e.name+\" \"+e.message)})):(k.warn(\"_startScreenCapture() fail - unsupported navigator.getUserMedia\"),t(\"unsupported navigator.getUserMedia\"))})))}},{key:\"_streamEnded\",value:(f=(0,i.default)(a.default.mark((function e(t){var r,n=this;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt(\"return\");case 2:if(r=t.getVideoTracks()[0]){e.next=5;break}return e.abrupt(\"return\");case 5:r.onended=function(e){k.debug(\"_streamEnded() track.onended - streamId: \"+n.getId()+\" \"+e.toString()+\" - Emit [stream-close]\"),n.emit(\"stream-close\",{streamId:n.streamID,stream:n})};case 6:case\"end\":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:\"_screenStreamEnded\",value:(p=(0,i.default)(a.default.mark((function e(t){var r,n=this;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt(\"return\");case 2:if(r=t.getVideoTracks()[0]){e.next=5;break}return e.abrupt(\"return\");case 5:r.onended=function(e){k.debug(\"_screenStreamEnded() track.onended - streamId: \"+n.getId()+\" \"+e.toString()+\" - Emit [screen-close]\"),n.emit(\"screen-close\",{streamId:n.streamID,stream:n})};case 6:case\"end\":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:\"capture\",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(new Date).toISOString().replace(/[-:TZ.]/g,\"\")+this._customStreamID,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Function;if(k.debug(\"API capture() - this._userId: \"+this._userId+\" streamId: \"+this.getId()),!this._streamObj)throw k.error(\"API capture() error - this._streamObj is NULL.\"),Error(\"stream is null, please init it at first.\");if(!this._video)throw k.error(\"API capture() error - this._video is NULL.\"),Error(\"this stream has not be played: \"+this._streamObj);if(!/[\\\\\\/\\*\\:\\<\\>\\|\\?\\\"]/g.test(t)&&t.length>255)throw k.error(\"API capture() error - illegal filename.\"),Error(\"illegal filename \");var n=document.createElement(\"canvas\");n.width=this._video.videoWidth,n.height=this._video.videoHeight;var a=n.getContext(\"2d\");a.drawImage(this._video,0,0,n.width,n.height),\"file\"===e?n.toBlob((function(e){r(new File([e],t+\".jpeg\",{type:\"image/jpeg\"}))})):r(n.toDataURL(\"image/jpeg\"))}},{key:\"setAudioVolume\",value:function(e){\"number\"==typeof e?this._gainNode?(e<0?e=0:e>1.5&&(e=1.5),this._gainNode.gain.value=e,k.debug(\"API setAudioVolume() success - volume: \"+e)):k.warn(\"API setAudioVolume() error - no gainNode existed.\"):k.warn(\"API setAudioVolume() TypeError - volume: \"+e)}},{key:\"setInputVolume\",value:function(e){if(\"number\"!=typeof e)throw k.warn(\"API setInputVolume() TypeError - volume: \"+e),TypeError(\"Wrong arguments: volume must be number.\");if(!this._gainNode)throw k.warn(\"API setInputVolume() error - no gainNode existed.\"),Error(\"setInputVolume() error - no gainNode existed.\");e<0?e=0:e>1.5&&(e=1.5),this._gainNode.gain.value=e,k.debug(\"API setInputVolume() success - volume: \"+e)}},{key:\"addTrack\",value:function(e){}},{key:\"removeTrack\",value:function(e){}},{key:\"replaceTrack\",value:(r=(0,i.default)(a.default.mark((function e(t){var r,n;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k.debug(\"API replaceTrack() - this._userId: \"+this._userId+\" streamId: \"+this.getId()),t){e.next=4;break}throw k.warn(\"API replaceTrack() error - parameter [trank] is INVALID.\"),TypeError(\"track\");case 4:r=null,n=null,e.t0=t.kind,e.next=\"video\"===e.t0?9:\"audio\"===e.t0?14:15;break;case 9:return(r=this._streamObj.getVideoTracks())&&r.length>0&&(n=r[0],this._streamObj.removeTrack(n),this.videoTracks=t,this._videoSetting=t.getSettings(),this._setKeyResolution(t)),e.next=13,this._webcamProducer.replaceTrack(t);case 13:return e.abrupt(\"break\",16);case 14:throw TypeError(\"Cannot support audio track replace now.\");case 15:throw TypeError(\"track have no audio or video.\");case 16:case\"end\":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:\"getVideoTrackSettings\",value:function(){return this._videoSetting}},{key:\"getAudioTrackSetting\",value:function(){return this._audioSetting}},{key:\"_setKeyResolution\",value:function(e){if(!e)throw new TypeError(\"track\");if(\"video\"===e.kind){var t=e.getSettings();t.height<=80?this._keyResolution=\"80p\":t.height>80&&t.height<=120?this._keyResolution=\"120p\":t.height>120&&t.height<=160?this._keyResolution=\"160p\":t.height>160&&t.height<=200?this._keyResolution=\"200p\":t.height>200&&t.height<=240?this._keyResolution=\"240p\":t.height>240&&t.height<=320?this._keyResolution=\"320p\":t.height>320&&t.height<=360?this._keyResolution=\"360p\":t.height>360&&t.height<=480?this._keyResolution=\"480p\":t.height>480&&t.height<=540?this._keyResolution=\"540p\":t.height>480&&t.height<=720?this._keyResolution=\"720p\":t.height>720&&t.height<=1080||t.height>1080?this._keyResolution=\"1080p\":this._keyResolution=\"480p\"}}},{key:\"_getResolutionByVideoProfile\",value:function(e){var t={width:640,height:480};if(!e&&\"string\"!=typeof e)return t;var r=e.toLowerCase(),n=h.videoResolution.get(r);return n&&(t.width=n.width,t.height=n.height),t}},{key:\"streamObj\",set:function(e){if(this._streamObj=e,e){if(this._isLocalStream){var t=this.videoTracks;if(t&&t.length>0){var r=t[0];this._videoSetting=r.getSettings(),this._setKeyResolution(r)}if((t=this.audioTracks)&&t.length>0){var n=t[0];this._audioSetting=n.getSettings()}}e.getAudioTracks().length>0&&this._speechEvents(e)}},get:function(){return this._streamObj}},{key:\"isLocalStream\",get:function(){return this._isLocalStream}},{key:\"streamType\",get:function(){return this._streamType}},{key:\"specialCameraId\",get:function(){return this._specialCameraId}},{key:\"specialMicId\",get:function(){return this._specialMicId}},{key:\"uuid\",get:function(){return this._uuid}},{key:\"streamID\",set:function(e){this._customStreamID=e},get:function(){return this._isLocalStream?this._innerStreamID:this._customStreamID}},{key:\"streamId\",get:function(){return this._isLocalStream?this._innerStreamID:this._customStreamID}},{key:\"userID\",set:function(e){this._userId=e},get:function(){return this._userId}},{key:\"userId\",get:function(){return this._userId}},{key:\"innerStreamID\",get:function(){return\"\"===this._innerStreamID&&(this._innerStreamID=t._getInnerStreamID(this._userId,this.streamID,0,this,this._isSubStream)),this._innerStreamID}},{key:\"audioTracks\",set:function(e){k.debug(\"API audioTracks() - this._userId: \"+this._userId+\" streamId: \"+this.getId()),this.attachAudioTracks({track:e,autoPlay:!1})},get:function(){return this._streamObj?this._streamObj.getAudioTracks():null}},{key:\"videoTracks\",set:function(e){if(k.debug(\"API videoTracks() - this._userId: \"+this._userId+\" streamId: \"+this.getId()),!e)return k.error(\"API videoTracks() error - parameter track is NULL\"),new TypeError(\"track\");if(\"video\"!==e.kind)return k.error(\"API videoTracks() error - parameter track.kind is node video\"),new TypeError(\"track is not video kind\");if(null===this._streamObj)throw k.error(\"API videoTracks() error - this._streamObj is NULL\"),new Error(\"stream object is null.\");var t=this._streamObj.getVideoTracks();if(t&&t.length>0){var r=t[0];r.stop(),this._streamObj.removeTrack(r)}this._streamObj.addTrack(e),this._video&&(this._video.srcObject=this._streamObj)},get:function(){return this._streamObj?this._streamObj.getVideoTracks():null}},{key:\"audioTrackStatus\",get:function(){if(!this._streamObj)return{};var e=this._streamObj.getAudioTracks();return e&&e.length>0?{id:e[0].id,label:e[0].label,enabled:e[0].enabled,muted:e[0].muted,readyState:e[0].readyState}:{}}},{key:\"videoTrackStatus\",get:function(){if(!this._streamObj)return{};var e=this._streamObj.getVideoTracks();return e&&e.length>0?{id:e[0].id,label:e[0].label,enabled:e[0].enabled,muted:e[0].muted,readyState:e[0].readyState}:{}}},{key:\"tracks\",get:function(){return this._streamObj.getTracks()}},{key:\"trackNumber\",get:function(){return this._streamObj?this._streamObj.getTracks().length:0}},{key:\"subscribed\",set:function(e){this._subscribed=e},get:function(){return this._subscribed}},{key:\"type\",get:function(){return 1===this.trackNumber&&this.audioTracks.length>0?\"audio\":\"video\"}},{key:\"published\",get:function(){return this._published},set:function(e){return this._published=e}},{key:\"publishState\",set:function(e){this._publishState=e}},{key:\"videoType\",set:function(e){this._videoType=+e},get:function(){return this._videoType}},{key:\"isMicClosed\",get:function(){return this._isMicClosed}},{key:\"isVideoTrackClosed\",get:function(){return this._isVideoTrackClosed}},{key:\"idealBandwidth\",get:function(){if(this._spec.codecOptions&&this._spec.codecOptions.startBitrate)return this._spec.codecOptions.startBitrate;var e=h.videoResolution.get(this._keyResolution),t=400;return e&&e.bps&&(t=e.bps.ideal/1e3),t>0?t:400}},{key:\"minBandwidth\",get:function(){if(this._spec.codecOptions&&this._spec.codecOptions.minBitrate)return this._spec.codecOptions.minBitrate;var e=h.videoResolution.get(this._keyResolution),t=300;return e&&e.bps&&(t=e.bps.min/1e3),t>0?t:300}},{key:\"maxBandwidth\",get:function(){if(this._spec.codecOptions&&this._spec.codecOptions.maxBitrate)return this._spec.codecOptions.maxBitrate;var e=h.videoResolution.get(this._keyResolution),t=500;return e&&e.bps&&(t=e.bps.max/1e3),t>0?t:500}}],[{key:\"clearStreamIdMap\",value:function(){w&&w.clear()}},{key:\"_getInnerStreamID\",value:function(e,r,n,a){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(\"\"===e)return\"\";var o=w.get(\"\"+r);return void 0===o?(w.set(\"\"+r,a),r):i?0===n?t._getInnerStreamID(e,e+\":\"+e+\"_low\",n+1,a):t._getInnerStreamID(e,e+\":\"+e+\"_\"+n+\"_low\",n+1,a):t._getInnerStreamID(e,e+\":\"+e+\"_\"+(n+1),n+1,a)}}]),t}(m.EventEmitter);t.default=P},function(e,t,r){var n;n=function(){var e=!0;function t(t){function r(e){var r=t.match(e);return r&&r.length>1&&r[1]||\"\"}function n(e){var r=t.match(e);return r&&r.length>1&&r[2]||\"\"}var a,o=r(/(ipod|iphone|ipad)/i).toLowerCase(),s=!/like android/i.test(t)&&/android/i.test(t),c=/nexus\\s*[0-6]\\s*/i.test(t),u=!c&&/nexus\\s*[0-9]+/i.test(t),d=/CrOS/.test(t),l=/silk/i.test(t),p=/sailfish/i.test(t),f=/tizen/i.test(t),m=/(web|hpw)(o|0)s/i.test(t),h=/windows phone/i.test(t),v=(/SamsungBrowser/i.test(t),!h&&/windows/i.test(t)),_=!o&&!l&&/macintosh/i.test(t),g=!s&&!p&&!f&&!m&&/linux/i.test(t),y=n(/edg([ea]|ios)\\/(\\d+(\\.\\d+)?)/i),b=r(/version\\/(\\d+(\\.\\d+)?)/i),k=/tablet/i.test(t)&&!/tablet pc/i.test(t),w=!k&&/[^-]mobi/i.test(t),P=/xbox/i.test(t);/opera/i.test(t)?a={name:\"Opera\",opera:e,version:b||r(/(?:opera|opr|opios)[\\s\\/](\\d+(\\.\\d+)?)/i)}:/opr\\/|opios/i.test(t)?a={name:\"Opera\",opera:e,version:r(/(?:opr|opios)[\\s\\/](\\d+(\\.\\d+)?)/i)||b}:/SamsungBrowser/i.test(t)?a={name:\"Samsung Internet for Android\",samsungBrowser:e,version:b||r(/(?:SamsungBrowser)[\\s\\/](\\d+(\\.\\d+)?)/i)}:/Whale/i.test(t)?a={name:\"NAVER Whale browser\",whale:e,version:r(/(?:whale)[\\s\\/](\\d+(?:\\.\\d+)+)/i)}:/MZBrowser/i.test(t)?a={name:\"MZ Browser\",mzbrowser:e,version:r(/(?:MZBrowser)[\\s\\/](\\d+(?:\\.\\d+)+)/i)}:/coast/i.test(t)?a={name:\"Opera Coast\",coast:e,version:b||r(/(?:coast)[\\s\\/](\\d+(\\.\\d+)?)/i)}:/focus/i.test(t)?a={name:\"Focus\",focus:e,version:r(/(?:focus)[\\s\\/](\\d+(?:\\.\\d+)+)/i)}:/yabrowser/i.test(t)?a={name:\"Yandex Browser\",yandexbrowser:e,version:b||r(/(?:yabrowser)[\\s\\/](\\d+(\\.\\d+)?)/i)}:/ucbrowser/i.test(t)?a={name:\"UC Browser\",ucbrowser:e,version:r(/(?:ucbrowser)[\\s\\/](\\d+(?:\\.\\d+)+)/i)}:/mxios/i.test(t)?a={name:\"Maxthon\",maxthon:e,version:r(/(?:mxios)[\\s\\/](\\d+(?:\\.\\d+)+)/i)}:/epiphany/i.test(t)?a={name:\"Epiphany\",epiphany:e,version:r(/(?:epiphany)[\\s\\/](\\d+(?:\\.\\d+)+)/i)}:/puffin/i.test(t)?a={name:\"Puffin\",puffin:e,version:r(/(?:puffin)[\\s\\/](\\d+(?:\\.\\d+)?)/i)}:/sleipnir/i.test(t)?a={name:\"Sleipnir\",sleipnir:e,version:r(/(?:sleipnir)[\\s\\/](\\d+(?:\\.\\d+)+)/i)}:/k-meleon/i.test(t)?a={name:\"K-Meleon\",kMeleon:e,version:r(/(?:k-meleon)[\\s\\/](\\d+(?:\\.\\d+)+)/i)}:h?(a={name:\"Windows Phone\",osname:\"Windows Phone\",windowsphone:e},y?(a.msedge=e,a.version=y):(a.msie=e,a.version=r(/iemobile\\/(\\d+(\\.\\d+)?)/i))):/msie|trident/i.test(t)?a={name:\"Internet Explorer\",msie:e,version:r(/(?:msie |rv:)(\\d+(\\.\\d+)?)/i)}:d?a={name:\"Chrome\",osname:\"Chrome OS\",chromeos:e,chromeBook:e,chrome:e,version:r(/(?:chrome|crios|crmo)\\/(\\d+(\\.\\d+)?)/i)}:/edg([ea]|ios)/i.test(t)?a={name:\"Microsoft Edge\",msedge:e,version:y}:/vivaldi/i.test(t)?a={name:\"Vivaldi\",vivaldi:e,version:r(/vivaldi\\/(\\d+(\\.\\d+)?)/i)||b}:p?a={name:\"Sailfish\",osname:\"Sailfish OS\",sailfish:e,version:r(/sailfish\\s?browser\\/(\\d+(\\.\\d+)?)/i)}:/seamonkey\\//i.test(t)?a={name:\"SeaMonkey\",seamonkey:e,version:r(/seamonkey\\/(\\d+(\\.\\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(t)?(a={name:\"Firefox\",firefox:e,version:r(/(?:firefox|iceweasel|fxios)[ \\/](\\d+(\\.\\d+)?)/i)},/\\((mobile|tablet);[^\\)]*rv:[\\d\\.]+\\)/i.test(t)&&(a.firefoxos=e,a.osname=\"Firefox OS\")):l?a={name:\"Amazon Silk\",silk:e,version:r(/silk\\/(\\d+(\\.\\d+)?)/i)}:/phantom/i.test(t)?a={name:\"PhantomJS\",phantom:e,version:r(/phantomjs\\/(\\d+(\\.\\d+)?)/i)}:/slimerjs/i.test(t)?a={name:\"SlimerJS\",slimer:e,version:r(/slimerjs\\/(\\d+(\\.\\d+)?)/i)}:/blackberry|\\bbb\\d+/i.test(t)||/rim\\stablet/i.test(t)?a={name:\"BlackBerry\",osname:\"BlackBerry OS\",blackberry:e,version:b||r(/blackberry[\\d]+\\/(\\d+(\\.\\d+)?)/i)}:m?(a={name:\"WebOS\",osname:\"WebOS\",webos:e,version:b||r(/w(?:eb)?osbrowser\\/(\\d+(\\.\\d+)?)/i)},/touchpad\\//i.test(t)&&(a.touchpad=e)):/bada/i.test(t)?a={name:\"Bada\",osname:\"Bada\",bada:e,version:r(/dolfin\\/(\\d+(\\.\\d+)?)/i)}:f?a={name:\"Tizen\",osname:\"Tizen\",tizen:e,version:r(/(?:tizen\\s?)?browser\\/(\\d+(\\.\\d+)?)/i)||b}:/qupzilla/i.test(t)?a={name:\"QupZilla\",qupzilla:e,version:r(/(?:qupzilla)[\\s\\/](\\d+(?:\\.\\d+)+)/i)||b}:/chromium/i.test(t)?a={name:\"Chromium\",chromium:e,version:r(/(?:chromium)[\\s\\/](\\d+(?:\\.\\d+)?)/i)||b}:/chrome|crios|crmo/i.test(t)?a={name:\"Chrome\",chrome:e,version:r(/(?:chrome|crios|crmo)\\/(\\d+(\\.\\d+)?)/i)}:s?a={name:\"Android\",version:b}:/safari|applewebkit/i.test(t)?(a={name:\"Safari\",safari:e},b&&(a.version=b)):o?(a={name:\"iphone\"==o?\"iPhone\":\"ipad\"==o?\"iPad\":\"iPod\"},b&&(a.version=b)):a=/googlebot/i.test(t)?{name:\"Googlebot\",googlebot:e,version:r(/googlebot\\/(\\d+(\\.\\d+))/i)||b}:{name:r(/^(.*)\\/(.*) /),version:n(/^(.*)\\/(.*) /)},!a.msedge&&/(apple)?webkit/i.test(t)?(/(apple)?webkit\\/537\\.36/i.test(t)?(a.name=a.name||\"Blink\",a.blink=e):(a.name=a.name||\"Webkit\",a.webkit=e),!a.version&&b&&(a.version=b)):!a.opera&&/gecko\\//i.test(t)&&(a.name=a.name||\"Gecko\",a.gecko=e,a.version=a.version||r(/gecko\\/(\\d+(\\.\\d+)?)/i)),a.windowsphone||!s&&!a.silk?!a.windowsphone&&o?(a[o]=e,a.ios=e,a.osname=\"iOS\"):_?(a.mac=e,a.osname=\"macOS\"):P?(a.xbox=e,a.osname=\"Xbox\"):v?(a.windows=e,a.osname=\"Windows\"):g&&(a.linux=e,a.osname=\"Linux\"):(a.android=e,a.osname=\"Android\");var S=\"\";a.windows?S=function(e){switch(e){case\"NT\":return\"NT\";case\"XP\":return\"XP\";case\"NT 5.0\":return\"2000\";case\"NT 5.1\":return\"XP\";case\"NT 5.2\":return\"2003\";case\"NT 6.0\":return\"Vista\";case\"NT 6.1\":return\"7\";case\"NT 6.2\":return\"8\";case\"NT 6.3\":return\"8.1\";case\"NT 10.0\":return\"10\";default:return}}(r(/Windows ((NT|XP)( \\d\\d?.\\d)?)/i)):a.windowsphone?S=r(/windows phone (?:os)?\\s?(\\d+(\\.\\d+)*)/i):a.mac?S=(S=r(/Mac OS X (\\d+([_\\.\\s]\\d+)*)/i)).replace(/[_\\s]/g,\".\"):o?S=(S=r(/os (\\d+([_\\s]\\d+)*) like mac os x/i)).replace(/[_\\s]/g,\".\"):s?S=r(/android[ \\/-](\\d+(\\.\\d+)*)/i):a.webos?S=r(/(?:web|hpw)os\\/(\\d+(\\.\\d+)*)/i):a.blackberry?S=r(/rim\\stablet\\sos\\s(\\d+(\\.\\d+)*)/i):a.bada?S=r(/bada\\/(\\d+(\\.\\d+)*)/i):a.tizen&&(S=r(/tizen[\\/\\s](\\d+(\\.\\d+)*)/i)),S&&(a.osversion=S);var I=!a.windows&&S.split(\".\")[0];return k||u||\"ipad\"==o||s&&(3==I||I>=4&&!w)||a.silk?a.tablet=e:(w||\"iphone\"==o||\"ipod\"==o||s||c||a.blackberry||a.webos||a.bada)&&(a.mobile=e),a.msedge||a.msie&&a.version>=10||a.yandexbrowser&&a.version>=15||a.vivaldi&&a.version>=1||a.chrome&&a.version>=20||a.samsungBrowser&&a.version>=4||a.whale&&1===i([a.version,\"1.0\"])||a.mzbrowser&&1===i([a.version,\"6.0\"])||a.focus&&1===i([a.version,\"1.0\"])||a.firefox&&a.version>=20||a.safari&&a.version>=6||a.opera&&a.version>=10||a.ios&&a.osversion&&a.osversion.split(\".\")[0]>=6||a.blackberry&&a.version>=10.1||a.chromium&&a.version>=20?a.a=e:a.msie&&a.version<10||a.chrome&&a.version<20||a.firefox&&a.version<20||a.safari&&a.version<6||a.opera&&a.version<10||a.ios&&a.osversion&&a.osversion.split(\".\")[0]<6||a.chromium&&a.version<20?a.c=e:a.x=e,a}var r=t(\"undefined\"!=typeof navigator&&navigator.userAgent||\"\");function n(e){return e.split(\".\").length}function a(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r++)n.push(t(e[r]));return n}function i(e){for(var t=Math.max(n(e[0]),n(e[1])),r=a(e,(function(e){var r=t-n(e);return a((e+=new Array(r+1).join(\".0\")).split(\".\"),(function(e){return new Array(20-e.length).join(\"0\")+e})).reverse()}));--t>=0;){if(r[0][t]>r[1][t])return 1;if(r[0][t]!==r[1][t])return-1;if(0===t)return 0}}function o(e,n,a){var o=r;\"string\"==typeof n&&(a=n,n=void 0),void 0===n&&(n=!1),a&&(o=t(a));var s=\"\"+o.version;for(var c in e)if(e.hasOwnProperty(c)&&o[c]){if(\"string\"!=typeof e[c])throw new Error(\"Browser version in the minVersion map should be a string: \"+c+\": \"+String(e));return i([s,e[c]])<0}return n}return r.test=function(e){for(var t=0;t<e.length;++t){var n=e[t];if(\"string\"==typeof n&&n in r)return!0}return!1},r.isUnsupportedBrowser=o,r.compareVersions=i,r.check=function(e,t,r){return!o(e,t,r)},r._detect=t,r.detect=t,r},e.exports?e.exports=n():r(177)(\"bowser\",n)},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.internals=t.Room=void 0;var n=u(r(6));t.setDeviceHandler=function(e,t){i.default.setHandler(e,t)},t.isDeviceSupported=function(){return i.default.isSupported()},t.getDeviceInfo=function(){return{flag:i.default.getFlag(),name:i.default.getName(),version:i.default.getVersion(),bowser:i.default.getBowser()}},t.checkCapabilitiesForRoom=function(e){return i.default.isSupported()?i.default.Handler.getNativeRtpCapabilities().then((function(t){var r=a.getExtendedRtpCapabilities(t,e);return{audio:a.canSend(\"audio\",r),video:a.canSend(\"video\",r)}})):n.default.reject(new Error(\"current browser/device not supported\"))};var a=c(r(15)),i=u(r(80)),o=u(r(209)),s=c(r(215));function c(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function u(e){return e&&e.__esModule?e:{default:e}}t.Room=o.default,t.internals=s},function(e,t,r){\"use strict\";var n,a=r(40),i=(n=a)&&n.__esModule?n:{default:n};var o=e.exports={v:[{name:\"version\",reg:/^(\\d*)$/}],o:[{name:\"origin\",reg:/^(\\S*) (\\d*) (\\d*) (\\S*) IP(\\d) (\\S*)/,names:[\"username\",\"sessionId\",\"sessionVersion\",\"netType\",\"ipVer\",\"address\"],format:\"%s %s %d %s IP%d %s\"}],s:[{name:\"name\"}],i:[{name:\"description\"}],u:[{name:\"uri\"}],e:[{name:\"email\"}],p:[{name:\"phone\"}],z:[{name:\"timezones\"}],r:[{name:\"repeats\"}],t:[{name:\"timing\",reg:/^(\\d*) (\\d*)/,names:[\"start\",\"stop\"],format:\"%d %d\"}],c:[{name:\"connection\",reg:/^IN IP(\\d) (\\S*)/,names:[\"version\",\"ip\"],format:\"IN IP%d %s\"}],b:[{push:\"bandwidth\",reg:/^(TIAS|AS|CT|RR|RS):(\\d*)/,names:[\"type\",\"limit\"],format:\"%s:%s\"}],m:[{reg:/^(\\w*) (\\d*) ([\\w\\/]*)(?: (.*))?/,names:[\"type\",\"port\",\"protocol\",\"payloads\"],format:\"%s %d %s %s\"}],a:[{push:\"rtp\",reg:/^rtpmap:(\\d*) ([\\w\\-\\.]*)(?:\\s*\\/(\\d*)(?:\\s*\\/(\\S*))?)?/,names:[\"payload\",\"codec\",\"rate\",\"encoding\"],format:function(e){return e.encoding?\"rtpmap:%d %s/%s/%s\":e.rate?\"rtpmap:%d %s/%s\":\"rtpmap:%d %s\"}},{push:\"fmtp\",reg:/^fmtp:(\\d*) ([\\S| ]*)/,names:[\"payload\",\"config\"],format:\"fmtp:%d %s\"},{name:\"control\",reg:/^control:(.*)/,format:\"control:%s\"},{name:\"rtcp\",reg:/^rtcp:(\\d*)(?: (\\S*) IP(\\d) (\\S*))?/,names:[\"port\",\"netType\",\"ipVer\",\"address\"],format:function(e){return null!=e.address?\"rtcp:%d %s IP%d %s\":\"rtcp:%d\"}},{push:\"rtcpFbTrrInt\",reg:/^rtcp-fb:(\\*|\\d*) trr-int (\\d*)/,names:[\"payload\",\"value\"],format:\"rtcp-fb:%d trr-int %d\"},{push:\"rtcpFb\",reg:/^rtcp-fb:(\\*|\\d*) ([\\w-_]*)(?: ([\\w-_]*))?/,names:[\"payload\",\"type\",\"subtype\"],format:function(e){return null!=e.subtype?\"rtcp-fb:%s %s %s\":\"rtcp-fb:%s %s\"}},{push:\"ext\",reg:/^extmap:(\\d+)(?:\\/(\\w+))? (\\S*)(?: (\\S*))?/,names:[\"value\",\"direction\",\"uri\",\"config\"],format:function(e){return\"extmap:%d\"+(e.direction?\"/%s\":\"%v\")+\" %s\"+(e.config?\" %s\":\"\")}},{push:\"crypto\",reg:/^crypto:(\\d*) ([\\w_]*) (\\S*)(?: (\\S*))?/,names:[\"id\",\"suite\",\"config\",\"sessionConfig\"],format:function(e){return null!=e.sessionConfig?\"crypto:%d %s %s %s\":\"crypto:%d %s %s\"}},{name:\"setup\",reg:/^setup:(\\w*)/,format:\"setup:%s\"},{name:\"mid\",reg:/^mid:([^\\s]*)/,format:\"mid:%s\"},{name:\"msid\",reg:/^msid:(.*)/,format:\"msid:%s\"},{name:\"ptime\",reg:/^ptime:(\\d*)/,format:\"ptime:%d\"},{name:\"maxptime\",reg:/^maxptime:(\\d*)/,format:\"maxptime:%d\"},{name:\"direction\",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:\"icelite\",reg:/^(ice-lite)/},{name:\"iceUfrag\",reg:/^ice-ufrag:(\\S*)/,format:\"ice-ufrag:%s\"},{name:\"icePwd\",reg:/^ice-pwd:(\\S*)/,format:\"ice-pwd:%s\"},{name:\"fingerprint\",reg:/^fingerprint:(\\S*) (\\S*)/,names:[\"type\",\"hash\"],format:\"fingerprint:%s %s\"},{push:\"candidates\",reg:/^candidate:(\\S*) (\\d*) (\\S*) (\\d*) (\\S*) (\\d*) typ (\\S*)(?: raddr (\\S*) rport (\\d*))?(?: tcptype (\\S*))?(?: generation (\\d*))?(?: network-id (\\d*))?(?: network-cost (\\d*))?/,names:[\"foundation\",\"component\",\"transport\",\"priority\",\"ip\",\"port\",\"type\",\"raddr\",\"rport\",\"tcptype\",\"generation\",\"network-id\",\"network-cost\"],format:function(e){var t=\"candidate:%s %d %s %d %s %d typ %s\";return t+=null!=e.raddr?\" raddr %s rport %d\":\"%v%v\",t+=null!=e.tcptype?\" tcptype %s\":\"%v\",null!=e.generation&&(t+=\" generation %d\"),t+=null!=e[\"network-id\"]?\" network-id %d\":\"%v\",t+=null!=e[\"network-cost\"]?\" network-cost %d\":\"%v\"}},{name:\"endOfCandidates\",reg:/^(end-of-candidates)/},{name:\"remoteCandidates\",reg:/^remote-candidates:(.*)/,format:\"remote-candidates:%s\"},{name:\"iceOptions\",reg:/^ice-options:(\\S*)/,format:\"ice-options:%s\"},{push:\"ssrcs\",reg:/^ssrc:(\\d*) ([\\w_-]*)(?::(.*))?/,names:[\"id\",\"attribute\",\"value\"],format:function(e){var t=\"ssrc:%d\";return null!=e.attribute&&(t+=\" %s\",null!=e.value&&(t+=\":%s\")),t}},{push:\"ssrcGroups\",reg:/^ssrc-group:([\\x21\\x23\\x24\\x25\\x26\\x27\\x2A\\x2B\\x2D\\x2E\\w]*) (.*)/,names:[\"semantics\",\"ssrcs\"],format:\"ssrc-group:%s %s\"},{name:\"msidSemantic\",reg:/^msid-semantic:\\s?(\\w*) (\\S*)/,names:[\"semantic\",\"token\"],format:\"msid-semantic: %s %s\"},{push:\"groups\",reg:/^group:(\\w*) (.*)/,names:[\"type\",\"mids\"],format:\"group:%s %s\"},{name:\"rtcpMux\",reg:/^(rtcp-mux)/},{name:\"rtcpRsize\",reg:/^(rtcp-rsize)/},{name:\"sctpmap\",reg:/^sctpmap:([\\w_\\/]*) (\\S*)(?: (\\S*))?/,names:[\"sctpmapNumber\",\"app\",\"maxMessageSize\"],format:function(e){return null!=e.maxMessageSize?\"sctpmap:%s %s %s\":\"sctpmap:%s %s\"}},{name:\"xGoogleFlag\",reg:/^x-google-flag:([^\\s]*)/,format:\"x-google-flag:%s\"},{push:\"rids\",reg:/^rid:([\\d\\w]+) (\\w+)(?: ([\\S| ]*))?/,names:[\"id\",\"direction\",\"params\"],format:function(e){return e.params?\"rid:%s %s %s\":\"rid:%s %s\"}},{push:\"imageattrs\",reg:new RegExp(\"^imageattr:(\\\\d+|\\\\*)[\\\\s\\\\t]+(send|recv)[\\\\s\\\\t]+(\\\\*|\\\\[\\\\S+\\\\](?:[\\\\s\\\\t]+\\\\[\\\\S+\\\\])*)(?:[\\\\s\\\\t]+(recv|send)[\\\\s\\\\t]+(\\\\*|\\\\[\\\\S+\\\\](?:[\\\\s\\\\t]+\\\\[\\\\S+\\\\])*))?\"),names:[\"pt\",\"dir1\",\"attrs1\",\"dir2\",\"attrs2\"],format:function(e){return\"imageattr:%s %s %s\"+(e.dir2?\" %s %s\":\"\")}},{name:\"simulcast\",reg:new RegExp(\"^simulcast:(send|recv) ([a-zA-Z0-9\\\\-_~;,]+)(?:\\\\s?(send|recv) ([a-zA-Z0-9\\\\-_~;,]+))?$\"),names:[\"dir1\",\"list1\",\"dir2\",\"list2\"],format:function(e){return\"simulcast:%s %s\"+(e.dir2?\" %s %s\":\"\")}},{name:\"simulcast_03\",reg:/^simulcast:[\\s\\t]+([\\S+\\s\\t]+)$/,names:[\"value\"],format:\"simulcast: %s\"},{name:\"framerate\",reg:/^framerate:(\\d+(?:$|\\.\\d+))/,format:\"framerate:%s\"},{name:\"sourceFilter\",reg:/^source-filter: *(excl|incl) (\\S*) (IP4|IP6|\\*) (\\S*) (.*)/,names:[\"filterMode\",\"netType\",\"addressTypes\",\"destAddress\",\"srcList\"],format:\"source-filter: %s %s %s %s %s\"},{name:\"bundleOnly\",reg:/^(bundle-only)/},{name:\"label\",reg:/^label:(.+)/,format:\"label:%s\"},{name:\"sctpPort\",reg:/^sctp-port:(\\d+)$/,format:\"sctp-port:%s\"},{name:\"maxMessageSize\",reg:/^max-message-size:(\\d+)$/,format:\"max-message-size:%s\"},{push:\"invalid\",names:[\"value\"]}]};(0,i.default)(o).forEach((function(e){o[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format=\"%s\")}))}))},function(e,t){!function(t){function r(e){var t=(e=e||{}).min,r=e.max,n=e.integer||!1;if(null==t&&null==r?(t=0,r=1):null==t?t=r-1:null==r&&(r=t+1),r<t)throw new Error(\"invalid options, max must be >= min\");return{min:t,max:r,integer:n}}function n(e){if((e=r(e)).max===e.min)return e.min;var t=Math.random()*(e.max-e.min+Number(!!e.integer))+e.min;return e.integer?Math.floor(t):t}e.exports=n,e.exports.generator=function(e){return e=r(e),function(t,r,a){return e.min=null!=t?t:e.min,e.max=null!=r?r:e.max,e.integer=null!=a?a:e.integer,n(e)}},e.exports.defaults=r}()},function(e,t,r){\"use strict\";t.__esModule=!0;var n=i(r(191)),a=i(r(17));function i(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if(Array.isArray(e))return e;if((0,n.default)(Object(e)))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var s,c=(0,a.default)(e);!(n=(s=c.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=c(r(26)),a=c(r(0)),i=c(r(1)),o=c(r(30)),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(116));function c(e){return e&&e.__esModule?e:{default:e}}var u=new o.default(\"<protooMessage>\"),d=function(){function e(){(0,a.default)(this,e)}return(0,i.default)(e,null,[{key:\"parse\",value:function(e){var t=void 0,r={};try{t=JSON.parse(e)}catch(e){return void u.error(\"parse() | invalid JSON: %s\",e)}if(\"object\"===(void 0===t?\"undefined\":(0,n.default)(t))&&!Array.isArray(t)){if(t.request){if(r.request=!0,\"string\"!=typeof t.method)return void u.error(\"parse() | missing/invalid method field\");if(\"number\"!=typeof t.id)return void u.error(\"parse() | missing/invalid id field\");r.id=t.id,r.method=t.method,r.data=t.data||{}}else if(t.response){if(r.response=!0,\"number\"!=typeof t.id)return void u.error(\"parse() | missing/invalid id field\");r.id=t.id,t.ok?(r.ok=!0,r.data=t.data||{}):(r.errorCode=t.errorCode,r.errorReason=t.errorReason)}else{if(!t.notification)return void u.error(\"parse() | missing request/response field\");if(r.notification=!0,\"string\"!=typeof t.method)return void u.error(\"parse() | missing/invalid method field\");r.method=t.method,r.data=t.data||{}}return r}u.error(\"parse() | not an object\")}},{key:\"requestFactory\",value:function(e,t){return{request:!0,id:s.randomNumberGenerator(),method:e,data:t||{}}}},{key:\"successResponseFactory\",value:function(e,t){return{response:!0,id:e.id,ok:!0,data:t||{}}}},{key:\"errorResponseFactory\",value:function(e,t,r){return{response:!0,id:e.id,errorCode:t,errorReason:r}}},{key:\"notificationFactory\",value:function(e,t){return{notification:!0,method:e,data:t||{}}}}]),e}();t.default=d},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=r(113);t.randomNumberGenerator=n.generator({min:1e6,max:9999999,integer:!0})},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=f(r(6)),a=f(r(2)),i=f(r(24)),o=f(r(0)),s=f(r(1)),c=f(r(3)),u=f(r(4)),d=r(29),l=f(r(30)),p=f(r(115));function f(e){return e&&e.__esModule?e:{default:e}}var m=r(220).w3cwebsocket,h=r(108),v=new l.default(\"<protooWebSocketTransport>\"),_={retries:10,factor:2,minTimeout:1e3,maxTimeout:4e3},g=function(e){function t(e,r){(0,o.default)(this,t),v.debug(\"constructor() - url: \"+e+\" options: \"+(0,i.default)(r));var n=(0,c.default)(this,(t.__proto__||(0,a.default)(t)).call(this));n.setMaxListeners(1/0);var s=Date.parse(new Date),u=Math.round(1e9*Math.random());return n._origUrl=e+\"&sid=\"+s+\"-\"+u,n._url=n._origUrl,n._options=r||{},n._ws=null,n._xNeedReInit=!1,n._closed=!1,n._connected=!1,n._setWebSocket(),n}return(0,u.default)(t,e),(0,s.default)(t,[{key:\"send\",value:function(e){if(this._closed)return n.default.reject(new Error(\"transport closed\"));try{return this._ws.send((0,i.default)(e)),n.default.resolve()}catch(t){return v.warn(\"send() messge: \"+(0,i.default)(e)+\" error - \"+t.toString()),n.default.reject(t)}}},{key:\"close\",value:function(){if(v.debug(\"close()\"),!this._closed){this._xNeedReInit=!1,this._closed=!0,this.emit(\"close\",{code:3e3,reason:\"active close\"});try{this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.close()}catch(e){v.error(\"close() error - closing the WebSocket: \"+e.toString())}}}},{key:\"_setWebSocket\",value:function(){var e=this,t=this._options,r=h.operation(this._options.retry||_);this._connected=!1,r.attempt((function(n){e._closed?r.stop():(null!=e._ws&&(e._ws.close(),e._ws=null),v.debug(\"_setWebSocket() - currentAttempt: \"+n),e._ws=new m(e._url,\"protoo\",t.origin,t.headers,t.requestOptions,t.clientConfig),e.emit(\"connecting\",n),e._ws.onopen=function(t){if(!e._closed){e._connected=!0;if(-1!==e._url.indexOf(\"retry=true\",e._url.length-\"retry=true\".length))v.debug(\"WebSocket event - [conn-reconn] - this._url: \"+e._url),e.emit(\"conn-reconn\");else{var r=e._xNeedReInit?\"reinit\":\"open\";v.debug(\"WebSocket event - [\"+r+\"] - this._url: \"+e._url),e._xNeedReInit=!1,e.emit(r)}}},e._ws.onclose=function(t){if(!e._closed)if(e.emit(\"conn-interrupt\",t),v.warn(\"WebSocket event - [close] wasClean: \"+t.wasClean+\" code: \"+t.code+\" reason: \"+t.reason),4e3!==t.code){if(e._xNeedReInit=3003===t.code,e._connected||e._xNeedReInit){if(r.stop(),e._closed)return;return e._url=e._xNeedReInit?e._origUrl+\"&timestamp=\"+ +new Date:e._origUrl+\"&timestamp=\"+ +new Date+\"&retry=true\",v.debug(\"WebSocket event - [close] event.code !== 4000 - retry websocket transport: \"+e._url),void e._setWebSocket()}if(e._closed)return;if(r.retry(!0))return;v.debug(\"WebSocket event - [close] event.code === 4000 - Emit [close]\"),e.emit(\"close\",t)}else e._xNeedReInit=!1,e._url=e._origUrl+\"&timestamp=\"+ +new Date,e._closed=!0,v.debug(\"WebSocket event - [close] event.code === 4000 - Emit [close]\"),e.emit(\"close\",t)},e._ws.onerror=function(t){e._closed||v.error(\"WebSocket event [error] - \"+t.toString()+\" - nothing todo.\")},e._ws.onmessage=function(t){if(!e._closed){var r=p.default.parse(t.data);r&&(0!==e.listenerCount(\"message\")?e.emit(\"message\",r):v.warn(\"no listeners for WebSocket event [message] - ignoring received message\"))}})}))}},{key:\"connected\",get:function(){return this._connected}},{key:\"closed\",get:function(){return this._closed}}]),t}(d.EventEmitter);t.default=g},function(e){e.exports=JSON.parse('{\"name\":\"tttwebsdk\",\"version\":\"3.4.28\",\"description\":\"webrtc of 3ttech.cn\",\"buildDate\":\"Apr__1_2020-1\",\"main\":\"lib/TTTRtcWeb.js\",\"scripts\":{\"test\":\"jest\",\"start\":\"webpack-dev-server --open\",\"build:app\":\"webpack\",\"build:demo\":\"webpack --config webpack.config/webpack.config.demo.js\",\"build:dev\":\"webpack --config webpack.config/webpack.config.dev.js --mode development\",\"build:prod\":\"webpack --config webpack.config/webpack.config.js\",\"build:proddemo\":\"webpack --config webpack.config/webpack.config.proddemo.js\",\"build:test\":\"webpack --config tests/webpack.config.js\",\"build:demo-multistream\":\"webpack --config webpack.config/webpack.config.demo_multistream.js\",\"lint\":\"eslint -c .eslintrc.js lib/protoo lib/client.js lib/index.js lib/stats.js lib/config.js lib/utils.js lib/stream.js lib/TTTRtcWeb.js\",\"3.1:test\":\"webpack --config ./tests/3.1.test.pages/webpack.config.js\"},\"author\":\"3ttech.cn\",\"license\":\"ISC\",\"dependencies\":{\"babel-runtime\":\"^6.26.0\",\"bowser\":\"^1.9.3\",\"debug\":\"^4.1.1\",\"hark\":\"^1.2.3\",\"random-number\":\"^0.0.9\",\"retry\":\"^0.12.0\",\"websocket\":\"^1.0.28\"},\"devDependencies\":{\"babel-core\":\"^6.26.3\",\"babel-loader\":\"^7.1.1\",\"babel-plugin-transform-runtime\":\"^6.23.0\",\"babel-polyfill\":\"^6.26.0\",\"babel-preset-env\":\"^1.7.0\",\"babel-preset-es2015\":\"^6.24.1\",\"babel-preset-stage-0\":\"^6.24.1\",\"copy-webpack-plugin\":\"^5.0.4\",\"eslint\":\"^5.16.0\",\"eslint-plugin-react\":\"^7.13.0\",\"html-webpack-plugin\":\"^3.2.0\",\"http-server\":\"^0.11.1\",\"jest\":\"^24.9.0\",\"jest-websocket-mock\":\"^1.5.0\",\"mock-socket\":\"^9.0.0\",\"sweetalert2\":\"^8.11.4\",\"webpack\":\"^4.41.0\",\"webpack-cli\":\"^3.2.3\",\"webpack-dev-server\":\"^3.1.14\",\"webpack-jquery-ui\":\"^2.0.1\"},\"files\":[\"lib/\",\"screen/\",\"docs/\",\"README.md\",\"CHANGELOG.md\"]}')},function(e,t,r){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0});var n=h(r(24)),a=h(r(2)),i=h(r(0)),o=h(r(1)),s=h(r(3)),c=h(r(4)),u=r(29),d=h(r(149)),l=h(r(109)),p=h(r(30)),f=h(r(107)),m=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(111));function h(e){return e&&e.__esModule?e:{default:e}}var v=r(118),_=new p.default(\"<TTTRtcWeb>\");e.g_client=null;var g=function(t){function r(){(0,i.default)(this,r);var t=(0,s.default)(this,(r.__proto__||(0,a.default)(r)).call(this));_.debug(\"constructor()\"),l.default.clearStreamIdMap(),r.listDevices((function(e){_.debug(\"TTTRtcWeb.listDevices - devices: \"+(0,n.default)(e))}),(function(e){var t=e.name+e.message+\"\\n\";_.warn(\"TTTRtcWeb.listDevices error - \"+t)})),e.g_tttRtcWeb=t,t._client=null;try{navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(e){_.debug(\"constructor succ.\")})).catch((function(e){_.warn(\"constructor fail - \"+e.toString())}))}catch(e){_.warn(\"constructor() fail - \"+e.toString())}return t}return(0,c.default)(r,t),(0,o.default)(r,[{key:\"checkSystemRequirements\",value:function(){var e=m.isDeviceSupported();return!!RTCPeerConnection&&!!navigator.mediaDevices.getUserMedia&&!!e}},{key:\"getDevices\",value:function(e,t){\"function\"==typeof e?\"function\"==typeof t?navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then((function(t){e(t)})).catch((function(e){t(e)})):_.error(\"enumerateDevices() not supported.\"):_.error(\"API getDevices() error - parameter: onFailure invalid\"):_.error(\"API getDevices() error - parameter: onSuccess invalid\")}},{key:\"createStream\",value:function(e){if(!r.isSystemSupported())return _.warn(\"createStream() - isSystemSupported not supported.\"),null;if(!this._client||this._client.isLocalStreamAllowed){_.debug(\"createStream() - spec: \"+(0,n.default)(e));var t=new l.default(e);return t||null}_.warn(\"createStream() - Client.isLocalStreamAllowed is false\")}},{key:\"createClient\",value:function(t){return r.isSystemSupported()?(e.g_client&&(e.g_client.close(),e.g_client=null),_.debug(\"createClient() - config: \"+(0,n.default)(t)),this._client=new d.default(t),e.g_client=this._client,this._client):(_.error(\"createClient() - isSystemSupported not supported.\"),null)}},{key:\"getStats\",value:function(){return null==this._client?{}:this._client.getNetState()}},{key:\"version\",get:function(){return v.version+\"-\"+v.buildDate}}],[{key:\"isSystemSupported\",value:function(){var e=m.isDeviceSupported();return!!RTCPeerConnection&&!!navigator.mediaDevices.getUserMedia&&!!e}},{key:\"listDevices\",value:function(e,t){\"function\"==typeof e?\"function\"==typeof t?navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then((function(t){e(t)})).catch((function(e){t(e)})):_.error(\"enumerateDevices() not supported.\"):_.error(\"API getDevices() error - parameter: onFailure invalid\"):_.error(\"API getDevices() error - parameter: onSuccess invalid\")}},{key:\"setLogLevel\",value:function(e){p.default.logLevel=e}},{key:\"setLogSubmit\",value:function(e){p.default.logSubmit=Boolean(e)}},{key:\"setPrivate\",value:function(e){p.default.privateCloud=e,f.default.privateCloud=e}},{key:\"getVersion\",value:function(){return v.version+\"-\"+v.buildDate}},{key:\"setServerUrl\",value:function(e){e&&\"\"!==e.trim()&&(_.debug(\"setServerUrl() - rootUrl: \"+e),f.default.MediaServerAddress=e.trim())}},{key:\"setIpLocationAddress\",value:function(e){e&&\"\"!==e.trim()&&(_.debug(\"setIpLocationAddress() - iplocation: \"+e),f.default.IplocationAddress=e)}},{key:\"setIpLocationPort\",value:function(e){_.debug(\"setIpLocationPort() - port: \"+e),f.default.IplocationPort=e}},{key:\"setTurnConf\",value:function(e){d.default.TurnConf=e}}]),r}(u.EventEmitter);t.default=g}).call(this,r(43))},function(e,t,r){var n=r(7),a=n.JSON||(n.JSON={stringify:JSON.stringify});e.exports=function(e){return a.stringify.apply(a,arguments)}},function(e,t,r){r(122),e.exports=r(7).Object.getPrototypeOf},function(e,t,r){var n=r(31),a=r(82);r(65)(\"getPrototypeOf\",(function(){return function(e){return a(n(e))}}))},function(e,t,r){e.exports={default:r(124),__esModule:!0}},function(e,t,r){r(125);var n=r(7).Object;e.exports=function(e,t,r){return n.defineProperty(e,t,r)}},function(e,t,r){var n=r(11);n(n.S+n.F*!r(22),\"Object\",{defineProperty:r(21).f})},function(e,t,r){e.exports={default:r(127),__esModule:!0}},function(e,t,r){r(34),r(39),e.exports=r(72).f(\"iterator\")},function(e,t,r){var n=r(68),a=r(62);e.exports=function(e){return function(t,r){var i,o,s=String(a(t)),c=n(r),u=s.length;return c<0||c>=u?e?\"\":void 0:(i=s.charCodeAt(c))<55296||i>56319||c+1===u||(o=s.charCodeAt(c+1))<56320||o>57343?e?s.charAt(c):i:e?s.slice(c,c+2):o-56320+(i-55296<<10)+65536}}},function(e,t,r){\"use strict\";var n=r(54),a=r(46),i=r(49),o={};r(28)(o,r(14)(\"iterator\"),(function(){return this})),e.exports=function(e,t,r){e.prototype=n(o,{next:a(1,r)}),i(e,t+\" Iterator\")}},function(e,t,r){var n=r(21),a=r(25),i=r(47);e.exports=r(22)?Object.defineProperties:function(e,t){a(e);for(var r,o=i(t),s=o.length,c=0;s>c;)n.f(e,r=o[c++],t[r]);return e}},function(e,t,r){var n=r(38),a=r(55),i=r(132);e.exports=function(e){return function(t,r,o){var s,c=n(t),u=a(c.length),d=i(o,u);if(e&&r!=r){for(;u>d;)if((s=c[d++])!=s)return!0}else for(;u>d;d++)if((e||d in c)&&c[d]===r)return e||d||0;return!e&&-1}}},function(e,t,r){var n=r(68),a=Math.max,i=Math.min;e.exports=function(e,t){return(e=n(e))<0?a(e+t,0):i(e,t)}},function(e,t,r){\"use strict\";var n=r(134),a=r(87),i=r(37),o=r(38);e.exports=r(69)(Array,\"Array\",(function(e,t){this._t=o(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,a(1)):a(0,\"keys\"==t?r:\"values\"==t?e[r]:[r,e[r]])}),\"values\"),i.Arguments=i.Array,n(\"keys\"),n(\"values\"),n(\"entries\")},function(e,t){e.exports=function(){}},function(e,t,r){e.exports={default:r(136),__esModule:!0}},function(e,t,r){r(137),r(58),r(140),r(141),e.exports=r(7).Symbol},function(e,t,r){\"use strict\";var n=r(13),a=r(32),i=r(22),o=r(11),s=r(84),c=r(56).KEY,u=r(33),d=r(64),l=r(49),p=r(53),f=r(14),m=r(72),h=r(73),v=r(138),_=r(88),g=r(25),y=r(18),b=r(31),k=r(38),w=r(67),P=r(46),S=r(54),I=r(139),T=r(90),C=r(74),R=r(21),x=r(47),A=T.f,E=R.f,D=I.f,O=n.Symbol,L=n.JSON,j=L&&L.stringify,M=f(\"_hidden\"),B=f(\"toPrimitive\"),V={}.propertyIsEnumerable,N=d(\"symbol-registry\"),F=d(\"symbols\"),U=d(\"op-symbols\"),G=Object.prototype,W=\"function\"==typeof O&&!!C.f,K=n.QObject,z=!K||!K.prototype||!K.prototype.findChild,q=i&&u((function(){return 7!=S(E({},\"a\",{get:function(){return E(this,\"a\",{value:7}).a}})).a}))?function(e,t,r){var n=A(G,t);n&&delete G[t],E(e,t,r),n&&e!==G&&E(G,t,n)}:E,H=function(e){var t=F[e]=S(O.prototype);return t._k=e,t},J=W&&\"symbol\"==typeof O.iterator?function(e){return\"symbol\"==typeof e}:function(e){return e instanceof O},Q=function(e,t,r){return e===G&&Q(U,t,r),g(e),t=w(t,!0),g(r),a(F,t)?(r.enumerable?(a(e,M)&&e[M][t]&&(e[M][t]=!1),r=S(r,{enumerable:P(0,!1)})):(a(e,M)||E(e,M,P(1,{})),e[M][t]=!0),q(e,t,r)):E(e,t,r)},Y=function(e,t){g(e);for(var r,n=v(t=k(t)),a=0,i=n.length;i>a;)Q(e,r=n[a++],t[r]);return e},$=function(e){var t=V.call(this,e=w(e,!0));return!(this===G&&a(F,e)&&!a(U,e))&&(!(t||!a(this,e)||!a(F,e)||a(this,M)&&this[M][e])||t)},X=function(e,t){if(e=k(e),t=w(t,!0),e!==G||!a(F,t)||a(U,t)){var r=A(e,t);return!r||!a(F,t)||a(e,M)&&e[M][t]||(r.enumerable=!0),r}},Z=function(e){for(var t,r=D(k(e)),n=[],i=0;r.length>i;)a(F,t=r[i++])||t==M||t==c||n.push(t);return n},ee=function(e){for(var t,r=e===G,n=D(r?U:k(e)),i=[],o=0;n.length>o;)!a(F,t=n[o++])||r&&!a(G,t)||i.push(F[t]);return i};W||(s((O=function(){if(this instanceof O)throw TypeError(\"Symbol is not a constructor!\");var e=p(arguments.length>0?arguments[0]:void 0),t=function(r){this===G&&t.call(U,r),a(this,M)&&a(this[M],e)&&(this[M][e]=!1),q(this,e,P(1,r))};return i&&z&&q(G,e,{configurable:!0,set:t}),H(e)}).prototype,\"toString\",(function(){return this._k})),T.f=X,R.f=Q,r(89).f=I.f=Z,r(57).f=$,C.f=ee,i&&!r(44)&&s(G,\"propertyIsEnumerable\",$,!0),m.f=function(e){return H(f(e))}),o(o.G+o.W+o.F*!W,{Symbol:O});for(var te=\"hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables\".split(\",\"),re=0;te.length>re;)f(te[re++]);for(var ne=x(f.store),ae=0;ne.length>ae;)h(ne[ae++]);o(o.S+o.F*!W,\"Symbol\",{for:function(e){return a(N,e+=\"\")?N[e]:N[e]=O(e)},keyFor:function(e){if(!J(e))throw TypeError(e+\" is not a symbol!\");for(var t in N)if(N[t]===e)return t},useSetter:function(){z=!0},useSimple:function(){z=!1}}),o(o.S+o.F*!W,\"Object\",{create:function(e,t){return void 0===t?S(e):Y(S(e),t)},defineProperty:Q,defineProperties:Y,getOwnPropertyDescriptor:X,getOwnPropertyNames:Z,getOwnPropertySymbols:ee});var ie=u((function(){C.f(1)}));o(o.S+o.F*ie,\"Object\",{getOwnPropertySymbols:function(e){return C.f(b(e))}}),L&&o(o.S+o.F*(!W||u((function(){var e=O();return\"[null]\"!=j([e])||\"{}\"!=j({a:e})||\"{}\"!=j(Object(e))}))),\"JSON\",{stringify:function(e){for(var t,r,n=[e],a=1;arguments.length>a;)n.push(arguments[a++]);if(r=t=n[1],(y(t)||void 0!==e)&&!J(e))return _(t)||(t=function(e,t){if(\"function\"==typeof r&&(t=r.call(this,e,t)),!J(t))return t}),n[1]=t,j.apply(L,n)}}),O.prototype[B]||r(28)(O.prototype,B,O.prototype.valueOf),l(O,\"Symbol\"),l(Math,\"Math\",!0),l(n.JSON,\"JSON\",!0)},function(e,t,r){var n=r(47),a=r(74),i=r(57);e.exports=function(e){var t=n(e),r=a.f;if(r)for(var o,s=r(e),c=i.f,u=0;s.length>u;)c.call(e,o=s[u++])&&t.push(o);return t}},function(e,t,r){var n=r(38),a=r(89).f,i={}.toString,o=\"object\"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return o&&\"[object Window]\"==i.call(e)?function(e){try{return a(e)}catch(e){return o.slice()}}(e):a(n(e))}},function(e,t,r){r(73)(\"asyncIterator\")},function(e,t,r){r(73)(\"observable\")},function(e,t,r){e.exports={default:r(143),__esModule:!0}},function(e,t,r){r(144),e.exports=r(7).Object.setPrototypeOf},function(e,t,r){var n=r(11);n(n.S,\"Object\",{setPrototypeOf:r(145).set})},function(e,t,r){var n=r(18),a=r(25),i=function(e,t){if(a(e),!n(t)&&null!==t)throw TypeError(t+\": can't set as prototype!\")};e.exports={set:Object.setPrototypeOf||(\"__proto__\"in{}?function(e,t,n){try{(n=r(27)(Function.call,r(90).f(Object.prototype,\"__proto__\").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,r){return i(e,r),t?e.__proto__=r:n(e,r),e}}({},!1):void 0),check:i}},function(e,t,r){e.exports={default:r(147),__esModule:!0}},function(e,t,r){r(148);var n=r(7).Object;e.exports=function(e,t){return n.create(e,t)}},function(e,t,r){var n=r(11);n(n.S,\"Object\",{create:r(54)})},function(e,t,r){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0});var n=C(r(40)),a=C(r(26)),i=C(r(6)),o=C(r(99)),s=C(r(100)),c=C(r(17)),u=C(r(24)),d=C(r(8)),l=C(r(2)),p=C(r(0)),f=C(r(1)),m=C(r(3)),h=C(r(4)),v=C(r(30)),_=C(r(107)),g=T(r(60)),y=C(r(109)),b=T(r(111)),k=r(29),w=T(r(51)),P=T(r(218)),S=T(r(116)),I=C(r(224));function T(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function C(e){return e&&e.__esModule?e:{default:e}}var R=r(228),x=new v.default(\"<Client>\"),A={},E=\"DISCONNECTED\",D=\"CONNECTING\",O=\"CONNECTED\",L=function(t){function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,p.default)(this,r);var n=(0,m.default)(this,(r.__proto__||(0,l.default)(r)).call(this));n._spy=!1,n._devices=null,n._mapWebcamProducers=new d.default,n._mapMicProducers=new d.default,n._mapVideoSendTransports=new d.default,n._publishStreams=new d.default,n._remoteStreams=new d.default,n._remoteAudios=new d.default,n._remoteVideos=new d.default,n._publishs=new d.default,n._subscribes=new d.default,n._protooTransportStat=!1,n._sendTransport=null,n._recvTransport=null,n._protooSessionId=\"\",n._protoo=null,n._room=null,n._screenProducer=null,n._screenTransport=null,n._iceSendDisconnectedCnt=0,n._iceRecvDisconnectedCnt=0,n._peers=new d.default,n._stats=new I.default,n._interval=3e3,n._hostPath=\"\",n._ip=\"\",n._port=3443,n._path=\"\",n._token=\"\",n._spec=t,n._useSimulcast=!1,n._tryJoin=0,n._joinTimer=null,n._hasInit=!1,n._closed=!1,n._connState=E,n._joined=!1,n._appId=\"\",n._uid=\"\",n._roomId=\"\",e.g_appid=\"\",e.g_userid=\"\",e.g_roomid=\"\",e.g_server=\"\";var a=/mobile/i.test(navigator.userAgent),i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),o=/Firefox/i.test(navigator.userAgent),s=t.audioCodec&&\"\"!==t.audioCodec.trim()?t.audioCodec:\"isac\";if(n._audioCodec=i||a||o?\"opus\":s,n._disableRtmpVideo=Boolean(t.disableRtmpVideo),n._liveMixerLayout=null,n._timesOfLinkGW=1,n._linkGWTime=0,n._sendGWTime=void 0,n._sendEnterTime=void 0,\"string\"==typeof t.rtmpUrl&&\"\"!==t.rtmpUrl.trim()?n._valid_rtmp_url=t.rtmpUrl.trim():n._valid_rtmp_url=\"\",\"string\"==typeof t.videoMixerBGIUrl&&\"\"!==t.videoMixerBGIUrl.trim()?n._videoMixerBGIUrl=t.videoMixerBGIUrl.trim():(t.videoMixerBGIUrl=\"http://3ttech.cn/res/tpl/default/images/bk.png\",n._videoMixerBGIUrl=t.videoMixerBGIUrl),!/^[123]$/.test(t.role))throw x.warn(\"API createClient() error - spec: role must be set as 1: master, 2: vice 3: audience.\"),new TypeError(\"role must be set as 1: master, 2: vice 3: audience\");return n._role=t.role+\"\",x.debug(\"API createClient() success - \"+(0,u.default)(t)),n._statsInterval=null,n}var v,k,T,C,L,j,M,B,V,N,F,U,G,W;return(0,h.default)(r,t),(0,f.default)(r,[{key:\"_startStatInterval\",value:function(){var e=this;this._statsInterval=setInterval((function(){var t=[];e._publishs.forEach((function(e,r){if(e){var n=e.stream?e.stream.audioTrackStatus:{},a=e.stream?e.stream.videoTrackStatus:{},i={streamId:e.streamId,audioTrackStatus:n,videoTrackStatus:a,status:e.status};t.push(i)}}));var r=[];e._subscribes.forEach((function(e,t){if(e){var n=e.stream?e.stream.audioTrackStatus:{},a=e.stream?e.stream.videoTrackStatus:{},i={userId:e.userId,streamId:e.streamId,audioTrackStatus:n,videoTrackStatus:a,status:e.status};r.push(i)}}));var n=[];e._remoteAudios.forEach((function(e,t){n.push(e)}));var a=[];e._remoteVideos.forEach((function(e,t){a.push(e)}));var i={host:e._ip,appId:e._appId,userId:e._uid,role:e._role,roomId:e._roomId,connState:e._connState,joined:e._joined,iceSendTransport:{state:e._sendTransport?e._sendTransport.connectionState:\"idle\",retryTimes:e._sendTransport?e._sendTransport.retryTimes:0,disconnCnt:e._iceSendDisconnectedCnt},iceRecvTransport:{state:e._recvTransport?e._recvTransport.connectionState:\"idle\",retryTimes:e._recvTransport?e._recvTransport.retryTimes:0,disconnCnt:e._iceRecvDisconnectedCnt},audioCodec:e._audioCodec,publishs:t,subscribes:r,remoteAudios:n,remoteVideos:a};x.debug(\"<CLIENT_STAT> \"+(0,u.default)(i))}),15e3)}},{key:\"_stopStatInterval\",value:function(){null!==this._statsInterval&&(clearInterval(this._statsInterval),this._statsInterval=null)}},{key:\"init\",value:function(t,r,n,a){var i=this;if(\"function\"!=typeof n)throw x.error(\"API init() error - parameter: onSuccess invalid\"),new TypeError(\"onSuccess parameter must be a function.\");if(\"function\"!=typeof a)throw x.error(\"API init() error - parameter: onFailure invalid\"),new TypeError(\"onFailure parameter must be a function.\");if(this._hasInit)return x.error(\"API init() error - Client has Already initialized\"),a(\"Client has Already initialized - please client.close() at first\");if(!t||\"\"===(\"\"+t).trim())return x.warn(\"API init() error - parameter: appId invalid\"),a(\"must be set appid\");if(!/^[1-9][0-9]{0,18}$/.test(r))return x.warn(\"API init() error - parameter: userId invalid\"),a(\"userId must be number\");this._uid=\"\"+r,e.g_appid=t,e.g_userid=this._uid,this._appId=t,this._stats.setAppid(t),x.debug(\"API init() appId: \"+t+\" uid: \"+r),this._startStatInterval();var o=_.default.MediaServerAddress;if(o&&\"\"!==o.trim())return o=o.trim(),this._hostPath=o,this._parseMsHost(o),this._ip&&\"\"!==this._ip?(this._stats.setDomain(this._ip),x.debug(\"API init() success - special media server: \"+this._hostPath),this._watchDeviceChange(),this._hasInit=!0,n()):a(\"iplocation error - msHost: \"+o);this._ipLocation=new _.default(t,+r,(function(e,t){return x.debug(\"API init() success - iplocation alloc server: \"+e.domain),i._hostPath=e.domain,i._parseMsHost(e.domain),i._stats.setDomain(i._ip),i._stats.setGWInfo(t),i._stats.setIPlocationInfo(i._ipLocation),i._watchDeviceChange(),i._hasInit=!0,n()}),(function(e){return i._stopStatInterval(),x.warn(\"API init() fail - iplocation error: \"+e.toString()),a(\"iplocation error: \"+e.toString())}))}},{key:\"_parseMsHost\",value:function(e){var t=/^(wss?:\\/\\/)?([0-9a-z.\\-_]+)(:[0-9]+)?([/0-9a-z.\\-_]+)?(\\?[0-9a-z&=]+)?(#[0-9-a-z]+)?/i.exec(e);if(t&&t[2]){var r=t[2];this._ip=r.trim()}if(t&&t[3]){var n=t[3],a=parseInt(n.slice(1));a&&(this._port=a)}else this._port=3443;if(t&&t[4]){var i=t[4];this._path=i.trim()}}},{key:\"_watchDeviceChange\",value:function(){var e=this;navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.mediaDevices.enumerateDevices().then((function(t){e._devices=t,x.debug(\"init() -- devices: \"+(0,u.default)(e._devices))})).catch((function(e){x.warn(\"init() enumerateDevices fail - \"+e.toString())})),navigator.mediaDevices.ondevicechange=function(t){x.debug(\"mediaDevices.ondevicechange - \"+t),x.debug(\"ondevicechange -- this._devices: \"+(0,u.default)(e._devices)),navigator.mediaDevices.enumerateDevices().then((function(t){x.debug(\"ondevicechange -- curr-devices: \"+(0,u.default)(t));var r=[];e._devices.forEach((function(e,n){var a=!1;t.forEach((function(t,r){e.deviceId==t.deviceId&&e.kind==t.kind&&e.label==t.label&&e.groupId==t.groupId&&(a=!0)})),a||\"communications\"!==e.deviceId&&\"default\"!==e.deviceId&&r.push(e)}));var n=[];t.forEach((function(t,r){var a=!1;e._devices.forEach((function(e,r){t.deviceId==e.deviceId&&t.kind==e.kind&&t.label==e.label&&t.groupId==e.groupId&&(a=!0)})),a||\"communications\"!==t.deviceId&&\"default\"!==t.deviceId&&n.push(t)})),(n.length<=0||r<=0)&&e.emit(\"device-hot-plug\",{plugDevices:n,pullDevices:r}),e._devices=t})).catch((function(e){x.warn(\"init() enumerateDevices fail - \"+e.toString())}))})}},{key:\"_onClientClose\",value:function(e){this._protooTransportStat=!1,x.warn(\"_onClientClose() \"+e.code+\" \"+e.reason+\" -- call this.close()\"),this.close({code:e.code,data:e.reason})}},{key:\"join\",value:function(t,r,n,a){if(\"function\"!=typeof n)throw x.error(\"API join() error - parameter: onSuccess invalid\"),new TypeError(\"onSuccess parameter must be a function.\");if(\"function\"!=typeof a)throw x.error(\"API join() error - parameter: onFailure invalid\"),new TypeError(\"onFailure parameter must be a function.\");if(this._connState===D)return x.warn(\"clientConnState.CONNECTING - join is running...\"),a(\"clientConnState.CONNECTING - join is running...\");if(!/^[1-9][0-9]{0,18}$/.test(r))return x.warn(\"API join() error - parameter: roomId invalid\"),a(\"roomId must be number\");e.g_roomid=r,e.g_server=this._hostPath,x.debug(\"API join() this._hostPath: \"+this._hostPath+\" - params roomId: \"+r+\" role: \"+this._role+\" - tryJoin: \"+this._tryJoin);this._token=t,r+=\"\",this._roomId=r,this._stats.setRoomId(r),this._stats.setUserId(this._uid),this._stats.setRoleType(+this._role);var i=b.getDeviceInfo();this._stats.setDeviceInfo(i);var o=g.getProtooUrl(this._uid,r,this._appId,this._ip,this._port,this._path);if(this._linkGWTime=Date.now(),this._protooSessionId=S.randomNumberGenerator(),this._protoo=new P.Peer(o,this._protooSessionId,this._spec.retries),!this._protoo)return this._innerClose(),x.warn(\"API join() error - new protooClient.Peer failed.\"),void a(\"fail to create protooClient.Peer\");var s=this._connState;this._connState=D,this.emit(\"connection-state-change\",{prevState:s,curState:D}),A.urls=A.urls||\"turn:\"+this._ip+\":3478\",A.credential=A.credential||w.clientConfig.turnServer.password,A.username=A.username||w.clientConfig.turnServer.username,A.iceTransportPolicy=A.iceTransportPolicy||w.clientConfig.turnServer.iceTransportPolicy,this._room=new b.Room({requestTimeout:3e4,transportOptions:{udp:!0,tcp:Boolean(!1)},spy:this._spy,iceTransportPolicy:A.iceTransportPolicy,turnServers:[{urls:A.urls,credential:A.credential,username:A.username}]}),this._join({displayName:this._uid,device:\"webcam\"},n,a)}},{key:\"_join\",value:function(e,t,r){var n=e.displayName,a=e.device,i=this;this._protoo.on(\"open\",(function(e){e.sid===i._protooSessionId?(x.debug(\"protooPeer event -- [open] - will _joinRoom...\"),i._stats.setWsState(\"open\"),i._protooTransportStat=!0,i._sendGWTime=Date.now(),i._linkGWTime=i._sendGWTime-i._linkGWTime,i._joinRoom({displayName:n,device:a},t,r)):x.debug(\"protooPeer event -- [open] - invalid protooSessionId - ignore\")})),this._protoo.on(\"conn-reconn\",(function(e){if(e.sid===i._protooSessionId){x.debug(\"protooPeer event -- [conn-reconn]\"),i._stats.setWsState(\"open\"),i._protooTransportStat=!0;var t=i._connState;i._connState=O,i.emit(\"connection-state-change\",{prevState:t,curState:O})}else x.debug(\"protooPeer event -- [conn-reconn] - invalid protooSessionId - ignore\")})),this._protoo.on(\"conn-interrupt\",(function(e){e.sid===i._protooSessionId?(x.debug(\"protooPeer event -- [conn-interrupt]\"),i._stats.setWsState(\"close\"),i._protooTransportStat=!1):x.debug(\"protooPeer event -- [conn-interrupt] - invalid protooSessionId - ignore\")})),this._protoo.on(\"reinit\",(function(e){e.sid===i._protooSessionId?i._onClientClose({code:4001,reason:\"protoo event [reinit]\"}):x.debug(\"protooPeer event -- [reinit] - invalid protooSessionId - ignore\")})),this._protoo.on(\"connecting\",(function(e){if(e.sid===i._protooSessionId){var t=i._connState;i._connState=D,i.emit(\"connection-state-change\",{prevState:t,curState:D})}else x.debug(\"protooPeer event -- [connecting] - invalid protooSessionId - ignore\")})),this._protoo.on(\"close\",(function(e){e.sid===i._protooSessionId?i._onClientClose({code:4001,reason:\"protoo event [close]\"}):x.debug(\"protooPeer event -- [close] - invalid protooSessionId - ignore\")})),this._protoo.on(\"request\",(function(e,t,r,n){if(e.sid===i._protooSessionId)switch(t.method){case\"mediasoup-notification\":r();var a=t.data;null!==i._room&&i._room.receiveNotification(a);break;case\"display-name-changed\":r();var o=t.data,s=o.peerName,c=o.displayName;o.oldDisplayName;if(null!==i._room){var u=i._room.getPeerByName(s);if(!u){x.warn(\"display-name-changed peer not found\");break}u.appData.displayName=c,x.debug(\"display-name-changed displayName: \"+c+\" peerName: \"+s)}break;case\"3T_applySpeak\":r(),i._protoo.send(\"approveSpeak\",t.data);break;case\"active-speaker\":r();t.data.peerName;break;default:x.warn(\"protoo.requst event -- [\"+t.method+\"] unknown protoo method\"),n(404,\"unknown method\")}else x.debug(\"protooPeer event -- [request] - invalid protooSessionId - ignore\")})),this._protoo.on(\"notification\",(function(e,r){if(e.sid===i._protooSessionId)switch(r.method){case\"3T_sessionid\":var n=r.data.sessionId;x.debug(\"protooPeer event -- [notification:3T_sessionid] - \"+n),i._stats.setSessionId(n);break;case\"3T_connectid\":var a=r.data.connectId;i._stats.setConnectionId(a),x.debug(\"protooPeer event -- [notification:3T_connectid] - \"+a),i._joined=!0,i._joinTimer&&(clearTimeout(i._joinTimer),i._joinTimer=null);var o=i._connState;i._connState=O,i.emit(\"connection-state-change\",{prevState:o,curState:O}),x.debug(\"API protooPeer event -- [notification:3T_connectid] -- Emit [enter] to APP\"),x.debug(\"API join() success - connectId: \"+a),t(\"You are join the room\");break;case\"3T_kickout\":x.debug(\"API protooPeer event -- [notification:3T_kickout] - Emit [kickout] to APP - \"+(0,u.default)(r.data)),i.close({code:3001,data:(0,u.default)(r.data)});break;case\"3T_CDN_URL\":var s=r.data.CDN_url;x.debug(\"API protooPeer event -- [notification:3T_CDN_URL] url: \"+s+\" - Emit [CDN_url] to APP\"),i.emit({CDN_url:s});break;case\"active-speaker\":r.data.peerName;break;case\"3T_audiencevisible\":var c=r.data.peerId;x.debug(\"API protooPeer event -- [notification:3T_audiencevisible] peerId: \"+c+\" - Emit [peer-join] to APP\");var d=i._peers.get(\"\"+c);d&&i.emit(\"peer-join\",{userID:c,peer:d});break;case\"3T_changerole\":var l=r.data,p=l.peerId,f=l.role;x.debug(\"API protooPeer event -- [notification:3T_changerole] peerId: \"+p+\" - role: \"+f);var m=i._peers.get(\"\"+p);m.appData.role=f.toString(),m&&(\"2\"===m.appData.role?(x.debug(\"API protooPeer event -- [notification:3T_changerole] peerId: \"+p+\" role: \"+f+\" - Emit [peer-join] to APP\"),i.emit(\"peer-join\",{userID:p,peer:m})):\"3\"===m.appData.role&&(x.debug(\"API protooPeer event -- [notification:3T_changerole] peerId: \"+p+\" role: \"+f+\" - Emit [peer-leave] to APP\"),i._subscribes.forEach((function(e,t){e&&e.userId==p&&i._subscribes.delete(t)})),i._remoteStreams.forEach((function(e,t){e&&e.userId==p&&i._remoteStreams.delete(t)})),i._remoteVideos.forEach((function(e,t){e&&e.userId==p&&i._remoteVideos.delete(t)})),i._remoteAudios.forEach((function(e,t){e&&e.userId==p&&i._remoteAudios.delete(t)})),i.emit(\"peer-leave\",{userID:p,streams:[]})));break;case\"3T_rtmpfailure\":var h=r.data,v=h.roomId,_=h.url;x.debug(\"API protooPeer event -- [notification:3T_rtmpfailure] url: \"+_+\" - Emit [rtmp-failure] to APP\"),i.emit(\"rtmp-failure\",{url:_,channelId:v});break;case\"3T_rtmpsuccess\":var g=r.data,y=g.roomId,b=g.url;x.debug(\"API protooPeer event -- [notification:3T_rtmpsuccess] url: \"+b+\" - Emit [rtmp-success] to APP\"),i.emit(\"rtmp-success\",{url:b,channelId:y});break;case\"3T_updatevideostatus\":var k=r.data,w=k.peerId,P=k.devId,S=k.videoType;x.debug(\"API protooPeer event -- [notification:3T_updatevideostatus] peerId: \"+w+\" devId: \"+P+\" videoType: \"+S+\" - Emit [video-update] to APP\"),i.emit(\"video-update\",{userId:w,streamId:P,videoType:S});break;case\"3T_needrefreshtoken\":x.debug(\"API protooPeer event -- [notification:3T_needrefreshtoken] - Emit [onTokenPrivilegeWillExpire] to APP\"),i.emit(\"onTokenPrivilegeWillExpire\");break;default:x.warn(\"protoo.requst event -- [\"+r.method+\"] unknown protoo method\")}else x.debug(\"protooPeer event -- [notification] - invalid protooSessionId - ignore\")}))}},{key:\"_joinRoom\",value:function(e,t,n){var a=e.displayName,i=e.device,o=this;x.debug(\"_joinRoom() try to join room...\"),this._room.removeAllListeners(),this._room.on(\"close\",(function(e,t){\"remote\"===e&&(x.warn(\"room event -- mediasoup Peer/Room remotely closed -- appData: \"+(0,u.default)(t)),o._stats.stopHeartBeat())})),this._room.on(\"request\",(function(e,t,r){x.debug(\"room event -- [request:\"+e.method+\"] sending to mediasoup \"),o._protoo.send(\"mediasoup-request\",e).then(t).catch(r)})),this._room.on(\"notify\",(function(e){x.debug(\"room event -- [notification:\"+e.method+\"] sending to mediasoup\"),o._closed||o._protoo.send(\"mediasoup-notification\",e).catch((function(e){x.warn(\"Send mediasoup notification failed - \"+e.toString())}))})),this._room.on(\"newpeer\",(function(e){x.debug(\"room event -- [newpeer] peerName: \"+e.name),o._peers.set(\"\"+e.name,e),o._handlePeer(e)})),this._tryJoin=0,this._joinTimer=setTimeout((function(){if(o._joined)return o._joinTimer&&clearTimeout(o._joinTimer),void(o._joinTimer=null);o._tryJoin++,+o._tryJoin<3?(o._innerClose(),o._room=null,o._protoo&&(o._protoo.close(),o._protoo=null),setTimeout((function(){o.join(o._token,o._roomId,t,n)}))):(x.warn(\"timeout -- join room timeout\"),o._joinTimer=null,o.close({code:5e3,data:\"join-timeout\"}),o._stats.sendTimeOutLog(o._timesOfLinkGW,3*+r.JOIN_ROOM_TIME_OUT),n(\"join room timeout\"))}),r.JOIN_ROOM_TIME_OUT);var s={displayName:a,device:i,role:this._role,audioCodec:this._audioCodec,token:this._token||\"\"};\"1\"===this._role&&(\"\"===this._valid_rtmp_url&&(this._valid_rtmp_url=\"rtmp://\"+this._ip+\":11936/sdk/\"+this._appId+\"-\"+this._roomId+\"-\"+this._uid+\"-\"+g.uuid()),\"\"!==this._valid_rtmp_url&&(s.rtmpUrl=this._valid_rtmp_url,s.disableRtmpVideo=this._disableRtmpVideo),s.videoMixerBGIUrl=this._videoMixerBGIUrl),x.debug(\"_joinRoom() - _room.join: \"+(0,u.default)(s)),this._room.join(this._uid,s).then((function(){o._spy||(o._sendTransport=o._room.createTransport(\"send\",{media:\"SEND_MIC_WEBCAM\"}),o._sendTransport.on(\"close\",(function(e){x.debug(\"_sendTransport event -- [close] originator: \"+(0,u.default)(e))})),o._sendTransport.on(\"restart-ice-trying\",(function(e){x.debug(\"_sendTransport event -- [restart-ice-trying] \"+(0,u.default)(e))})),o._sendTransport.on(\"restart-ice-fail\",(function(e){x.debug(\"_sendTransport event -- [restart-ice-fail] \"+(0,u.default)(e)),o._onClientClose({code:4003,reason:\"_sendTransport event [restart-ice-fail]\"})})),o._sendTransport.on(\"connectionstatechange\",(function(e){x.debug(\"_sendTransport event -- [connectionstatechange] connectionstat: \"+e),\"disconnected\"===e&&(o._iceSendDisconnectedCnt++,x.debug(\"_sendTransport event -- [connectionstatechange:disconnected] - will restart ice after 500ms\"),setTimeout((function(){o._sendTransport.attemptRestartIce()}),500)),\"failed\"===e&&(x.debug(\"_sendTransport event -- [connectionstatechange:failed] - will restart ice\"),o._sendTransport.attemptRestartIce()),\"connected\"===e&&(x.debug(\"_sendTransport event -- [connectionstatechange:connected]\"),R(o._sendTransport._handler._pc,(function(e){o._stats.setWebrtcInternalSendStats(e)}),1e3)),o._stats.setSendIceState(e)}))),o._recvTransport=o._room.createTransport(\"recv\",{media:\"RECV\"}),o._recvTransport.on(\"close\",(function(e){x.debug(\"_recvTransport event -- [close] originator: \"+(0,u.default)(e))})),o._recvTransport.on(\"restart-ice-trying\",(function(e){x.debug(\"_recvTransport event -- [restart-ice-trying] \"+(0,u.default)(e))})),o._recvTransport.on(\"restart-ice-fail\",(function(e){x.debug(\"_recvTransport event -- [restart-ice-fail] \"+(0,u.default)(e)),o._onClientClose({code:4004,reason:\"recvTransport event [restart-ice-fail]\"})})),o._recvTransport.on(\"connectionstatechange\",(function(e){x.debug(\"_recvTransport event -- [connectionstatechange] connectionstate: \"+e),\"disconnected\"===e&&(o._iceRecvDisconnectedCnt++,x.debug(\"_recvTransport event -- [connectionstatechange:disconnected] - will restart ice after 500ms\"),setTimeout((function(){o._recvTransport.attemptRestartIce()}),500)),\"failed\"===e&&(x.debug(\"_recvTransport event -- [connectionstatechange:failed] - will restart ice\"),o._recvTransport.attemptRestartIce()),\"connected\"===e&&(x.debug(\"_recvTransport event -- [connectionstatechange:connected]\"),R(o._recvTransport._handler._pc,(function(e){o._stats.setWebrtcInternalRecvStats(e)}),1e3)),o._stats.setRecvIceState(e)}))})).then((function(){o._spy})).then((function(){x.debug(\"_room.join() mediasoup response.\");var e=o._room.peers,t=!0,r=!1,n=void 0;try{for(var a,i=(0,c.default)(e);!(t=(a=i.next()).done);t=!0){var s=a.value;o._handlePeer(s,{notify:!1})}}catch(e){r=!0,n=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw n}}o._stats.startHeartBeat()})).catch((function(e){}))}},{key:\"leave\",value:(W=(0,s.default)(o.default.mark((function e(t,r){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(\"function\"==typeof t){e.next=3;break}throw x.error(\"API leave() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not a fucntion.\");case 3:if(\"function\"==typeof r){e.next=6;break}throw x.error(\"API leave() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not a fucntion.\");case 6:this._protooTransportStat||x.warn(\"API leave() error - protooTransport broken\");try{this.close({code:1e3,data:\"Normal exit\"}),x.debug(\"API leave() success\")}catch(e){x.warn(\"API leave() error - \"+e.toString())}finally{x.debug(\"API leave() finish.\"),t()}case 8:case\"end\":return e.stop()}}),e,this)}))),function(e,t){return W.apply(this,arguments)})},{key:\"publish\",value:(G=(0,s.default)(o.default.mark((function e(t,r,n){var a,c,u,d,l=this;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(\"function\"==typeof r){e.next=3;break}throw x.error(\"API publish() error - parameter: onSuccess invalid\"),new TypeError(\"onSuccess parameter must be a function.\");case 3:if(\"function\"==typeof n){e.next=6;break}throw x.error(\"API publish() error - parameter: onFailure invalid\"),new TypeError(\"onFailure parameter must be a function.\");case 6:if(x.debug(\"API publish() - streamId: \"+t.getId()),t&&t.streamObj){e.next=11;break}return x.warn(\"API publish() error - stream is null\"),n(\"stream param error\"),e.abrupt(\"return\");case 11:if(this._protooTransportStat){e.next=15;break}return x.warn(\"API publish() error - protooTransport is broken\"),n(\"protooTransport is broken\"),e.abrupt(\"return\");case 15:if(this._joined){e.next=19;break}return x.warn(\"API publish() error - non-joined\"),n(\"non-joined\"),e.abrupt(\"return\");case 19:if(!this._spy){e.next=23;break}return x.warn(\"API publish() error - forbidden: user is _spy\"),n(\"Permission denied - spy Not allowed publish\"),e.abrupt(\"return\");case 23:if(\"3\"!==this._role){e.next=27;break}return x.warn(\"API publish() error - forbidden: Audience No permission\"),n(\"Permission denied - Audience Not allowed publish\"),e.abrupt(\"return\");case 27:if(t.publishState!==w.PUBLISH_STATE.PUBLISHING){e.next=31;break}return x.warn(\"API publish() error - config.PUBLISH_STATE.PUBLISHING - publish is running...\"),n(\"config.PUBLISH_STATE.PUBLISHING - publish is running...\"),e.abrupt(\"return\");case 31:if(t.publishState=w.PUBLISH_STATE.PUBLISHING,t.userID=this._uid,(a=this._mapMicProducers.get(t._innerStreamID))&&this._resumeProducer(a),!(c=this._mapWebcamProducers.get(t._innerStreamID))){e.next=50;break}return this._resumeProducer(c),e.prev=40,e.next=43,t._openCamera();case 43:e.next=49;break;case 45:e.prev=45,e.t0=e.catch(40),x.warn(\"API publish() stream._openCamera error - \"+e.t0.toString());case 49:t._needUpdateVideoStreamBitrate&&(this._updateVideoTrack(t,t.videoTracks,t._updateConstraints),t._needUpdateVideoStreamBitrate=!1);case 50:if(t.removeAllListeners(\"pause-video\"),t.removeAllListeners(\"pause-audio\"),t.removeAllListeners(\"resume-audio\"),t.removeAllListeners(\"resume-video\"),t.on(\"pause-video\",(function(e){if(e){var t=e.stream;l.pauseWebcam(t)}})),t.on(\"pause-audio\",(function(e){if(e){var t=e.stream;l.pauseMic(t)}})),t.on(\"resume-audio\",(function(e){if(e){var t=e.stream;l.resumeMic(t)}})),t.on(\"resume-video\",(function(e){if(e){var t=e.stream;l.resumeWebcam(t)}})),!c&&!a){e.next=66;break}return x.debug(\"API publish() success - streamId: \"+t.innerStreamID+\" - Emit [stream-published] to APP\"),t._published=!0,t.publishState=w.PUBLISH_STATE.PUBLISHED,this._publishs.set(t.uuid,{streamId:t.innerStreamID,stream:t}),this.emit(\"stream-published\",{stream:t}),r(),e.abrupt(\"return\");case 66:if(t.streamObj.getAudioTracks()[0]||t.streamObj.getVideoTracks()[0]){e.next=71;break}return t.publishState=w.PUBLISH_STATE.IDLE,x.debug(\"API publish() error - audioTrack or videoTrack non-exist.\"),n(\"no audio or video kind track\"),e.abrupt(\"return\");case 71:u=!1,d=!1,i.default.resolve().then((0,s.default)(o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l._room.canSend(\"audio\")){e.next=3;break}return x.warn(\"API publish() error - audio cannot Send.\"),e.abrupt(\"return\");case 3:if(t.streamObj.getAudioTracks()[0]){e.next=6;break}return x.debug(\"API publish() error - audioTrack non-exist.\"),e.abrupt(\"return\");case 6:return e.prev=6,e.next=9,l._setMicProducer(t);case 9:u=!0,l._stats.audioOpen=!0,e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),x.warn(\"API publish() error - \"+e.t0.toString());case 16:case\"end\":return e.stop()}}),e,l,[[6,13]])})))).then((0,s.default)(o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l._room.canSend(\"video\")){e.next=3;break}return x.warn(\"API publish() error - video cannot Send.\"),e.abrupt(\"return\");case 3:if(t.streamObj.getVideoTracks()[0]){e.next=6;break}return x.debug(\"API publish() error - videoTrack non-exist.\"),e.abrupt(\"return\");case 6:return e.prev=6,e.next=9,l._setWebcamProducer(t);case 9:d=!0,l._stats.videoOpen=!0,e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),x.warn(\"API publish() error - \"+e.t0.toString());case 16:case\"end\":return e.stop()}}),e,l,[[6,13]])})))).then((function(){u||d?(t._published=!0,t.publishState=w.PUBLISH_STATE.PUBLISHED,x.debug(\"API publish() success - streamId: \"+t.innerStreamID+\" - Emit [stream-published] to APP\"),l._publishs.set(t.uuid,{streamId:t.innerStreamID,stream:t}),l.emit(\"stream-published\",{stream:t}),r()):(t.publishState=w.PUBLISH_STATE.IDLE,n(\"no audio or video to be sent\"))})).catch((function(e){t.publishState=w.PUBLISH_STATE.IDLE,x.warn(\"API publish() fail - \"+e.toString()),n(e)}));case 74:case\"end\":return e.stop()}}),e,this,[[40,45]])}))),function(e,t,r){return G.apply(this,arguments)})},{key:\"unpublish\",value:(U=(0,s.default)(o.default.mark((function e(t,r,n,a){var i,s;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(\"function\"==typeof r){e.next=3;break}throw x.error(\"API unpublish() error - parameter: onSuccess invalid\"),new TypeError(\"onSuccess parameter must be a function.\");case 3:if(\"function\"==typeof n){e.next=6;break}throw x.error(\"API unpublish() error - parameter: onFailure invalid\"),new TypeError(\"onFailure parameter must be a function.\");case 6:if(t||(x.warn(\"API unpublish() error - stream is null\"),n(\"Param error - stream\")),this._protooTransportStat){e.next=11;break}return x.warn(\"API unpublish() error - protooTransport is broken\"),n(\"protooTransport is broken\"),e.abrupt(\"return\");case 11:if(t.removeAllListeners(\"pause-video\"),t.removeAllListeners(\"pause-audio\"),t.removeAllListeners(\"resume-audio\"),t.removeAllListeners(\"resume-video\"),(i=this._mapMicProducers.get(t._innerStreamID))&&this._pauseProducer(i),!(s=this._mapWebcamProducers.get(t._innerStreamID))){e.next=23;break}if(this._pauseProducer(s),!a){e.next=23;break}return e.next=23,t._closeCamera();case 23:this._stats.audioOpen=!1,this._stats.videoOpen=!1,t._published=!1,t.publishState=w.PUBLISH_STATE.IDLE,this._publishs.delete(t.uuid),x.debug(\"API unpublish() success - streamId: \"+t.innerStreamID+\" - Emit [stream-unpublished] to APP\"),this.emit(\"stream-unpublished\",{stream:t}),r();case 31:case\"end\":return e.stop()}}),e,this)}))),function(e,t,r,n){return U.apply(this,arguments)})},{key:\"publishScreen\",value:function(e,t,r){var n=this;if(\"function\"!=typeof t)throw x.error(\"API publishScreen() error - parameter: onSuccess invalid\"),new TypeError(\"onSuccess is not function.\");if(\"function\"!=typeof r)throw x.error(\"API publishScreen() error - parameter: onFailure invalid\"),new TypeError(\"onFailure is not function.\");return e&&e.streamObj?this._protooTransportStat?this._joined?this._spy?(x.warn(\"API publishScreen() error - user is _spy\"),void r(\"Permission denied - spy Not allowed publish\")):\"3\"===this._role?(x.warn(\"API publishScreen() error - forbidden: Audience\"),void r(\"Permission denied - Audience Not allowed publish\")):(e.userID=this._uid,null!==this._screenProducer?(this.resumeScreen(),x.debug(\"API publishScreen() success streamId: \"+e.innerStreamID+\" - Emit [stream-published] to APP\"),void this.emit(\"screen-published\",{stream:e})):void i.default.resolve().then((function(){n._room.canSend(\"video\")?(n._setScreenProducer(e).catch((function(e){x.warn(\"API publishScreen() error - \"+e.toString()+\".\")})),n._publishs.set(e.uuid,{streamId:e.innerStreamID,stream:e}),x.debug(\"API publishScreen() success - streamId: \"+e.innerStreamID+\" - Emit [stream-published] to APP\"),n.emit(\"screen-published\",{stream:e}),t()):x.warn(\"API publishScreen() error - video cannot Send.\")}))):(x.warn(\"API publishScreen() error - non-joined\"),void r(\"non-joined\")):(x.warn(\"API publishScreen() error - protooTransport broken\"),void r(\"protooTransport is broken\")):(x.warn(\"API publishScreen() error - parameter: stream is invalid\"),void r(\"Param error - stream is invalid\"))}},{key:\"unpublishScreen\",value:function(e,t,r){if(\"function\"!=typeof t)throw x.error(\"API unpublishScreen() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not function.\");if(\"function\"!=typeof r)throw x.error(\"API unpublishScreen() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not function.\");return e&&e.streamObj?this._protooTransportStat?(this._screenProducer&&this._screenProducer.close(),this._publishs.delete(e.uuid),this._screenProducer=null,x.debug(\"API unpublishScreen() success - streamId: \"+e.innerStreamID+\" - Emit [stream-unpublished] to APP\"),this.emit(\"screen-unpublished\",{stream:e}),t()):(x.warn(\"API unpublishScreen() error - protooTransport broken\"),void r(\"protooTransport is broken\")):(x.warn(\"API unpublishScreen() error - parameter: stream is invalid\"),void r(\"Param error - stream is invalid\"))}},{key:\"subscribeAudio\",value:function(e,t,r){var n=this;if(\"function\"!=typeof t)throw x.error(\"API subscribeAudio() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not function.\");if(\"function\"!=typeof r)throw x.error(\"API subscribeAudio() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not function.\");if(!e)return x.warn(\"API subscribeAudio() error - parameter: stream is invalid\"),void r(\"param error - stream is invalid\");if(!this._protooTransportStat)return x.warn(\"API subscribeAudio() error - protooTransport broken\"),void r(\"protooTransport is broken\");if(!this._joined)return x.warn(\"API subscribeAudio() error - non-joined\"),void r(\"non-joined\");x.debug(\"API subscribeAudio() - streamId: \"+e.getId()+\" stream.userID: \"+e.userID);var a=this._peers.get(\"\"+e.userID);if(!a)return x.warn(\"API subscribeAudio() error - non-peer: \"+e.userID),r(\"Can not found this peer\");a.consumers.forEach((function(r){r.appData&&r.appData.streamID===e.streamID&&\"audio\"===r.kind&&n._consumerAct(e,r,\"resume\",\"audio\",t)}))}},{key:\"unsubscribeAudio\",value:function(e,t,r){var n=this;if(\"function\"!=typeof t)throw x.error(\"API unsubscribeAudio() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not function.\");if(\"function\"!=typeof r)throw x.error(\"API unsubscribeAudio() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not function.\");if(!e)return x.warn(\"API unsubscribeAudio() error - parameter: stream is invalid\"),void r(\"Param error - stream is invalid\");if(!this._protooTransportStat)return x.warn(\"API unsubscribeAudio() error - protooTransport broken\"),void r(\"protooTransport is broken\");x.debug(\"API unsubscribeAudio() - streamId: \"+e.getId()+\" stream.userID: \"+e.userID);var a=this._peers.get(\"\"+e.userID);if(!a)return x.warn(\"API unsubscribeAudio() error - non-peer: \"+e.userID),r(\"Can not found this peer\");a.consumers.forEach((function(r){r.appData&&r.appData.streamID===e.streamID&&\"audio\"===r.kind&&n._consumerAct(e,r,\"pause\",\"audio\",t)}))}},{key:\"subscribeVideo\",value:function(e,t,r){var n=this;if(\"function\"!=typeof t)throw x.error(\"API subscribeVideo() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not function.\");if(\"function\"!=typeof r)throw x.error(\"API subscribeVideo() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not function.\");if(!e)return x.warn(\"API subscribeVideo() error - parameter: stream is invalid\"),void r(\"Param error - stream is invalid\");if(!this._protooTransportStat)return x.warn(\"API subscribeVideo() error - protooTransport broken\"),void r(\"protooTransport is broken\");if(!this._joined)return x.warn(\"API subscribeVideo() error - non-joined\"),void r(\"non-joined\");x.debug(\"API subscribeVideo() - streamId: \"+e.getId()+\" stream.userID: \"+e.userID);var a=this._peers.get(\"\"+e.userID);if(!a)return x.warn(\"API subscribeVideo() error - non-peer: \"+e.userID),r(\"Can not found this peer\");a.consumers.forEach((function(r){r.appData&&r.appData.streamID===e.streamID&&\"video\"===r.kind&&n._consumerAct(e,r,\"resume\",\"video\",t)}))}},{key:\"unsubscribeVideo\",value:function(e,t,r){var n=this;if(\"function\"!=typeof t)throw x.error(\"API unsubscribeVideo() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not function.\");if(\"function\"!=typeof r)throw x.error(\"API unsubscribeVideo() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not function.\");if(!e)return x.warn(\"API unsubscribeVideo() error - parameter: stream is invalid\"),void r(\"parameter - stream is invalid\");if(!this._protooTransportStat)return x.warn(\"API unsubscribeVideo() error - protooTransport broken\"),void r(\"protooTransport is broken\");x.debug(\"API unsubscribeVideo() streamId: \"+e.getId()+\" stream.userID: \"+e.userID);var a=this._peers.get(\"\"+e.userID);if(!a)return x.warn(\"API unsubscribeVideo() error - non-peer: \"+e.userID),r(\"Can not found this peer\");a.consumers.forEach((function(r){r.appData&&r.appData.streamID===e.streamID&&\"video\"===r.kind&&n._consumerAct(e,r,\"pause\",\"video\",t)}))}},{key:\"_consumerAct\",value:function(e,t,r,n,a){t||x.warn(\"API _consumerAct() error - invalid consumer\");var i={stream:e};return\"pause\"===r?(t.pause(),x.debug(\"API _consumerAct() success - streamId: \"+e.getId()+\" - Emit [stream-\"+n+\"-unsubscribed] to APP\"),a(e),void this.emit(\"stream-\"+n+\"-unsubscribed\",i)):\"resume\"===r?(t.resume(),x.debug(\"API _consumerAct() success - streamId: \"+e.getId()+\" - Emit [stream-\"+n+\"-subscribed] to APP\"),a(e),void this.emit(\"stream-\"+n+\"-subscribed\",i)):void x.warn(\"API _consumerAct() error - invalid type - should be [resume|pause]\")}},{key:\"subscribe\",value:function(e,t,r){var n=this;if(\"function\"!=typeof t)throw x.error(\"API subscribe() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not function.\");if(\"function\"!=typeof r)throw x.error(\"API subscribe() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not function.\");if(!e)return x.warn(\"API subscribe() error - parameter: stream is invalid\"),void r(\"Param error - stream is invalid\");if(!this._protooTransportStat)return x.warn(\"API subscribe() error - protooTransport broken\"),void r(\"protooTransport is broken\");if(!this._joined)return x.warn(\"API subscribe() error - non-joined\"),void r(\"non-joined\");var a=this._peers.get(\"\"+e.userID);if(!a)return x.warn(\"API subscribe() error - non-peer: \"+e.userID),r(\"Can not found this peer\");var i=[];a.consumers.forEach((function(t){t.appData.streamID===e.streamID&&(i.push(t),n._subscribes.set(e.uuid,{userId:e.userID,streamId:e.getId(),stream:e,status:\"active\"}))})),i.forEach((function(e){e.resume()})),e.subscribed=!0,x.debug(\"API subscribe() success - streamId: \"+e.getId()+\" - Emit [stream-subscribed] to APP\");var o={stream:e};t(e),this.emit(\"stream-subscribed\",o)}},{key:\"unsubscribe\",value:function(e,t,r){var n=this;if(\"function\"!=typeof t)throw x.error(\"API unsubscribe() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not function.\");if(\"function\"!=typeof r)throw x.error(\"API unsubscribe() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not function.\");if(!e)return x.warn(\"API unsubscribe() error - parameter: stream is invalid\"),void r(\"Param error - stream is invalid\");if(!this._protooTransportStat)return x.warn(\"API unsubscribe() error - protooTransport broken\"),void r(\"protooTransport is broken\");var a=this._peers.get(\"\"+e.userID);if(!a)return x.warn(\"API unsubscribe() error - non-peer: \"+e.userID),r(\"Can not found this peer\");var i=[];a.consumers.forEach((function(t){t.appData.streamID===e.streamID&&(i.push(t),n._subscribes.delete(e.uuid))})),i.forEach((function(e){e.pause()})),e.subscribed=!1,x.debug(\"API unsubscribe() success - streamId: \"+e.getId()+\" - Emit [stream-unsubscribed] to APP\");var o={stream:e};t(e),this.emit(\"stream-unsubscribed\",o)}},{key:\"pauseMic\",value:function(e,t,r){if(e)if(e._published){var n=void 0;if(!(n=e?this._mapMicProducers.get(e._innerStreamID):this._mapMicProducers.values().next().value))return x.warn(\"API pauseMic() error - non mic producer.\"),void(\"function\"==typeof r&&r(\"non mic producer\"));x.debug(\"API pauseMic() sucess - streamId: \"+e.getId()),this._pauseProducer(n),\"function\"==typeof t&&t()}else x.warn(\"API pauseMic() error - no-published\");else x.warn(\"API pauseMic() error - Param: invalid stream\")}},{key:\"resumeMic\",value:function(e,t,r){if(e)if(e._published){var n=void 0;if(!(n=e?this._mapMicProducers.get(e._innerStreamID):this._mapMicProducers.values().next().value))return x.warn(\"API resumeMic() error - non mic producer.\"),void(\"function\"==typeof r&&r(\"non mic producer\"));x.debug(\"API resumeMic() sucess - streamId: \"+e.getId()),this._resumeProducer(n),\"function\"==typeof t&&t()}else x.warn(\"API resumeMic() error - no-published\");else x.warn(\"API resumeMic() error - Param: invalid stream\")}},{key:\"pauseWebcam\",value:(F=(0,s.default)(o.default.mark((function e(t,r,n,a){var i;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return x.warn(\"API pauseWebcam() error - Param: invalid stream\"),e.abrupt(\"return\");case 3:if(t._published){e.next=6;break}return x.warn(\"API pauseWebcam() error - no-published\"),e.abrupt(\"return\");case 6:if(i=void 0,i=t?this._mapWebcamProducers.get(t._innerStreamID):this._mapWebcamProducers.values().next().value){e.next=14;break}return x.warn(\"API pauseWebcam() error - non webcam producer.\"),\"function\"==typeof a&&a(\"non webcam producer\"),e.abrupt(\"return\");case 14:if(x.debug(\"API pauseWebcam() sucess - streamId: \"+t.getId()),this._pauseProducer(i),!r){e.next=19;break}return e.next=19,t._closeCamera();case 19:\"function\"==typeof n&&n();case 20:case\"end\":return e.stop()}}),e,this)}))),function(e,t,r,n){return F.apply(this,arguments)})},{key:\"resumeWebcam\",value:function(e,t,r){var n=this;if(e)if(e._published){var a=void 0;if(!(a=e?this._mapWebcamProducers.get(e._innerStreamID):this._mapWebcamProducers.values().next().value))return x.warn(\"API resumeWebcam() error - non webcam producer.\"),void(\"function\"==typeof r&&r(\"non webcam producer\"));e._openCamera().then((function(){x.debug(\"API resumeWebcam() success - stream._openCamera() - streamId: \"+e.getId()),n._resumeProducer(a),\"function\"==typeof t&&t()})).catch((function(e){x.warn(\"API resumeWebcam() fail - stream._openCamera() error - \"+e.toString()),\"function\"==typeof r&&r(\"stream._openCamera fail - \"+e.toString())}))}else x.warn(\"API resumeWebcam() error - no-published\");else x.warn(\"API resumeWebcam() error - Param: invalid stream\")}},{key:\"_updateVideoTrack\",value:(N=(0,s.default)(o.default.mark((function e(t,r,n){var a;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return x.warn(\"_setVideoStreamBitrate() error - parameter [stream] is INVALID.\"),e.abrupt(\"return\");case 3:if(x.debug(\"_setVideoStreamBitrate() - streamId: \"+t.innerStreamID),a=this._mapWebcamProducers.get(t._innerStreamID)){e.next=8;break}return x.debug(\"_setVideoStreamBitrate() error - client update track(kind video of webcam) can not found producer \"+t.innerStreamID+\".\"),e.abrupt(\"return\");case 8:return e.prev=8,e.next=11,a.updateTrack(r,n,{idealBandwidth:t.idealBandwidth,maxBandwidth:t.maxBandwidth,minBandwidth:t.minBandwidth});case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(8),x.warn(\"_updateVideoTrack() fail - producer.updateTrack error - \"+e.t0.toString());case 16:case\"end\":return e.stop()}}),e,this,[[8,13]])}))),function(e,t,r){return N.apply(this,arguments)})},{key:\"_replaceTrack\",value:function(e,t){if(e){x.debug(\"_replaceTrack() - stream.streamID: \"+e.innerStreamID);var r=this._mapWebcamProducers.get(e._innerStreamID);r?i.default.resolve().then((function(){return r.replaceTrack(t)})).then((function(){})).catch((function(e){throw x.warn(\"_replaceTrack() error - replace track failed - \"+e.toString()),e})):x.debug(\"_replaceTrack() error - client replace track(kind video of webcam) can not found producer \"+e._innerStreamID+\".\")}else x.warn(\"_replaceTrack() error - parameter [stream] is INVALID.\")}},{key:\"_resumeProducer\",value:function(e){e?e.resume():x.warn(\"_resumeProducer() error - parameter [producer] is INVALID.\")}},{key:\"_pauseProducer\",value:function(e){e?e.pause():x.warn(\"_pauseProducer() error - parameter [producer] is INVALID.\")}},{key:\"pauseScreen\",value:function(){x.debug(\"API pauseScreen()\"),null!==this._screenProducer&&this._screenProducer.pause()}},{key:\"resumeScreen\",value:function(){x.debug(\"API resumeScreen()\"),null!==this._screenProducer&&this._screenProducer.resume()}},{key:\"renewChannelKey\",value:function(e,t,r){}},{key:\"enableDualStream\",value:function(){}},{key:\"setRemoteVideoStreamType\",value:function(e,t){}},{key:\"setLowStreamParameter\",value:function(){}},{key:\"disableDualStream\",value:function(e,t){}},{key:\"setProxyServer\",value:function(e){}},{key:\"setEncryptionSecret\",value:function(){}},{key:\"setEncryptionMode\",value:function(){}},{key:\"closeStream\",value:(V=(0,s.default)(o.default.mark((function e(t){var r,n;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return x.warn(\"API closeStream() error - parameter [stream] is INVALID.\"),e.abrupt(\"return\");case 3:if(x.debug(\"API closeStream() - streamId: \"+t.getId()),!(r=this._mapMicProducers.get(t._innerStreamID))){e.next=14;break}return e.prev=6,e.next=9,r.close();case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(6),x.warn(\"API closeStream() error - close micProducer error - \"+e.t0.toString());case 14:if(!(n=this._mapWebcamProducers.get(t._innerStreamID))){e.next=24;break}return e.prev=16,e.next=19,n.close();case 19:e.next=24;break;case 21:e.prev=21,e.t1=e.catch(16),x.warn(\"API closeStream() error - close webcamProducer error - \"+e.t1.toString());case 24:case\"end\":return e.stop()}}),e,this,[[6,11],[16,21]])}))),function(e){return V.apply(this,arguments)})},{key:\"_innerClose\",value:(B=(0,s.default)(o.default.mark((function e(){var t,r;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._joined=!1,t=this._connState,this._connState=E,!this._room){e.next=7;break}return this._room.removeAllListeners(),e.next=7,this._room.leave();case 7:this._joinTimer&&(clearTimeout(this._joinTimer),this._joinTimer=null),this._stopStatInterval(),this._remoteAudios.clear(),this._remoteVideos.clear(),this._publishs.clear(),this._subscribes.clear(),this._mapMicProducers.forEach((function(e,t){e.close()})),this._mapWebcamProducers.forEach((function(e,t){e.close()})),this._mapMicProducers.clear(),this._mapWebcamProducers.clear(),null!=this._sendTransport&&(this._sendTransport.close(),this._sendTransport=null),this._screenTransport&&(this._screenTransport.close(),this._screenTransport=null),this._screenProducer&&(this._screenProducer.close(),this._screenProducer=null),this._mapVideoSendTransports.forEach((function(e,t){e.close()})),this._mapVideoSendTransports.clear(),this._recvTransport&&(this._recvTransport.close(),this._recvTransport=null),this._peers.clear(),x.debug(\"_innerClose() - Emit [connection-state-change] - \"+(0,u.default)(r)),r={prevState:t,curState:E},this.emit(\"connection-state-change\",r);case 27:case\"end\":return e.stop()}}),e,this)}))),function(){return B.apply(this,arguments)})},{key:\"close\",value:function(e){this._closed||(x.debug(\"API close()\"),this._hasInit=!1,this._closed=!0,this._innerClose(),this._liveMixerLayout=null,this._room=null,this._connState=E,this._joined=!1,this._protoo&&(this._protoo.close(),this._protoo=null),navigator.mediaDevices&&(navigator.mediaDevices.ondevicechange=null),this._stats.stopHeartBeat(),e&&3001===e.code&&this.emit(\"kickout\",e.data),this.emit(\"disconnected\",{code:e?e.code:1e3}),this.removeAllListeners())}},{key:\"_handlePeer\",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r.notify,e.appData.displayName;x.debug(\"_handlePeer() userID: \"+e.name+\" - Emit [peer-join] to APP\"),\"3\"!==e.appData.role.toString()&&this.emit(\"peer-join\",{userID:e.name,peer:e}),this._peers.set(\"\"+e.name,e);var n=!0,a=!1,i=void 0;try{for(var o,s=(0,c.default)(e.consumers);!(n=(o=s.next()).done);n=!0){var u=o.value;this._handleConsumer(u)}}catch(e){a=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw i}}e.on(\"close\",(function(r){x.debug(\"peer event -- [close] - userID: \"+e.name+\" originator: \"+r),t._peers.delete(\"\"+e.name),t._closed||(x.debug(\"_handlePeer() event -- [close] - userID: \"+e.name+\" - Emit [peer-leave] to APP\"),t._subscribes.forEach((function(r,n){r&&r.userId==e.name&&t._subscribes.delete(n)})),t._remoteStreams.forEach((function(r,n){r&&r.userId==e.name&&t._remoteStreams.delete(n)})),t._remoteVideos.forEach((function(r,n){r&&r.userId==e.name&&t._remoteVideos.delete(n)})),t._remoteAudios.forEach((function(r,n){r&&r.userId==e.name&&t._remoteAudios.delete(n)})),t.emit(\"peer-leave\",{userID:e.name,streams:e.streams||[],peer:e}))})),e.on(\"newconsumer\",(function(r){x.debug(\"_handlePeer() peer event -- [newconsumer] - peer.name: \"+e.name+\" consumer.id: \"+r.id),t._handleConsumer(r)}))}},{key:\"_handleConsumer\",value:(M=(0,s.default)(o.default.mark((function e(t){var r,n,a,i,s=this;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.rtpParameters.codecs[0],n={id:t.id,peerName:t.peer.name,source:t.appData.source,supported:t.supported,locallyPaused:t.locallyPaused,remotelyPaused:t.remotelyPaused,track:null,codec:r?r.name:null},x.debug(\"_handleConsumer() consumerPeerName: \"+t.peer.name+\" consumerInfo: \"+(0,u.default)(n)+\" \"),t.on(\"close\",(function(e){s._stats.removeStreamById(\"consumer_\"+t.id),x.debug(\"consumer event -- [close] - consumer.id: \"+t.id+\" originator: \"+e),t.disableStats()})),t.on(\"pause\",(function(e){s._stats.actStreamSSRCPairs(\"consumer_\"+t.id,!1),x.debug(\"consumer event -- [pause] - consumer.id: \"+t.id+\" originator: \"+e);var r=\"audio-mute\";if(\"audio\"===t.kind&&(r=\"audio-mute\"),\"video\"===t.kind&&(r=\"video-mute\"),\"remote\"===e)if(t.peer&&t.peer.streams&&t.appData){x.debug(\"_handleConsumer() consumer event -- [pause] - streamId: \"+t.appData.streamID+\" userID: \"+t.peer.name+\" - Emit [\"+r+\"] to APP\");var n=t.peer.streams.get(t.appData.streamID);s.emit(r,{stream:n}),s._subscribes.set(n.uuid,{userId:n.userID,streamId:n.getId(),stream:n,status:\"inactive\"})}else x.warn(\"_handleConsumer() consumer event -- [pause] error - invalid consumer.peer or consumer.appData\")})),t.on(\"resume\",(function(e){s._stats.actStreamSSRCPairs(\"consumer_\"+t.id,!0),x.debug(\"consumer event -- [resume] - consumer.id: \"+t.id+\" originator: \"+e);var r=\"audio-unmute\";if(\"audio\"===t.kind&&(r=\"audio-unmute\"),\"video\"===t.kind&&(r=\"video-unmute\"),\"remote\"===e)if(t.peer&&t.peer.streams&&t.appData){var n=t.peer.streams.get(t.appData.streamID);\"video-unmute\"===r&&(s._remoteVideos.has(n.uuid)||(s.emit(\"video-added\",{stream:n}),s._remoteVideos.set(n.uuid,{userId:t.peer.name,streamId:n.getId()}))),\"audio-unmute\"===r&&(s._remoteAudios.has(n.uuid)||(s.emit(\"audio-added\",{stream:n}),s._remoteAudios.set(n.uuid,{userId:t.peer.name,streamId:n.getId()}))),x.debug(\"_handleConsumer() consumer event -- [resume] - streamId: \"+t.appData.streamID+\" userID: \"+t.peer.name+\" - Emit [\"+r+\"] to APP\"),s.emit(r,{stream:n}),s._subscribes.set(n.uuid,{userId:n.userID,streamId:n.getId(),stream:n,status:\"active\"})}else x.warn(\"_handleConsumer() consumer event -- [resume] - error - invalid consumer.peer or consumer.appData\")})),t.on(\"effectiveprofilechange\",(function(e){x.debug(\"consumer event -- [effectiveprofilechange] - consumer.id: \"+t.id+\" profile: \"+e)})),t.on(\"stats\",(function(e){t.getStats().then((function(r){var n={};if(t.track&&\"video\"===t.track.kind&&(n=s._extractResolution(r)),t.peer){var a=t.peer.name;t.appData&&(a=t.appData.streamID),s._stats.setConsumeStats(e,n,t.peer.name,t.id,a)}})).catch((function(e){x.warn(\"consumer event -- [stats] error - \"+e.toString())}))})),t.on(\"internalStats\",(function(e){if(t.peer){var r=s._internalStats(\"receiverStats\",e,t.peer.name,t.id);s._stats.pushLoggerToServer(null,r)}})),t.supported?(t.peer.streams||(t.peer.streams=new d.default),(a=t.peer.streams.get(t.appData.streamID))||(i=t.appData.streamID?t.appData.streamID:t.peer.name,(a=new y.default({userID:t.peer.name,source:t.appData.source,streamID:i,videoType:t.appData.videoType,streamType:\"consumer\",openAudioCtx:!0})).streamObj=new MediaStream,t.peer.streams.set(a.streamID,a),this._remoteStreams.set(\"\"+i,a)),a&&\"video\"===t.kind&&void 0!==t.appData.videoType&&(a.videoType=t.appData.videoType),t.receive(this._recvTransport).then((function(e){x.debug(\"_handleConsumer() consumer.receive - consumer.name: \"+t.peer.name+\" track.kind: \"+e.kind),\"audio\"===e.kind&&(a.attachAudioTracks({track:e,autoPlay:!1}),setTimeout((function(){x.debug(\"_handleConsumer() consumer userID: \"+t.peer.name+\" streamId: \"+a.getId()+\" - Emit [audio-added] to APP\"),s.emit(\"audio-added\",{stream:a}),s._remoteAudios.set(a.uuid,{userId:t.peer.name,streamId:a.getId()})}),100)),\"video\"===e.kind&&(a.videoTracks=e,setTimeout((function(){x.debug(\"_handleConsumer() consumer userID: \"+t.peer.name+\" streamId: \"+a.getId()+\" - Emit [video-added] to APP\"),t.remotelyPaused||(s.emit(\"video-added\",{stream:a}),s.emit(\"video-update\",{userId:t.peer.name,streamId:a.getId(),videoType:a.videoType}),s._remoteVideos.set(a.uuid,{userId:t.peer.name,streamId:a.getId()}))}),100)),1===a.trackNumber&&setTimeout((function(){x.debug(\"_handleConsumer() consumer userID: \"+t.peer.name+\" streamId: \"+a.getId()+\" - Emit [stream-added] to APP\"),s.emit(\"stream-added\",{stream:a,type:a.type})}),500),t.transport.handler._pc.getStats(e).then((function(e){e.forEach((function(e){if(\"inbound-rtp\"===e.type){var r=s._stats.getStreamPropertyBySSRC(e.ssrc,\"userID\");r.id,\"\"===r.value&&s._stats.setStreamSSRCPairs(\"consumer_\"+t.id,e.ssrc,a,!1)}}))}))})).catch((function(e){x.warn(\"_handleConsumer() error - unexpected error while receiving a new Consumer: \"+e.toString())})),a.subscribed||t.pause(),t.enableStats(this._interval)):x.warn(\"_handleConsumer() error - consumer.peer.name: \"+t.peer.name+\" consumer.supported: \"+t.supported);case 10:case\"end\":return e.stop()}}),e,this)}))),function(e){return M.apply(this,arguments)})},{key:\"_setMicProducer\",value:function(e){var t=this;if(!e)return x.warn(\"_setMicProducer() error - parameter [stream] is INVALID.\"),i.default.reject(new Error(\"INVALID parameter [stream]\"));if(x.debug(\"_setMicProducer() - stream.streamID: \"+e.streamID),!this._room.canSend(\"audio\"))return i.default.reject(new Error(\"cannot send audio\"));if(this._mapMicProducers.get(e._innerStreamID))return i.default.reject(new Error(\"mic Producer already exists\"));var r=void 0;return i.default.resolve().then((function(){var n=e.streamObj.getAudioTracks();if(n.length<=0)return i.default.reject(\"Audio track non-exist\");var a=n[0],o=t._audioCodec.toLowerCase(),s=e.getAudioProfile();(s?s.codec.toLowerCase():\"\")!==o&&(x.debug(\"_setMicProducer() Stream.audioProfile is not match this._audioCodec - this._audioCodec: \"+t._audioCodec),e.setAudioProfile(\"opus\"===o?\"music_standard\":\"isac32\"));var c=e.getAudioProfile();return x.debug(\"_setMicProducer() will createProducer - streamId: \"+e.streamID+\" audioProfile: \"+(0,u.default)(c)),(r=t._room.createProducer(a,{audioProfile:c},{source:\"mic_\"+e.streamID,streamID:e.innerStreamID,userID:e.userID})).send(t._sendTransport)})).then((function(){t._mapMicProducers.set(e._innerStreamID,r),e.attachMicProducer(r),r.enableStats(t._interval);var n={id:r.id,source:\"mic\",locallyPaused:r.locallyPaused,remotelyPaused:r.remotelyPaused,track:r.track,codec:r.rtpParameters.codecs[0].name};x.debug(\"_setMicProducer() - producerInfo: \"+(0,u.default)(n)),r.on(\"close\",(function(n){x.debug(\"_setMicProducer() micProducer event -- [close] - [originator:\"+n+\"]\"),\"remote\"===n&&x.debug(\"producer close\"),t._mapMicProducers.delete(e._innerStreamID),e.detachMicProducer(r),r.disableStats()})),r.on(\"pause\",(function(e){x.debug(\"_setMicProducer() micProducer event -- [pause] - [originator:\"+e+\"]\")})),r.on(\"resume\",(function(e){x.debug(\"_setMicProducer() micProducer event -- [resume] - [originator:\"+e+\"]\")})),r.on(\"handled\",(function(){x.debug(\"_setMicProducer() micProducer event -- [handled]\")})),r.on(\"unhandled\",(function(){x.debug(\"_setMicProducer() micProducer event -- [unhandled]\")})),r.on(\"stats\",(function(r){t._stats.setMicStats(r,e._innerStreamID)})),r.on(\"internalStats\",(function(e){var r=t._internalStats(\"senderStats\",e);t._stats.pushLoggerToServer(null,r)}))})).then((function(){x.debug(\"_setMicProducer() succeeded\")})).catch((function(n){throw x.warn(\"_setMicProducer() failed - \"+n.toString()),r&&(t._mapMicProducers.delete(e._innerStreamID),e.detachMicProducer(r),r.close()),n}))}},{key:\"_setWebcamProducer\",value:function(e){var t=this;if(!e)return x.warn(\"_setWebcamProducer() error - parameter [stream] is INVALID.\"),i.default.reject(new Error(\"INVALID parameter [stream]\"));if(x.debug(\"_setWebcamProducer() stream.streamID: \"+e.streamID),!this._room.canSend(\"video\"))return i.default.reject(new Error(\"cannot send video\"));if(this._webcamProducer)return i.default.reject(new Error(\"webcam Producer already exists\"));var r=void 0;return i.default.resolve().then((0,s.default)(o.default.mark((function n(){var a,s,c,d,l,p;return o.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!((a=e.streamObj.getVideoTracks()).length<=0)){n.next=5;break}return n.abrupt(\"return\",i.default.reject(\"Video track non-exist\"));case 5:if(s=a[0],c=t._audioCodec.toLowerCase(),d=e.getAudioProfile(),(d?d.codec.toLowerCase():\"\")!==c&&(x.debug(\"_setWebcamProducer() Stream.audioProfile is not match this._audioCodec - this._audioCodec: \"+t._audioCodec),e.setAudioProfile(\"opus\"===c?\"music_standard\":\"isac32\")),l=e.getAudioProfile(),x.debug(\"_setWebcamProducer() will createProducer - streamId: \"+e.streamID+\" audioProfile: \"+(0,u.default)(l)),r=t._room.createProducer(s,{simulcast:t._useSimulcast,audioProfile:l,codecOptions:{videoGoogleStartBitrate:1e3*e.idealBandwidth,videoGoogleMaxBitrate:e.maxBandwidth,videoGoogleMinBitrate:e.minBandwidth}},{source:\"webcam_\"+e.streamID,streamID:e.innerStreamID,userID:e.userID,videoType:e.videoType})){n.next=17;break}return n.abrupt(\"return\",i.default.reject(\"_setWebcamProducer() fail - createProducer fail\"));case 17:if(p=void 0,!t._sendTransport.videoSent()){n.next=25;break}return n.next=21,t._newTransport(\"send\",\"web_cam\");case 21:p=n.sent,t._mapVideoSendTransports.set(e._innerStreamID,p),n.next=26;break;case 25:p=t._sendTransport;case 26:return x.debug(\"_setWebcamProducer() watching producer event\"),n.abrupt(\"return\",r.send(p));case 28:case\"end\":return n.stop()}}),n,t)})))).then((function(){t._mapWebcamProducers.set(e._innerStreamID,r),e.attachWebcamProducer(r),r.enableStats(t._interval);var n={id:r.id,source:\"webcam\",deviceLabel:\"device.webcam\",type:\"front/rear\",locallyPaused:r.locallyPaused,remotelyPaused:r.remotelyPaused,track:r.track,codec:r.rtpParameters.codecs[0].name};x.debug(\"_setWebcamProducer() - producerInfo: \"+(0,u.default)(n)),r.on(\"close\",(function(n){t._stats.removeStreamById(\"producer_\"+r.id),x.debug(\"_setWebcamProducer() webcamProducer event -- [close] - [originator:\"+n+\"]\"),r.disableStats(),t._mapWebcamProducers.delete(e._innerStreamID),e.detachWebcamProducer(r);var a=t._mapVideoSendTransports.get(e._innerStreamID);void 0!==a&&(a.close(),a.removeAllListeners(),t._mapVideoSendTransports.delete(e._innerStreamID))})),r.on(\"pause\",(function(e){t._stats.actStreamSSRCPairs(\"producer_\"+r.id,!1),x.debug(\"_setWebcamProducer() webcamProducer event -- [pause] - [originator:\"+e+\"]\")})),r.on(\"resume\",(function(e){t._stats.actStreamSSRCPairs(\"producer_\"+r.id,!0),x.debug(\"_setWebcamProducer() webcamProducer event -- [resume] [originator:\"+e+\"]\")})),r.on(\"handled\",(function(){x.debug(\"_setWebcamProducer() webcamProducer event -- [handled]\")})),r.on(\"unhandled\",(function(){x.debug(\"_setWebcamProducer() webcamProducer event -- [unhandled]\")})),r.on(\"stats\",(function(r){t._stats.setWebcamStats(r,e._innerStreamID)})),r.on(\"internalStats\",(function(e){var r=t._internalStats(\"senderStats\",e);t._stats.pushLoggerToServer(null,r)}))})).then((function(){x.debug(\"_setWebcamProducer() succeeded\"),r.transport.handler._pc.getStats(r.track).then((function(n){n.forEach((function(n){\"outbound-rtp\"===n.type&&t._stats.setStreamSSRCPairs(\"producer_\"+r.id,n.ssrc,e,!0)}))}))})).catch((function(n){throw x.warn(\"_setWebcamProducer() failed: - \"+n.toString()),r&&(t._mapWebcamProducers.delete(e._innerStreamID),e.detachWebcamProducer(r),r.close()),n}))}},{key:\"_setScreenProducer\",value:function(e){var t=this;if(!e)return x.warn(\"_setScreenProducer() error - parameter [stream] is INVALID.\"),i.default.reject(new Error(\"INVALID parameter [stream]\"));if(x.debug(\"_setScreenProducer() - streamId: \"+e.innerStreamID),!this._room.canSend(\"video\"))return i.default.reject(new Error(\"cannot send video\"));if(this._screenProducer)return i.default.reject(new Error(\"screen Producer already exists\"));var r=void 0;return i.default.resolve().then((0,s.default)(o.default.mark((function n(){var a;return o.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=e.streamObj.getVideoTracks()[0],r=t._room.createProducer(a,{simulcast:t._useSimulcast},{source:\"screen\",streamID:e.innerStreamID}),n.next=4,t._newTransport(\"send\",\"screen\");case 4:return t._screenTransport=n.sent,n.abrupt(\"return\",r.send(t._screenTransport));case 6:case\"end\":return n.stop()}}),n,t)})))).then((function(){t._screenProducer=r,t._screenProducer.enableStats(t._interval);var n={id:r.id,source:\"screen\",deviceLabel:\"device.screen\",type:\"front\",locallyPaused:r.locallyPaused,remotelyPaused:r.remotelyPaused,track:r.track,codec:r.rtpParameters.codecs[0].name};x.debug(\"_setScreenProducer() - streamId: \"+e.innerStreamID+\" producerInfo: \"+n),r.on(\"close\",(function(e){t._stats.removeStreamById(\"producer_\"+r.id),x.debug(\"setScreenProducer() screenProducer event -- [close] - [originator:\"+e+\"]\"),t._screenProducer=null,t._screenTransport.close(),t._screenTransport.removeAllListeners(),t._screenTransport=null,r.disableStats()})),r.on(\"pause\",(function(e){t._stats.actStreamSSRCPairs(\"producer_\"+r.id,!1),x.debug(\"_setScreenProducer() screenProducer event -- [pause] - [originator:\"+e+\"]\")})),r.on(\"resume\",(function(e){t._stats.actStreamSSRCPairs(\"producer_\"+r.id,!0),x.debug(\"_setScreenProducer() screenProducer event -- [resume] - [originator:\"+e+\"]\")})),r.on(\"handled\",(function(){x.debug(\"_setScreenProducer() screenProducer event -- [handled]\")})),r.on(\"unhandled\",(function(){x.debug(\"screen Producer event -- [unhandled]\")})),r.on(\"stats\",(function(r){t._stats.setWebcamStats(r,e.innerStreamID)})),r.on(\"internalStats\",(function(e){var r=t._internalStats(\"senderStats\",e);t._stats.pushLoggerToServer(null,r)}))})).then((function(){x.debug(\"_setScreenProducer() succeeded\"),r.transport.handler._pc.getStats(r.track).then((function(n){n.forEach((function(n){\"outbound-rtp\"===n.type&&t._stats.setStreamSSRCPairs(\"producer_\"+r.id,n.ssrc,e,!0)}))}))})).catch((function(e){throw x.warn(\"_setScreenProducer() failed:%o\",e),r&&(r.close(),t._screenProducer=null),e}))}},{key:\"_delay\",value:function(e){var t,r,n=new i.default((function(n,a){t=setTimeout(n,e),r=a}));return n.cancel=function(){clearTimeout(t),r(Error(\"Cancelled\"))},n}},{key:\"getStats\",value:function(){return this.getNetState()}},{key:\"getNetState\",value:function(){return{iceSendTransport:this._sendTransport?this._sendTransport.connectionState:\"fault\",iceRecvTransport:this._recvTransport?this._recvTransport.connectionState:\"fault\",websocketTransport:this._protoo&&this._protoo._transport?this._protoo._transport.connected?\"online\":\"offline\":\"fault\",loginStatus:this._joined?\"online\":\"offline\",stats:this._stats?this._stats.summarize:{}}}},{key:\"getRemoteAudioStats\",value:function(e){if(\"function\"!=typeof e)throw x.warn(\"API getRemoteAudioStats() error - parameter: callback invalid\"),new TypeError(\"callback is not function.\");e(this._stats.audioDownStat)}},{key:\"remoteAudioStats\",value:function(){return this._stats.audioDownStat}},{key:\"getRemoteVideoStats\",value:function(e){if(\"function\"!=typeof e)throw x.warn(\"API getRemoteVideoStats() error - parameter: callback invalid\"),new TypeError(\"callback is not function.\");e(this._stats.videoDownStat)}},{key:\"remoteVideoStats\",value:function(){return this._stats.videoDownStat}},{key:\"getLocalAudioStats\",value:function(e){if(\"function\"!=typeof e)throw x.warn(\"API getLocalAudioStats() error - parameter: callback invalid\"),new TypeError(\"callback is not function.\");e(this._stats.audioUpStat)}},{key:\"localAudioStats\",value:function(){return this._stats.audioUpStat}},{key:\"getLocalVideoStats\",value:function(e){if(\"function\"!=typeof e)throw x.warn(\"API getLocalVideoStats() error - parameter: callback invalid\"),new TypeError(\"callback is not function.\");e(this._stats.videoUpStat)}},{key:\"localVideoStats\",value:function(){return this._stats.videoUpStat}},{key:\"setLiveMixerLayout\",value:(j=(0,s.default)(o.default.mark((function e(t,r,n){var i,s,c,d,l,p,f,m,h,v,_,y,b,k,w,P;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(\"function\"==typeof r){e.next=3;break}throw x.error(\"API setLiveMixerLayout() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not function.\");case 3:if(\"function\"==typeof n){e.next=6;break}throw x.error(\"API setLiveMixerLayout() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not function.\");case 6:if(t&&t.users){e.next=9;break}return n(\"API setLiveMixerLayout() error - parameter: liveMixerLayout invalid\"),e.abrupt(\"return\");case 9:if(this._protooTransportStat){e.next=13;break}return x.warn(\"API setLiveMixerLayout() error - protooTransport broken\"),\"function\"==typeof n&&n(\"protooTransport broken\"),e.abrupt(\"return\");case 13:if(this._joined){e.next=17;break}return x.warn(\"API setLiveMixerLayout() error - non-joined\"),\"function\"==typeof n&&n(\"non-joined\"),e.abrupt(\"return\");case 17:if(\"1\"===this._role){e.next=21;break}return x.warn(\"API setLiveMixerLayout() error - Must be master - this._role: \"+this._role),\"function\"==typeof n&&n(\"Must be master\"),e.abrupt(\"return\");case 21:if(i=[],this._liveMixerLayout&&this._liveMixerLayout.users)for(s=0;s<t.users.length;s++)for(c=0;c<this._liveMixerLayout.users.length;c++)this._liveMixerLayout.users[c].streamId===t.users[s].streamId&&i.push(this._liveMixerLayout.users[c]);d=[],this._liveMixerLayout&&this._liveMixerLayout.users&&(d=this._liveMixerLayout.users.filter((function(e){return!i.find((function(t){return e.streamId===t.streamId}))}))),l=t.users.filter((function(e){return!i.find((function(t){return e.streamId===t.streamId}))})),x.debug(\"API setLiveMixerLayout() - liveMixerLayout: \"+(0,u.default)(t)+\" - this._liveMixerLayout: \"+(0,u.default)(this._liveMixerLayout)+\" - addUser: \"+(0,u.default)(l)+\" delUser: \"+(0,u.default)(d)),e.prev=27,p=\"\",f=0,f=0;case 31:if(!(f<d.length)){e.next=40;break}if(!d[f]){e.next=37;break}return m={type:\"del\",peerId:\"\"+d[f].userId,devId:\"\"+d[f].streamId||\"\"},p=p+\" - \"+(0,u.default)(m),e.next=37,this._protoo.send(\"setMixer\",m);case 37:f++,e.next=31;break;case 40:\"\"!==p&&x.debug(\"API setLiveMixerLayout() - type: del - setMixer: \"+p),p=\"\",f=0;case 43:if(!(f<l.length)){e.next=52;break}if(!l[f]){e.next=49;break}return h={type:\"add\",peerId:\"\"+l[f].userId,devId:\"\"+l[f].streamId||\"\"},p=p+\" - \"+(0,u.default)(h),e.next=49,this._protoo.send(\"setMixer\",h);case 49:f++,e.next=43;break;case 52:return\"\"!==p&&x.debug(\"API setLiveMixerLayout() - type: add - setMixer: \"+p),v=232,_=230,y=232,b=t.backgroundColor?t.backgroundColor.toString(16):\"00000000\",(k=b.length)<=2?y=parseInt(\"0x\"+b.slice(0)):k<=4?(y=parseInt(\"0x\"+b.slice(k-2)),_=parseInt(\"0x\"+b.slice(0,k-2))):(y=parseInt(\"0x\"+b.slice(k-2)),_=parseInt(\"0x\"+b.slice(k-4,k-2)),v=parseInt(\"0x\"+b.slice(0,k-4))),w=(new Date).getTime(),P={ts:\"\"+w,ver:\"20161227\",canvas:{bgrad:[v,_,y],h:t.height?t.width:480,w:t.width?t.width:640},mid:\"\"+this._uid,pos:[]},t.users.forEach((function(e){if(e&&\"object\"===(void 0===e?\"undefined\":(0,a.default)(e))){var t={};t.id=\"\"+e.streamId,t.x=e.x,t.y=e.y,t.w=e.w,t.h=e.h,t.z=e.z,P.pos.push(t)}})),e.next=64,this._protoo.send(\"setSEI\",{sei:P});case 64:this._liveMixerLayout=g.clone(t),x.debug(\"API setLiveMixerLayout() success - sei: \"+(0,u.default)(P)+\" - this._liveMixerLayout: \"+(0,u.default)(this._liveMixerLayout)),r(),e.next=73;break;case 69:e.prev=69,e.t0=e.catch(27),x.warn(\"API setLiveMixerLayout() fail - \"+e.t0.toString()),n(\"\"+e.t0.toString());case 73:case\"end\":return e.stop()}}),e,this,[[27,69]])}))),function(e,t,r){return j.apply(this,arguments)})},{key:\"setSEI\",value:function(e,t,r,n,a,o,s){var c=this;if(!this._protooTransportStat)return x.warn(\"API setSEI() error - protooTransport broken\"),void(\"function\"==typeof s&&s(\"protooTransport broken\"));if(!this._joined)return x.warn(\"API setSEI() error - non-joined\"),void(\"function\"==typeof s&&s(\"non-joined\"));if(\"1\"!==this._role)return x.warn(\"API setSEI() error - Must be master - this._role: \"+this._role),void(\"function\"==typeof s&&s(\"Must be master\"));var d=\"\";if(\"add\"===t.toLocaleLowerCase()?d=\"add\":\"del\"===t.toLocaleLowerCase()&&(d=\"del\"),\"\"===d)return x.warn(\"setSEI() error - parameter [type] type: \"+t+\" is INVALID\"),void(\"function\"==typeof s&&s(\"parameter [type] is INVALID\"));var l={type:d,peerId:\"\"+e,devId:a||\"\"};r&&(l.devId=e+\":screen\",n.pos=n.pos.map((function(t){return t.id===a&&(t.id=e+\":screen\"),t}))),x.debug(\"API setSEI() - uid: \"+e+\" type: \"+t+\" isScreen: \"+r+\" sei: \"+(0,u.default)(n)+\" devId: \"+a),i.default.resolve().then((function(){x.debug(\"API setSEI() - setMixer sType: \"+(0,u.default)(l)),c._protoo.send(\"setMixer\",l)})).then((function(){c._protoo.send(\"setSEI\",{sei:n}),\"function\"==typeof o&&o(),x.warn(\"API setSEI() success\")})).catch((function(e){x.warn(\"API setSEI() error - \"+e.toString()),\"function\"==typeof s&&s(\"\"+e.toString())}))}},{key:\"subscribeOtherRoom\",value:function(e,t,r){if(\"function\"!=typeof t)throw x.error(\"API subscribeOtherRoom() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not function.\");if(\"function\"!=typeof r)throw x.error(\"API subscribeOtherRoom() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not function.\");return e?this._protooTransportStat?this._joined?\"1\"!==this._role?(x.warn(\"API subscribeOtherRoom() error - Must be master - this._role: \"+this._role),void r(\"Must be master\")):(x.warn(\"API subscribeOtherRoom() success - subscribeRoomId: \"+e),void this._protoo.send(\"subscribeOtherRoom\",{subscribeRoomId:e}).then(t).catch(r)):(x.warn(\"API subscribeOtherRoom() error - non-joined\"),void r(\"non-joined\")):(x.warn(\"API subscribeOtherRoom() error - protooTransport broken\"),void r(\"protooTransport is broken\")):(x.warn(\"API subscribeOtherRoom() error - parameter: subscribeRoomId invalid\"),void r(\"Param error - subscribeRoomId is invalid\"))}},{key:\"unsubscribeOtherRoom\",value:function(e,t,r){if(\"function\"!=typeof t)throw x.error(\"API unsubscribeOtherRoom() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not function.\");if(\"function\"!=typeof r)throw x.error(\"API unsubscribeOtherRoom() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not function.\");return e?this._protooTransportStat?this._joined?\"1\"!==this._role?(x.warn(\"API unsubscribeOtherRoom() error - Must be master - this._role: \"+this._role),void r(\"Must be master\")):(x.warn(\"API unsubscribeOtherRoom() success - subscribeRoomId: \"+e),void this._protoo.send(\"unsubscribeOtherRoom\",{unsubscribeRoomId:e}).then(t).catch(r)):(x.warn(\"API unsubscribeOtherRoom() error - non-joined\"),void r(\"non-joined\")):(x.warn(\"API unsubscribeOtherRoom() error - protooTransport broken\"),void r(\"protooTransport is broken\")):(x.warn(\"API unsubscribeOtherRoom() error - parameter: unsubscribeRoomId invalid\"),void r(\"Param error - unsubscribeRoomId is invalid\"))}},{key:\"setUserRole\",value:function(e,t,r){var n=this;if(\"function\"!=typeof t)throw x.error(\"API setUserRole() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not function.\");if(\"function\"!=typeof r)throw x.error(\"API setUserRole() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not function.\");if(!e)return x.warn(\"API setUserRole() error - parameter [role] is INVALID.\"),void r(\"Param error - role is invalid\");var a=+e;if(this._joined){if(!this._protooTransportStat)return x.warn(\"API setUserRole() error - protooTransport broken\"),void r(\"protooTransport is broken\");if(3===a&&this.isPublish)return x.warn(\"API setUserRole() error - unpublish all the stream before setUserRole\"),void r(\"Please unpublish all stream\");if(+this._role===a)return void r(\"Role: no changed.\");if(2!==a&&3!==a)return x.warn(\"API setUserRole() error - Role: Only allowed between 2 | 3\"),void r(\"Role: Only allowed between 2 | 3\");if(1==+this._role)return x.warn(\"API setUserRole() error - Role: Only allowed between 2 | 3\"),void r(\"Role: Only allowed between 2 | 3\");x.debug(\"API setUserRole() - role: \"+a),this._protoo.send(\"changeRole\",{role:a}).then((function(){x.debug(\"API setUserRole() success\"),n._role=a+\"\",t()})).catch((function(e){x.debug(\"API setUserRole() fail - \"+e.toString()),r(e.toString())}))}else{if(a>3||a<1)return x.warn(\"API setUserRole() error - parameter [role] is INVALID.\"),void r(\"Role: Only allowed between 1 | 2 | 3\");x.warn(\"API setUserRole() - role: \"+e),this._role=e+\"\",t()}}},{key:\"setVideoMixerBGIUrl\",value:(L=(0,s.default)(o.default.mark((function e(t,r,n){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(\"function\"==typeof r){e.next=3;break}throw x.error(\"API setVideoMixerBGIUrl() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not function.\");case 3:if(\"function\"==typeof n){e.next=6;break}throw x.error(\"API setVideoMixerBGIUrl() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not function.\");case 6:if(\"string\"==typeof t){e.next=10;break}return x.warn(\"API setVideoMixerBGIUrl() error - url: \"+(void 0===t?\"undefined\":(0,a.default)(t))),n(\"parameter [url] is INVALID\"),e.abrupt(\"return\");case 10:if(this._videoMixerBGIUrl=t.trim(),!this._joined){e.next=16;break}return e.next=14,this._protoo.send(\"updateVideoMixerBGIUrl\",{roomId:this._roomId,url:t});case 14:x.debug(\"API setVideoMixerBGIUrl() success - \"+t),r();case 16:case\"end\":return e.stop()}}),e,this)}))),function(e,t,r){return L.apply(this,arguments)})},{key:\"setRtmpUrl\",value:(C=(0,s.default)(o.default.mark((function e(t,r,n){var i,s,c;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.url,s=t.avMode,c=0,c=void 0!==(void 0===s?\"undefined\":(0,a.default)(s))&&\"audio\"===s?1:2,\"string\"==typeof i){e.next=7;break}return x.warn(\"API setRtmpUrl() error - url: \"+(void 0===i?\"undefined\":(0,a.default)(i))),\"function\"==typeof n&&n(\"parameter [url] is INVALID\"),e.abrupt(\"return\");case 7:if(\"1\"===this._role){e.next=11;break}return x.warn(\"API setRtmpUrl() error - Must be master - this._role: \"+this._role),\"function\"==typeof n&&n(\"Must be master\"),e.abrupt(\"return\");case 11:if(this._valid_rtmp_url=i.trim(),!this._joined){e.next=17;break}return e.next=15,this._protoo.send(\"updateRtmpUrl\",{roomId:this._roomId,url:i,mediaType:c});case 15:x.debug(\"API setRtmpUrl() success - \"+i+\" mediaType: \"+c),\"function\"==typeof r&&r();case 17:case\"end\":return e.stop()}}),e,this)}))),function(e,t,r){return C.apply(this,arguments)})},{key:\"renewToken\",value:(T=(0,s.default)(o.default.mark((function e(t,r,n){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(\"function\"==typeof r){e.next=3;break}throw x.error(\"API renewToken() error - parameter: onSuccess invalid\"),TypeError(\"onSuccess is not function.\");case 3:if(\"function\"==typeof n){e.next=6;break}throw x.error(\"API renewToken() error - parameter: onFailure invalid\"),TypeError(\"onFailure is not function.\");case 6:if(this._joined){e.next=10;break}return x.warn(\"you should join room first.\"),n(\"non-joined\"),e.abrupt(\"return\");case 10:if(\"string\"!=typeof t){e.next=16;break}return e.next=13,this._protoo.send(\"refreshToken\",{token:t});case 13:x.debug(\"API renewToken() success\"),e.next=19;break;case 16:return x.debug(\"API renewToken() error - Param error - token is invalid\"),n(\"Param error - token is invalid\"),e.abrupt(\"return\");case 19:case\"end\":return e.stop()}}),e,this)}))),function(e,t,r){return T.apply(this,arguments)})},{key:\"kickOut\",value:(k=(0,s.default)(o.default.mark((function e(t,r,n){var a;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._protooTransportStat){e.next=4;break}return x.warn(\"API kickOut() error - protooTransport broken\"),\"function\"==typeof n&&n(\"protooTransport broken\"),e.abrupt(\"return\");case 4:if(this._joined){e.next=8;break}return x.warn(\"API kickOut() error - non-joined\"),\"function\"==typeof n&&n(\"non-joined\"),e.abrupt(\"return\");case 8:if(t){e.next=12;break}return x.warn(\"API kickOut() error - parameter [userId] is INVALID.\"),\"function\"==typeof n&&n(\"parameter [userId] is INVALID\"),e.abrupt(\"return\");case 12:if(\"\"!==(a=(a=t+\"\").trim())){e.next=18;break}return x.warn(\"API kickOut() error - parameter [userId] is INVALID.\"),\"function\"==typeof n&&n(\"parameter [userId] is INVALID\"),e.abrupt(\"return\");case 18:if(\"1\"===this._role){e.next=22;break}return x.warn(\"API kickOut() error - Must be master - this._role: \"+this._role),\"function\"==typeof n&&n(\"Must be master\"),e.abrupt(\"return\");case 22:if(this._peers.get(\"\"+a)){e.next=26;break}return x.warn(\"API kickOut() error - userId: \"+a+\" not found.\"),\"function\"==typeof n&&n(a+\" not found\"),e.abrupt(\"return\");case 26:return e.next=28,this._protoo.send(\"kickout\",{peerId:a});case 28:x.debug(\"API kickOut() sucess - userId: \"+a),\"function\"==typeof r&&r();case 30:case\"end\":return e.stop()}}),e,this)}))),function(e,t,r){return k.apply(this,arguments)})},{key:\"getTransportStatus\",value:function(){return{iceSendTransport:this._sendTransport?this._sendTransport.connectionState:\"fault\",iceRecvTransport:this._recvTransport?this._recvTransport.connectionState:\"fault\",websocketTransport:this._protoo&&this._protoo._transport?this._protoo._transport.connected:\"fault\",loginStatus:this._joined?\"online\":\"offline\"}}},{key:\"_extractResolution\",value:function(e){var t={frameHeight:0,frameWidth:0},r={};return e.forEach((function(e){(0,n.default)(e).forEach((function(r){\"frameheight\"===r.toLocaleLowerCase()&&(t.frameHeight=e[r]),\"framewidth\"===r.toLocaleLowerCase()&&(t.frameWidth=e[r])}));try{if(0!==t.frameWidth)throw r}catch(e){if(e!==r)throw e}})),t}},{key:\"_newTransport\",value:(v=(0,s.default)(o.default.mark((function e(t,r){var n,a,i=this;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=\"\",t){e.next=3;break}return e.abrupt(\"return\");case 3:if(\"send\"===t||\"recv\"===t){e.next=5;break}return e.abrupt(\"return\");case 5:n=r&&\"\"!==r?r:\"SEND_MIC_WEBCAM\",a=null,e.prev=7,a=this._room.createTransport(\"send\",{media:n}),e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(7),x.warn(\"_newTransport() this._room.createTransport fail - \"+e.t0.toString()),e.abrupt(\"return\");case 15:return a.on(\"close\",(function(e){x.debug(\"sendTransport event -- [close] - [originator: \"+e+\"]\")})),a.on(\"connectionstatechange\",function(){var e=(0,s.default)(o.default.mark((function e(t){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:\"disconnected\"===t&&(i._iceSendDisconnectedCnt++,x.warn(\"sendTransport disconnected. will retryRestartIce after 500ms\"),setTimeout((function(){a.attemptRestartIce()}),500)),\"failed\"===t&&(x.warn(\"sendTransport failed. will retryRestartIce...\"),a.attemptRestartIce()),\"connected\"===t&&R(a._handler._pc,(function(e){i._stats.setWebrtcInternalSendStats(e)}),1e3),x.debug(\"sendTransport connectionstatechange: \"+t);case 4:case\"end\":return e.stop()}}),e,i)})));return function(t){return e.apply(this,arguments)}}()),e.abrupt(\"return\",a);case 18:case\"end\":return e.stop()}}),e,this,[[7,11]])}))),function(e,t){return v.apply(this,arguments)})},{key:\"_internalStats\",value:function(e,t,r,n){var a={appId:this._appId,userId:this._uid,roomId:this._roomId,stats:\"internalStats\",direction:e,\"media-source\":[],certificate:[],codec:[],\"candidate-pair\":[],\"local-candidate\":[],\"remote-candidate\":[],\"inbound-rtp\":[],\"outbound-rtp\":[],\"remote-inbound-rtp\":[],track:[],stream:[],\"peer-connection\":[],transport:[]};return t.forEach((function(e){e.type,\"codec\"===e.type&&a.codec.push(e),\"candidate-pair\"===e.type&&a[\"candidate-pair\"].push(e),\"local-candidate\"===e.type&&a[\"local-candidate\"].push(e),\"inbound-rtp\"===e.type&&a[\"inbound-rtp\"].push(e),\"track\"===e.type&&a.track.push(e),\"stream\"===e.type&&a.stream.push(e),\"peer-connection\"===e.type&&a[\"peer-connection\"].push(e),\"transport\"===e.type&&a.transport.push(e),\"media-source\"===e.type&&a[\"media-source\"].push(e),\"transport\"===e.type&&a.transport.push(e)})),\"receiverStats\"===e&&(a.consumerPeerId=r,a.consumer=n),a}},{key:\"producerStreams\",get:function(){var e=[];return this._publishStreams.forEach((function(t,r){if(t){var n={streamId:t.streamID,type:t.streamType,userId:t.userID,specialCameraId:t.specialCameraId,specialMicId:t.specialMicId,hasVideo:t.hasVideo(),hasAudio:t.hasAudio()};e.push(n)}})),e}},{key:\"consumerStreams\",get:function(){var e=[];return this._peers.forEach((function(t,r){t.streams&&t.streams.forEach((function(t,r){if(t){var n={streamId:t.streamID,type:t.streamType,userId:t.userID,specialCameraId:t.specialCameraId,specialMicId:t.specialMicId,hasVideo:t.hasVideo(),hasAudio:t.hasAudio()};e.push(n)}}))})),e}},{key:\"micProducers\",get:function(){var e=[];return this._mapMicProducers.forEach((function(t,r){var n={streamId:r,appData:t.appData};e.push(n)})),e}},{key:\"webcamProducers\",get:function(){var e=[];return this._mapWebcamProducers.forEach((function(t,r){var n={streamId:r,appData:t.appData};e.push(n)})),e}},{key:\"screenProducers\",get:function(){var e=[];if(null!=this._screenProducer){var t={streamId:\"x_screen\",appData:this._screenProducer.appData};e.push(t)}return e}},{key:\"isLocalStreamAllowed\",get:function(){var e=+this._role;return 1===e||2===e}},{key:\"isPublish\",get:function(){return!!this._publishs&&this._publishs.size>0}},{key:\"closed\",get:function(){return this._closed}}],[{key:\"JOIN_ROOM_TIME_OUT\",get:function(){return 4e3}},{key:\"TurnConf\",set:function(e){if(null==e)throw new TypeError(\"turn configure\");try{A.urls=e.urls,A.credential=e.credential,A.username=e.username,A.iceTransportPolicy=e.iceTransportPolicy}catch(e){throw e}}}]),r}(k.EventEmitter);t.default=L}).call(this,r(43))},function(e,t,r){r(151),e.exports=r(7).Object.keys},function(e,t,r){var n=r(31),a=r(47);r(65)(\"keys\",(function(){return function(e){return a(n(e))}}))},function(e,t,r){r(58),r(34),r(39),r(153),r(157),r(158),e.exports=r(7).Promise},function(e,t,r){\"use strict\";var n,a,i,o,s=r(44),c=r(13),u=r(27),d=r(59),l=r(11),p=r(18),f=r(45),m=r(75),h=r(50),v=r(93),_=r(94).set,g=r(155)(),y=r(77),b=r(95),k=r(156),w=r(96),P=c.TypeError,S=c.process,I=S&&S.versions,T=I&&I.v8||\"\",C=c.Promise,R=\"process\"==d(S),x=function(){},A=a=y.f,E=!!function(){try{var e=C.resolve(1),t=(e.constructor={})[r(14)(\"species\")]=function(e){e(x,x)};return(R||\"function\"==typeof PromiseRejectionEvent)&&e.then(x)instanceof t&&0!==T.indexOf(\"6.6\")&&-1===k.indexOf(\"Chrome/66\")}catch(e){}}(),D=function(e){var t;return!(!p(e)||\"function\"!=typeof(t=e.then))&&t},O=function(e,t){if(!e._n){e._n=!0;var r=e._c;g((function(){for(var n=e._v,a=1==e._s,i=0,o=function(t){var r,i,o,s=a?t.ok:t.fail,c=t.resolve,u=t.reject,d=t.domain;try{s?(a||(2==e._h&&M(e),e._h=1),!0===s?r=n:(d&&d.enter(),r=s(n),d&&(d.exit(),o=!0)),r===t.promise?u(P(\"Promise-chain cycle\")):(i=D(r))?i.call(r,c,u):c(r)):u(n)}catch(e){d&&!o&&d.exit(),u(e)}};r.length>i;)o(r[i++]);e._c=[],e._n=!1,t&&!e._h&&L(e)}))}},L=function(e){_.call(c,(function(){var t,r,n,a=e._v,i=j(e);if(i&&(t=b((function(){R?S.emit(\"unhandledRejection\",a,e):(r=c.onunhandledrejection)?r({promise:e,reason:a}):(n=c.console)&&n.error&&n.error(\"Unhandled promise rejection\",a)})),e._h=R||j(e)?2:1),e._a=void 0,i&&t.e)throw t.v}))},j=function(e){return 1!==e._h&&0===(e._a||e._c).length},M=function(e){_.call(c,(function(){var t;R?S.emit(\"rejectionHandled\",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})}))},B=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),O(t,!0))},V=function(e){var t,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===e)throw P(\"Promise can't be resolved itself\");(t=D(e))?g((function(){var n={_w:r,_d:!1};try{t.call(e,u(V,n,1),u(B,n,1))}catch(e){B.call(n,e)}})):(r._v=e,r._s=1,O(r,!1))}catch(e){B.call({_w:r,_d:!1},e)}}};E||(C=function(e){m(this,C,\"Promise\",\"_h\"),f(e),n.call(this);try{e(u(V,this,1),u(B,this,1))}catch(e){B.call(this,e)}},(n=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r(78)(C.prototype,{then:function(e,t){var r=A(v(this,C));return r.ok=\"function\"!=typeof e||e,r.fail=\"function\"==typeof t&&t,r.domain=R?S.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&O(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),i=function(){var e=new n;this.promise=e,this.resolve=u(V,e,1),this.reject=u(B,e,1)},y.f=A=function(e){return e===C||e===o?new i(e):a(e)}),l(l.G+l.W+l.F*!E,{Promise:C}),r(49)(C,\"Promise\"),r(97)(\"Promise\"),o=r(7).Promise,l(l.S+l.F*!E,\"Promise\",{reject:function(e){var t=A(this);return(0,t.reject)(e),t.promise}}),l(l.S+l.F*(s||!E),\"Promise\",{resolve:function(e){return w(s&&this===o?C:this,e)}}),l(l.S+l.F*!(E&&r(98)((function(e){C.all(e).catch(x)}))),\"Promise\",{all:function(e){var t=this,r=A(t),n=r.resolve,a=r.reject,i=b((function(){var r=[],i=0,o=1;h(e,!1,(function(e){var s=i++,c=!1;r.push(void 0),o++,t.resolve(e).then((function(e){c||(c=!0,r[s]=e,--o||n(r))}),a)})),--o||n(r)}));return i.e&&a(i.v),r.promise},race:function(e){var t=this,r=A(t),n=r.reject,a=b((function(){h(e,!1,(function(e){t.resolve(e).then(r.resolve,n)}))}));return a.e&&n(a.v),r.promise}})},function(e,t){e.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},function(e,t,r){var n=r(13),a=r(94).set,i=n.MutationObserver||n.WebKitMutationObserver,o=n.process,s=n.Promise,c=\"process\"==r(48)(o);e.exports=function(){var e,t,r,u=function(){var n,a;for(c&&(n=o.domain)&&n.exit();e;){a=e.fn,e=e.next;try{a()}catch(n){throw e?r():t=void 0,n}}t=void 0,n&&n.enter()};if(c)r=function(){o.nextTick(u)};else if(!i||n.navigator&&n.navigator.standalone)if(s&&s.resolve){var d=s.resolve(void 0);r=function(){d.then(u)}}else r=function(){a.call(n,u)};else{var l=!0,p=document.createTextNode(\"\");new i(u).observe(p,{characterData:!0}),r=function(){p.data=l=!l}}return function(n){var a={fn:n,next:void 0};t&&(t.next=a),e||(e=a,r()),t=a}}},function(e,t,r){var n=r(13).navigator;e.exports=n&&n.userAgent||\"\"},function(e,t,r){\"use strict\";var n=r(11),a=r(7),i=r(13),o=r(93),s=r(96);n(n.P+n.R,\"Promise\",{finally:function(e){var t=o(this,a.Promise||i.Promise),r=\"function\"==typeof e;return this.then(r?function(r){return s(t,e()).then((function(){return r}))}:e,r?function(r){return s(t,e()).then((function(){throw r}))}:e)}})},function(e,t,r){\"use strict\";var n=r(11),a=r(77),i=r(95);n(n.S,\"Promise\",{try:function(e){var t=a.f(this),r=i(e);return(r.e?t.reject:t.resolve)(r.v),t.promise}})},function(e,t,r){var n=function(){return this}()||Function(\"return this\")(),a=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf(\"regeneratorRuntime\")>=0,i=a&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,e.exports=r(160),a)n.regeneratorRuntime=i;else try{delete n.regeneratorRuntime}catch(e){n.regeneratorRuntime=void 0}},function(e,t){!function(t){\"use strict\";var r=Object.prototype,n=r.hasOwnProperty,a=\"function\"==typeof Symbol?Symbol:{},i=a.iterator||\"@@iterator\",o=a.asyncIterator||\"@@asyncIterator\",s=a.toStringTag||\"@@toStringTag\",c=\"object\"==typeof e,u=t.regeneratorRuntime;if(u)c&&(e.exports=u);else{(u=t.regeneratorRuntime=c?e.exports:{}).wrap=h;var d={},l={};l[i]=function(){return this};var p=Object.getPrototypeOf,f=p&&p(p(T([])));f&&f!==r&&n.call(f,i)&&(l=f);var m=y.prototype=_.prototype=Object.create(l);g.prototype=m.constructor=y,y.constructor=g,y[s]=g.displayName=\"GeneratorFunction\",u.isGeneratorFunction=function(e){var t=\"function\"==typeof e&&e.constructor;return!!t&&(t===g||\"GeneratorFunction\"===(t.displayName||t.name))},u.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,s in e||(e[s]=\"GeneratorFunction\")),e.prototype=Object.create(m),e},u.awrap=function(e){return{__await:e}},b(k.prototype),k.prototype[o]=function(){return this},u.AsyncIterator=k,u.async=function(e,t,r,n){var a=new k(h(e,t,r,n));return u.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},b(m),m[s]=\"Generator\",m[i]=function(){return this},m.toString=function(){return\"[object Generator]\"},u.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},u.values=T,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method=\"next\",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)\"t\"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if(\"throw\"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return o.type=\"throw\",o.arg=e,t.next=r,n&&(t.method=\"next\",t.arg=void 0),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if(\"root\"===i.tryLoc)return r(\"end\");if(i.tryLoc<=this.prev){var s=n.call(i,\"catchLoc\"),c=n.call(i,\"finallyLoc\");if(s&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error(\"try statement without catch or finally\");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,\"finallyLoc\")&&this.prev<a.finallyLoc){var i=a;break}}i&&(\"break\"===e||\"continue\"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method=\"next\",this.next=i.finallyLoc,d):this.complete(o)},complete:function(e,t){if(\"throw\"===e.type)throw e.arg;return\"break\"===e.type||\"continue\"===e.type?this.next=e.arg:\"return\"===e.type?(this.rval=this.arg=e.arg,this.method=\"return\",this.next=\"end\"):\"normal\"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if(\"throw\"===n.type){var a=n.arg;S(r)}return a}}throw new Error(\"illegal catch attempt\")},delegateYield:function(e,t,r){return this.delegate={iterator:T(e),resultName:t,nextLoc:r},\"next\"===this.method&&(this.arg=void 0),d}}}function h(e,t,r,n){var a=t&&t.prototype instanceof _?t:_,i=Object.create(a.prototype),o=new I(n||[]);return i._invoke=function(e,t,r){var n=\"suspendedStart\";return function(a,i){if(\"executing\"===n)throw new Error(\"Generator is already running\");if(\"completed\"===n){if(\"throw\"===a)throw i;return C()}for(r.method=a,r.arg=i;;){var o=r.delegate;if(o){var s=w(o,r);if(s){if(s===d)continue;return s}}if(\"next\"===r.method)r.sent=r._sent=r.arg;else if(\"throw\"===r.method){if(\"suspendedStart\"===n)throw n=\"completed\",r.arg;r.dispatchException(r.arg)}else\"return\"===r.method&&r.abrupt(\"return\",r.arg);n=\"executing\";var c=v(e,t,r);if(\"normal\"===c.type){if(n=r.done?\"completed\":\"suspendedYield\",c.arg===d)continue;return{value:c.arg,done:r.done}}\"throw\"===c.type&&(n=\"completed\",r.method=\"throw\",r.arg=c.arg)}}}(e,r,o),i}function v(e,t,r){try{return{type:\"normal\",arg:e.call(t,r)}}catch(e){return{type:\"throw\",arg:e}}}function _(){}function g(){}function y(){}function b(e){[\"next\",\"throw\",\"return\"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function k(e){var t;this._invoke=function(r,a){function i(){return new Promise((function(t,i){!function t(r,a,i,o){var s=v(e[r],e,a);if(\"throw\"!==s.type){var c=s.arg,u=c.value;return u&&\"object\"==typeof u&&n.call(u,\"__await\")?Promise.resolve(u.__await).then((function(e){t(\"next\",e,i,o)}),(function(e){t(\"throw\",e,i,o)})):Promise.resolve(u).then((function(e){c.value=e,i(c)}),o)}o(s.arg)}(r,a,t,i)}))}return t=t?t.then(i,i):i()}}function w(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,\"throw\"===t.method){if(e.iterator.return&&(t.method=\"return\",t.arg=void 0,w(e,t),\"throw\"===t.method))return d;t.method=\"throw\",t.arg=new TypeError(\"The iterator does not provide a 'throw' method\")}return d}var n=v(r,e.iterator,t.arg);if(\"throw\"===n.type)return t.method=\"throw\",t.arg=n.arg,t.delegate=null,d;var a=n.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,\"return\"!==t.method&&(t.method=\"next\",t.arg=void 0),t.delegate=null,d):a:(t.method=\"throw\",t.arg=new TypeError(\"iterator result is not an object\"),t.delegate=null,d)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type=\"normal\",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:\"root\"}],e.forEach(P,this),this.reset(!0)}function T(e){if(e){var t=e[i];if(t)return t.call(e);if(\"function\"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:C}}function C(){return{value:void 0,done:!0}}}(function(){return this}()||Function(\"return this\")())},function(e,t,r){r(39),r(34),e.exports=r(162)},function(e,t,r){var n=r(25),a=r(76);e.exports=r(7).getIterator=function(e){var t=a(e);if(\"function\"!=typeof t)throw TypeError(e+\" is not iterable!\");return n(t.call(e))}},function(e,t,r){r(58),r(34),r(39),r(164),r(168),r(170),r(171),e.exports=r(7).Map},function(e,t,r){\"use strict\";var n=r(101),a=r(79);e.exports=r(102)(\"Map\",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=n.getEntry(a(this,\"Map\"),e);return t&&t.v},set:function(e,t){return n.def(a(this,\"Map\"),0===e?0:e,t)}},n,!0)},function(e,t,r){var n=r(27),a=r(70),i=r(31),o=r(55),s=r(166);e.exports=function(e,t){var r=1==e,c=2==e,u=3==e,d=4==e,l=6==e,p=5==e||l,f=t||s;return function(t,s,m){for(var h,v,_=i(t),g=a(_),y=n(s,m,3),b=o(g.length),k=0,w=r?f(t,b):c?f(t,0):void 0;b>k;k++)if((p||k in g)&&(v=y(h=g[k],k,_),e))if(r)w[k]=v;else if(v)switch(e){case 3:return!0;case 5:return h;case 6:return k;case 2:w.push(h)}else if(d)return!1;return l?-1:u||d?d:w}}},function(e,t,r){var n=r(167);e.exports=function(e,t){return new(n(e))(t)}},function(e,t,r){var n=r(18),a=r(88),i=r(14)(\"species\");e.exports=function(e){var t;return a(e)&&(\"function\"!=typeof(t=e.constructor)||t!==Array&&!a(t.prototype)||(t=void 0),n(t)&&null===(t=t[i])&&(t=void 0)),void 0===t?Array:t}},function(e,t,r){var n=r(11);n(n.P+n.R,\"Map\",{toJSON:r(103)(\"Map\")})},function(e,t,r){var n=r(50);e.exports=function(e,t){var r=[];return n(e,!1,r.push,r,t),r}},function(e,t,r){r(104)(\"Map\")},function(e,t,r){r(105)(\"Map\")},function(e,t){var r,n,a=e.exports={};function i(){throw new Error(\"setTimeout has not been defined\")}function o(){throw new Error(\"clearTimeout has not been defined\")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r=\"function\"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{n=\"function\"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var c,u=[],d=!1,l=-1;function p(){d&&c&&(d=!1,c.length?u=c.concat(u):l=-1,u.length&&f())}function f(){if(!d){var e=s(p);d=!0;for(var t=u.length;t;){for(c=u,u=[];++l<t;)c&&c[l].run();l=-1,t=u.length}c=null,d=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function h(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new m(e,t)),1!==u.length||d||s(f)},m.prototype.run=function(){this.fun.apply(null,this.array)},a.title=\"browser\",a.browser=!0,a.env={},a.argv=[],a.version=\"\",a.versions={},a.on=h,a.addListener=h,a.once=h,a.off=h,a.removeListener=h,a.removeAllListeners=h,a.emit=h,a.prependListener=h,a.prependOnceListener=h,a.listeners=function(e){return[]},a.binding=function(e){throw new Error(\"process.binding is not supported\")},a.cwd=function(){return\"/\"},a.chdir=function(e){throw new Error(\"process.chdir is not supported\")},a.umask=function(){return 0}},function(e,t,r){e.exports=function(e){function t(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return n.colors[Math.abs(t)%n.colors.length]}function n(e){let r;function o(...e){if(!o.enabled)return;const t=o,a=Number(new Date),i=a-(r||a);t.diff=i,t.prev=r,t.curr=a,r=a,e[0]=n.coerce(e[0]),\"string\"!=typeof e[0]&&e.unshift(\"%O\");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(r,a)=>{if(\"%%\"===r)return r;s++;const i=n.formatters[a];if(\"function\"==typeof i){const n=e[s];r=i.call(t,n),e.splice(s,1),s--}return r}),n.formatArgs.call(t,e),(t.log||n.log).apply(t,e)}return o.namespace=e,o.enabled=n.enabled(e),o.useColors=n.useColors(),o.color=t(e),o.destroy=a,o.extend=i,\"function\"==typeof n.init&&n.init(o),n.instances.push(o),o}function a(){const e=n.instances.indexOf(this);return-1!==e&&(n.instances.splice(e,1),!0)}function i(e,t){const r=n(this.namespace+(void 0===t?\":\":t)+e);return r.log=this.log,r}function o(e){return e.toString().substring(2,e.toString().length-2).replace(/\\.\\*\\?$/,\"*\")}return n.debug=n,n.default=n,n.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},n.disable=function(){const e=[...n.names.map(o),...n.skips.map(o).map(e=>\"-\"+e)].join(\",\");return n.enable(\"\"),e},n.enable=function(e){let t;n.save(e),n.names=[],n.skips=[];const r=(\"string\"==typeof e?e:\"\").split(/[\\s,]+/),a=r.length;for(t=0;t<a;t++)r[t]&&(\"-\"===(e=r[t].replace(/\\*/g,\".*?\"))[0]?n.skips.push(new RegExp(\"^\"+e.substr(1)+\"$\")):n.names.push(new RegExp(\"^\"+e+\"$\")));for(t=0;t<n.instances.length;t++){const e=n.instances[t];e.enabled=n.enabled(e.namespace)}},n.enabled=function(e){if(\"*\"===e[e.length-1])return!0;let t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=r(174),Object.keys(e).forEach(t=>{n[t]=e[t]}),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=t,n.enable(n.load()),n}},function(e,t){var r=1e3,n=6e4,a=36e5,i=24*a;function o(e,t,r,n){var a=t>=1.5*r;return Math.round(e/r)+\" \"+n+(a?\"s\":\"\")}e.exports=function(e,t){t=t||{};var s=typeof e;if(\"string\"===s&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var o=parseFloat(t[1]);switch((t[2]||\"ms\").toLowerCase()){case\"years\":case\"year\":case\"yrs\":case\"yr\":case\"y\":return 315576e5*o;case\"weeks\":case\"week\":case\"w\":return 6048e5*o;case\"days\":case\"day\":case\"d\":return o*i;case\"hours\":case\"hour\":case\"hrs\":case\"hr\":case\"h\":return o*a;case\"minutes\":case\"minute\":case\"mins\":case\"min\":case\"m\":return o*n;case\"seconds\":case\"second\":case\"secs\":case\"sec\":case\"s\":return o*r;case\"milliseconds\":case\"millisecond\":case\"msecs\":case\"msec\":case\"ms\":return o;default:return}}(e);if(\"number\"===s&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=i)return o(e,t,i,\"day\");if(t>=a)return o(e,t,a,\"hour\");if(t>=n)return o(e,t,n,\"minute\");if(t>=r)return o(e,t,r,\"second\");return e+\" ms\"}(e):function(e){var t=Math.abs(e);if(t>=i)return Math.round(e/i)+\"d\";if(t>=a)return Math.round(e/a)+\"h\";if(t>=n)return Math.round(e/n)+\"m\";if(t>=r)return Math.round(e/r)+\"s\";return e+\"ms\"}(e);throw new Error(\"val is not a non-empty string or a valid number. val=\"+JSON.stringify(e))}},function(e,t,r){var n=r(176);t.operation=function(e){var r=t.timeouts(e);return new n(r,{forever:e&&e.forever,unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error(\"minTimeout is greater than maxTimeout\");for(var n=[],a=0;a<t.retries;a++)n.push(this.createTimeout(a,t));return e&&e.forever&&!n.length&&n.push(this.createTimeout(a,t)),n.sort((function(e,t){return e-t})),n},t.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,n=Math.round(r*t.minTimeout*Math.pow(t.factor,e));return n=Math.min(n,t.maxTimeout)},t.wrap=function(e,r,n){if(r instanceof Array&&(n=r,r=null),!n)for(var a in n=[],e)\"function\"==typeof e[a]&&n.push(a);for(var i=0;i<n.length;i++){var o=n[i],s=e[o];e[o]=function(n){var a=t.operation(r),i=Array.prototype.slice.call(arguments,1),o=i.pop();i.push((function(e){a.retry(e)||(e&&(arguments[0]=a.mainError()),o.apply(this,arguments))})),a.attempt((function(){n.apply(e,i)}))}.bind(e,s),e[o].options=r}}},function(e,t){function r(e,t){\"boolean\"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=r,r.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},r.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},r.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error(\"RetryOperation timeout occurred\")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),r=this._timeouts.shift()}var n=this,a=setTimeout((function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout((function(){n._operationTimeoutCb(n._attempts)}),n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)}),r);return this._options.unref&&a.unref(),!0},r.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},r.prototype.try=function(e){console.log(\"Using RetryOperation.try() is deprecated\"),this.attempt(e)},r.prototype.start=function(e){console.log(\"Using RetryOperation.start() is deprecated\"),this.attempt(e)},r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,n=0;n<this._errors.length;n++){var a=this._errors[n],i=a.message,o=(e[i]||0)+1;e[i]=o,o>=r&&(t=a,r=o)}return t}},function(e,t){e.exports=function(){throw new Error(\"define cannot be used indirect\")}},function(e,t,r){var n,a=r(179);\"undefined\"!=typeof window&&(n=window.AudioContext||window.webkitAudioContext);var i=null;e.exports=function(e,t){var r=new a;if(!n)return r;var o,s,c,u=(t=t||{}).smoothing||.1,d=t.interval||50,l=t.threshold,p=t.play,f=t.history||10,m=!0;i=t.audioContext||i||new n,(c=i.createAnalyser()).fftSize=512,c.smoothingTimeConstant=u,s=new Float32Array(c.frequencyBinCount),e.jquery&&(e=e[0]),e instanceof HTMLAudioElement||e instanceof HTMLVideoElement?(o=i.createMediaElementSource(e),void 0===p&&(p=!0),l=l||-50):(o=i.createMediaStreamSource(e),l=l||-50),o.connect(c),p&&c.connect(i.destination),r.speaking=!1,r.suspend=function(){return i.suspend()},r.resume=function(){return i.resume()},Object.defineProperty(r,\"state\",{get:function(){return i.state}}),i.onstatechange=function(){r.emit(\"state_change\",i.state)},r.setThreshold=function(e){l=e},r.setInterval=function(e){d=e},r.stop=function(){m=!1,r.emit(\"volume_change\",-100,l),r.speaking&&(r.speaking=!1,r.emit(\"stopped_speaking\")),c.disconnect(),o.disconnect()},r.speakingHistory=[];for(var h=0;h<f;h++)r.speakingHistory.push(0);var v=function(){setTimeout((function(){if(m){var e=function(e,t){var r=-1/0;e.getFloatFrequencyData(t);for(var n=4,a=t.length;n<a;n++)t[n]>r&&t[n]<0&&(r=t[n]);return r}(c,s);r.emit(\"volume_change\",e,l);var t=0;if(e>l&&!r.speaking){for(var n=r.speakingHistory.length-3;n<r.speakingHistory.length;n++)t+=r.speakingHistory[n];t>=2&&(r.speaking=!0,r.emit(\"speaking\"))}else if(e<l&&r.speaking){for(n=0;n<r.speakingHistory.length;n++)t+=r.speakingHistory[n];0==t&&(r.speaking=!1,r.emit(\"stopped_speaking\"))}r.speakingHistory.shift(),r.speakingHistory.push(0+(e>l)),v()}}),d)};return v(),r}},function(e,t){function r(){}e.exports=r,r.mixin=function(e){var t=e.prototype||e;t.isWildEmitter=!0,t.on=function(e,t,r){this.callbacks=this.callbacks||{};var n=3===arguments.length,a=n?arguments[1]:void 0,i=n?arguments[2]:arguments[1];return i._groupName=a,(this.callbacks[e]=this.callbacks[e]||[]).push(i),this},t.once=function(e,t,r){var n=this,a=3===arguments.length,i=a?arguments[1]:void 0,o=a?arguments[2]:arguments[1];function s(){n.off(e,s),o.apply(this,arguments)}return this.on(e,i,s),this},t.releaseGroup=function(e){var t,r,n,a;for(t in this.callbacks=this.callbacks||{},this.callbacks)for(r=0,n=(a=this.callbacks[t]).length;r<n;r++)a[r]._groupName===e&&(a.splice(r,1),r--,n--);return this},t.off=function(e,t){this.callbacks=this.callbacks||{};var r,n=this.callbacks[e];return n?1===arguments.length?(delete this.callbacks[e],this):(-1!==(r=n.indexOf(t))&&(n.splice(r,1),0===n.length&&delete this.callbacks[e]),this):this},t.emit=function(e){this.callbacks=this.callbacks||{};var t,r,n,a=[].slice.call(arguments,1),i=this.callbacks[e],o=this.getWildcardCallbacks(e);if(i)for(t=0,r=(n=i.slice()).length;t<r&&n[t];++t)n[t].apply(this,a);if(o)for(r=o.length,t=0,r=(n=o.slice()).length;t<r&&n[t];++t)n[t].apply(this,[e].concat(a));return this},t.getWildcardCallbacks=function(e){this.callbacks=this.callbacks||{};var t,r,n=[];for(t in this.callbacks)r=t.split(\"*\"),(\"*\"===t||2===r.length&&e.slice(0,r[0].length)===r[0])&&(n=n.concat(this.callbacks[t]));return n}},r.mixin(r)},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=w(r(16)),a=w(r(8)),i=w(r(6)),o=w(r(19)),s=w(r(2)),c=w(r(0)),u=w(r(1)),d=w(r(3)),l=w(r(4)),p=w(r(12)),f=w(r(5)),m=w(r(10)),h=k(r(9)),v=k(r(15)),_=k(r(20)),g=k(r(35)),y=w(r(36)),b=w(r(23));function k(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function w(e){return e&&e.__esModule?e:{default:e}}var P=new f.default(\"Chrome70\"),S=function(e){function t(e,r,n){(0,c.default)(this,t);var a=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,P));return a._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\",sdpSemantics:\"unified-plan\"}),a._rtpParametersByKind=r,a._remoteSdp=new y.default(e,r),a._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(a._pc.iceConnectionState){case\"checking\":a.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":a.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":a.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":a.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":a.emit(\"@connectionstatechange\",\"closed\")}})),a}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"close\",value:function(){P.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){P.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(m.default),I=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"send\",e,r));return n._transportReady=!1,n._trackIds=new o.default,n}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"addProducer\",value:function(e){var t=this,r=e.track;if(P.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),this._trackIds.has(r.id))return i.default.reject(new Error(\"track already added\"));var n=\"isac\";e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(P.debug(\"addProducer() [id:%s, kind:%s, trackId:%s] producer.audioProfile: %o\",e.id,e.kind,r.id,e.audioProfile),n=e.audioProfile.codec.toLowerCase());var a=void 0,o=void 0;return this._trackIds.add(r.id),i.default.resolve().then((function(){if(a=t._pc.getTransceivers().find((function(e){return e.receiver.track.kind===r.kind&&\"inactive\"===e.direction})))return P.debug(\"addProducer() | reusing an inactive transceiver\"),a.direction=\"sendonly\",a.sender.replaceTrack(r);a=t._pc.addTransceiver(r,{direction:\"sendonly\"})})).then((function(){return t._pc.createOffer()})).then((function(i){if(i.sdp=b.default.setVideoBitrates(i.sdp,e.videoBitrateOptions),i.sdp=b.default.setOpusAttributes(i.sdp,e.audioProfile),i.sdp=b.default.setSpecialAudioCodec(i.sdp,n),e.simulcast){P.debug(\"addProducer() | enabling simulcast\");var o=p.default.parse(i.sdp);g.addPlanBSimulcast(o,r,{mid:a.mid}),i={type:\"offer\",sdp:p.default.write(o)}}return P.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",i),t._pc.setLocalDescription(i)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){o=p.default.parse(t._pc.localDescription.sdp),P.debug(\"addProducer() | this._pc.localDescription.sdp: \",o,\" - producer.videoBitrateOptions: \",e.videoBitrateOptions);var r=t._remoteSdp.createAnswerSdp(o);r=b.default.setVideoBitrates(r,e.videoBitrateOptions),r=b.default.setOpusAttributes(r,e.audioProfile);var a={type:\"answer\",sdp:r=b.default.setSpecialAudioCodec(r,n)};return P.debug(\"addProducer() | calling pc.setRemoteDescription() remoteSdp: \",r),t._pc.setRemoteDescription(a)})).then((function(){var i=h.clone(t._rtpParametersByKind[e.kind]);return i&&i.codecs&&(i.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+n&&i.codecs.splice(t,1)})),P.debug(\"addProducer() _rtpParametersByKind: %o - rtpParameters: %o\",t._rtpParametersByKind[e.kind],i)),g.fillRtpParametersForTrack(i,o,r,{mid:a.mid,planBSimulcast:!0}),i})).catch((function(e){try{a.direction=\"inactive\"}catch(e){}throw t._trackIds.delete(r.id),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;if(!this._trackIds.has(r.id))return i.default.reject(new Error(\"track not found\"));var n=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase()),P.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),i.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error(\"local track not found\");return t._pc.removeTrack(e),t._trackIds.delete(r.id),t._pc.createOffer()})).then((function(r){return r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,n),P.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).then((function(){var r=p.default.parse(t._pc.localDescription.sdp),a=t._remoteSdp.createAnswerSdp(r);a=b.default.setVideoBitrates(a,e.videoBitrateOptions),a=b.default.setOpusAttributes(a,e.audioProfile);var i={type:\"answer\",sdp:a=b.default.setSpecialAudioCodec(a,n)};return P.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",i),t._pc.setRemoteDescription(i)}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;P.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=e.track;return i.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error(\"local track not found\");return e.replaceTrack(t)})).then((function(){r._trackIds.delete(n.id),r._trackIds.add(t.id)}))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),i.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=p.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),i.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=p.default.parse(r),a=_.extractDtlsParameters(n);return a.role=\"server\",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}},{key:\"updateTrack\",value:function(e,t){var r,n,a=this;P.debug(\"update Track() [trackId:%s]\",t.id);var o=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(o=e.audioProfile.codec.toLowerCase()),i.default.resolve().then((function(){n=a._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return a._pc.createOffer()})).then((function(r){if(r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,o),e.simulcast){P.debug(\"updateTrack() | enabling simulcast\");var i=p.default.parse(r.sdp);g.addPlanBSimulcast(i,t,{mid:n.mid}),r={type:\"offer\",sdp:p.default.write(i)}}return P.debug(\"updateTrack() | calling pc.setLocalDescription() [offer:%o]\",r),a._pc.setLocalDescription(r)})).then((function(){r=p.default.parse(a._pc.localDescription.sdp);var t=a._remoteSdp.createAnswerSdp(r);t=b.default.setVideoBitrates(t,e.videoBitrateOptions),t=b.default.setOpusAttributes(t,e.audioProfile);var n={type:\"answer\",sdp:t=b.default.setSpecialAudioCodec(t,o)};return P.debug(\"updateTrack() | calling pc.setRemoteDescription() [answer:%o]\",n),a._pc.setRemoteDescription(n)})).then((function(){var i=h.clone(a._rtpParametersByKind[e.kind]);return i&&i.codecs&&(i.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+o&&i.codecs.splice(t,1)})),P.debug(\"updateTrack() _rtpParametersByKind: %o - rtpParameters: %o\",a._rtpParametersByKind[e.kind],i)),g.fillRtpParametersForTrack(i,r,t,{mid:n.mid,planBSimulcast:!0}),i})).catch((function(e){throw e}))}}]),t}(S),T=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"recv\",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new a.default,n}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"addConsumer\",value:function(e){var t=this;if(P.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return i.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],a=e.rtpParameters.rtcp.cname,o={mid:\"\"+e.kind[0]+e.id,kind:e.kind,closed:e.closed,streamId:\"recv-stream-\"+e.id,trackId:\"consumer-\"+e.kind+\"-\"+e.id,ssrc:r.ssrc,cname:a};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),i.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var r={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return P.debug(\"addConsumer() | calling pc.setRemoteDescription() kind:%s [offer:%o]\",e.kind,r),t._pc.setRemoteDescription(r)})).then((function(){return t._pc.createAnswer()})).then((function(r){return P.debug(\"addConsumer() | calling pc.setLocalDescription() kind:%s [answer:%o]\",e.kind,r),t._pc.setLocalDescription(r)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getTransceivers().find((function(e){return e.mid===o.mid}));if(!e)throw new Error(\"remote track not found\");return e.receiver.track}))}},{key:\"removeConsumer\",value:function(e){var t=this;P.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,i.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return P.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):i.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),i.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return P.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),i.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){P.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=p.default.parse(e),r={dtlsParameters:_.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(S),C=function(){function e(t,r,n){(0,c.default)(this,e),P.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r);var a=void 0;switch(t){case\"send\":return a={audio:v.getSendingRtpParameters(\"audio\",r),video:v.getSendingRtpParameters(\"video\",r)},new I(a,n);case\"recv\":return a={audio:v.getReceivingFullRtpParameters(\"audio\",r),video:v.getReceivingFullRtpParameters(\"video\",r)},new T(a,n)}}return(0,u.default)(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){P.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\",sdpSemantics:\"unified-plan\"});return e.addTransceiver(\"audio\"),e.addTransceiver(\"video\"),e.createOffer().then((function(t){try{e.close()}catch(e){}var r=p.default.parse(t.sdp);return _.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:\"tag\",get:function(){return\"Chrome70\"}}]),e}();t.default=C},function(e,t,r){r(34),r(182),e.exports=r(7).Array.from},function(e,t,r){\"use strict\";var n=r(27),a=r(11),i=r(31),o=r(91),s=r(92),c=r(55),u=r(183),d=r(76);a(a.S+a.F*!r(98)((function(e){Array.from(e)})),\"Array\",{from:function(e){var t,r,a,l,p=i(e),f=\"function\"==typeof this?this:Array,m=arguments.length,h=m>1?arguments[1]:void 0,v=void 0!==h,_=0,g=d(p);if(v&&(h=n(h,m>2?arguments[2]:void 0,2)),null==g||f==Array&&s(g))for(r=new f(t=c(p.length));t>_;_++)u(r,_,v?h(p[_],_):p[_]);else for(l=g.call(p),r=new f;!(a=l.next()).done;_++)u(r,_,v?o(l,h,[a.value,_],!0):a.value);return r.length=_,r}})},function(e,t,r){\"use strict\";var n=r(21),a=r(46);e.exports=function(e,t,r){t in e?n.f(e,t,a(0,r)):e[t]=r}},function(e,t,r){r(58),r(34),r(39),r(185),r(186),r(187),r(188),e.exports=r(7).Set},function(e,t,r){\"use strict\";var n=r(101),a=r(79);e.exports=r(102)(\"Set\",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return n.def(a(this,\"Set\"),e=0===e?0:e,e)}},n)},function(e,t,r){var n=r(11);n(n.P+n.R,\"Set\",{toJSON:r(103)(\"Set\")})},function(e,t,r){r(104)(\"Set\")},function(e,t,r){r(105)(\"Set\")},function(e,t,r){\"use strict\";var n=function(e){return String(Number(e))===e?Number(e):e},a=function(e,t,r){var a=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:a&&!t[e.name]&&(t[e.name]={});var i=e.push?{}:a?t[e.name]:t;!function(e,t,r,a){if(a&&!r)t[a]=n(e[1]);else for(var i=0;i<r.length;i+=1)null!=e[i+1]&&(t[r[i]]=n(e[i+1]))}(r.match(e.reg),i,e.names,e.name),e.push&&t[e.push].push(i)},i=r(112),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],n=t;return e.split(/(\\r\\n|\\r|\\n)/).filter(o).forEach((function(e){var t=e[0],o=e.slice(2);\"m\"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var s=0;s<(i[t]||[]).length;s+=1){var c=i[t][s];if(c.reg.test(o))return a(c,n,o)}})),t.media=r,t};var s=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=n(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};t.parseParams=function(e){return e.split(/\\;\\s?/).reduce(s,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.split(\" \").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(\" \").map(n),a=0;a<r.length;a+=3)t.push({component:r[a],ip:r[a+1],port:r[a+2]});return t},t.parseImageAttributes=function(e){return e.split(\" \").map((function(e){return e.substring(1,e.length-1).split(\",\").reduce(s,{})}))},t.parseSimulcastStreamList=function(e){return e.split(\";\").map((function(e){return e.split(\",\").map((function(e){var t,r=!1;return\"~\"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}}))}))}},function(e,t,r){\"use strict\";var n=r(112),a=/%[sdv%]/g,i=function(e){var t=1,r=arguments,n=r.length;return e.replace(a,(function(e){if(t>=n)return e;var a=r[t];switch(t+=1,e){case\"%%\":return\"%\";case\"%s\":return String(a);case\"%d\":return Number(a);case\"%v\":return\"\"}}))},o=function(e,t,r){var n=[e+\"=\"+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var a=0;a<t.names.length;a+=1){var o=t.names[a];t.name?n.push(r[t.name][o]):n.push(r[t.names[a]])}else n.push(r[t.name]);return i.apply(null,n)},s=[\"v\",\"o\",\"s\",\"i\",\"u\",\"e\",\"p\",\"c\",\"b\",\"t\",\"r\",\"z\",\"a\"],c=[\"i\",\"c\",\"b\",\"a\"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=\" \"),e.media.forEach((function(e){null==e.payloads&&(e.payloads=\"\")}));var r=t.outerOrder||s,a=t.innerOrder||c,i=[];return r.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(o(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(o(t,r,e))}))}))})),e.media.forEach((function(e){i.push(o(\"m\",n.m[0],e)),a.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(o(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(o(t,r,e))}))}))}))})),i.join(\"\\r\\n\")+\"\\r\\n\"}},function(e,t,r){e.exports={default:r(192),__esModule:!0}},function(e,t,r){r(39),r(34),e.exports=r(193)},function(e,t,r){var n=r(59),a=r(14)(\"iterator\"),i=r(37);e.exports=r(7).isIterable=function(e){var t=Object(e);return void 0!==t[a]||\"@@iterator\"in t||i.hasOwnProperty(n(t))}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=w(r(16)),a=w(r(8)),i=w(r(19)),o=w(r(6)),s=w(r(2)),c=w(r(0)),u=w(r(1)),d=w(r(3)),l=w(r(4)),p=w(r(12)),f=w(r(5)),m=w(r(10)),h=k(r(9)),v=k(r(15)),_=k(r(20)),g=k(r(41)),y=w(r(42)),b=w(r(23));function k(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function w(e){return e&&e.__esModule?e:{default:e}}var P=new f.default(\"Chrome69\"),S=function(e){function t(e,r,n){(0,c.default)(this,t);var a=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,P));return a._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\",sdpSemantics:\"plan-b\"}),a._rtpParametersByKind=r,a._remoteSdp=new y.default(e,r),a._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(a._pc.iceConnectionState){case\"checking\":a.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":a.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":a.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":a.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":a.emit(\"@connectionstatechange\",\"closed\")}})),a}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"close\",value:function(){P.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){P.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(m.default),I=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"send\",e,r));return n._transportReady=!1,n._stream=new MediaStream,n}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"addProducer\",value:function(e){var t=this,r=e.track;if(P.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return o.default.reject(new Error(\"track already added\"));var n=\"isac\";e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase());var a=void 0,i=void 0;return o.default.resolve().then((function(){return t._stream.addTrack(r),a=t._pc.addTrack(r,t._stream),t._pc.createOffer()})).then((function(a){if(a.sdp=b.default.setVideoBitrates(a.sdp,e.videoBitrateOptions),a.sdp=b.default.setOpusAttributes(a.sdp,e.audioProfile),a.sdp=b.default.setSpecialAudioCodec(a.sdp,n),e.simulcast){P.debug(\"addProducer() | enabling simulcast\");var i=p.default.parse(a.sdp);g.addSimulcastForTrack(i,r),a={type:\"offer\",sdp:p.default.write(i)}}return P.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",a),t._pc.setLocalDescription(a)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){i=p.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(i);r=b.default.setVideoBitrates(r,e.videoBitrateOptions),r=b.default.setOpusAttributes(r,e.audioProfile);var a={type:\"answer\",sdp:r=b.default.setSpecialAudioCodec(r,n)};return P.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",a),t._pc.setRemoteDescription(a)})).then((function(){var a=h.clone(t._rtpParametersByKind[e.kind]);return a&&a.codecs&&(a.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+n&&a.codecs.splice(t,1)})),P.debug(\"addProducer() _rtpParametersByKind: %o - rtpParameters: %o\",t._rtpParametersByKind[e.kind],a)),g.fillRtpParametersForTrack(a,i,r),a})).catch((function(e){try{t._pc.removeTrack(a)}catch(e){}throw t._stream.removeTrack(r),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track,n=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase()),P.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),o.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error(\"RTCRtpSender not found\");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()})).then((function(r){return r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,n),P.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).catch((function(e){if(0!==t._stream.getTracks().length)throw e;P.warn(\"removeProducer() | ignoring expected error due no sending tracks: %s\",e.toString())})).then((function(){if(\"stable\"!==t._pc.signalingState){var r=p.default.parse(t._pc.localDescription.sdp),a=t._remoteSdp.createAnswerSdp(r);a=b.default.setVideoBitrates(a,e.videoBitrateOptions),a=b.default.setOpusAttributes(a,e.audioProfile);var i={type:\"answer\",sdp:a=b.default.setSpecialAudioCodec(a,n)};return P.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",i),t._pc.setRemoteDescription(i)}}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;P.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=e.track;return o.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error(\"local track not found\");return e.replaceTrack(t)})).then((function(){r._stream.removeTrack(n),r._stream.addTrack(t)}))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=p.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),o.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=p.default.parse(r),a=_.extractDtlsParameters(n);return a.role=\"server\",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}},{key:\"updateTrack\",value:function(e,t){var r,n=this;P.debug(\"update Track() [trackId:%s]\",t.id);var a=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(a=e.audioProfile.codec.toLowerCase()),o.default.resolve().then((function(){n._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return n._pc.createOffer()})).then((function(r){if(r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,a),e.simulcast){P.debug(\"updateTrack() | enabling simulcast\");var i=p.default.parse(r.sdp);g.addSimulcastForTrack(i,t),r={type:\"offer\",sdp:p.default.write(i)}}return P.debug(\"updateTrack() | calling pc.setLocalDescription() [offer:%o]\",r),n._pc.setLocalDescription(r)})).then((function(){r=p.default.parse(n._pc.localDescription.sdp);var t=n._remoteSdp.createAnswerSdp(r);t=b.default.setVideoBitrates(t,e.videoBitrateOptions),t=b.default.setOpusAttributes(t,e.audioProfile);var i={type:\"answer\",sdp:t=b.default.setSpecialAudioCodec(t,a)};return P.debug(\"updateTrack() | calling pc.setRemoteDescription() [answer:%o]\",i),n._pc.setRemoteDescription(i)})).then((function(){var i=h.clone(n._rtpParametersByKind[e.kind]);return i&&i.codecs&&(i.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+a&&i.codecs.splice(t,1)})),P.debug(\"updateTrack() _rtpParametersByKind: %o - rtpParameters: %o\",n._rtpParametersByKind[e.kind],i)),g.fillRtpParametersForTrack(i,r,t),i})).catch((function(e){throw e}))}}]),t}(S),T=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"recv\",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._kinds=new i.default,n._consumerInfos=new a.default,n}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"addConsumer\",value:function(e){var t=this;if(P.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return o.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],a=e.rtpParameters.rtcp.cname,i={kind:e.kind,streamId:\"recv-stream-\"+e.id,trackId:\"consumer-\"+e.kind+\"-\"+e.id,ssrc:r.ssrc,cname:a};return r.rtx&&r.rtx.ssrc&&(i.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,i),this._kinds.add(e.kind),o.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getReceivers().find((function(e){var t=e.track;return!!t&&t.id===i.trackId}));if(!e)throw new Error(\"remote track not found\");return e.track}))}},{key:\"removeConsumer\",value:function(e){var t=this;return P.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),o.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):o.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),o.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){P.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=p.default.parse(e),r={dtlsParameters:_.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(S),C=function(){function e(t,r,n){(0,c.default)(this,e),P.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r);var a=void 0;switch(t){case\"send\":return a={audio:v.getSendingRtpParameters(\"audio\",r),video:v.getSendingRtpParameters(\"video\",r)},new I(a,n);case\"recv\":return a={audio:v.getReceivingFullRtpParameters(\"audio\",r),video:v.getReceivingFullRtpParameters(\"video\",r)},new T(a,n)}}return(0,u.default)(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){P.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\",sdpSemantics:\"plan-b\"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(t){try{e.close()}catch(e){}var r=p.default.parse(t.sdp);return _.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:\"tag\",get:function(){return\"Chrome69\"}}]),e}();t.default=C},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=w(r(16)),a=w(r(8)),i=w(r(19)),o=w(r(6)),s=w(r(2)),c=w(r(0)),u=w(r(1)),d=w(r(3)),l=w(r(4)),p=w(r(12)),f=w(r(5)),m=w(r(10)),h=k(r(9)),v=k(r(15)),_=k(r(20)),g=k(r(41)),y=w(r(42)),b=w(r(23));function k(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function w(e){return e&&e.__esModule?e:{default:e}}var P=new f.default(\"Chrome67\"),S=function(e){function t(e,r,n){(0,c.default)(this,t);var a=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,P));return a._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\",sdpSemantics:\"plan-b\"}),a._rtpParametersByKind=r,a._remoteSdp=new y.default(e,r),a._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(a._pc.iceConnectionState){case\"checking\":a.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":a.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":a.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":a.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":a.emit(\"@connectionstatechange\",\"closed\")}})),a}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"close\",value:function(){P.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){P.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(m.default),I=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"send\",e,r));return n._transportReady=!1,n._stream=new MediaStream,n}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"addProducer\",value:function(e){var t=this,r=e.track;if(P.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return o.default.reject(new Error(\"track already added\"));var n=\"isac\";e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase());var a=void 0;return o.default.resolve().then((function(){return t._stream.addTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()})).then((function(a){if(a.sdp=b.default.setVideoBitrates(a.sdp,e.videoBitrateOptions),a.sdp=b.default.setOpusAttributes(a.sdp,e.audioProfile),a.sdp=b.default.setSpecialAudioCodec(a.sdp,n),e.simulcast){P.debug(\"addProducer() | enabling simulcast\");var i=p.default.parse(a.sdp);g.addSimulcastForTrack(i,r),a={type:\"offer\",sdp:p.default.write(i)}}return P.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",a),t._pc.setLocalDescription(a)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){a=p.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(a);r=b.default.setVideoBitrates(r,e.videoBitrateOptions),r=b.default.setOpusAttributes(r,e.audioProfile);var i={type:\"answer\",sdp:r=b.default.setSpecialAudioCodec(r,n)};return P.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",i),t._pc.setRemoteDescription(i)})).then((function(){var i=h.clone(t._rtpParametersByKind[e.kind]);return i&&i.codecs&&(i.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+n&&i.codecs.splice(t,1)})),P.debug(\"addProducer() _rtpParametersByKind: %o - rtpParameters: %o\",t._rtpParametersByKind[e.kind],i)),g.fillRtpParametersForTrack(i,a,r),i})).catch((function(e){throw t._stream.removeTrack(r),t._pc.addStream(t._stream),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;P.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id);var n=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase()),o.default.resolve().then((function(){return t._stream.removeTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()})).then((function(r){return r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,n),P.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).catch((function(e){if(0!==t._stream.getTracks().length)throw e;P.warn(\"removeProducer() | ignoring expected error due no sending tracks: %s\",e.toString())})).then((function(){if(\"stable\"!==t._pc.signalingState){var r=p.default.parse(t._pc.localDescription.sdp),a=t._remoteSdp.createAnswerSdp(r);a=b.default.setVideoBitrates(a,e.videoBitrateOptions),a=b.default.setOpusAttributes(a,e.audioProfile);var i={type:\"answer\",sdp:a=b.default.setSpecialAudioCodec(a,n)};return P.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",i),t._pc.setRemoteDescription(i)}}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;P.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=e.track;return o.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error(\"local track not found\");return e.replaceTrack(t)})).then((function(){r._stream.removeTrack(n),r._stream.addTrack(t)}))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=p.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),o.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=p.default.parse(r),a=_.extractDtlsParameters(n);return a.role=\"server\",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}},{key:\"updateTrack\",value:function(e,t){var r,n=this;P.debug(\"update Track() [trackId:%s]\",t.id);var a=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(a=e.audioProfile.codec.toLowerCase()),o.default.resolve().then((function(){n._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return n._pc.createOffer()})).then((function(r){if(r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,a),e.simulcast){P.debug(\"updateTrack() | enabling simulcast\");var i=p.default.parse(r.sdp);g.addSimulcastForTrack(i,t),r={type:\"offer\",sdp:p.default.write(i)}}return P.debug(\"updateTrack() | calling pc.setLocalDescription() [offer:%o]\",r),n._pc.setLocalDescription(r)})).then((function(){r=p.default.parse(n._pc.localDescription.sdp);var t=n._remoteSdp.createAnswerSdp(r);t=b.default.setVideoBitrates(t,e.videoBitrateOptions),t=b.default.setOpusAttributes(t,e.audioProfile);var i={type:\"answer\",sdp:t=b.default.setSpecialAudioCodec(t,a)};return P.debug(\"updateTrack() | calling pc.setRemoteDescription() [answer:%o]\",i),n._pc.setRemoteDescription(i)})).then((function(){var i=h.clone(n._rtpParametersByKind[e.kind]);return i&&i.codecs&&(i.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+a&&i.codecs.splice(t,1)})),P.debug(\"updateTrack() _rtpParametersByKind: %o - rtpParameters: %o\",n._rtpParametersByKind[e.kind],i)),g.fillRtpParametersForTrack(i,r,t),i})).catch((function(e){throw e}))}}]),t}(S),T=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"recv\",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._kinds=new i.default,n._consumerInfos=new a.default,n}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"addConsumer\",value:function(e){var t=this;if(P.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return o.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],a=e.rtpParameters.rtcp.cname,i={kind:e.kind,streamId:\"recv-stream-\"+e.id,trackId:\"consumer-\"+e.kind+\"-\"+e.id,ssrc:r.ssrc,cname:a};return r.rtx&&r.rtx.ssrc&&(i.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,i),this._kinds.add(e.kind),o.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getRemoteStreams().find((function(e){return e.id===i.streamId})).getTrackById(i.trackId);if(!e)throw new Error(\"remote track not found\");return e}))}},{key:\"removeConsumer\",value:function(e){var t=this;return P.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),o.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):o.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),o.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){P.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=p.default.parse(e),r={dtlsParameters:_.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(S),C=function(){function e(t,r,n){(0,c.default)(this,e),P.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r);var a=void 0;switch(t){case\"send\":return a={audio:v.getSendingRtpParameters(\"audio\",r),video:v.getSendingRtpParameters(\"video\",r)},new I(a,n);case\"recv\":return a={audio:v.getReceivingFullRtpParameters(\"audio\",r),video:v.getReceivingFullRtpParameters(\"video\",r)},new T(a,n)}}return(0,u.default)(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){P.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\",sdpSemantics:\"plan-b\"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(t){try{e.close()}catch(e){}var r=p.default.parse(t.sdp);return _.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:\"tag\",get:function(){return\"Chrome67\"}}]),e}();t.default=C},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=w(r(16)),a=w(r(8)),i=w(r(19)),o=w(r(6)),s=w(r(2)),c=w(r(0)),u=w(r(1)),d=w(r(3)),l=w(r(4)),p=w(r(12)),f=w(r(5)),m=w(r(10)),h=k(r(9)),v=k(r(15)),_=k(r(20)),g=k(r(41)),y=w(r(42)),b=w(r(23));function k(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function w(e){return e&&e.__esModule?e:{default:e}}var P=new f.default(\"Chrome55\"),S=function(e){function t(e,r,n){(0,c.default)(this,t);var a=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,P));return a._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"}),a._rtpParametersByKind=r,a._remoteSdp=new y.default(e,r),a._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(a._pc.iceConnectionState){case\"checking\":a.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":a.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":a.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":a.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":a.emit(\"@connectionstatechange\",\"closed\")}})),a}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"close\",value:function(){P.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){P.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(m.default),I=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"send\",e,r));return n._transportReady=!1,n._stream=new MediaStream,n}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"addProducer\",value:function(e){var t=this,r=e.track;if(P.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return o.default.reject(new Error(\"track already added\"));var n=\"isac\";e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase());var a=void 0;return o.default.resolve().then((function(){return t._stream.addTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()})).then((function(a){if(a.sdp=b.default.setVideoBitrates(a.sdp,e.videoBitrateOptions),a.sdp=b.default.setOpusAttributes(a.sdp,e.audioProfile),a.sdp=b.default.setSpecialAudioCodec(a.sdp,n),e.simulcast){P.debug(\"addProducer() | enabling simulcast\");var i=p.default.parse(a.sdp);g.addSimulcastForTrack(i,r),a={type:\"offer\",sdp:p.default.write(i)}}return P.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",a),t._pc.setLocalDescription(a)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){a=p.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(a);r=b.default.setVideoBitrates(r,e.videoBitrateOptions),r=b.default.setOpusAttributes(r,e.audioProfile);var i={type:\"answer\",sdp:r=b.default.setSpecialAudioCodec(r,n)};return P.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",i),t._pc.setRemoteDescription(i)})).then((function(){var i=h.clone(t._rtpParametersByKind[e.kind]);return i&&i.codecs&&(i.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+n&&i.codecs.splice(t,1)})),P.debug(\"addProducer() _rtpParametersByKind: %o - rtpParameters: %o\",t._rtpParametersByKind[e.kind],i)),g.fillRtpParametersForTrack(i,a,r),i})).catch((function(e){throw t._stream.removeTrack(r),t._pc.addStream(t._stream),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;P.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id);var n=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase()),o.default.resolve().then((function(){return t._stream.removeTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()})).then((function(r){return r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,n),P.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).catch((function(e){if(0!==t._stream.getTracks().length)throw e;P.warn(\"removeProducer() | ignoring expected error due no sending tracks: %s\",e.toString())})).then((function(){if(\"stable\"!==t._pc.signalingState){var r=p.default.parse(t._pc.localDescription.sdp),a=t._remoteSdp.createAnswerSdp(r);a=b.default.setVideoBitrates(a,e.videoBitrateOptions),a=b.default.setOpusAttributes(a,e.audioProfile);var i={type:\"answer\",sdp:a=b.default.setSpecialAudioCodec(a,n)};return P.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",i),t._pc.setRemoteDescription(i)}}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;P.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=\"isac\";e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase());var a=e.track,i=void 0;return o.default.resolve().then((function(){return r._stream.removeTrack(a),r._stream.addTrack(t),r._pc.addStream(r._stream),r._pc.createOffer()})).then((function(a){if(a.sdp=b.default.setVideoBitrates(a.sdp,e.videoBitrateOptions),a.sdp=b.default.setOpusAttributes(a.sdp,e.audioProfile),a.sdp=b.default.setSpecialAudioCodec(a.sdp,n),e.simulcast){P.debug(\"addProducer() | enabling simulcast\");var i=p.default.parse(a.sdp);g.addSimulcastForTrack(i,t),a={type:\"offer\",sdp:p.default.write(i)}}return P.debug(\"replaceProducerTrack() | calling pc.setLocalDescription() [offer:%o]\",a),r._pc.setLocalDescription(a)})).then((function(){i=p.default.parse(r._pc.localDescription.sdp);var t=r._remoteSdp.createAnswerSdp(i);t=b.default.setVideoBitrates(t,e.videoBitrateOptions),t=b.default.setOpusAttributes(t,e.audioProfile);var a={type:\"answer\",sdp:t=b.default.setSpecialAudioCodec(t,n)};return P.debug(\"replaceProducerTrack() | calling pc.setRemoteDescription() [answer:%o]\",a),r._pc.setRemoteDescription(a)})).then((function(){var a=h.clone(r._rtpParametersByKind[e.kind]);a&&a.codecs&&(a.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+n&&a.codecs.splice(t,1)})),P.debug(\"replaceProducerTrack() _rtpParametersByKind: %o - rtpParameters: %o\",r._rtpParametersByKind[e.kind],a)),g.fillRtpParametersForTrack(a,i,t),r.safeEmit(\"@needupdateproducer\",e,a)})).catch((function(e){throw r._stream.removeTrack(t),r._stream.addTrack(a),r._pc.addStream(r._stream),e}))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=p.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),o.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=p.default.parse(r),a=_.extractDtlsParameters(n);return a.role=\"server\",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}},{key:\"updateTrack\",value:function(e,t){var r,n=this;P.debug(\"update Track() [trackId:%s]\",t.id);var a=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(a=e.audioProfile.codec.toLowerCase()),o.default.resolve().then((function(){n._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return n._pc.createOffer()})).then((function(r){if(r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,a),e.simulcast){P.debug(\"updateTrack() | enabling simulcast\");var i=p.default.parse(r.sdp);g.addSimulcastForTrack(i,t),r={type:\"offer\",sdp:p.default.write(i)}}return P.debug(\"updateTrack() | calling pc.setLocalDescription() [offer:%o]\",r),n._pc.setLocalDescription(r)})).then((function(){r=p.default.parse(n._pc.localDescription.sdp);var t=n._remoteSdp.createAnswerSdp(r);t=b.default.setVideoBitrates(t,e.videoBitrateOptions),t=b.default.setOpusAttributes(t,e.audioProfile);var i={type:\"answer\",sdp:t=b.default.setSpecialAudioCodec(t,a)};return P.debug(\"updateTrack() | calling pc.setRemoteDescription() [answer:%o]\",i),n._pc.setRemoteDescription(i)})).then((function(){var i=h.clone(n._rtpParametersByKind[e.kind]);return i&&i.codecs&&(i.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+a&&i.codecs.splice(t,1)})),P.debug(\"updateTrack() _rtpParametersByKind: %o - rtpParameters: %o\",n._rtpParametersByKind[e.kind],i)),g.fillRtpParametersForTrack(i,r,t),i})).catch((function(e){throw e}))}}]),t}(S),T=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"recv\",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._kinds=new i.default,n._consumerInfos=new a.default,n}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"addConsumer\",value:function(e){var t=this;if(P.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return o.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],a=e.rtpParameters.rtcp.cname,i={kind:e.kind,streamId:\"recv-stream-\"+e.id,trackId:\"consumer-\"+e.kind+\"-\"+e.id,ssrc:r.ssrc,cname:a};return r.rtx&&r.rtx.ssrc&&(i.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,i),this._kinds.add(e.kind),o.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getRemoteStreams().find((function(e){return e.id===i.streamId})).getTrackById(i.trackId);if(!e)throw new Error(\"remote track not found\");return e}))}},{key:\"removeConsumer\",value:function(e){var t=this;return P.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),o.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):o.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),o.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){P.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=p.default.parse(e),r={dtlsParameters:_.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(S),C=function(){function e(t,r,n){(0,c.default)(this,e),P.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r);var a=void 0;switch(t){case\"send\":return a={audio:v.getSendingRtpParameters(\"audio\",r),video:v.getSendingRtpParameters(\"video\",r)},new I(a,n);case\"recv\":return a={audio:v.getReceivingFullRtpParameters(\"audio\",r),video:v.getReceivingFullRtpParameters(\"video\",r)},new T(a,n)}}return(0,u.default)(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){P.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(t){try{e.close()}catch(e){}var r=p.default.parse(t.sdp);return _.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:\"tag\",get:function(){return\"Chrome55\"}}]),e}();t.default=C},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=w(r(16)),a=w(r(8)),i=w(r(6)),o=w(r(19)),s=w(r(2)),c=w(r(0)),u=w(r(1)),d=w(r(3)),l=w(r(4)),p=w(r(12)),f=w(r(5)),m=w(r(10)),h=k(r(9)),v=k(r(15)),_=k(r(20)),g=k(r(35)),y=w(r(36)),b=w(r(23));function k(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function w(e){return e&&e.__esModule?e:{default:e}}var P=new f.default(\"Safari13\"),S=function(e){function t(e,r,n){(0,c.default)(this,t);var a=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,P));return a._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"}),a._rtpParametersByKind=r,a._remoteSdp=new y.default(e,r),a._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(a._pc.iceConnectionState){case\"checking\":a.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":a.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":a.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":a.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":a.emit(\"@connectionstatechange\",\"closed\")}})),a}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"close\",value:function(){P.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){P.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(m.default),I=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"send\",e,r));return n._transportReady=!1,n._trackIds=new o.default,n}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"addProducer\",value:function(e){var t=this,r=e.track;if(P.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),this._trackIds.has(r.id))return i.default.reject(new Error(\"track already added\"));var n=void 0,a=void 0;return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),this._trackIds.add(r.id),i.default.resolve().then((function(){if(n=t._pc.getTransceivers().find((function(e){return e.receiver.track.kind===r.kind&&\"inactive\"===e.direction})))return P.debug(\"addProducer() | reusing an inactive transceiver\"),n.direction=\"sendonly\",n.sender.replaceTrack(r);n=t._pc.addTransceiver(r,{direction:\"sendonly\"})})).then((function(){return t._pc.createOffer()})).then((function(a){if(a.sdp=b.default.setVideoBitrates(a.sdp,e.videoBitrateOptions),e.simulcast){P.debug(\"addProducer() | enabling simulcast\");var i=p.default.parse(a.sdp);g.addPlanBSimulcast(i,r,{mid:n.mid}),a={type:\"offer\",sdp:p.default.write(i)}}return P.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",a),t._pc.setLocalDescription(a)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){a=p.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(a),n={type:\"answer\",sdp:r=b.default.setVideoBitrates(r,e.videoBitrateOptions)};return P.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",n),t._pc.setRemoteDescription(n)})).then((function(){var i=h.clone(t._rtpParametersByKind[e.kind]);return g.fillRtpParametersForTrack(i,a,r,{mid:n.mid,planBSimulcast:!0}),i})).catch((function(e){try{n.direction=\"inactive\"}catch(e){}throw t._trackIds.delete(r.id),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;if(!this._trackIds.has(r.id))return i.default.reject(new Error(\"track not found\"));P.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id);return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),i.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error(\"local track not found\");return t._pc.removeTrack(e),t._trackIds.delete(r.id),t._pc.createOffer()})).then((function(r){return r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),P.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).then((function(){var r=p.default.parse(t._pc.localDescription.sdp),n=t._remoteSdp.createAnswerSdp(r),a={type:\"answer\",sdp:n=b.default.setVideoBitrates(n,e.videoBitrateOptions)};return P.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",a),t._pc.setRemoteDescription(a)}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;P.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=e.track;return i.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error(\"local track not found\");return e.replaceTrack(t)})).then((function(){r._trackIds.delete(n.id),r._trackIds.add(t.id)}))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),i.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=p.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),i.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=p.default.parse(r),a=_.extractDtlsParameters(n);return a.role=\"server\",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}},{key:\"updateTrack\",value:function(e,t){var r,n,a=this;P.debug(\"update Track() [trackId:%s]\",t.id);return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),i.default.resolve().then((function(){n=a._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return a._pc.createOffer()})).then((function(r){if(r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),e.simulcast){P.debug(\"updateTrack() | enabling simulcast\");var i=p.default.parse(r.sdp);g.addPlanBSimulcast(i,t,{mid:n.mid}),r={type:\"offer\",sdp:p.default.write(i)}}return P.debug(\"updateTrack() | calling pc.setLocalDescription() [offer:%o]\",r),a._pc.setLocalDescription(r)})).then((function(){r=p.default.parse(a._pc.localDescription.sdp);var t=a._remoteSdp.createAnswerSdp(r),n={type:\"answer\",sdp:t=b.default.setVideoBitrates(t,e.videoBitrateOptions)};return P.debug(\"updateTrack() | calling pc.setRemoteDescription() [answer:%o]\",n),a._pc.setRemoteDescription(n)})).then((function(){var i=h.clone(a._rtpParametersByKind[e.kind]);return g.fillRtpParametersForTrack(i,r,t,{mid:n.mid,planBSimulcast:!0}),i})).catch((function(e){throw e}))}}]),t}(S),T=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"recv\",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new a.default,n}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"addConsumer\",value:function(e){var t=this;if(P.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return i.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],a=e.rtpParameters.rtcp.cname,o={mid:\"\"+e.kind[0]+e.id,kind:e.kind,closed:e.closed,streamId:\"recv-stream-\"+e.id,trackId:\"consumer-\"+e.kind+\"-\"+e.id,ssrc:r.ssrc,cname:a};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),i.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return P.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getTransceivers().find((function(e){return e.mid===o.mid}));if(!e)throw new Error(\"remote track not found\");return e.receiver.track}))}},{key:\"removeConsumer\",value:function(e){var t=this;P.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,i.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return P.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):i.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),i.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return P.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),i.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){P.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=p.default.parse(e),r={dtlsParameters:_.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(S),C=function(){function e(t,r,n){(0,c.default)(this,e),P.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r);var a=void 0;switch(t){case\"send\":return a={audio:v.getSendingRtpParameters(\"audio\",r),video:v.getSendingRtpParameters(\"video\",r)},new I(a,n);case\"recv\":return a={audio:v.getReceivingFullRtpParameters(\"audio\",r),video:v.getReceivingFullRtpParameters(\"video\",r)},new T(a,n)}}return(0,u.default)(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){P.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"});return e.addTransceiver(\"audio\"),e.addTransceiver(\"video\"),e.createOffer().then((function(t){try{e.close()}catch(e){}var r=p.default.parse(t.sdp);return _.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:\"tag\",get:function(){return\"Safari13\"}}]),e}();t.default=C},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=w(r(16)),a=w(r(8)),i=w(r(6)),o=w(r(19)),s=w(r(2)),c=w(r(0)),u=w(r(1)),d=w(r(3)),l=w(r(4)),p=w(r(12)),f=w(r(5)),m=w(r(10)),h=k(r(9)),v=k(r(15)),_=k(r(20)),g=k(r(35)),y=w(r(36)),b=w(r(23));function k(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function w(e){return e&&e.__esModule?e:{default:e}}var P=new f.default(\"Safari12\"),S=function(e){function t(e,r,n){(0,c.default)(this,t);var a=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,P));return a._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"}),a._rtpParametersByKind=r,a._remoteSdp=new y.default(e,r),a._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(a._pc.iceConnectionState){case\"checking\":a.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":a.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":a.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":a.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":a.emit(\"@connectionstatechange\",\"closed\")}})),a}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"close\",value:function(){P.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){P.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(m.default),I=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"send\",e,r));return n._transportReady=!1,n._trackIds=new o.default,n}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"addProducer\",value:function(e){var t=this,r=e.track;if(P.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),this._trackIds.has(r.id))return i.default.reject(new Error(\"track already added\"));var n=void 0,a=void 0;return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),this._trackIds.add(r.id),i.default.resolve().then((function(){if(n=t._pc.getTransceivers().find((function(e){return e.receiver.track.kind===r.kind&&\"inactive\"===e.direction})))return P.debug(\"addProducer() | reusing an inactive transceiver\"),n.direction=\"sendonly\",n.sender.replaceTrack(r);n=t._pc.addTransceiver(r,{direction:\"sendonly\"})})).then((function(){return t._pc.createOffer()})).then((function(a){if(a.sdp=b.default.setVideoBitrates(a.sdp,e.videoBitrateOptions),e.simulcast){P.debug(\"addProducer() | enabling simulcast\");var i=p.default.parse(a.sdp);g.addPlanBSimulcast(i,r,{mid:n.mid}),a={type:\"offer\",sdp:p.default.write(i)}}return P.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",a),t._pc.setLocalDescription(a)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){a=p.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(a),n={type:\"answer\",sdp:r=b.default.setVideoBitrates(r,e.videoBitrateOptions)};return P.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",n),t._pc.setRemoteDescription(n)})).then((function(){var i=h.clone(t._rtpParametersByKind[e.kind]);return g.fillRtpParametersForTrack(i,a,r,{mid:n.mid,planBSimulcast:!0}),i})).catch((function(e){try{n.direction=\"inactive\"}catch(e){}throw t._trackIds.delete(r.id),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;if(!this._trackIds.has(r.id))return i.default.reject(new Error(\"track not found\"));P.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id);return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),i.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error(\"local track not found\");return t._pc.removeTrack(e),t._trackIds.delete(r.id),t._pc.createOffer()})).then((function(r){return r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),P.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).then((function(){var r=p.default.parse(t._pc.localDescription.sdp),n=t._remoteSdp.createAnswerSdp(r),a={type:\"answer\",sdp:n=b.default.setVideoBitrates(n,e.videoBitrateOptions)};return P.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",a),t._pc.setRemoteDescription(a)}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;P.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=e.track;return i.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error(\"local track not found\");return e.replaceTrack(t)})).then((function(){r._trackIds.delete(n.id),r._trackIds.add(t.id)}))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),i.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=p.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),i.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=p.default.parse(r),a=_.extractDtlsParameters(n);return a.role=\"server\",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}},{key:\"updateTrack\",value:function(e,t){var r,n,a=this;P.debug(\"update Track() [trackId:%s]\",t.id);return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),i.default.resolve().then((function(){n=a._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return a._pc.createOffer()})).then((function(r){if(r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),e.simulcast){P.debug(\"updateTrack() | enabling simulcast\");var i=p.default.parse(r.sdp);g.addPlanBSimulcast(i,t,{mid:n.mid}),r={type:\"offer\",sdp:p.default.write(i)}}return P.debug(\"updateTrack() | calling pc.setLocalDescription() [offer:%o]\",r),a._pc.setLocalDescription(r)})).then((function(){r=p.default.parse(a._pc.localDescription.sdp);var t=a._remoteSdp.createAnswerSdp(r),n={type:\"answer\",sdp:t=b.default.setVideoBitrates(t,e.videoBitrateOptions)};return P.debug(\"updateTrack() | calling pc.setRemoteDescription() [answer:%o]\",n),a._pc.setRemoteDescription(n)})).then((function(){var i=h.clone(a._rtpParametersByKind[e.kind]);return g.fillRtpParametersForTrack(i,r,t,{mid:n.mid,planBSimulcast:!0}),i})).catch((function(e){throw e}))}}]),t}(S),T=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"recv\",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new a.default,n}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"addConsumer\",value:function(e){var t=this;if(P.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return i.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],a=e.rtpParameters.rtcp.cname,o={mid:\"\"+e.kind[0]+e.id,kind:e.kind,closed:e.closed,streamId:\"recv-stream-\"+e.id,trackId:\"consumer-\"+e.kind+\"-\"+e.id,ssrc:r.ssrc,cname:a};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),i.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return P.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getTransceivers().find((function(e){return e.mid===o.mid}));if(!e)throw new Error(\"remote track not found\");return e.receiver.track}))}},{key:\"removeConsumer\",value:function(e){var t=this;P.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,i.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return P.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):i.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),i.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return P.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),i.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){P.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=p.default.parse(e),r={dtlsParameters:_.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(S),C=function(){function e(t,r,n){(0,c.default)(this,e),P.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r);var a=void 0;switch(t){case\"send\":return a={audio:v.getSendingRtpParameters(\"audio\",r),video:v.getSendingRtpParameters(\"video\",r)},new I(a,n);case\"recv\":return a={audio:v.getReceivingFullRtpParameters(\"audio\",r),video:v.getReceivingFullRtpParameters(\"video\",r)},new T(a,n)}}return(0,u.default)(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){P.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"});return e.addTransceiver(\"audio\"),e.addTransceiver(\"video\"),e.createOffer().then((function(t){try{e.close()}catch(e){}var r=p.default.parse(t.sdp);return _.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:\"tag\",get:function(){return\"Safari12\"}}]),e}();t.default=C},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=w(r(16)),a=w(r(8)),i=w(r(19)),o=w(r(6)),s=w(r(2)),c=w(r(0)),u=w(r(1)),d=w(r(3)),l=w(r(4)),p=w(r(12)),f=w(r(5)),m=w(r(10)),h=k(r(9)),v=k(r(15)),_=k(r(20)),g=k(r(41)),y=w(r(42)),b=w(r(23));function k(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function w(e){return e&&e.__esModule?e:{default:e}}var P=new f.default(\"Safari11\"),S=function(e){function t(e,r,n){(0,c.default)(this,t);var a=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,P));return a._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"}),a._rtpParametersByKind=r,a._remoteSdp=new y.default(e,r),a._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(a._pc.iceConnectionState){case\"checking\":a.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":a.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":a.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":a.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":a.emit(\"@connectionstatechange\",\"closed\")}})),a}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"close\",value:function(){P.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){P.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(m.default),I=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"send\",e,r));return n._transportReady=!1,n._stream=new MediaStream,n}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"addProducer\",value:function(e){var t=this,r=e.track;if(P.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return o.default.reject(new Error(\"track already added\"));var n=void 0,a=void 0;return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),o.default.resolve().then((function(){return t._stream.addTrack(r),n=t._pc.addTrack(r,t._stream),t._pc.createOffer()})).then((function(r){return r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),P.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){a=p.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(a),n={type:\"answer\",sdp:r=b.default.setVideoBitrates(r,e.videoBitrateOptions)};return P.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",n),t._pc.setRemoteDescription(n)})).then((function(){var n=h.clone(t._rtpParametersByKind[e.kind]);return g.fillRtpParametersForTrack(n,a,r),n})).catch((function(e){try{t._pc.removeTrack(n)}catch(e){}throw t._stream.removeTrack(r),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;P.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id);return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),o.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error(\"RTCRtpSender not found\");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()})).then((function(r){return r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),P.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).catch((function(e){if(0!==t._stream.getTracks().length)throw e;P.warn(\"removeProducer() | ignoring expected error due no sending tracks: %s\",e.toString())})).then((function(){if(\"stable\"!==t._pc.signalingState){var r=p.default.parse(t._pc.localDescription.sdp),n=t._remoteSdp.createAnswerSdp(r),a={type:\"answer\",sdp:n=b.default.setVideoBitrates(n,e.videoBitrateOptions)};return P.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",a),t._pc.setRemoteDescription(a)}}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;P.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=e.track;return o.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error(\"local track not found\");return e.replaceTrack(t)})).then((function(){r._stream.removeTrack(n),r._stream.addTrack(t)}))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=p.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),o.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=p.default.parse(r),a=_.extractDtlsParameters(n);return a.role=\"server\",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}},{key:\"updateTrack\",value:function(e,t){var r,n=this;P.debug(\"update Track() [trackId:%s]\",t.id);return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&e.audioProfile.codec.toLowerCase(),o.default.resolve().then((function(){n._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return n._pc.createOffer()})).then((function(r){if(r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),e.simulcast){P.debug(\"updateTrack() | enabling simulcast\");var a=p.default.parse(r.sdp);g.addSimulcastForTrack(a,t),r={type:\"offer\",sdp:p.default.write(a)}}return P.debug(\"updateTrack() | calling pc.setLocalDescription() [offer:%o]\",r),n._pc.setLocalDescription(r)})).then((function(){r=p.default.parse(n._pc.localDescription.sdp);var t=n._remoteSdp.createAnswerSdp(r),a={type:\"answer\",sdp:t=b.default.setVideoBitrates(t,e.videoBitrateOptions)};return P.debug(\"updateTrack() | calling pc.setRemoteDescription() [answer:%o]\",a),n._pc.setRemoteDescription(a)})).then((function(){var a=h.clone(n._rtpParametersByKind[e.kind]);return g.fillRtpParametersForTrack(a,r,t),a})).catch((function(e){throw e}))}}]),t}(S),T=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"recv\",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._kinds=new i.default,n._consumerInfos=new a.default,n}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"addConsumer\",value:function(e){var t=this;if(P.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return o.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],a=e.rtpParameters.rtcp.cname,i={kind:e.kind,streamId:\"recv-stream-\"+e.id,trackId:\"consumer-\"+e.kind+\"-\"+e.id,ssrc:r.ssrc,cname:a};return r.rtx&&r.rtx.ssrc&&(i.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,i),this._kinds.add(e.kind),o.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getReceivers().find((function(e){var t=e.track;return!!t&&t.id===i.trackId}));if(!e)throw new Error(\"remote track not found\");return e.track}))}},{key:\"removeConsumer\",value:function(e){var t=this;return P.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),o.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):o.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return P.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),o.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){P.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=p.default.parse(e),r={dtlsParameters:_.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}},{key:\"getPCStats\",value:function(e){return this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(S),C=function(){function e(t,r,n){(0,c.default)(this,e),P.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r);var a=void 0;switch(t){case\"send\":return a={audio:v.getSendingRtpParameters(\"audio\",r),video:v.getSendingRtpParameters(\"video\",r)},new I(a,n);case\"recv\":return a={audio:v.getReceivingFullRtpParameters(\"audio\",r),video:v.getReceivingFullRtpParameters(\"video\",r)},new T(a,n)}}return(0,u.default)(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){P.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"});return e.addTransceiver(\"audio\"),e.addTransceiver(\"video\"),e.createOffer().then((function(t){try{e.close()}catch(e){}var r=p.default.parse(t.sdp);return _.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:\"tag\",get:function(){return\"Safari11\"}}]),e}();t.default=C},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=P(r(16)),a=P(r(8)),i=P(r(81)),o=P(r(6)),s=P(r(19)),c=P(r(2)),u=P(r(0)),d=P(r(1)),l=P(r(3)),p=P(r(4)),f=P(r(12)),m=P(r(5)),h=P(r(10)),v=w(r(9)),_=w(r(15)),g=w(r(20)),y=w(r(35)),b=P(r(36)),k=P(r(23));function w(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function P(e){return e&&e.__esModule?e:{default:e}}var S=new m.default(\"Firefox65\"),I=function(e){function t(e,r,n){(0,u.default)(this,t);var a=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,S));return a._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"}),a._rtpParametersByKind=r,a._remoteSdp=new b.default(e,r),a._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(a._pc.iceConnectionState){case\"checking\":a.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":a.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":a.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":a.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":a.emit(\"@connectionstatechange\",\"closed\")}})),a}return(0,p.default)(t,e),(0,d.default)(t,[{key:\"close\",value:function(){S.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){S.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(h.default),T=function(e){function t(e,r){(0,u.default)(this,t);var n=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,\"send\",e,r));return n._transportReady=!1,n._trackIds=new s.default,n._nextRid=1,n}return(0,p.default)(t,e),(0,d.default)(t,[{key:\"addProducer\",value:function(e){var t=this,r=e.track;if(S.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),this._trackIds.has(r.id))return o.default.reject(new Error(\"track already added\"));var n=\"isac\";e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase());var a=void 0,s=void 0;return this._trackIds.add(r.id),o.default.resolve().then((function(){if(a=t._pc.getTransceivers().find((function(e){return e.receiver.track.kind===r.kind&&\"inactive\"===e.direction})))return S.debug(\"addProducer() | reusing an inactive transceiver\"),a.direction=\"sendonly\",a.sender.replaceTrack(r);a=t._pc.addTransceiver(r,{direction:\"sendonly\"})})).then((function(){var r=a.sender,n=[];e.simulcast&&(S.debug(\"addProducer() | enabling simulcast\"),e.simulcast.high&&n.push({rid:\"high\"+t._nextRid,active:!0,priority:\"low\",maxBitrate:e.simulcast.high}),e.simulcast.medium&&n.push({rid:\"medium\"+t._nextRid,active:!0,priority:\"medium\",maxBitrate:e.simulcast.medium}),e.simulcast.low&&n.push({rid:\"low\"+t._nextRid,active:!0,priority:\"high\",maxBitrate:e.simulcast.low}),t._nextRid++);var o=r.getParameters();return r.setParameters((0,i.default)({},o,{encodings:n}))})).then((function(){return t._pc.createOffer()})).then((function(r){return r.sdp=k.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=k.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=k.default.setSpecialAudioCodec(r.sdp,n),S.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){s=f.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(s);r=k.default.setVideoBitrates(r,e.videoBitrateOptions),r=k.default.setOpusAttributes(r,e.audioProfile);var a={type:\"answer\",sdp:r=k.default.setSpecialAudioCodec(r,n)};return S.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",a),t._pc.setRemoteDescription(a)})).then((function(){var i=v.clone(t._rtpParametersByKind[e.kind]);return i&&i.codecs&&(i.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+n&&i.codecs.splice(t,1)})),S.debug(\"addProducer() _rtpParametersByKind: %o - rtpParameters: %o\",t._rtpParametersByKind[e.kind],i)),y.fillRtpParametersForTrack(i,s,r,{mid:a.mid}),i})).catch((function(e){try{a.direction=\"inactive\"}catch(e){}throw t._trackIds.delete(r.id),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;if(!this._trackIds.has(r.id))return o.default.reject(new Error(\"track not found\"));S.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id);var n=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase()),o.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error(\"local track not found\");return t._pc.removeTrack(e),t._trackIds.delete(r.id),t._pc.createOffer()})).then((function(r){return r.sdp=k.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=k.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=k.default.setSpecialAudioCodec(r.sdp,n),S.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).then((function(){var r=f.default.parse(t._pc.localDescription.sdp),a=t._remoteSdp.createAnswerSdp(r);a=k.default.setVideoBitrates(a,e.videoBitrateOptions),a=k.default.setOpusAttributes(a,e.audioProfile);var i={type:\"answer\",sdp:a=k.default.setSpecialAudioCodec(a,n)};return S.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",i),t._pc.setRemoteDescription(i)}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;S.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=e.track;return o.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error(\"local track not found\");return e.replaceTrack(t)})).then((function(){r._trackIds.delete(n.id),r._trackIds.add(t.id)}))}},{key:\"restartIce\",value:function(e){var t=this;return S.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return S.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=f.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return S.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return S.debug(\"_setupTransport()\"),o.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=f.default.parse(r),a=g.extractDtlsParameters(n);return a.role=\"server\",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:\"updateTrack\",value:function(e,t){var r,n,a=this;S.debug(\"update Track() [trackId:%s]\",t.id);var i=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(i=e.audioProfile.codec.toLowerCase()),o.default.resolve().then((function(){n=a._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return a._pc.createOffer()})).then((function(r){if(r.sdp=k.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=k.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=k.default.setSpecialAudioCodec(r.sdp,i),e.simulcast){S.debug(\"updateTrack() | enabling simulcast\");var o=f.default.parse(r.sdp);y.addPlanBSimulcast(o,t,{mid:n.mid}),r={type:\"offer\",sdp:f.default.write(o)}}return S.debug(\"updateTrack() | calling pc.setLocalDescription() [offer:%o]\",r),a._pc.setLocalDescription(r)})).then((function(){r=f.default.parse(a._pc.localDescription.sdp);var t=a._remoteSdp.createAnswerSdp(r);t=k.default.setVideoBitrates(t,e.videoBitrateOptions),t=k.default.setOpusAttributes(t,e.audioProfile);var n={type:\"answer\",sdp:t=k.default.setSpecialAudioCodec(t,i)};return S.debug(\"updateTrack() | calling pc.setRemoteDescription() [answer:%o]\",n),a._pc.setRemoteDescription(n)})).then((function(){var o=v.clone(a._rtpParametersByKind[e.kind]);return o&&o.codecs&&(o.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+i&&o.codecs.splice(t,1)})),S.debug(\"updateTrack() _rtpParametersByKind: %o - rtpParameters: %o\",a._rtpParametersByKind[e.kind],o)),y.fillRtpParametersForTrack(o,r,t,{mid:n.mid,planBSimulcast:!0}),o})).catch((function(e){throw e}))}}]),t}(I),C=function(e){function t(e,r){(0,u.default)(this,t);var n=(0,l.default)(this,(t.__proto__||(0,c.default)(t)).call(this,\"recv\",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new a.default,n}return(0,p.default)(t,e),(0,d.default)(t,[{key:\"addConsumer\",value:function(e){var t=this;if(S.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return o.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],a=e.rtpParameters.rtcp.cname,i={mid:\"\"+e.kind[0]+e.id,kind:e.kind,closed:e.closed,streamId:\"recv-stream-\"+e.id,trackId:\"consumer-\"+e.kind+\"-\"+e.id,ssrc:r.ssrc,cname:a};return r.rtx&&r.rtx.ssrc&&(i.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,i),o.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return S.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getTransceivers().find((function(e){return e.mid===i.mid}));if(!e)throw new Error(\"remote track not found\");return e.receiver.track}))}},{key:\"removeConsumer\",value:function(e){var t=this;S.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,o.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return S.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):o.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return S.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return S.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return S.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return S.debug(\"_setupTransport()\"),o.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){S.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=f.default.parse(e),r={dtlsParameters:g.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}}]),t}(I),R=function(){function e(t,r,n){(0,u.default)(this,e),S.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r);var a=void 0;switch(t){case\"send\":return a={audio:_.getSendingRtpParameters(\"audio\",r),video:_.getSendingRtpParameters(\"video\",r)},new T(a,n);case\"recv\":return a={audio:_.getReceivingFullRtpParameters(\"audio\",r),video:_.getReceivingFullRtpParameters(\"video\",r)},new C(a,n)}}return(0,d.default)(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){S.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"}),t=document.createElement(\"canvas\");t.getContext(\"2d\");var r=t.captureStream(),n=r.getVideoTracks()[0];return e.addTrack(n,r).setParameters({encodings:[{rid:\"RID1\",maxBitrate:4e4},{rid:\"RID2\",maxBitrate:1e4}]}),e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(r){try{t.remove()}catch(e){}try{n.stop()}catch(e){}try{e.close()}catch(e){}var a=f.default.parse(r.sdp);return g.extractRtpCapabilities(a)})).catch((function(r){try{t.remove()}catch(e){}try{n.stop()}catch(e){}try{e.close()}catch(e){}throw r}))}},{key:\"tag\",get:function(){return\"Firefox65\"}}]),e}();t.default=R},function(e,t,r){r(202),e.exports=r(7).Object.assign},function(e,t,r){var n=r(11);n(n.S+n.F,\"Object\",{assign:r(203)})},function(e,t,r){\"use strict\";var n=r(22),a=r(47),i=r(74),o=r(57),s=r(31),c=r(70),u=Object.assign;e.exports=!u||r(33)((function(){var e={},t={},r=Symbol(),n=\"abcdefghijklmnopqrst\";return e[r]=7,n.split(\"\").forEach((function(e){t[e]=e})),7!=u({},e)[r]||Object.keys(u({},t)).join(\"\")!=n}))?function(e,t){for(var r=s(e),u=arguments.length,d=1,l=i.f,p=o.f;u>d;)for(var f,m=c(arguments[d++]),h=l?a(m).concat(l(m)):a(m),v=h.length,_=0;v>_;)f=h[_++],n&&!p.call(m,f)||(r[f]=m[f]);return r}:u},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=w(r(16)),a=w(r(8)),i=w(r(81)),o=w(r(6)),s=w(r(2)),c=w(r(0)),u=w(r(1)),d=w(r(3)),l=w(r(4)),p=w(r(12)),f=w(r(5)),m=w(r(10)),h=k(r(9)),v=k(r(15)),_=k(r(20)),g=k(r(35)),y=w(r(36)),b=w(r(23));function k(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function w(e){return e&&e.__esModule?e:{default:e}}var P=new f.default(\"Firefox59\"),S=function(e){function t(e,r,n){(0,c.default)(this,t);var a=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,P));return a._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"}),a._rtpParametersByKind=r,a._remoteSdp=new y.default(e,r),a._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(a._pc.iceConnectionState){case\"checking\":a.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":a.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":a.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":a.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":a.emit(\"@connectionstatechange\",\"closed\")}})),a}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"close\",value:function(){P.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){P.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(m.default),I=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"send\",e,r));return n._transportReady=!1,n._stream=new MediaStream,n._nextRid=1,n}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"addProducer\",value:function(e){var t=this,r=e.track;if(P.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return o.default.reject(new Error(\"track already added\"));var n=\"isac\";e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase());var a=void 0,s=void 0;return o.default.resolve().then((function(){t._stream.addTrack(r),a=t._pc.addTrack(r,t._stream)})).then((function(){var r=[];e.simulcast&&(P.debug(\"addProducer() | enabling simulcast\"),e.simulcast.high&&r.push({rid:\"high\"+t._nextRid,active:!0,priority:\"low\",maxBitrate:e.simulcast.high}),e.simulcast.medium&&r.push({rid:\"medium\"+t._nextRid,active:!0,priority:\"medium\",maxBitrate:e.simulcast.medium}),e.simulcast.low&&r.push({rid:\"low\"+t._nextRid,active:!0,priority:\"high\",maxBitrate:e.simulcast.low}),t._nextRid++);var n=a.getParameters();return a.setParameters((0,i.default)({},n,{encodings:r}))})).then((function(){return t._pc.createOffer()})).then((function(r){return r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,n),P.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){s=p.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(s);r=b.default.setVideoBitrates(r,e.videoBitrateOptions),r=b.default.setOpusAttributes(r,e.audioProfile);var a={type:\"answer\",sdp:r=b.default.setSpecialAudioCodec(r,n)};return P.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",a),t._pc.setRemoteDescription(a)})).then((function(){var a=h.clone(t._rtpParametersByKind[e.kind]);return a&&a.codecs&&(a.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+n&&a.codecs.splice(t,1)})),P.debug(\"addProducer() _rtpParametersByKind: %o - rtpParameters: %o\",t._rtpParametersByKind[e.kind],a)),g.fillRtpParametersForTrack(a,s,r),a})).catch((function(e){try{t._pc.removeTrack(a)}catch(e){}throw t._stream.removeTrack(r),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;P.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id);var n=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase()),o.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error(\"RTCRtpSender not found\");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()})).then((function(r){return r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,n),P.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).then((function(){var r=p.default.parse(t._pc.localDescription.sdp),a=t._remoteSdp.createAnswerSdp(r);a=b.default.setVideoBitrates(a,e.videoBitrateOptions),a=b.default.setOpusAttributes(a,e.audioProfile);var i={type:\"answer\",sdp:a=b.default.setSpecialAudioCodec(a,n)};return P.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",i),t._pc.setRemoteDescription(i)}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;P.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=e.track;return o.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error(\"local track not found\");return e.replaceTrack(t)})).then((function(){r._stream.removeTrack(n),r._stream.addTrack(t)}))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=p.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),o.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=p.default.parse(r),a=_.extractDtlsParameters(n);return a.role=\"server\",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:\"updateTrack\",value:function(e,t){var r,n,a=this;P.debug(\"update Track() [trackId:%s]\",t.id);var i=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(i=e.audioProfile.codec.toLowerCase()),o.default.resolve().then((function(){n=a._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return a._pc.createOffer()})).then((function(r){if(r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,i),e.simulcast){P.debug(\"updateTrack() | enabling simulcast\");var o=p.default.parse(r.sdp);g.addPlanBSimulcast(o,t,{mid:n.mid}),r={type:\"offer\",sdp:p.default.write(o)}}return P.debug(\"updateTrack() | calling pc.setLocalDescription() [offer:%o]\",r),a._pc.setLocalDescription(r)})).then((function(){r=p.default.parse(a._pc.localDescription.sdp);var t=a._remoteSdp.createAnswerSdp(r);t=b.default.setVideoBitrates(t,e.videoBitrateOptions),t=b.default.setOpusAttributes(t,e.audioProfile);var n={type:\"answer\",sdp:t=b.default.setSpecialAudioCodec(t,i)};return P.debug(\"updateTrack() | calling pc.setRemoteDescription() [answer:%o]\",n),a._pc.setRemoteDescription(n)})).then((function(){var o=h.clone(a._rtpParametersByKind[e.kind]);return o&&o.codecs&&(o.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+i&&o.codecs.splice(t,1)})),P.debug(\"updateTrack() _rtpParametersByKind: %o - rtpParameters: %o\",a._rtpParametersByKind[e.kind],o)),g.fillRtpParametersForTrack(o,r,t,{mid:n.mid,planBSimulcast:!0}),o})).catch((function(e){throw e}))}}]),t}(S),T=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"recv\",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new a.default,n}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"addConsumer\",value:function(e){var t=this;if(P.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return o.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],a=e.rtpParameters.rtcp.cname,i={mid:\"\"+e.kind[0]+e.id,kind:e.kind,closed:e.closed,streamId:\"recv-stream-\"+e.id,trackId:\"consumer-\"+e.kind+\"-\"+e.id,ssrc:r.ssrc,cname:a};return r.rtx&&r.rtx.ssrc&&(i.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,i),o.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return P.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getTransceivers().find((function(e){var t=e.receiver;return!!t&&(!!t.track&&e.mid===i.mid)}));if(!e)throw new Error(\"remote track not found\");return e.receiver.track}))}},{key:\"removeConsumer\",value:function(e){var t=this;P.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,o.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return P.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):o.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return P.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),o.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){P.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=p.default.parse(e),r={dtlsParameters:_.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}}]),t}(S),C=function(){function e(t,r,n){(0,c.default)(this,e),P.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r);var a=void 0;switch(t){case\"send\":return a={audio:v.getSendingRtpParameters(\"audio\",r),video:v.getSendingRtpParameters(\"video\",r)},new I(a,n);case\"recv\":return a={audio:v.getReceivingFullRtpParameters(\"audio\",r),video:v.getReceivingFullRtpParameters(\"video\",r)},new T(a,n)}}return(0,u.default)(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){P.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"}),t=document.createElement(\"canvas\");t.getContext(\"2d\");var r=t.captureStream(),n=r.getVideoTracks()[0];return e.addTrack(n,r).setParameters({encodings:[{rid:\"RID1\",maxBitrate:4e4},{rid:\"RID2\",maxBitrate:1e4}]}),e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(r){try{t.remove()}catch(e){}try{n.stop()}catch(e){}try{e.close()}catch(e){}var a=p.default.parse(r.sdp);return _.extractRtpCapabilities(a)})).catch((function(r){try{t.remove()}catch(e){}try{n.stop()}catch(e){}try{e.close()}catch(e){}throw r}))}},{key:\"tag\",get:function(){return\"Firefox59\"}}]),e}();t.default=C},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=w(r(16)),a=w(r(8)),i=w(r(81)),o=w(r(6)),s=w(r(2)),c=w(r(0)),u=w(r(1)),d=w(r(3)),l=w(r(4)),p=w(r(12)),f=w(r(5)),m=w(r(10)),h=k(r(9)),v=k(r(15)),_=k(r(20)),g=k(r(35)),y=w(r(36)),b=w(r(23));function k(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function w(e){return e&&e.__esModule?e:{default:e}}var P=new f.default(\"Firefox50\"),S=function(e){function t(e,r,n){(0,c.default)(this,t);var a=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,P));return a._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"}),a._rtpParametersByKind=r,a._remoteSdp=new y.default(e,r),a._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(a._pc.iceConnectionState){case\"checking\":a.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":a.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":a.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":a.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":a.emit(\"@connectionstatechange\",\"closed\")}})),a}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"close\",value:function(){P.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){P.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(m.default),I=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"send\",e,r));return n._transportReady=!1,n._stream=new MediaStream,n._nextRid=1,n}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"addProducer\",value:function(e){var t=this,r=e.track;if(P.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return o.default.reject(new Error(\"track already added\"));var n=\"isac\";e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase());var a=void 0,s=void 0;return o.default.resolve().then((function(){t._stream.addTrack(r),a=t._pc.addTrack(r,t._stream)})).then((function(){var r=[];e.simulcast&&(P.debug(\"addProducer() | enabling simulcast\"),e.simulcast.high&&r.push({rid:\"high\"+t._nextRid,active:!0,priority:\"low\",maxBitrate:e.simulcast.high}),e.simulcast.medium&&r.push({rid:\"medium\"+t._nextRid,active:!0,priority:\"medium\",maxBitrate:e.simulcast.medium}),e.simulcast.low&&r.push({rid:\"low\"+t._nextRid,active:!0,priority:\"high\",maxBitrate:e.simulcast.low}),t._nextRid++);var n=a.getParameters();return a.setParameters((0,i.default)({},n,{encodings:r}))})).then((function(){return t._pc.createOffer()})).then((function(r){return r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,n),P.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){s=p.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(s);r=b.default.setVideoBitrates(r,e.videoBitrateOptions),r=b.default.setOpusAttributes(r,e.audioProfile);var a={type:\"answer\",sdp:r=b.default.setSpecialAudioCodec(r,n)};return P.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",a),t._pc.setRemoteDescription(a)})).then((function(){var a=h.clone(t._rtpParametersByKind[e.kind]);return a&&a.codecs&&(a.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+n&&a.codecs.splice(t,1)})),P.debug(\"addProducer() _rtpParametersByKind: %o - rtpParameters: %o\",t._rtpParametersByKind[e.kind],a)),g.fillRtpParametersForTrack(a,s,r),a})).catch((function(e){try{t._pc.removeTrack(a)}catch(e){}throw t._stream.removeTrack(r),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;P.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id);var n=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase()),o.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error(\"RTCRtpSender not found\");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()})).then((function(r){return r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,n),P.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).then((function(){var r=p.default.parse(t._pc.localDescription.sdp),a=t._remoteSdp.createAnswerSdp(r);a=b.default.setVideoBitrates(a,e.videoBitrateOptions),a=b.default.setOpusAttributes(a,e.audioProfile);var i={type:\"answer\",sdp:a=b.default.setSpecialAudioCodec(a,n)};return P.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",i),t._pc.setRemoteDescription(i)}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;P.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=e.track;return o.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error(\"local track not found\");return e.replaceTrack(t)})).then((function(){r._stream.removeTrack(n),r._stream.addTrack(t)}))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=p.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),o.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=p.default.parse(r),a=_.extractDtlsParameters(n);return a.role=\"server\",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:\"updateTrack\",value:function(e,t){var r,n,a=this;P.debug(\"update Track() [trackId:%s]\",t.id);var i=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(i=e.audioProfile.codec.toLowerCase()),o.default.resolve().then((function(){n=a._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return a._pc.createOffer()})).then((function(r){if(r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,i),e.simulcast){P.debug(\"updateTrack() | enabling simulcast\");var o=p.default.parse(r.sdp);g.addPlanBSimulcast(o,t,{mid:n.mid}),r={type:\"offer\",sdp:p.default.write(o)}}return P.debug(\"updateTrack() | calling pc.setLocalDescription() [offer:%o]\",r),a._pc.setLocalDescription(r)})).then((function(){r=p.default.parse(a._pc.localDescription.sdp);var t=a._remoteSdp.createAnswerSdp(r);t=b.default.setVideoBitrates(t,e.videoBitrateOptions),t=b.default.setOpusAttributes(t,e.audioProfile);var n={type:\"answer\",sdp:t=b.default.setSpecialAudioCodec(t,i)};return P.debug(\"updateTrack() | calling pc.setRemoteDescription() [answer:%o]\",n),a._pc.setRemoteDescription(n)})).then((function(){var o=h.clone(a._rtpParametersByKind[e.kind]);return o&&o.codecs&&(o.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+i&&o.codecs.splice(t,1)})),P.debug(\"updateTrack() _rtpParametersByKind: %o - rtpParameters: %o\",a._rtpParametersByKind[e.kind],o)),g.fillRtpParametersForTrack(o,r,t,{mid:n.mid,planBSimulcast:!0}),o})).catch((function(e){throw e}))}}]),t}(S),T=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"recv\",e,r));n._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new a.default;return n._consumerInfos.set(555,{mid:\"fake-dc\",kind:\"application\",closed:!1,cname:null}),n}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"addConsumer\",value:function(e){var t=this;if(P.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return o.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],a=e.rtpParameters.rtcp.cname,i={mid:\"\"+e.kind[0]+e.id,kind:e.kind,closed:e.closed,streamId:\"recv-stream-\"+e.id,trackId:\"consumer-\"+e.kind+\"-\"+e.id,ssrc:r.ssrc,cname:a};return r.rtx&&r.rtx.ssrc&&(i.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,i),o.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return P.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getReceivers().find((function(e){var t=e.track;return!!t&&t.id===i.trackId}));if(!e)throw new Error(\"remote track not found\");return e.track}))}},{key:\"removeConsumer\",value:function(e){var t=this;P.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,o.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return P.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):o.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),o.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return P.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),o.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){P.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=p.default.parse(e),r={dtlsParameters:_.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}}]),t}(S),C=function(){function e(t,r,n){(0,c.default)(this,e),P.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r);var a=void 0;switch(t){case\"send\":return a={audio:v.getSendingRtpParameters(\"audio\",r),video:v.getSendingRtpParameters(\"video\",r)},new I(a,n);case\"recv\":return a={audio:v.getReceivingFullRtpParameters(\"audio\",r),video:v.getReceivingFullRtpParameters(\"video\",r)},new T(a,n)}}return(0,u.default)(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){P.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"}),t=document.createElement(\"canvas\");t.getContext(\"2d\");var r=t.captureStream(),n=r.getVideoTracks()[0];return e.addTrack(n,r).setParameters({encodings:[{rid:\"RID1\",maxBitrate:4e4},{rid:\"RID2\",maxBitrate:1e4}]}),e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(r){try{t.remove()}catch(e){}try{n.stop()}catch(e){}try{e.close()}catch(e){}var a=p.default.parse(r.sdp);return _.extractRtpCapabilities(a)})).catch((function(r){try{t.remove()}catch(e){}try{n.stop()}catch(e){}try{e.close()}catch(e){}throw r}))}},{key:\"tag\",get:function(){return\"Firefox50\"}}]),e}();t.default=C},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=_(r(17)),a=_(r(8)),i=_(r(2)),o=_(r(6)),s=_(r(0)),c=_(r(3)),u=_(r(1)),d=_(r(4)),l=_(r(5)),p=_(r(10)),f=v(r(9)),m=v(r(15)),h=v(r(207));function v(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function _(e){return e&&e.__esModule?e:{default:e}}var g=\"CNAME-EDGE-\"+f.randomNumber(),y=new l.default(\"Edge11\"),b=function(e){function t(e,r,n){(0,s.default)(this,t);var o=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,y));return y.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",e,r),o._rtpParametersByKind={audio:m.getSendingRtpParameters(\"audio\",r),video:m.getSendingRtpParameters(\"video\",r)},o._transportReady=!1,o._iceGatherer=null,o._iceTransport=null,o._dtlsTransport=null,o._rtpSenders=new a.default,o._rtpReceivers=new a.default,o._transportRemoteParameters=null,o._setIceGatherer(n),o._setIceTransport(),o._setDtlsTransport(),o}return(0,d.default)(t,e),(0,u.default)(t,null,[{key:\"getNativeRtpCapabilities\",value:function(){return y.debug(\"getNativeRtpCapabilities()\"),o.default.resolve(h.getCapabilities())}},{key:\"tag\",get:function(){return\"Edge11\"}}]),(0,u.default)(t,[{key:\"close\",value:function(){y.debug(\"close()\");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}var e=!0,t=!1,r=void 0;try{for(var a,i=(0,n.default)(this._rtpSenders.values());!(e=(a=i.next()).done);e=!0){var o=a.value;try{o.stop()}catch(e){}}}catch(e){t=!0,r=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw r}}var s=!0,c=!1,u=void 0;try{for(var d,l=(0,n.default)(this._rtpReceivers.values());!(s=(d=l.next()).done);s=!0){var p=d.value;try{p.stop()}catch(e){}}}catch(e){c=!0,u=e}finally{try{!s&&l.return&&l.return()}finally{if(c)throw u}}}},{key:\"remoteClosed\",value:function(){y.debug(\"remoteClosed()\"),this._transportReady=!1}},{key:\"addProducer\",value:function(e){var t=this,r=e.track;return y.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),this._rtpSenders.has(e.id)?o.default.reject(new Error(\"Producer already added\")):o.default.resolve().then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){y.debug(\"addProducer() | calling new RTCRtpSender()\");var n=new RTCRtpSender(r,t._dtlsTransport),a=f.clone(t._rtpParametersByKind[e.kind]),i={ssrc:f.randomNumber()};a.codecs.some((function(e){return\"rtx\"===e.name}))&&(i.rtx={ssrc:f.randomNumber()}),a.encodings.push(i),a.rtcp={cname:g,reducedSize:!0,mux:!0};var o=h.mangleRtpParameters(a);return y.debug(\"addProducer() | calling rtpSender.send() [params:%o]\",o),n.send(o),t._rtpSenders.set(e.id,n),a}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;return y.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),o.default.resolve().then((function(){var r=t._rtpSenders.get(e.id);if(!r)throw new Error(\"RTCRtpSender not found\");t._rtpSenders.delete(e.id);try{y.debug(\"removeProducer() | calling rtpSender.stop()\"),r.stop()}catch(e){y.warn(\"rtpSender.stop() failed:%o\",e)}}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;return y.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id),o.default.resolve().then((function(){var n=r._rtpSenders.get(e.id);if(!n)throw new Error(\"RTCRtpSender not found\");n.setTrack(t)}))}},{key:\"addConsumer\",value:function(e){var t=this;return y.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._rtpReceivers.has(e.id)?o.default.reject(new Error(\"Consumer already added\")):o.default.resolve().then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){y.debug(\"addConsumer() | calling new RTCRtpReceiver()\");var r=new RTCRtpReceiver(t._dtlsTransport,e.kind);r.addEventListener(\"error\",(function(e){y.error('iceGatherer \"error\" event [event:%o]',e)}));var n=h.mangleRtpParameters(e.rtpParameters);return n.headerExtensions=n.headerExtensions.filter((function(e){return\"urn:ietf:params:rtp-hdrext:sdes:mid\"!==e.uri})),y.debug(\"addConsumer() | calling rtpReceiver.receive() [params:%o]\",n),r.receive(n),t._rtpReceivers.set(e.id,r),r.track}))}},{key:\"removeConsumer\",value:function(e){var t=this;return y.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind),o.default.resolve().then((function(){var r=t._rtpReceivers.get(e.id);if(!r)throw new Error(\"RTCRtpReceiver not found\");t._rtpReceivers.delete(e.id);try{y.debug(\"removeConsumer() | calling rtpReceiver.stop()\"),r.stop()}catch(e){y.warn(\"rtpReceiver.stop() failed:%o\",e)}}))}},{key:\"restartIce\",value:function(e){var t=this;y.debug(\"restartIce()\"),o.default.resolve().then((function(){t._transportRemoteParameters.iceParameters=e;var r=t._transportRemoteParameters.iceCandidates;y.debug(\"restartIce() | calling iceTransport.start()\"),t._iceTransport.start(t._iceGatherer,e,\"controlling\");var a=!0,i=!1,o=void 0;try{for(var s,c=(0,n.default)(r);!(a=(s=c.next()).done);a=!0){var u=s.value;t._iceTransport.addRemoteCandidate(u)}}catch(e){i=!0,o=e}finally{try{!a&&c.return&&c.return()}finally{if(i)throw o}}t._iceTransport.addRemoteCandidate({})}))}},{key:\"_setIceGatherer\",value:function(e){var t=new RTCIceGatherer({iceServers:e.turnServers||[],gatherPolicy:e.iceTransportPolicy});t.addEventListener(\"error\",(function(e){y.error('iceGatherer \"error\" event [event:%o]',e)}));try{t.gather()}catch(e){y.debug(\"iceGatherer.gather() failed: %s\",e.toString())}this._iceGatherer=t}},{key:\"_setIceTransport\",value:function(){var e=this,t=new RTCIceTransport(this._iceGatherer);t.addEventListener(\"statechange\",(function(){switch(t.state){case\"checking\":e.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":e.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":e.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":e.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":e.emit(\"@connectionstatechange\",\"closed\")}})),t.addEventListener(\"icestatechange\",(function(){switch(t.state){case\"checking\":e.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":e.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":e.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":e.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":e.emit(\"@connectionstatechange\",\"closed\")}})),t.addEventListener(\"candidatepairchange\",(function(e){y.debug('iceTransport \"candidatepairchange\" event [pair:%o]',e.pair)})),this._iceTransport=t}},{key:\"_setDtlsTransport\",value:function(){var e=this,t=new RTCDtlsTransport(this._iceTransport);t.addEventListener(\"statechange\",(function(){y.debug('dtlsTransport \"statechange\" event [state:%s]',t.state)})),t.addEventListener(\"dtlsstatechange\",(function(){y.debug('dtlsTransport \"dtlsstatechange\" event [state:%s]',t.state),\"closed\"===t.state&&e.emit(\"@connectionstatechange\",\"closed\")})),t.addEventListener(\"error\",(function(e){y.error('dtlsTransport \"error\" event [event:%o]',e)})),this._dtlsTransport=t}},{key:\"_setupTransport\",value:function(){var e=this;return y.debug(\"_setupTransport()\"),o.default.resolve().then((function(){var t={},r=e._dtlsTransport.getLocalParameters();return r.role=\"server\",t.dtlsParameters=r,e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._transportRemoteParameters=t;var r=t.iceParameters,a=t.iceCandidates,i=t.dtlsParameters;e._iceTransport.start(e._iceGatherer,r,\"controlling\");var o=!0,s=!1,c=void 0;try{for(var u,d=(0,n.default)(a);!(o=(u=d.next()).done);o=!0){var l=u.value;e._iceTransport.addRemoteCandidate(l)}}catch(e){s=!0,c=e}finally{try{!o&&d.return&&d.return()}finally{if(s)throw c}}e._iceTransport.addRemoteCandidate({}),i.fingerprints=i.fingerprints.filter((function(e){return\"sha-256\"===e.algorithm||\"sha-384\"===e.algorithm||\"sha-512\"===e.algorithm})),e._dtlsTransport.start(i),e._transportReady=!0}))}}]),t}(p.default);t.default=b},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n,a=r(17),i=(n=a)&&n.__esModule?n:{default:n};t.getCapabilities=function(){var e=RTCRtpReceiver.getCapabilities(),t=o.clone(e),r=!0,n=!1,a=void 0;try{for(var s,c=(0,i.default)(t.codecs);!(r=(s=c.next()).done);r=!0){var u=s.value;if(u.channels=u.numChannels,delete u.numChannels,\"audio\"!==u.kind?delete u.channels:u.channels||(u.channels=1),u.mimeType=u.kind+\"/\"+u.name,u.parameters){var d=u.parameters;d.apt&&(d.apt=Number(d.apt)),d[\"packetization-mode\"]&&(d[\"packetization-mode\"]=Number(d[\"packetization-mode\"]))}var l=!0,p=!1,f=void 0;try{for(var m,h=(0,i.default)(u.rtcpFeedback||[]);!(l=(m=h.next()).done);l=!0){var v=m.value;v.parameter||delete v.parameter}}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}}}catch(e){n=!0,a=e}finally{try{!r&&c.return&&c.return()}finally{if(n)throw a}}return t},t.mangleRtpParameters=function(e){var t=o.clone(e),r=!0,n=!1,a=void 0;try{for(var s,c=(0,i.default)(t.codecs);!(r=(s=c.next()).done);r=!0){var u=s.value;u.channels&&(u.numChannels=u.channels,delete u.channels),delete u.mimeType}}catch(e){n=!0,a=e}finally{try{!r&&c.return&&c.return()}finally{if(n)throw a}}return t};var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(9))},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=w(r(16)),a=w(r(8)),i=w(r(6)),o=w(r(19)),s=w(r(2)),c=w(r(0)),u=w(r(1)),d=w(r(3)),l=w(r(4)),p=w(r(12)),f=w(r(5)),m=w(r(10)),h=k(r(9)),v=k(r(15)),_=k(r(20)),g=k(r(41)),y=w(r(42)),b=w(r(23));function k(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function w(e){return e&&e.__esModule?e:{default:e}}var P=new f.default(\"ReactNative\"),S=function(e){function t(e,r,n){(0,c.default)(this,t);var a=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,P));return a._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"}),a._rtpParametersByKind=r,a._remoteSdp=new y.default(e,r),a._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(a._pc.iceConnectionState){case\"checking\":a.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":a.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":a.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":a.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":a.emit(\"@connectionstatechange\",\"closed\")}})),a}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"close\",value:function(){P.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){P.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(m.default),I=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"send\",e,r));return n._transportReady=!1,n._tracks=new o.default,n}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"addProducer\",value:function(e){var t=this,r=e.track;if(P.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),this._tracks.has(r))return i.default.reject(new Error(\"track already added\"));if(!r.streamReactTag)return i.default.reject(new Error(\"no track.streamReactTag property\"));var n=\"isac\";e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase());var a=void 0,o=void 0;return i.default.resolve().then((function(){return t._tracks.add(r),(a=new MediaStream(r.streamReactTag)).addTrack(r),t._pc.addStream(a),t._pc.createOffer()})).then((function(a){if(a.sdp=b.default.setVideoBitrates(a.sdp,e.videoBitrateOptions),a.sdp=b.default.setOpusAttributes(a.sdp,e.audioProfile),a.sdp=b.default.setSpecialAudioCodec(a.sdp,n),e.simulcast){P.debug(\"addProducer() | enabling simulcast\");var i=p.default.parse(a.sdp);g.addSimulcastForTrack(i,r),a={type:\"offer\",sdp:p.default.write(i)}}P.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",a);var o=new RTCSessionDescription(a);return t._pc.setLocalDescription(o)})).then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){o=p.default.parse(t._pc.localDescription.sdp);var r=t._remoteSdp.createAnswerSdp(o);r=b.default.setVideoBitrates(r,e.videoBitrateOptions),r=b.default.setOpusAttributes(r,e.audioProfile);var a={type:\"answer\",sdp:r=b.default.setSpecialAudioCodec(r,n)};P.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",a);var i=new RTCSessionDescription(a);return t._pc.setRemoteDescription(i)})).then((function(){var a=h.clone(t._rtpParametersByKind[e.kind]);return a&&a.codecs&&(a.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+n&&a.codecs.splice(t,1)})),P.debug(\"addProducer() _rtpParametersByKind: %o - rtpParameters: %o\",t._rtpParametersByKind[e.kind],a)),g.fillRtpParametersForTrack(a,o,r),a})).catch((function(e){throw t._tracks.delete(r),a.removeTrack(r),t._pc.removeStream(a),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;if(P.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),!r.streamReactTag)return i.default.reject(new Error(\"no track.streamReactTag property\"));var n=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(n=e.audioProfile.codec.toLowerCase()),i.default.resolve().then((function(){t._tracks.delete(r);var e=new MediaStream(r.streamReactTag);return e.addTrack(r),t._pc.removeStream(e),t._pc.createOffer()})).then((function(r){return r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,n),P.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",r),t._pc.setLocalDescription(r)})).catch((function(e){if(0!==t._tracks.size)throw e;P.warn(\"removeProducer() | ignoring expected error due no sending tracks: %s\",e.toString())})).then((function(){if(\"stable\"!==t._pc.signalingState){var r=p.default.parse(t._pc.localDescription.sdp),a=t._remoteSdp.createAnswerSdp(r);a=b.default.setVideoBitrates(a,e.videoBitrateOptions),a=b.default.setOpusAttributes(a,e.audioProfile);var i={type:\"answer\",sdp:a=b.default.setSpecialAudioCodec(a,n)};P.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",i);var o=new RTCSessionDescription(i);return t._pc.setRemoteDescription(o)}}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;if(P.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id),!t.streamReactTag)return i.default.reject(new Error(\"no track.streamReactTag property\"));var n=e.track,a=void 0,o=void 0,s=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(s=e.audioProfile.codec.toLowerCase()),i.default.resolve().then((function(){return r._tracks.add(t),r._tracks.delete(n),(a=new MediaStream(t.streamReactTag)).addTrack(t),a.removeTrack(n),r._pc.addStream(a),r._pc.createOffer()})).then((function(n){if(n.sdp=b.default.setVideoBitrates(n.sdp,e.videoBitrateOptions),n.sdp=b.default.setOpusAttributes(n.sdp,e.audioProfile),n.sdp=b.default.setSpecialAudioCodec(n.sdp,s),e.simulcast){P.debug(\"addProducer() | enabling simulcast\");var a=p.default.parse(n.sdp);g.addSimulcastForTrack(a,t),n={type:\"offer\",sdp:p.default.write(a)}}P.debug(\"replaceProducerTrack() | calling pc.setLocalDescription() [offer:%o]\",n);var i=new RTCSessionDescription(n);return r._pc.setLocalDescription(i)})).then((function(){o=p.default.parse(r._pc.localDescription.sdp);var t=r._remoteSdp.createAnswerSdp(o);t=b.default.setVideoBitrates(t,e.videoBitrateOptions),t=b.default.setOpusAttributes(t,e.audioProfile);var n={type:\"answer\",sdp:t=b.default.setSpecialAudioCodec(t,s)};P.debug(\"replaceProducerTrack() | calling pc.setRemoteDescription() [answer:%o]\",n);var a=new RTCSessionDescription(n);return r._pc.setRemoteDescription(a)})).then((function(){var n=h.clone(r._rtpParametersByKind[e.kind]);n&&n.codecs&&(n.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+s&&n.codecs.splice(t,1)})),P.debug(\"replaceProducerTrack() _rtpParametersByKind: %o - rtpParameters: %o\",r._rtpParametersByKind[e.kind],n)),g.fillRtpParametersForTrack(n,o,t),r.safeEmit(\"@needupdateproducer\",e,n)})).catch((function(e){throw r._tracks.delete(t),a.removeTrack(t),r._pc.addStream(a),e}))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),i.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=p.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};P.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r);var n=new RTCSessionDescription(r);return t._pc.setRemoteDescription(n)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),i.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=p.default.parse(r),a=_.extractDtlsParameters(n);return a.role=\"server\",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:\"updateTrack\",value:function(e,t){var r,n=this;P.debug(\"update Track() [trackId:%s]\",t.id);var a=\"isac\";return e.audioProfile&&e.audioProfile.codec&&\"\"!==e.audioProfile.codec&&(a=e.audioProfile.codec.toLowerCase()),i.default.resolve().then((function(){n._pc.getTransceivers().find((function(e){return e.receiver.track.kind===t.kind}))})).then((function(){return n._pc.createOffer()})).then((function(r){if(r.sdp=b.default.setVideoBitrates(r.sdp,e.videoBitrateOptions),r.sdp=b.default.setOpusAttributes(r.sdp,e.audioProfile),r.sdp=b.default.setSpecialAudioCodec(r.sdp,a),e.simulcast){P.debug(\"updateTrack() | enabling simulcast\");var i=p.default.parse(r.sdp);g.addSimulcastForTrack(i,t),r={type:\"offer\",sdp:p.default.write(i)}}return P.debug(\"updateTrack() | calling pc.setLocalDescription() [offer:%o]\",r),n._pc.setLocalDescription(r)})).then((function(){r=p.default.parse(n._pc.localDescription.sdp);var t=n._remoteSdp.createAnswerSdp(r);t=b.default.setVideoBitrates(t,e.videoBitrateOptions),t=b.default.setOpusAttributes(t,e.audioProfile);var i={type:\"answer\",sdp:t=b.default.setSpecialAudioCodec(t,a)};return P.debug(\"updateTrack() | calling pc.setRemoteDescription() [answer:%o]\",i),n._pc.setRemoteDescription(i)})).then((function(){var i=h.clone(n._rtpParametersByKind[e.kind]);return i&&i.codecs&&(i.codecs.forEach((function(e,t){0===e.mimeType.indexOf(\"audio\")&&e.mimeType.toLowerCase()!==\"audio/\"+a&&i.codecs.splice(t,1)})),P.debug(\"updateTrack() _rtpParametersByKind: %o - rtpParameters: %o\",n._rtpParametersByKind[e.kind],i)),g.fillRtpParametersForTrack(i,r,t),i})).catch((function(e){throw e}))}}]),t}(S),T=function(e){function t(e,r){(0,c.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,\"recv\",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._kinds=new o.default,n._consumerInfos=new a.default,n}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"addConsumer\",value:function(e){var t=this;if(P.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return i.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],a=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:\"recv-stream-\"+e.id,trackId:\"consumer-\"+e.kind+\"-\"+e.id,ssrc:r.ssrc,cname:a};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),i.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};P.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e);var r=new RTCSessionDescription(e);return t._pc.setRemoteDescription(r)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getRemoteStreams().find((function(e){return e.id===o.streamId})),r=e.getTrackById(o.trackId);if(r.streamReactTag=e.reactTag,!r)throw new Error(\"remote track not found\");return r}))}},{key:\"removeConsumer\",value:function(e){var t=this;return P.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),i.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};P.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e);var r=new RTCSessionDescription(e);return t._pc.setRemoteDescription(r)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):i.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return P.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),i.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};P.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e);var r=new RTCSessionDescription(e);return t._pc.setRemoteDescription(r)})).then((function(){return t._pc.createAnswer()})).then((function(e){return P.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return P.debug(\"_setupTransport()\"),i.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){P.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=p.default.parse(e),r={dtlsParameters:_.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}}]),t}(S),C=function(){function e(t,r,n){(0,c.default)(this,e),P.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r);var a=void 0;switch(t){case\"send\":return a={audio:v.getSendingRtpParameters(\"audio\",r),video:v.getSendingRtpParameters(\"video\",r)},new I(a,n);case\"recv\":return a={audio:v.getReceivingFullRtpParameters(\"audio\",r),video:v.getReceivingFullRtpParameters(\"video\",r)},new T(a,n)}}return(0,u.default)(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){P.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(t){try{e.close()}catch(e){}var r=p.default.parse(t.sdp);return _.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:\"tag\",get:function(){return\"ReactNative\"}}]),e}();t.default=C},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=P(r(16)),a=P(r(61)),i=P(r(26)),o=P(r(17)),s=P(r(6)),c=P(r(8)),u=P(r(2)),d=P(r(0)),l=P(r(1)),p=P(r(3)),f=P(r(4)),m=P(r(5)),h=P(r(10)),v=r(52),_=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(15)),g=P(r(80)),y=P(r(210)),b=P(r(212)),k=P(r(213)),w=P(r(214));function P(e){return e&&e.__esModule?e:{default:e}}var S=new m.default(\"<Room>\"),I=\"new\",T=\"joining\",C=\"joined\",R=\"closed\",x=function(e){function t(e){(0,d.default)(this,t);var r=(0,p.default)(this,(t.__proto__||(0,u.default)(t)).call(this,S));if(S.debug(\"constructor() [options:%o]\",e),!g.default.isSupported())throw new Error(\"current browser/device not supported\");return e=e||{},r._settings={roomSettings:e.roomSettings,requestTimeout:e.requestTimeout||3e4,transportOptions:e.transportOptions||{},turnServers:e.turnServers||[],iceTransportPolicy:e.iceTransportPolicy||\"all\",spy:Boolean(e.spy)},r._state=I,r._peerName=null,r._transports=new c.default,r._producers=new c.default,r._peers=new c.default,r._extendedRtpCapabilities=null,r._canSendByKind={audio:!1,video:!1},r}return(0,f.default)(t,e),(0,l.default)(t,[{key:\"getTransportById\",value:function(e){return this._transports.get(e)}},{key:\"getProducerById\",value:function(e){return this._producers.get(e)}},{key:\"getPeerByName\",value:function(e){return this._peers.get(e)}},{key:\"join\",value:function(e,t){var r=this;if(S.debug('join() [peerName:\"%s\"]',e),\"string\"!=typeof e)return s.default.reject(new TypeError(\"invalid peerName\"));if(this._state!==I&&this._state!==R)return s.default.reject(new v.InvalidStateError('invalid state \"'+this._state+'\"'));this._peerName=e,this._state=T;var n=void 0;return s.default.resolve().then((function(){return r._settings.roomSettings?void(n=r._settings.roomSettings):r._sendRequest(\"queryRoom\",{target:\"room\"}).then((function(e){n=e,S.debug(\"join() | got Room settings:%o\",n)}))})).then((function(){return g.default.Handler.getNativeRtpCapabilities()})).then((function(e){S.debug(\"join() | native RTP capabilities:%o\",e),r._extendedRtpCapabilities=_.getExtendedRtpCapabilities(e,n.rtpCapabilities),S.debug(\"join() | extended RTP capabilities:%o\",r._extendedRtpCapabilities);var a=_.getUnsupportedCodecs(n.rtpCapabilities,n.mandatoryCodecPayloadTypes,r._extendedRtpCapabilities);if(a.length>0)throw S.error(\"%s mandatory room codecs not supported:%o\",a.length,a),new v.UnsupportedError(\"mandatory room codecs not supported\",a);r._canSendByKind.audio=_.canSend(\"audio\",r._extendedRtpCapabilities),r._canSendByKind.video=_.canSend(\"video\",r._extendedRtpCapabilities);var i=_.getRtpCapabilities(r._extendedRtpCapabilities);S.debug(\"join() | effective local RTP capabilities for receiving:%o\",i);var o={target:\"room\",peerName:r._peerName,rtpCapabilities:i,spy:r._settings.spy,appData:t};return r._sendRequest(\"join\",o).then((function(e){return e.peers}))})).then((function(e){var t=!0,n=!1,a=void 0;try{for(var i,s=(0,o.default)(e||[]);!(t=(i=s.next()).done);t=!0){var c=i.value;try{r._handlePeerData(c)}catch(e){S.error(\"join() | error handling Peer:%o\",e)}}}catch(e){n=!0,a=e}finally{try{!t&&s.return&&s.return()}finally{if(n)throw a}}return r._state=C,S.debug(\"join() | joined the Room\"),r.peers})).catch((function(e){throw r._state=I,e}))}},{key:\"leave\",value:function(e){if(S.debug(\"leave()\"),!this.closed){this._sendNotification(\"leave\",{appData:e}),this._state=R,this.safeEmit(\"close\",\"local\",e);var t=!0,r=!1,n=void 0;try{for(var a,i=(0,o.default)(this._transports.values());!(t=(a=i.next()).done);t=!0){a.value.close()}}catch(e){r=!0,n=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw n}}var s=!0,c=!1,u=void 0;try{for(var d,l=(0,o.default)(this._producers.values());!(s=(d=l.next()).done);s=!0){d.value.close()}}catch(e){c=!0,u=e}finally{try{!s&&l.return&&l.return()}finally{if(c)throw u}}var p=!0,f=!1,m=void 0;try{for(var h,v=(0,o.default)(this._peers.values());!(p=(h=v.next()).done);p=!0){h.value.close()}}catch(e){f=!0,m=e}finally{try{!p&&v.return&&v.return()}finally{if(f)throw m}}}}},{key:\"remoteClose\",value:function(e){if(S.debug(\"remoteClose()\"),!this.closed){this._state=R,this.safeEmit(\"close\",\"remote\",e);var t=!0,r=!1,n=void 0;try{for(var a,i=(0,o.default)(this._transports.values());!(t=(a=i.next()).done);t=!0){a.value.remoteClose(null,{destroy:!0})}}catch(e){r=!0,n=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw n}}var s=!0,c=!1,u=void 0;try{for(var d,l=(0,o.default)(this._producers.values());!(s=(d=l.next()).done);s=!0){d.value.remoteClose()}}catch(e){c=!0,u=e}finally{try{!s&&l.return&&l.return()}finally{if(c)throw u}}var p=!0,f=!1,m=void 0;try{for(var h,v=(0,o.default)(this._peers.values());!(p=(h=v.next()).done);p=!0){h.value.remoteClose()}}catch(e){f=!0,m=e}finally{try{!p&&v.return&&v.return()}finally{if(f)throw m}}}}},{key:\"canSend\",value:function(e){if(\"audio\"!==e&&\"video\"!==e)throw new TypeError('invalid kind \"'+e+'\"');return!(!this.joined||this._settings.spy)&&this._canSendByKind[e]}},{key:\"createTransport\",value:function(e,t){var r=this;if(S.debug(\"createTransport() [direction:%s]\",e),!this.joined)throw new v.InvalidStateError('invalid state \"'+this._state+'\"');if(\"send\"!==e&&\"recv\"!==e)throw new TypeError('invalid direction \"'+e+'\"');if(\"send\"===e&&this._settings.spy)throw new TypeError(\"a spy peer cannot send media to the room\");var n=new y.default(e,this._extendedRtpCapabilities,this._settings,t);return this._transports.set(n.id,n),n.on(\"@request\",(function(e,t,n,a){r._sendRequest(e,t).then(n).catch(a)})),n.on(\"@notify\",(function(e,t){r._sendNotification(e,t)})),n.on(\"@close\",(function(){r._transports.delete(n.id)})),n}},{key:\"createProducer\",value:function(e,t,r){var n=this;if(S.debug(\"createProducer() [track:%o, options:%o]\",e,t),!this.joined)throw new v.InvalidStateError('invalid state \"'+this._state+'\"');if(this._settings.spy)throw new Error(\"a spy peer cannot send media to the room\");if(!e)throw new TypeError(\"no track given\");if(!this._canSendByKind[e.kind])throw new Error(\"cannot send \"+e.kind);if(\"ended\"===e.readyState)throw new Error('track.readyState is \"ended\"');t=t||{};var a=new b.default(e,t,r);return this._producers.set(a.id,a),a.on(\"@close\",(function(){n._producers.delete(a.id)})),a}},{key:\"restartIce\",value:function(e,t){if(this.joined){var r=!0,n=!1,a=void 0;try{for(var i,s=(0,o.default)(this._transports.values());!(r=(i=s.next()).done);r=!0){i.value.restartIce(e,t)}}catch(e){n=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw a}}}else S.warn('restartIce() | invalid state \"'+this._state+'\"')}},{key:\"receiveNotification\",value:function(e){var t=this;if(this.closed)return s.default.reject(new v.InvalidStateError(\"Room closed\"));if(\"object\"!==(void 0===e?\"undefined\":(0,i.default)(e)))return s.default.reject(new TypeError(\"wrong notification Object\"));if(!0!==e.notification)return s.default.reject(new TypeError(\"not a notification\"));if(\"string\"!=typeof e.method)return s.default.reject(new TypeError(\"wrong/missing notification method\"));var r=e.method;return\"producerStats\"!==r&&\"consumerStats\"!==r&&S.debug(\"receiveNotification() [method:%s, notification:%o]\",r,e),s.default.resolve().then((function(){switch(r){case\"closed\":var n=e.appData;t.remoteClose(n);break;case\"transportClosed\":var a=e.id,i=e.appData,o=t._transports.get(a);if(!o)throw new Error('Transport not found [id:\"'+a+'\"]');o.remoteClose(i,{destroy:!1});break;case\"transportStats\":var s=e.id,c=e.stats,u=t._transports.get(s);if(!u)throw new Error(\"Transport not found [id:\"+s+\"]\");u.remoteStats(c);break;case\"newPeer\":var d=e.name;if(t._peers.has(d))throw new Error('Peer already exists [name:\"'+d+'\"]');var l=e;t._handlePeerData(l);break;case\"peerClosed\":var p=e.name,f=e.appData,m=t._peers.get(p);if(!m)throw new Error('no Peer found [name:\"'+p+'\"]');m.remoteClose(f);break;case\"producerPaused\":var h=e.id,v=e.appData,_=t._producers.get(h);if(!_)throw new Error(\"Producer not found [id:\"+h+\"]\");_.remotePause(v);break;case\"producerResumed\":var g=e.id,y=e.appData,b=t._producers.get(g);if(!b)throw new Error(\"Producer not found [id:\"+g+\"]\");b.remoteResume(y);break;case\"producerClosed\":var k=e.id,w=e.appData,P=t._producers.get(k);if(!P)throw new Error(\"Producer not found [id:\"+k+\"]\");P.remoteClose(w);break;case\"producerStats\":var S=e.id,I=e.stats,T=t._producers.get(S);if(!T)throw new Error(\"Producer not found [id:\"+S+\"]\");T.remoteStats(I);break;case\"newConsumer\":var C=e.peerName,R=t._peers.get(C);if(!R)throw new Error('no Peer found [name:\"'+C+'\"]');var x=e;t._handleConsumerData(x,R);break;case\"consumerClosed\":var A=e.id,E=e.peerName,D=e.appData,O=t._peers.get(E);if(!O)throw new Error('no Peer found [name:\"'+E+'\"]');var L=O.getConsumerById(A);if(!L)throw new Error(\"Consumer not found [id:\"+A+\"]\");L.remoteClose(D);break;case\"consumerPaused\":var j=e.id,M=e.peerName,B=e.appData,V=t._peers.get(M);if(!V)throw new Error('no Peer found [name:\"'+M+'\"]');var N=V.getConsumerById(j);if(!N)throw new Error(\"Consumer not found [id:\"+j+\"]\");N.remotePause(B);break;case\"consumerResumed\":var F=e.id,U=e.peerName,G=e.appData,W=t._peers.get(U);if(!W)throw new Error('no Peer found [name:\"'+U+'\"]');var K=W.getConsumerById(F);if(!K)throw new Error(\"Consumer not found [id:\"+F+\"]\");K.remoteResume(G);break;case\"consumerPreferredProfileSet\":var z=e.id,q=e.peerName,H=e.profile,J=t._peers.get(q);if(!J)throw new Error('no Peer found [name:\"'+q+'\"]');var Q=J.getConsumerById(z);if(!Q)throw new Error(\"Consumer not found [id:\"+z+\"]\");Q.remoteSetPreferredProfile(H);break;case\"consumerEffectiveProfileChanged\":var Y=e.id,$=e.peerName,X=e.profile,Z=t._peers.get($);if(!Z)throw new Error('no Peer found [name:\"'+$+'\"]');var ee=Z.getConsumerById(Y);if(!ee)throw new Error(\"Consumer not found [id:\"+Y+\"]\");ee.remoteEffectiveProfileChanged(X);break;case\"consumerStats\":var te=e.id,re=e.peerName,ne=e.stats,ae=t._peers.get(re);if(!ae)throw new Error('no Peer found [name:\"'+re+'\"]');var ie=ae.getConsumerById(te);if(!ie)throw new Error(\"Consumer not found [id:\"+te+\"]\");ie.remoteStats(ne);break;default:throw new Error('unknown notification method \"'+r+'\"')}})).catch((function(t){S.error(\"receiveNotification() failed [notification:%o]: %s\",e,t)}))}},{key:\"_sendRequest\",value:function(e,t){var r=this,n=(0,a.default)({method:e,target:\"peer\"},t);return this.closed?(S.error(\"_sendRequest() | Room closed [method:%s, request:%o]\",e,n),s.default.reject(new v.InvalidStateError(\"Room closed\"))):(S.debug(\"_sendRequest() [method:%s, request:%o]\",e,n),new s.default((function(t,a){var i=!1,o=setTimeout((function(){S.error(\"request failed [method:%s]: timeout\",e),i=!0,a(new v.TimeoutError(\"timeout\"))}),r._settings.requestTimeout);r.safeEmit(\"request\",n,(function(n){if(!i){if(i=!0,clearTimeout(o),r.closed)return S.error(\"request failed [method:%s]: Room closed\",e),void a(new Error(\"Room closed\"));S.debug(\"request succeeded [method:%s, response:%o]\",e,n),t(n)}}),(function(t){if(!i){if(i=!0,clearTimeout(o),r.closed)return S.error(\"request failed [method:%s]: Room closed\",e),void a(new Error(\"Room closed\"));t instanceof Error||(t=new Error(String(t))),S.error(\"request failed [method:%s]:%o\",e,t),a(t)}}))})))}},{key:\"_sendNotification\",value:function(e,t){if(!this.closed){var r=(0,a.default)({method:e,target:\"peer\",notification:!0},t);S.debug(\"_sendNotification() [method:%s, notification:%o]\",e,r),this.safeEmit(\"notify\",r)}}},{key:\"_handlePeerData\",value:function(e){var t=this,r=e.name,n=e.consumers,a=e.appData,i=new k.default(r,a);this._peers.set(i.name,i),i.on(\"@close\",(function(){t._peers.delete(i.name)}));var s=!0,c=!1,u=void 0;try{for(var d,l=(0,o.default)(n);!(s=(d=l.next()).done);s=!0){var p=d.value;try{this._handleConsumerData(p,i)}catch(e){S.error(\"error handling existing Consumer in Peer:%o\",e)}}}catch(e){c=!0,u=e}finally{try{!s&&l.return&&l.return()}finally{if(c)throw u}}this.joined&&this.safeEmit(\"newpeer\",i)}},{key:\"_handleConsumerData\",value:function(e,t){var r=e.id,n=e.kind,a=e.rtpParameters,i=e.paused,o=e.appData,s=new w.default(r,n,a,t,o);_.canReceive(s.rtpParameters,this._extendedRtpCapabilities)&&s.setSupported(!0),i&&s.remotePause(),t.addConsumer(s)}},{key:\"joined\",get:function(){return this._state===C}},{key:\"closed\",get:function(){return this._state===R}},{key:\"peerName\",get:function(){return this._peerName}},{key:\"transports\",get:function(){return(0,n.default)(this._transports.values())}},{key:\"producers\",get:function(){return(0,n.default)(this._producers.values())}},{key:\"peers\",get:function(){return(0,n.default)(this._peers.values())}}]),t}(h.default);t.default=x},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=h(r(6)),a=h(r(2)),i=h(r(0)),o=h(r(1)),s=h(r(3)),c=h(r(4)),u=h(r(5)),d=h(r(10)),l=r(52),p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(9)),f=h(r(80)),m=h(r(211));function h(e){return e&&e.__esModule?e:{default:e}}var v=new u.default(\"<Transport>\"),_=function(e){function t(e,r,n,o){(0,i.default)(this,t);var c=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).call(this,v));return v.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",e,r),c._id=p.randomNumber(),c._closed=!1,c._direction=e,c._settings=n,c._appData=o,c._statsEnabled=!1,c._commandQueue=new m.default,c._handler=new f.default.Handler(e,r,n),c._retryTime=0,c._iceRestartInterval=null,c._connectionState=\"new\",c._audioSent=!1,c._videoSent=!1,c._commandQueue.on(\"exec\",c._execCommand.bind(c)),c._handleHandler(),c}return(0,c.default)(t,e),(0,o.default)(t,[{key:\"close\",value:function(e){v.debug(\"close()\"),this._closed||(this._retryTime=0,this._closed=!0,this._audioSent=!1,this._videoSent=!1,this._statsEnabled&&(this._statsEnabled=!1,this.disableStats()),this.safeEmit(\"@notify\",\"closeTransport\",{id:this._id,appData:e}),this.emit(\"@close\"),this.safeEmit(\"close\",\"local\",e),this._destroy())}},{key:\"remoteClose\",value:function(e,t){var r=t.destroy;v.debug(\"remoteClose() [destroy:%s]\",r),this._closed||(r?(this._retryTime=0,this._closed=!0,this._audioSent=!1,this._videoSent=!1,this.emit(\"@close\"),this.safeEmit(\"close\",\"remote\",e),this._destroy()):this._handler.remoteClosed())}},{key:\"_destroy\",value:function(){this.closeRestartIce(),this._commandQueue.close(),this._handler.close()}},{key:\"closeRestartIce\",value:function(){this._iceRestartInterval&&clearInterval(this._iceRestartInterval),this._iceRestartInterval=null}},{key:\"attemptRestartIce\",value:function(){var e=this;\"connected\"!==this.connectionState&&(this.closed||(this.closeRestartIce(),this._retryTime=0,this._iceRestartInterval=setInterval((function(){return e.closed||\"connected\"===e.connectionState?(e.closeRestartIce(),void v.debug(\"attemptRestartIce() - id: \"+e.id+\" [FIN-END] _retryTime: \"+e._retryTime+\" closed: \"+e.closed+\" connectionState: \"+e.connectionState)):++e._retryTime>=15?(e.closeRestartIce(),v.debug(\"attemptRestartIce() - id: \"+e.id+\" [FIN-END] _retryTime: \"+e._retryTime+\" closed: \"+e.closed+\" connectionState: \"+e.connectionState),void e.safeEmit(\"restart-ice-fail\",{retryTime:e._retryTime})):(v.debug(\"attemptRestartIce() - retrying ... id: \"+e.id+\" _retryTime: \"+e._retryTime),void e.restartIce(null,(function(t){v.warn(\"attemptRestartIce() fail - id: \"+e.id+\" error - \"+t.toString())})))}),2e3)))}},{key:\"restartIce\",value:function(e,t){var r=this;v.debug(\"restartIce()\"),this._closed||\"new\"!==this._connectionState&&n.default.resolve().then((function(){r.safeEmit(\"restart-ice-trying\",{retryTime:r._retryTime});var e={id:r._id};return r.safeEmitAsPromise(\"@request\",\"restartTransport\",e)})).then((function(e){var t=e.iceParameters;return r._commandQueue.push(\"restartIce\",{remoteIceParameters:t})})).catch((function(e){t&&t(e)}))}},{key:\"enableStats\",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;v.debug(\"enableStats() [interval:%s]\",e),(\"number\"!=typeof e||e<1e3)&&(e=1e3),this._statsEnabled=!0;var t={id:this._id,interval:e};this.safeEmit(\"@notify\",\"enableTransportStats\",t)}},{key:\"disableStats\",value:function(){v.debug(\"disableStats()\"),this._statsEnabled=!1;var e={id:this._id};this.safeEmit(\"@notify\",\"disableTransportStats\",e)}},{key:\"_handleHandler\",value:function(){var e=this,t=this._handler;t.on(\"@connectionstatechange\",(function(t){\"connected\"===t&&(e._retryTime=0),e._connectionState!==t&&(v.debug(\"Transport connection state changed to [\"+t+\"]\"),e._connectionState=t,e._closed||e.safeEmit(\"connectionstatechange\",t))})),t.on(\"@needcreatetransport\",(function(t,r,n){var a={id:e._id,direction:e._direction,options:e._settings.transportOptions,appData:e._appData};t&&(t.dtlsParameters?a.dtlsParameters=t.dtlsParameters:t.plainRtpParameters&&(a.plainRtpParameters=t.plainRtpParameters)),e.safeEmit(\"@request\",\"createTransport\",a,r,n)})),t.on(\"@needupdatetransport\",(function(t){var r={id:e._id};t&&(t.dtlsParameters?r.dtlsParameters=t.dtlsParameters:t.plainRtpParameters&&(r.plainRtpParameters=t.plainRtpParameters)),e.safeEmit(\"@notify\",\"updateTransport\",r)})),t.on(\"@needupdateproducer\",(function(t,r){var n={id:t.id,rtpParameters:r};t.setRtpParameters(r),e.safeEmit(\"@notify\",\"updateProducer\",n)}))}},{key:\"addProducer\",value:function(e){return v.debug(\"addProducer() [producer:%o]\",e),this._closed?n.default.reject(new l.InvalidStateError(\"Transport closed\")):\"send\"!==this._direction?n.default.reject(new Error(\"not a sending Transport\")):this._commandQueue.push(\"addProducer\",{producer:e})}},{key:\"removeProducer\",value:function(e,t,r){v.debug(\"removeProducer() [producer:%o]\",e),this._closed||this._commandQueue.push(\"removeProducer\",{producer:e}).catch((function(){})),\"local\"===t&&this.safeEmit(\"@notify\",\"closeProducer\",{id:e.id,appData:r})}},{key:\"pauseProducer\",value:function(e,t){v.debug(\"pauseProducer() [producer:%o]\",e);var r={id:e.id,appData:t};this.safeEmit(\"@notify\",\"pauseProducer\",r)}},{key:\"resumeProducer\",value:function(e,t){v.debug(\"resumeProducer() [producer:%o]\",e);var r={id:e.id,appData:t};this.safeEmit(\"@notify\",\"resumeProducer\",r)}},{key:\"replaceProducerTrack\",value:function(e,t){return v.debug(\"replaceProducerTrack() [producer:%o]\",e),this._commandQueue.push(\"replaceProducerTrack\",{producer:e,track:t})}},{key:\"enableProducerStats\",value:function(e,t){v.debug(\"enableProducerStats() [producer:%o]\",e);var r={id:e.id,interval:t};this.safeEmit(\"@notify\",\"enableProducerStats\",r)}},{key:\"disableProducerStats\",value:function(e){v.debug(\"disableProducerStats() [producer:%o]\",e);var t={id:e.id};this.safeEmit(\"@notify\",\"disableProducerStats\",t)}},{key:\"addConsumer\",value:function(e){return v.debug(\"addConsumer() [consumer:%o]\",e),this._closed?n.default.reject(new l.InvalidStateError(\"Transport closed\")):\"recv\"!==this._direction?n.default.reject(new Error(\"not a receiving Transport\")):this._commandQueue.push(\"addConsumer\",{consumer:e})}},{key:\"removeConsumer\",value:function(e){v.debug(\"removeConsumer() [consumer:%o]\",e),this._commandQueue.push(\"removeConsumer\",{consumer:e}).catch((function(){}))}},{key:\"pauseConsumer\",value:function(e,t){v.debug(\"pauseConsumer() [consumer:%o]\",e);var r={id:e.id,appData:t};this.safeEmit(\"@notify\",\"pauseConsumer\",r)}},{key:\"resumeConsumer\",value:function(e,t){v.debug(\"resumeConsumer() [consumer:%o]\",e);var r={id:e.id,appData:t};this.safeEmit(\"@notify\",\"resumeConsumer\",r)}},{key:\"setConsumerPreferredProfile\",value:function(e,t){v.debug(\"setConsumerPreferredProfile() [consumer:%o]\",e);var r={id:e.id,profile:t};this.safeEmit(\"@notify\",\"setConsumerPreferredProfile\",r)}},{key:\"enableConsumerStats\",value:function(e,t){v.debug(\"enableConsumerStats() [consumer:%o]\",e);var r={id:e.id,interval:t};this.safeEmit(\"@notify\",\"enableConsumerStats\",r)}},{key:\"disableConsumerStats\",value:function(e){v.debug(\"disableConsumerStats() [consumer:%o]\",e);var t={id:e.id};this.safeEmit(\"@notify\",\"disableConsumerStats\",t)}},{key:\"remoteStats\",value:function(e){this.safeEmit(\"stats\",e)}},{key:\"getStats\",value:function(e){return this._handler.getPCStats(e)}},{key:\"removeTrack\",value:function(e){return this._handler.removeTrack(e)}},{key:\"audioSent\",value:function(){return this._audioSent}},{key:\"videoSent\",value:function(){return this._videoSent}},{key:\"updateTrack\",value:function(e,t){return this._handler.updateTrack(e,t)}},{key:\"_execCommand\",value:function(e,t){var r=void 0;try{switch(e.method){case\"addProducer\":var a=e.producer;r=this._execAddProducer(a);break;case\"removeProducer\":var i=e.producer;r=this._execRemoveProducer(i);break;case\"replaceProducerTrack\":var o=e.producer,s=e.track;r=this._execReplaceProducerTrack(o,s);break;case\"addConsumer\":var c=e.consumer;r=this._execAddConsumer(c);break;case\"removeConsumer\":var u=e.consumer;r=this._execRemoveConsumer(u);break;case\"restartIce\":var d=e.remoteIceParameters;r=this._execRestartIce(d);break;default:r=n.default.reject(new Error('unknown command method \"'+e.method+'\"'))}}catch(e){r=n.default.reject(e)}t.promise=r}},{key:\"_execAddProducer\",value:function(e){var t=this;v.debug(\"_execAddProducer()\");var r=void 0;return n.default.resolve().then((function(){return t._handler.addProducer(e)})).then((function(n){r=n;var a={id:e.id,kind:e.kind,transportId:t._id,rtpParameters:n,paused:e.locallyPaused,appData:e.appData};return t.safeEmitAsPromise(\"@request\",\"createProducer\",a)})).then((function(){e.setRtpParameters(r)}))}},{key:\"_execRemoveProducer\",value:function(e){return v.debug(\"_execRemoveProducer()\"),this._handler.removeProducer(e)}},{key:\"_execReplaceProducerTrack\",value:function(e,t){return v.debug(\"_execReplaceProducerTrack()\"),this._handler.replaceProducerTrack(e,t)}},{key:\"_execAddConsumer\",value:function(e){var t=this;v.debug(\"_execAddConsumer()\");var r=void 0;return n.default.resolve().then((function(){return t._handler.addConsumer(e)})).then((function(n){r=n;var a={id:e.id,transportId:t.id,paused:e.locallyPaused,preferredProfile:e.preferredProfile};return t.safeEmitAsPromise(\"@request\",\"enableConsumer\",a)})).then((function(t){var n=t.paused,a=t.preferredProfile,i=t.effectiveProfile;return n&&e.remotePause(),a&&e.remoteSetPreferredProfile(a),i&&e.remoteEffectiveProfileChanged(i),r}))}},{key:\"_execRemoveConsumer\",value:function(e){return v.debug(\"_execRemoveConsumer()\"),this._handler.removeConsumer(e)}},{key:\"_execRestartIce\",value:function(e){return v.debug(\"_execRestartIce()\"),this._handler.restartIce(e)}},{key:\"id\",get:function(){return this._id}},{key:\"closed\",get:function(){return this._closed}},{key:\"direction\",get:function(){return this._direction}},{key:\"appData\",get:function(){return this._appData}},{key:\"connectionState\",get:function(){return this._connectionState}},{key:\"retryTimes\",get:function(){return this._retryTime}},{key:\"handler\",get:function(){return this._handler}}]),t}(d.default);t.default=_},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=f(r(6)),a=f(r(61)),i=f(r(2)),o=f(r(0)),s=f(r(1)),c=f(r(3)),u=f(r(4)),d=r(29),l=f(r(5)),p=r(52);function f(e){return e&&e.__esModule?e:{default:e}}var m=new l.default(\"<CommandQueue>\"),h=function(e){function t(){(0,o.default)(this,t);var e=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return e.setMaxListeners(1/0),e._closed=!1,e._busy=!1,e._queue=[],e}return(0,u.default)(t,e),(0,s.default)(t,[{key:\"close\",value:function(){this._closed=!0}},{key:\"push\",value:function(e,t){var r=this,i=(0,a.default)({method:e},t);return m.debug(\"push() [method:%s]\",e),new n.default((function(e,t){var n=r._queue;i.resolve=e,i.reject=t,n.push(i),r._handlePendingCommands()}))}},{key:\"_handlePendingCommands\",value:function(){var e=this;if(!this._busy){var t=this._queue,r=t[0];r&&(this._busy=!0,this._handleCommand(r).then((function(){e._busy=!1,t.shift(),e._handlePendingCommands()})))}}},{key:\"_handleCommand\",value:function(e){var t=this;if(m.debug(\"_handleCommand() [method:%s]\",e.method),this._closed)return e.reject(new p.InvalidStateError(\"closed\")),n.default.resolve();var r={promise:null};return this.emit(\"exec\",e,r),n.default.resolve().then((function(){return r.promise})).then((function(r){m.debug(\"_handleCommand() | command succeeded [method:%s]\",e.method),t._closed?e.reject(new p.InvalidStateError(\"closed\")):e.resolve(r)})).catch((function(t){m.error(\"_handleCommand() | command failed [method:%s]: %o\",e.method,t),e.reject(t)}))}}]),t}(d.EventEmitter);t.default=h},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=v(r(24)),a=v(r(6)),i=v(r(61)),o=v(r(26)),s=v(r(2)),c=v(r(0)),u=v(r(1)),d=v(r(3)),l=v(r(4)),p=v(r(5)),f=v(r(10)),m=r(52),h=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(9));function v(e){return e&&e.__esModule?e:{default:e}}var _={low:1e5,medium:3e5,high:15e5},g=new p.default(\"<Producer>\"),y=function(e){function t(e,r,n){(0,c.default)(this,t);var a=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this,g));a._id=h.randomNumber(),a._closed=!1,a._originalTrack=e;try{a._track=e.clone()}catch(t){a._track=e}return a._appData=n,a._simulcast=!1,\"object\"===(0,o.default)(r.simulcast)?a._simulcast=(0,i.default)({},_,r.simulcast):!0===r.simulcast&&(a._simulcast=(0,i.default)({},_)),a._audioProfile=null,\"object\"==(0,o.default)(r.audioProfile)&&(a._audioProfile=r.audioProfile),a._videoBitrateOptions=null,\"object\"===(0,o.default)(r.codecOptions)&&(a._videoBitrateOptions=r.codecOptions),a._transport=null,a._rtpParameters=null,a._locallyPaused=!a._track.enabled,a._remotelyPaused=!1,a._statsEnabled=!1,a._statsInterval=1e3,a._handleTrack(),a}return(0,l.default)(t,e),(0,u.default)(t,[{key:\"close\",value:function(e){g.debug(\"close()\"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.transport&&this.transport.disableProducerStats(this)),this._transport&&this._transport.removeProducer(this,\"local\",e),this._destroy(),this.emit(\"@close\",\"local\",e),this.safeEmit(\"close\",\"local\",e))}},{key:\"remoteClose\",value:function(e){g.debug(\"remoteClose()\"),this._closed||(this._closed=!0,this._transport&&this._transport.removeProducer(this,\"remote\",e),this._destroy(),this.emit(\"@close\",\"remote\",e),this.safeEmit(\"close\",\"remote\",e))}},{key:\"_destroy\",value:function(){this._transport=!1,this._rtpParameters=null;try{this._track.stop()}catch(e){}}},{key:\"send\",value:function(e){var t=this;return g.debug(\"send() [transport:%o]\",e),this._closed?a.default.reject(new m.InvalidStateError(\"Producer closed\")):this._transport?a.default.reject(new Error(\"already handled by a Transport\")):\"object\"!==(void 0===e?\"undefined\":(0,o.default)(e))?a.default.reject(new TypeError(\"invalid Transport\")):(\"audio\"===this._originalTrack.kind?e._audioSent=!0:\"video\"===this._originalTrack.kind&&(e._videoSent=!0),this._transport=e,e.addProducer(this).then((function(){e.once(\"@close\",(function(){t._closed||t._transport!==e||(t._transport.removeProducer(t,\"local\"),t._transport=null,t._rtpParameters=null,t.safeEmit(\"unhandled\"))})),t.safeEmit(\"handled\"),t._statsEnabled&&e.enableProducerStats(t,t._statsInterval)})).catch((function(e){throw t._transport=null,e})))}},{key:\"pause\",value:function(e){return g.debug(\"pause()\"),!this._closed&&(!!this._locallyPaused||(this._locallyPaused=!0,this._track.enabled=!1,this._transport&&this._transport.pauseProducer(this,e),this.safeEmit(\"pause\",\"local\",e),this.paused))}},{key:\"remotePause\",value:function(e){g.debug(\"remotePause()\"),this._closed||this._remotelyPaused||(this._remotelyPaused=!0,this._track.enabled=!1,this.safeEmit(\"pause\",\"remote\",e))}},{key:\"resume\",value:function(e){return g.debug(\"resume()\"),!this._closed&&(!this._locallyPaused||(this._locallyPaused=!1,this._remotelyPaused||(this._track.enabled=!0),this._transport&&this._transport.resumeProducer(this,e),this.safeEmit(\"resume\",\"local\",e),!this.paused))}},{key:\"remoteResume\",value:function(e){g.debug(\"remoteResume()\"),!this._closed&&this._remotelyPaused&&(this._remotelyPaused=!1,this._locallyPaused||(this._track.enabled=!0),this.safeEmit(\"resume\",\"remote\",e))}},{key:\"stopTrack\",value:function(){g.debug(\"stopTrack() \");try{this._track.onended=null,this._track.stop()}catch(e){g.debug(\"stopTrack() fail - \"+e.toString())}}},{key:\"replaceTrack\",value:function(e){var t=this;if(g.debug(\"replaceTrack() [track:%o]\",e),this._closed)return a.default.reject(new m.InvalidStateError(\"Producer closed\"));if(!e)return a.default.reject(new TypeError(\"no track given\"));if(\"ended\"===e.readyState)return a.default.reject(new Error(\"track.readyState is [ended]\"));var r=void 0;try{r=e.clone()}catch(t){r=e}return a.default.resolve().then((function(){if(t._transport)return t._transport.replaceProducerTrack(t,r)})).then((function(){try{t._track.onended=null,t._track.stop()}catch(e){g.debug(\"replaceTrack() fail - \"+e.toString())}return t.paused?r.enabled=!1:r.enabled=!0,t._originalTrack=e,t._track=r,t._handleTrack(),t._track}))}},{key:\"updateTrack\",value:function(e,t,r){var a=this;this._track.applyConstraints(t).then((function(){g.debug(\"updateTrack() track.applyConstraints ok -- constraints: \"+(0,n.default)(t)),a.setCodecOption(r),a._transport.updateTrack(a,e)})).catch((function(e){g.warn(\"updateTrack() error - track.applyConstraints failed - \"+e.toString())}))}},{key:\"setCodecOption\",value:function(e){this._videoBitrateOptions={videoGoogleStartBitrate:e.idealBandwidth,videoGoogleMaxBitrate:e.maxBandwidth,videoGoogleMinBitrate:e.minBandwidth}}},{key:\"setRtpParameters\",value:function(e){this._rtpParameters=e}},{key:\"enableStats\",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;g.debug(\"enableStats() [interval:%s]\",e),this._closed||this._statsEnabled||(this._statsInterval=\"number\"!=typeof e||e<1e3?1e3:e,this._statsEnabled=!0,this._transport&&this._transport.enableProducerStats(this,this._statsInterval))}},{key:\"disableStats\",value:function(){this._closed||this._statsEnabled&&(this._statsEnabled=!1,this._transport&&this._transport.disableProducerStats(this))}},{key:\"enableInternalStats\",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;g.debug(\"enableInternalStats() [interval:%s]\",t),this._closed||this._internalStatsEnabled||(\"number\"!=typeof t||t<1e3?this._interanlStatsInterval=1e3:this._statsInterval=t,this._internalStatsEnabled=!0,this._transport&&(this._internalTimer=setInterval((function(){return e.getStats().then((function(t){e.emit(\"internalStats\",t)}))}),t)))}},{key:\"disableInternalStats\",value:function(){this._internalStatsEnabled&&clearInterval(this._internalTimer),this._internalTimer=null,this._internalStatsEnabled=!1}},{key:\"remoteStats\",value:function(e){this.safeEmit(\"stats\",e)}},{key:\"getStats\",value:function(){return this.transport.getStats(this.track)}},{key:\"_handleTrack\",value:function(){var e=this;this._track.onended=function(){e._closed||(g.warn('track \"ended\" event'),e.safeEmit(\"trackended\"))}}},{key:\"id\",get:function(){return this._id}},{key:\"closed\",get:function(){return this._closed}},{key:\"kind\",get:function(){return this._track.kind}},{key:\"track\",get:function(){return this._track}},{key:\"originalTrack\",get:function(){return this._originalTrack}},{key:\"simulcast\",get:function(){return this._simulcast}},{key:\"appData\",get:function(){return this._appData}},{key:\"transport\",get:function(){return this._transport}},{key:\"rtpParameters\",get:function(){return this._rtpParameters}},{key:\"locallyPaused\",get:function(){return this._locallyPaused}},{key:\"remotelyPaused\",get:function(){return this._remotelyPaused}},{key:\"paused\",get:function(){return this._locallyPaused||this._remotelyPaused}},{key:\"videoBitrateOptions\",get:function(){return this._videoBitrateOptions}},{key:\"audioProfile\",get:function(){return this._audioProfile}}]),t}(f.default);t.default=y},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=f(r(16)),a=f(r(17)),i=f(r(8)),o=f(r(2)),s=f(r(0)),c=f(r(1)),u=f(r(3)),d=f(r(4)),l=f(r(5)),p=f(r(10));function f(e){return e&&e.__esModule?e:{default:e}}var m=new l.default(\"<Peer>\"),h=function(e){function t(e,r){(0,s.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,o.default)(t)).call(this,m));return n._name=e,n._closed=!1,n._appData=r,n._consumers=new i.default,n}return(0,d.default)(t,e),(0,c.default)(t,[{key:\"close\",value:function(){if(m.debug(\"close()\"),!this._closed){this._closed=!0,this.emit(\"@close\"),this.safeEmit(\"close\",\"local\");var e=!0,t=!1,r=void 0;try{for(var n,i=(0,a.default)(this._consumers.values());!(e=(n=i.next()).done);e=!0){n.value.close()}}catch(e){t=!0,r=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw r}}}}},{key:\"remoteClose\",value:function(e){if(m.debug(\"remoteClose()\"),!this._closed){this._closed=!0,this.emit(\"@close\"),this.safeEmit(\"close\",\"remote\",e);var t=!0,r=!1,n=void 0;try{for(var i,o=(0,a.default)(this._consumers.values());!(t=(i=o.next()).done);t=!0){i.value.remoteClose()}}catch(e){r=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(r)throw n}}}}},{key:\"getConsumerById\",value:function(e){return this._consumers.get(e)}},{key:\"addConsumer\",value:function(e){var t=this;if(this._consumers.has(e.id))throw new Error(\"Consumer already exists [id:\"+e.id+\"]\");this._consumers.set(e.id,e),e.on(\"@close\",(function(){t._consumers.delete(e.id)})),this.safeEmit(\"newconsumer\",e)}},{key:\"name\",get:function(){return this._name}},{key:\"closed\",get:function(){return this._closed}},{key:\"appData\",get:function(){return this._appData}},{key:\"consumers\",get:function(){return(0,n.default)(this._consumers.values())}}]),t}(p.default);t.default=h},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=m(r(26)),a=m(r(6)),i=m(r(2)),o=m(r(0)),s=m(r(1)),c=m(r(3)),u=m(r(4)),d=m(r(19)),l=m(r(5)),p=m(r(10)),f=r(52);function m(e){return e&&e.__esModule?e:{default:e}}var h=new d.default([\"default\",\"low\",\"medium\",\"high\"]),v=new l.default(\"Consumer\"),_=function(e){function t(e,r,n,a,s){(0,o.default)(this,t);var u=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,v));return u._id=e,u._closed=!1,u._kind=r,u._rtpParameters=n,u._peer=a,u._appData=s,u._supported=!1,u._transport=null,u._track=null,u._locallyPaused=!1,u._remotelyPaused=!1,u._statsEnabled=!1,u._statsInterval=1e3,u._preferredProfile=\"default\",u._effectiveProfile=null,u}return(0,u.default)(t,e),(0,s.default)(t,[{key:\"close\",value:function(){v.debug(\"close()\"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.transport&&this.transport.disableConsumerStats(this)),this.emit(\"@close\"),this.safeEmit(\"close\",\"local\"),this._destroy())}},{key:\"remoteClose\",value:function(){v.debug(\"remoteClose()\"),this._closed||(this._closed=!0,this._transport&&this._transport.removeConsumer(this),this._destroy(),this.emit(\"@close\"),this.safeEmit(\"close\",\"remote\"))}},{key:\"_destroy\",value:function(){this._transport=null;try{this._track.stop()}catch(e){}this._track=null}},{key:\"receive\",value:function(e){var t=this;return v.debug(\"receive() [transport:%o]\",e),this._closed?a.default.reject(new f.InvalidStateError(\"Consumer closed\")):this._supported?this._transport?a.default.reject(new Error(\"already handled by a Transport\")):\"object\"!==(void 0===e?\"undefined\":(0,n.default)(e))?a.default.reject(new TypeError(\"invalid Transport\")):(this._transport=e,e.addConsumer(this).then((function(r){return t._track=r,t.paused&&(r.enabled=!1),e.once(\"@close\",(function(){if(!t._closed&&t._transport===e){t._transport=null;try{t._track.stop()}catch(e){}t._track=null,t.safeEmit(\"unhandled\")}})),t.safeEmit(\"handled\"),t._statsEnabled&&e.enableConsumerStats(t,t._statsInterval),r})).catch((function(e){throw t._transport=null,e}))):a.default.reject(new Error(\"unsupported codecs\"))}},{key:\"pause\",value:function(e){return v.debug(\"pause()\"),!this._closed&&(!!this._locallyPaused||(this._locallyPaused=!0,this._track&&(this._track.enabled=!1),this._transport&&this._transport.pauseConsumer(this,e),this.safeEmit(\"pause\",\"local\",e),this.paused))}},{key:\"remotePause\",value:function(e){v.debug(\"remotePause()\"),this._closed||this._remotelyPaused||(this._remotelyPaused=!0,this._track&&(this._track.enabled=!1),this.safeEmit(\"pause\",\"remote\",e))}},{key:\"resume\",value:function(e){return v.debug(\"resume()\"),!this._closed&&(!this._locallyPaused||(this._locallyPaused=!1,this._track&&!this._remotelyPaused&&(this._track.enabled=!0),this._transport&&this._transport.resumeConsumer(this,e),this.safeEmit(\"resume\",\"local\",e),!this.paused))}},{key:\"remoteResume\",value:function(e){v.debug(\"remoteResume()\"),!this._closed&&this._remotelyPaused&&(this._remotelyPaused=!1,this._track&&!this._locallyPaused&&(this._track.enabled=!0),this.safeEmit(\"resume\",\"remote\",e))}},{key:\"setPreferredProfile\",value:function(e){v.debug(\"setPreferredProfile() [profile:%s]\",e),this._closed?v.warn(\"setPreferredProfile() | Consumer closed\"):e!==this._preferredProfile&&(h.has(e)?(this._preferredProfile=e,this._transport&&this._transport.setConsumerPreferredProfile(this,this._preferredProfile)):v.error('setPreferredProfile() | invalid profile \"%s\"',e))}},{key:\"remoteSetPreferredProfile\",value:function(e){v.debug(\"remoteSetPreferredProfile() [profile:%s]\",e),this._closed||e===this._preferredProfile||(this._preferredProfile=e)}},{key:\"remoteEffectiveProfileChanged\",value:function(e){v.debug(\"remoteEffectiveProfileChanged() [profile:%s]\",e),this._closed||e===this._effectiveProfile||(this._effectiveProfile=e,this.safeEmit(\"effectiveprofilechange\",this._effectiveProfile))}},{key:\"enableStats\",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;v.debug(\"enableStats() [interval:%s]\",e),this._closed||this._statsEnabled||(this._statsInterval=\"number\"!=typeof e||e<1e3?1e3:e,this._statsEnabled=!0,this._transport&&this._transport.enableConsumerStats(this,this._statsInterval))}},{key:\"disableStats\",value:function(){this._closed||this._statsEnabled&&(this._statsEnabled=!1,this._transport&&this._transport.disableConsumerStats(this))}},{key:\"setSupported\",value:function(e){this._supported=e}},{key:\"remoteStats\",value:function(e){this.safeEmit(\"stats\",e)}},{key:\"getStats\",value:function(e){return this.transport.getStats(e)}},{key:\"enableInternalStats\",value:function(e){var t=this,r=e>0&&void 0!==e?e:1e3;this._closed||this._internalStatsEnabled||(this._interanlStatsInterval=\"number\"!=typeof r||r<1e3?1e3:r,this._internalStatsEnabled=!0,this._transport&&(this._internalTimer=setInterval((function(){return t.getStats().then((function(e){t.emit(\"internalStats\",e)}))}),r)))}},{key:\"disableInternalStats\",value:function(){this._internalStatsEnabled&&clearInterval(this._internalTimer),this._internalTimer=null,this._internalStatsEnabled=!1}},{key:\"id\",get:function(){return this._id}},{key:\"closed\",get:function(){return this._closed}},{key:\"kind\",get:function(){return this._kind}},{key:\"rtpParameters\",get:function(){return this._rtpParameters}},{key:\"peer\",get:function(){return this._peer}},{key:\"appData\",get:function(){return this._appData}},{key:\"supported\",get:function(){return this._supported}},{key:\"transport\",get:function(){return this._transport}},{key:\"track\",get:function(){return this._track}},{key:\"locallyPaused\",get:function(){return this._locallyPaused}},{key:\"remotelyPaused\",get:function(){return this._remotelyPaused}},{key:\"paused\",get:function(){return this._locallyPaused||this._remotelyPaused}},{key:\"preferredProfile\",get:function(){return this._preferredProfile}},{key:\"effectiveProfile\",get:function(){return this._effectiveProfile}}]),t}(p.default);t.default=_},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.RemotePlainRtpSdp=t.RemotePlanBSdp=t.RemoteUnifiedPlanSdp=t.sdpPlainRtpUtils=t.sdpPlanBUtils=t.sdpUnifiedPlanUtils=t.sdpCommonUtils=t.ortc=t.utils=t.EnhancedEventEmitter=t.Logger=void 0;var n=h(r(5)),a=h(r(10)),i=m(r(9)),o=m(r(15)),s=m(r(20)),c=m(r(35)),u=m(r(41)),d=m(r(216)),l=h(r(36)),p=h(r(42)),f=h(r(217));function m(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function h(e){return e&&e.__esModule?e:{default:e}}t.Logger=n.default,t.EnhancedEventEmitter=a.default,t.utils=i,t.ortc=o,t.sdpCommonUtils=s,t.sdpUnifiedPlanUtils=c,t.sdpPlanBUtils=u,t.sdpPlainRtpUtils=d,t.RemoteUnifiedPlanSdp=l.default,t.RemotePlanBSdp=p.default,t.RemotePlainRtpSdp=f.default},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.extractPlainRtpParametersByKind=function(e,t){var r=(e.media||[]).find((function(e){return e.type===t}));if(!r)throw new Error(\"m=\"+t+\" section not found\");return{ip:e.connection.ip,port:r.port}},t.fillRtpParametersForKind=function(e,t,r){var n={cname:null,reducedSize:!0,mux:!0},a=(t.media||[]).find((function(e){return e.type===r}));if(!a)throw new Error(\"m=\"+r+\" section not found\");var i=(a.ssrcs||[]).find((function(e){return\"cname\"===e.attribute})),o=void 0;i&&(o=i.id,n.cname=i.value);e.rtcp=n,e.encodings=[];var s={ssrc:o};e.encodings.push(s)}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=f(r(40)),a=f(r(17)),i=f(r(2)),o=f(r(3)),s=f(r(4)),c=f(r(0)),u=f(r(1)),d=f(r(12)),l=f(r(5)),p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(9));function f(e){return e&&e.__esModule?e:{default:e}}var m=new l.default(\"<RemotePlainRtpSdp>\"),h=function(){function e(t){(0,c.default)(this,e),this._rtpParametersByKind=t,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:p.randomNumber(),version:0}}return(0,u.default)(e,[{key:\"setTransportLocalParameters\",value:function(e){m.debug(\"setTransportLocalParameters() [transportLocalParameters:%o]\",e),this._transportLocalParameters=e}},{key:\"setTransportRemoteParameters\",value:function(e){m.debug(\"setTransportRemoteParameters() [transportRemoteParameters:%o]\",e),this._transportRemoteParameters=e}}]),e}(),v=function(e){function t(e){return(0,c.default)(this,t),(0,o.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,u.default)(t,[{key:\"createAnswerSdp\",value:function(e){if(m.debug(\"createAnswerSdp()\"),!this._transportLocalParameters)throw new Error(\"no transport local parameters\");if(!this._transportRemoteParameters)throw new Error(\"no transport remote parameters\");var t=this._transportRemoteParameters.plainRtpParameters,r={},i=(e.media||[]).filter((function(e){return e.hasOwnProperty(\"mid\")})).map((function(e){return String(e.mid)}));this._sdpGlobalFields.version++,r.version=0,r.origin={address:t.ip,ipVer:t.version,netType:\"IN\",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:\"mediasoup-client\"},r.name=\"-\",r.timing={start:0,stop:0},r.msidSemantic={semantic:\"WMS\",token:\"*\"},i.length>0&&(r.groups=[{type:\"BUNDLE\",mids:i.join(\" \")}]),r.media=[];var o=!0,s=!1,c=void 0;try{for(var u,l=(0,a.default)(e.media||[]);!(o=(u=l.next()).done);o=!0){var p=u.value,f=\"inactive\"===p.direction,h=p.type,v=this._rtpParametersByKind[h].codecs,_=this._rtpParametersByKind[h].headerExtensions,g={};switch(g.type=p.type,g.port=t.port,g.protocol=\"RTP/AVP\",g.connection={ip:t.ip,version:t.version},g.mid=p.mid,p.direction){case\"sendrecv\":case\"sendonly\":g.direction=\"recvonly\";break;case\"recvonly\":case\"inactive\":g.direction=\"inactive\"}g.rtp=[],g.rtcpFb=[],g.fmtp=[];var y=!0,b=!1,k=void 0;try{for(var w,P=(0,a.default)(v);!(y=(w=P.next()).done);y=!0){var S=w.value,I={payload:S.payloadType,codec:S.name,rate:S.clockRate};if(S.channels>1&&(I.encoding=S.channels),g.rtp.push(I),S.parameters){var T={payload:S.payloadType,config:\"\"},C=!0,R=!1,x=void 0;try{for(var A,E=(0,a.default)((0,n.default)(S.parameters));!(C=(A=E.next()).done);C=!0){var D=A.value;T.config&&(T.config+=\";\"),T.config+=D+\"=\"+S.parameters[D]}}catch(e){R=!0,x=e}finally{try{!C&&E.return&&E.return()}finally{if(R)throw x}}T.config&&g.fmtp.push(T)}if(S.rtcpFeedback){var O=!0,L=!1,j=void 0;try{for(var M,B=(0,a.default)(S.rtcpFeedback);!(O=(M=B.next()).done);O=!0){var V=M.value;g.rtcpFb.push({payload:S.payloadType,type:V.type,subtype:V.parameter||\"\"})}}catch(e){L=!0,j=e}finally{try{!O&&B.return&&B.return()}finally{if(L)throw j}}}}}catch(e){b=!0,k=e}finally{try{!y&&P.return&&P.return()}finally{if(b)throw k}}if(g.payloads=v.map((function(e){return e.payloadType})).join(\" \"),!f){g.ext=[];var N=!0,F=!1,U=void 0;try{for(var G,W=function(){var e=G.value;if(!(p.ext||[]).find((function(t){return t.uri===e.uri})))return\"continue\";g.ext.push({uri:e.uri,value:e.id})},K=(0,a.default)(_);!(N=(G=K.next()).done);N=!0)W()}catch(e){F=!0,U=e}finally{try{!N&&K.return&&K.return()}finally{if(F)throw U}}}if(p.simulcast_03){g.simulcast_03={value:p.simulcast_03.value.replace(/send/g,\"recv\")},g.rids=[];var z=!0,q=!1,H=void 0;try{for(var J,Q=(0,a.default)(p.rids||[]);!(z=(J=Q.next()).done);z=!0){var Y=J.value;\"send\"===Y.direction&&g.rids.push({id:Y.id,direction:\"recv\"})}}catch(e){q=!0,H=e}finally{try{!z&&Q.return&&Q.return()}finally{if(q)throw H}}}g.rtcpMux=\"rtcp-mux\",g.rtcpRsize=\"rtcp-rsize\",r.media.push(g)}}catch(e){s=!0,c=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw c}}return d.default.write(r)}}]),t}(h),_=function(e){function t(e){return(0,c.default)(this,t),(0,o.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e))}return(0,s.default)(t,e),(0,u.default)(t,[{key:\"createOfferSdp\",value:function(e){if(m.debug(\"createOfferSdp()\"),!this._transportRemoteParameters)throw new Error(\"no transport remote parameters\");var t=this._transportRemoteParameters.plainRtpParameters,r={},i=e.map((function(e){return String(e.mid)}));this._sdpGlobalFields.version++,r.version=0,r.origin={address:t.ip,ipVer:t.version,netType:\"IN\",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:\"mediasoup-client\"},r.name=\"-\",r.timing={start:0,stop:0},r.msidSemantic={semantic:\"WMS\",token:\"*\"},i.length>0&&(r.groups=[{type:\"BUNDLE\",mids:i.join(\" \")}]),r.media=[];var o=!0,s=!1,c=void 0;try{for(var u,l=(0,a.default)(e);!(o=(u=l.next()).done);o=!0){var p=u.value,f=p.closed,h=p.kind,v=this._rtpParametersByKind[h].codecs,_=this._rtpParametersByKind[h].headerExtensions,g={};g.type=h,g.mid=p.mid,g.msid=p.streamId+\" \"+p.trackId,g.port=t.port,g.protocol=\"RTP/AVP\",g.connection={ip:t.ip,version:t.version},g.direction=f?\"inactive\":\"sendonly\",g.rtp=[],g.rtcpFb=[],g.fmtp=[];var y=!0,b=!1,k=void 0;try{for(var w,P=(0,a.default)(v);!(y=(w=P.next()).done);y=!0){var S=w.value,I={payload:S.payloadType,codec:S.name,rate:S.clockRate};if(S.channels>1&&(I.encoding=S.channels),g.rtp.push(I),S.parameters){var T={payload:S.payloadType,config:\"\"},C=!0,R=!1,x=void 0;try{for(var A,E=(0,a.default)((0,n.default)(S.parameters));!(C=(A=E.next()).done);C=!0){var D=A.value;T.config&&(T.config+=\";\"),T.config+=D+\"=\"+S.parameters[D]}}catch(e){R=!0,x=e}finally{try{!C&&E.return&&E.return()}finally{if(R)throw x}}T.config&&g.fmtp.push(T)}if(S.rtcpFeedback){var O=!0,L=!1,j=void 0;try{for(var M,B=(0,a.default)(S.rtcpFeedback);!(O=(M=B.next()).done);O=!0){var V=M.value;g.rtcpFb.push({payload:S.payloadType,type:V.type,subtype:V.parameter||\"\"})}}catch(e){L=!0,j=e}finally{try{!O&&B.return&&B.return()}finally{if(L)throw j}}}}}catch(e){b=!0,k=e}finally{try{!y&&P.return&&P.return()}finally{if(b)throw k}}if(g.payloads=v.map((function(e){return e.payloadType})).join(\" \"),!f){g.ext=[];var N=!0,F=!1,U=void 0;try{for(var G,W=(0,a.default)(_);!(N=(G=W.next()).done);N=!0){var K=G.value;\"urn:ietf:params:rtp-hdrext:sdes:mid\"!==K.uri&&g.ext.push({uri:K.uri,value:K.id})}}catch(e){F=!0,U=e}finally{try{!N&&W.return&&W.return()}finally{if(F)throw U}}}g.rtcpMux=\"rtcp-mux\",g.rtcpRsize=\"rtcp-rsize\",f||(g.ssrcs=[],g.ssrcGroups=[],g.ssrcs.push({id:p.ssrc,attribute:\"cname\",value:p.cname}),p.rtxSsrc&&(g.ssrcs.push({id:p.rtxSsrc,attribute:\"cname\",value:p.cname}),g.ssrcGroups.push({semantics:\"FID\",ssrcs:p.ssrc+\" \"+p.rtxSsrc}))),r.media.push(g)}}catch(e){s=!0,c=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw c}}return d.default.write(r)}}]),t}(h);t.default=function e(t,r){switch((0,c.default)(this,e),m.debug(\"constructor() [direction:%s, rtpParametersByKind:%o]\",t,r),t){case\"send\":return new v(r);case\"recv\":return new _(r)}}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.WebSocketTransport=t.Peer=void 0;var n=i(r(219)),a=i(r(117));function i(e){return e&&e.__esModule?e:{default:e}}t.Peer=n.default,t.WebSocketTransport=a.default},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=h(r(24)),a=h(r(6)),i=h(r(8)),o=h(r(2)),s=h(r(0)),c=h(r(1)),u=h(r(3)),d=h(r(4)),l=r(29),p=h(r(30)),f=h(r(115)),m=h(r(117));function h(e){return e&&e.__esModule?e:{default:e}}var v=new p.default(\"<protooPeer>\"),_=function(e){function t(e,r,n){(0,s.default)(this,t),v.debug(\"constructor() protooUrl: \"+e);var a=(0,u.default)(this,(t.__proto__||(0,o.default)(t)).call(this));a.setMaxListeners(1/0),a._sessionId=r,a._protooUrl=e;var c={retries:n||10,factor:2,minTimeout:1e3,maxTimeout:4e3};return a._transport=new m.default(e,{retry:c}),a._closed=!1,a._connected=!1,a._data={},a._requestHandlers=new i.default,a._handleTransport(),a}return(0,d.default)(t,e),(0,c.default)(t,[{key:\"send\",value:function(e,t){var r=this;if(this.connected){var n=f.default.requestFactory(e,t);return this._transport.send(n).then((function(){return new a.default((function(e,t){var a={resolve:function(t){r._requestHandlers.delete(n.id)&&(clearTimeout(a.timer),e(t))},reject:function(e){r._requestHandlers.delete(n.id)&&(clearTimeout(a.timer),t(e))},timer:setTimeout((function(){r._requestHandlers.delete(n.id)&&(r.closed||t(new Error(\"request timeout\")))}),2e4),close:function(){clearTimeout(a.timer),t(new Error(\"peer closed\"))}};r._requestHandlers.set(n.id,a)}))}))}}},{key:\"notify\",value:function(e,t){if(this.connected){var r=f.default.notificationFactory(e,t);return this._transport.send(r)}}},{key:\"close\",value:function(){v.debug(\"close()\"),this._closed||(this._closed=!0,this._transport.close(),this._requestHandlers.forEach((function(e){return e.close()})),this.emit(\"close\",{sid:this._sessionId}))}},{key:\"_handleTransport\",value:function(){var e=this;if(this._transport.closed)return this._closed=!0,void setTimeout((function(){return e.emit(\"close\",{sid:e._sessionId})}));this._transport.on(\"connecting\",(function(t){v.debug(\"_handleTransport() _transport event [connecting] - [currentAttempt: \"+t+\"]\"),e.emit(\"connecting\",{sid:e._sessionId,currentAttempt:t})})),this._transport.on(\"open\",(function(){e._closed||(v.debug(\"_handleTransport() _transport event [open]\"),e._connected=!0,e.emit(\"open\",{sid:e._sessionId}))})),this._transport.on(\"conn-interrupt\",(function(){e._closed||(v.debug(\"_handleTransport() _transport event [conn-interrupt]\"),e._connected=!1,e.emit(\"conn-interrupt\",{sid:e._sessionId}))})),this._transport.on(\"reinit\",(function(){e._closed||(v.debug(\"_handleTransport(0 _transport event [reinit]\"),e._connected=!0,e.emit(\"reinit\",{sid:e._sessionId}))})),this._transport.on(\"conn-reconn\",(function(){e._closed||(v.debug(\"_handleTransport() _transport event [conn-reconn]\"),e._connected=!0,e.emit(\"conn-reconn\",{sid:e._sessionId}))})),this._transport.on(\"disconnected\",(function(){v.debug(\"_handleTransport() _transport [disconnected]\"),e._connected=!1,e.emit(\"disconnected\",{sid:e._sessionId})})),this._transport.on(\"failed\",(function(t){v.debug(\"_handleTransport() _transport event [failed] - [currentAttempt: \"+t+\"]\"),e._connected=!1,e.emit(\"failed\",{sid:e._sessionId,currentAttempt:t})})),this._transport.on(\"close\",(function(){e._closed||(e._closed=!0,e._connected=!1,v.debug(\"_handleTransport() _transport event [close]\"),e.emit(\"close\",{sid:e._sessionId}))})),this._transport.on(\"message\",(function(t){e.closed||(t.request?e._handleRequest(t):t.response?e._handleResponse(t):t.notification&&e._handleNotification(t))}))}},{key:\"_handleRequest\",value:function(e){var t=this;this.emit(\"request\",{sid:this._sessionId},e,(function(r){var a=f.default.successResponseFactory(e,r);t._transport.send(a).catch((function(e){v.warn(\"_handleRequest() accept() _transport.send error - \"+(0,n.default)(e))}))}),(function(r,a){r instanceof Error?(a=r.toString(),r=500):\"number\"==typeof r&&a instanceof Error&&(a=a.toString());var i=f.default.errorResponseFactory(e,r,a);t._transport.send(i).catch((function(e){v.warn(\"_handleRequest() reject() error - \"+(0,n.default)(e))}))}))}},{key:\"_handleResponse\",value:function(e){var t=this._requestHandlers.get(e.id);if(t)if(e.ok)t.resolve(e.data);else{var r=new Error(e.errorReason);r.code=e.errorCode,t.reject(r)}else v.error(\"_handleResponse() received response does not match any sent request\")}},{key:\"_handleNotification\",value:function(e){this.emit(\"notification\",{sid:this._sessionId},e)}},{key:\"data\",get:function(){return this._data},set:function(e){this._data=e||{}}},{key:\"closed\",get:function(){return this._closed}},{key:\"connected\",get:function(){return this._connected}}]),t}(l.EventEmitter);t.default=_},function(e,t,r){var n;try{n=r(221)}catch(e){}finally{if(n||\"undefined\"==typeof window||(n=window),!n)throw new Error(\"Could not determine global this\")}var a=n.WebSocket||n.MozWebSocket,i=r(222);function o(e,t){return t?new a(e,t):new a(e)}a&&[\"CONNECTING\",\"OPEN\",\"CLOSING\",\"CLOSED\"].forEach((function(e){Object.defineProperty(o,e,{get:function(){return a[e]}})})),e.exports={w3cwebsocket:a?o:null,version:i}},function(e,t){var r=function(){if(\"object\"==typeof self&&self)return self;if(\"object\"==typeof window&&window)return window;throw new Error(\"Unable to resolve global `this`\")};e.exports=function(){if(this)return this;if(\"object\"==typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,\"__global__\",{get:function(){return this},configurable:!0})}catch(e){return r()}try{return __global__||r()}finally{delete Object.prototype.__global__}}()},function(e,t,r){e.exports=r(223).version},function(e){e.exports=JSON.parse('{\"name\":\"websocket\",\"description\":\"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.\",\"keywords\":[\"websocket\",\"websockets\",\"socket\",\"networking\",\"comet\",\"push\",\"RFC-6455\",\"realtime\",\"server\",\"client\"],\"author\":\"Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)\",\"contributors\":[\"Iaki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)\"],\"version\":\"1.0.31\",\"repository\":{\"type\":\"git\",\"url\":\"https://github.com/theturtle32/WebSocket-Node.git\"},\"homepage\":\"https://github.com/theturtle32/WebSocket-Node\",\"engines\":{\"node\":\">=0.10.0\"},\"dependencies\":{\"debug\":\"^2.2.0\",\"es5-ext\":\"^0.10.50\",\"nan\":\"^2.14.0\",\"typedarray-to-buffer\":\"^3.1.5\",\"yaeti\":\"^0.0.6\"},\"devDependencies\":{\"buffer-equal\":\"^1.0.0\",\"faucet\":\"^0.0.1\",\"gulp\":\"^4.0.2\",\"gulp-jshint\":\"^2.0.4\",\"jshint-stylish\":\"^2.2.1\",\"jshint\":\"^2.0.0\",\"tape\":\"^4.9.1\"},\"config\":{\"verbose\":false},\"scripts\":{\"install\":\"(node-gyp rebuild 2> builderror.log) || (exit 0)\",\"test\":\"faucet test/unit\",\"gulp\":\"gulp\"},\"main\":\"index\",\"directories\":{\"lib\":\"./lib\"},\"browser\":\"lib/browser.js\",\"license\":\"Apache-2.0\",\"__npminstall_done\":\"Fri Feb 28 2020 14:40:09 GMT+0800 (GMT+08:00)\",\"_from\":\"websocket@1.0.31\",\"_resolved\":\"https://registry.npm.taobao.org/websocket/download/websocket-1.0.31.tgz\"}')},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=p(r(24)),a=p(r(8)),i=p(r(0)),o=p(r(1)),s=p(r(225)),c=p(r(30)),u=l(r(51)),d=l(r(60));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}var f=r(118),m=(0,s.default)({HEART_BEAT:\"event=sdkHeartbeat\",ENTER_FAIL:\"event=ENTER_FAIL\",ENTER_TIMEOUT:\"event=ENTER_TIMEOUT\"}),h=new c.default(\"Stats\"),v=function(){function e(){(0,i.default)(this,e),this._appId=\"\",this._roomId=\"\",this._sessionId=\"\",this._userId=\"\",this._connectionId=\"\",this._roleType=\"\",this._domain=\"\",this._signalReconnectTimes=0,this._netType=\"\",this._isMobile=/mobile/i.test(navigator.userAgent),this._outputAdjustVolume=1,this._micAdjustVolume=1,this._presetAudioBitrate=0,this._isAudioOpen=!1,this._isVideoOpen=!1,this._webrtcInternalSendStats=new Array,this._webrtcInternalRecvStats=new Array,this._reportInterval=null,this._webrtcStats=[],this._audioRecvStats=new a.default,this._videoRecvStats=new a.default,this._audioSendStats=new a.default,this._videoSendStats=new a.default,this._sendRTT=0,this._recvRTT=0,this._summarize={rtt:0,networkType:\"\",upSpeed:0,upFractionLost:0,downSpeed:0,downFractionLost:0},this._netstat={fractionLost:0,roundTripTime:0,quality:0,wsState:\"\",sendIceState:\"\",recvIceState:\"\",audioUp:{timestamp:0,bitrate:0,packetCount:0,packetsLost:0,nackCount:0,jitter:0,pliCount:0,sliCount:0,fractionLost:0,roundTripTime:0},audioDown:{timestamp:0,bitrate:0,packetCount:0,packetsLost:0,nackCount:0,pliCount:0,sliCount:0,fractionLost:0,roundTripTime:0},videoUp:{timestamp:0,bitrate:0,packetCount:0,packetsLost:0,nackCount:0,jitter:0,pliCount:0,sliCount:0,fractionLost:0,roundTripTime:0},videoDown:{timestamp:0,bitrate:0,packetCount:0,packetsLost:0,nackCount:0,pliCount:0,sliCount:0,fractionLost:0,roundTripTime:0}},this._cstat={peerId:\"\",appId:\"\",connectionId:\"\",roomId:\"\",consumer:\"\",stat:[]},this.streamSsrcPairs=new a.default,this.STATS_INTERVAL=4e3,this.STATS_INTERVAL_S=2e3,this._gwInfo={},this._iplocationInfo={},this.setNetworkType()}return(0,o.default)(e,[{key:\"stop\",value:function(){this._reportInterval&&(clearInterval(this._reportInterval),this._reportInterval=null),this._webrtcInternalSendStats.clear(),this._webrtcInternalRecvStats.clear()}},{key:\"getAudioUpStat\",value:function(e){return this._audioSendStats?this._audioSendStats.get(e):null}},{key:\"getVideoUpStat\",value:function(e){return this._videoSendStats?this._videoSendStats.get(e):null}},{key:\"getAudioDownStat\",value:function(e){return this._audioRecvStats?this._audioRecvStats.get(e):null}},{key:\"getVideoDownStat\",value:function(e){return this._videoRecvStats?this._videoRecvStats.get(e):null}},{key:\"setStreamSSRCPairs\",value:function(e,t,r,n){var a={ssrc:t,active:n,stream:r};this.streamSsrcPairs.set(e,a)}},{key:\"actStreamSSRCPairs\",value:function(e,t){var r=this.streamSsrcPairs.get(e);r&&(r.active=t)}},{key:\"isActStreamSSRCPairs\",value:function(e){var t=this.streamSsrcPairs.get(e);return!!t&&t.active}},{key:\"getStreamPropertyBySSRC\",value:function(e,t){var r=\"\",n=!1,a=\"\";return this.streamSsrcPairs.forEach((function(i,o){!n&&i&&\"\"+i.ssrc==\"\"+e&&(r=o,a=i.stream[t],n=!0)})),{id:r,value:a}}},{key:\"removeStreamById\",value:function(e){this.streamSsrcPairs.delete(e)}},{key:\"setWsState\",value:function(e){this._netstat.wsState=e}},{key:\"setSendIceState\",value:function(e){this._netstat.sendIceState=e}},{key:\"setRecvIceState\",value:function(e){this._netstat.recvIceState=e}},{key:\"setAppid\",value:function(e){this._appId=e,this._cstat.appId=e}},{key:\"setRoomId\",value:function(e){this._roomId=e,this._cstat.roomId=e}},{key:\"setSessionId\",value:function(e){this._sessionId=e}},{key:\"setUserId\",value:function(e){this._userId=e,this._cstat.peerId=e}},{key:\"setConnectionId\",value:function(e){this._connectionId=e,this._cstat.connectionId=e}},{key:\"setRoleType\",value:function(e){this._roleType=\"\"+e}},{key:\"setOutputAdjustVolume\",value:function(e){this._outputAdjustVolume=e}},{key:\"setMicAdjustVolume\",value:function(e){this._micAdjustVolume=e}},{key:\"setPresetAudioBitrate\",value:function(e){this._presetAudioBitrate=e}},{key:\"setSignalReconnectTimes\",value:function(e){this._signalReconnectTimes=e}},{key:\"setDeviceInfo\",value:function(e){}},{key:\"setDomain\",value:function(e){this._domain=e}},{key:\"setGWInfo\",value:function(e){this._gwInfo=e[0]}},{key:\"setIPlocationInfo\",value:function(e){this._iplocationInfo=e}},{key:\"setNetworkType\",value:function(){try{switch((navigator.connection||navigator.mozConnection||navigator.webkitConnection).type){case\"wifi\":this._netType=\"0\";break;case\"ethernet\":default:this._netType=\"4\"}}catch(e){}}},{key:\"_reportWebrtcStats\",value:function(){var e=this;if(this._webrtcInternalSendStats||this._webrtcInternalRecvStats){var t=this._webrtcInternalSendStats.length,r=this._webrtcInternalRecvStats.length,n=Math.min(Math.max(t,r),10);this._webrtcStats=[];for(var a=function(t){var r={};r.appId=\"\"+e._appId,r.roomId=\"\"+e._roomId,r.sessionId=\"\"+e._sessionId,r.userId=\"\"+e._userId,r.connectionId=\"\"+e._connectionId,r.roleType=\"\"+e._roleType,r.signalReconnectTimes=e._signalReconnectTimes,r.equipInfo={sdkVersion:f.version+\"_\"+f.buildDate,netType:\"\"+e._netType,equipModel:e._isMobile?\"web_mobile\":\"web\",inBackground:0,systemVersion:\"web\",publicVersion:\"3T_Web_SDK_V\"+f.version+\"_\"+f.buildDate},r.audioInfo={},r.audioInfo.A_SENT={},r.audioInfo.A_RECV=[],r.videoInfo={},r.videoInfo.V_SENT=[],r.videoInfo.V_RECV=[];var n=e._webrtcInternalSendStats.shift();if(n){r.logTime=n.statTimeTick;var a=0;n.results.forEach((function(t){if(\"VideoBwe\"===t.type);else if(\"googCandidatePair\"===t.type)\"true\"===t.googActiveConnection&&parseInt(t.googRtt,10);else if(\"ssrc\"===t.type){var i=parseInt(t.ssrc,10);if(\"audio\"===t.mediaType){var o=n.audio[i].upSpeedKBPS?n.audio[i].upSpeedKBPS:0;r.audioInfo.A_SENT.A_BR=parseInt(o,10),r.audioInfo.A_SENT.A_SSRC=i,r.audioInfo.A_SENT.A_RTT=parseInt(t.googRtt,10),r.audioInfo.A_SENT.A_MUTED=e._isAudioOpen?0:1;var s=parseInt(n.audio[i].packetsLost?n.audio[i].packetsLost:0,10),c=parseInt(n.audio[i].packetsSent?n.audio[i].packetsSent:0,10),u=c>0?s/c:0;r.audioInfo.A_SENT.A_FRACTIONLOST=parseFloat(u.toFixed(1)),r.audioInfo.A_SENT.A_RECV=0,r.audioInfo.A_SENT.A_SENT=parseInt(t.bytesSent,10),r.audioInfo.A_SENT.A_RECONNECT={},r.audioInfo.A_SENT.A_LEVELSUM=1,r.audioInfo.A_SENT.A_PRELEVELSUM=1,r.audioInfo.A_SENT.A_MIC_VOL=e._micAdjustVolume,r.audioInfo.A_SENT.A_CAP_STAT=1,r.audioInfo.A_SENT.A_SPEAKING=1,r.audioInfo.A_SENT.A_BITRATE=e._presetAudioBitrate}else if(\"video\"===t.mediaType){var d,l=e.getStreamPropertyBySSRC(i,\"innerStreamID\"),p=l.id,f=l.value;if(!e.isActStreamSSRCPairs(p))return;d=f,r.videoInfo.V_SENT[a]={},r.videoInfo.V_SENT[a].DEVID=\"\"+d,r.videoInfo.V_SENT[a].V_SSRC=+i;var m=n.video[i].upSpeedKBPS?n.video[i].upSpeedKBPS:0;r.videoInfo.V_SENT[a].V_VBR=parseInt(m,10),r.videoInfo.V_SENT[a].V_FPS=parseInt(t.googFrameRateInput,10),r.videoInfo.V_SENT[a].V_SENDBYTES=parseInt(t.bytesSent,10),r.videoInfo.V_SENT[a].V_SENDCOUNT=parseInt(t.packetsSent,10);var h=parseInt(n.video[i].packetsLost?n.video[i].packetsLost:0,10),v=parseInt(n.video[i].packetsSent?n.video[i].packetsSent:0,10),_=v>0?h/v:0;r.videoInfo.V_SENT[a].V_SENDFRACTIONLOST=parseFloat(_.toFixed(1)),r.videoInfo.V_SENT[a].V_RTT=parseInt(t.googRtt,10),r.videoInfo.V_SENT[a].V_RECV=0,r.videoInfo.V_SENT[a].V_SEND=parseInt(t.bytesSent,10),r.videoInfo.V_SENT[a].V_LOSS=0,r.videoInfo.V_SENT[a].V_RECONNECT={},r.videoInfo.V_SENT[a].V_MUTED=e._isVideoOpen?0:1,r.videoInfo.V_SENT[a].V_QP=36,r.videoInfo.V_SENT[a].V_SFPS=parseInt(t.googFrameRateSent,10),a++}}}))}var i=e._webrtcInternalRecvStats.shift();if(i){r.logTime=i.statTimeTick;var o=0,s=0,c=0;i.results.forEach((function(t){if(\"VideoBwe\"===t.type);else if(\"googCandidatePair\"===t.type)\"true\"===t.googActiveConnection&&(c=parseInt(t.googRtt,10));else if(\"ssrc\"===t.type){var n=parseInt(t.ssrc,10);if(\"audio\"===t.mediaType){var a=e.getStreamPropertyBySSRC(n,\"userID\"),u=a.id,d=a.value;if(!e.isActStreamSSRCPairs(u))return;var l=d;if(\"\"===l)return;r.audioInfo.A_RECV[s]={},r.audioInfo.A_RECV[s].RECVUID=l,r.audioInfo.A_RECV[s].A_SSRC=n;var p=i.audio[n].downSpeedKBPS?i.audio[n].downSpeedKBPS:0;r.audioInfo.A_RECV[s].A_RECVBR=parseInt(p,10),r.audioInfo.A_RECV[s].A_RECVBYTES=parseInt(t.bytesReceived,10);var f=parseInt(i.audio[n].packetsLost?i.audio[n].packetsLost:0,10),m=parseInt(i.audio[n].packetsReceived?i.audio[n].packetsReceived:0,10),h=m>0?f/m:0;r.audioInfo.A_RECV[s].A_LOSTRATE=parseFloat(h.toFixed(1)),r.audioInfo.A_RECV[s].A_BUFFERDURATION=parseInt(t.googJitterBufferMs,10),r.audioInfo.A_RECV[s].A_RECVFRACTIONLOST=parseFloat(h.toFixed(1)),r.audioInfo.A_RECV[s].A_RTT=c,r.audioInfo.A_RECV[s].A_DELAY=parseInt(i.audio[n].latency?i.audio[n].latency:0,10),r.audioInfo.A_RECV[s].A_AVJMS=0,r.audioInfo.A_RECV[s].A_MAXJMS=0,r.audioInfo.A_RECV[s].A_DISCARDEDPKTS=parseInt(t.packetsLost,10),r.audioInfo.A_RECV[s].A_VOLUME=e._outputAdjustVolume,r.audioInfo.A_RECV[s].A_LEVELSUM=1,r.audioInfo.A_RECV[s].A_MUTE=0,s++}else if(\"video\"===t.mediaType){var v,_=e.getStreamPropertyBySSRC(n,\"userID\"),g=_.id,y=_.value;if(!e.isActStreamSSRCPairs(g))return;if(\"\"===(v=y))return;var b,k=e.getStreamPropertyBySSRC(n,\"streamID\");k.id;b=k.value,r.videoInfo.V_RECV[o]={},r.videoInfo.V_RECV[o].RECVUID=\"\"+v,r.videoInfo.V_RECV[o].RECVID=\"\"+b,r.videoInfo.V_RECV[o].V_SSRC=+n,r.videoInfo.V_RECV[o].V_FPS=parseInt(t.googFrameRateOutput,10),r.videoInfo.V_RECV[o].V_WIDTH=parseInt(t.googFrameWidthReceived,10),r.videoInfo.V_RECV[o].V_HEIGHT=parseInt(t.googFrameHeightReceived,10);var w=i.video[n].downSpeedKBPS?i.video[n].downSpeedKBPS:0;r.videoInfo.V_RECV[o].V_RECVBR=parseInt(w,10),r.videoInfo.V_RECV[o].V_RECVBYTES=parseInt(t.bytesReceived,10),r.videoInfo.V_RECV[o].V_RECVCOUNT=parseInt(t.packetsReceived,10);var P=parseInt(i.video[n].packetsLost?i.video[n].packetsLost:0,10),S=parseInt(i.video[n].packetsReceived?i.video[n].packetsReceived:0,10),I=S>0?P/S:0;r.videoInfo.V_RECV[o].V_LOSTRATE=parseFloat(I.toFixed(1)),r.videoInfo.V_RECV[o].V_RTT=c,r.videoInfo.V_RECV[o].V_JITTER=parseInt(t.googJitterBufferMs,10),r.videoInfo.V_RECV[o].V_RECVFRAMECOUNT=parseInt(t.framesDecoded,10);var T=i.video[n].latency?i.video[n].latency:0;r.videoInfo.V_RECV[o].V_DELAY=parseInt(T,10),r.videoInfo.V_RECV[o].V_FRACTIONLOST=parseFloat(I.toFixed(1)),r.videoInfo.V_RECV[o].V_MUTED=1,r.videoInfo.V_RECV[o].V_TARGETVBR=parseInt(w,10),o++}}}))}var u=\"\",d=0;n&&n.connectionType&&n.connectionType.remote&&(u=n.connectionType.remote.ipAddress,d=n.connectionType.remote.portNumber),i&&i.connectionType&&i.connectionType.remote&&(u=i.connectionType.remote.ipAddress,d=i.connectionType.remote.portNumber),r.mediaServerInfo={aIp:u,audio_port:d,aSid:\"\",vIp:u,vPort:d,vSid:\"\"},e._webrtcStats.push(r)},i=0;i<n;i++)a();n>0&&this.pushLoggerToServer(m.HEART_BEAT,this._webrtcStats),Math.max(t,r)>10&&this._reportWebrtcStats()}}},{key:\"setWebrtcInternalSendStats\",value:function(e){this._sendRTT=e.bandwidth.rtt,this._summarize.rtt=e.bandwidth.rtt;var t=e.bandwidth.upSpeed;if(this._summarize.upSpeed=parseInt(t,10),this._summarize.networkType=e.connectionType.local.networkType,this._webrtcInternalSendStats){var r=(new Date).getTime();e.statTimeTick=r,this._webrtcInternalSendStats.push(e)}}},{key:\"setWebrtcInternalRecvStats\",value:function(e){this._recvRTT=e.bandwidth.rtt,this._summarize.rtt=e.bandwidth.rtt;var t=e.bandwidth.downSpeed;if(this._summarize.downSpeed=parseInt(t,10),this._summarize.networkType=e.connectionType.local.networkType,this._webrtcInternalRecvStats){var r=(new Date).getTime();e.statTimeTick=r,this._webrtcInternalRecvStats.push(e)}}},{key:\"setConsumeStats\",value:function(e,t,r,n,a){var i=this;this._cstat.consumer=n,this._cstat.stat=e;var o=(new Date).getTime(),s=!1,c={},u=!1,d={},l=0;e.forEach((function(e){if(\"outbound-rtp\"===e.type)if(\"video\"===e.kind){c.statTS=o,c.streamId=a,c.ssrc=e.ssrc,c.timestamp=e.timestamp,i._netstat.videoDown.timestamp=e.timestamp;var t=e.bitrate;c.bitrate=parseInt(t/1024,10),i._netstat.videoDown.bitrate=e.bitrate,c.packetCount=e.packetCount,i._netstat.videoDown.packetCount=e.packetCount,c.packetLost=e.packetsLost,i._netstat.videoDown.packageLost=e.packetsLost,c.nackCount=e.nackCount,i._netstat.videoDown.nackCount=e.nackCount,c.pliCount=e.pliCount,i._netstat.videoDown.pliCount=e.pliCount,c.sliCount=e.sliCount,i._netstat.videoDown.sliCount=e.sliCount,c.fractionLost=e.fractionLost,+c.fractionLost>+l&&(l=+c.fractionLost),i._netstat.videoDown.fractionLost=e.fractionLost,void 0!==e.roundTripTime&&(i._netstat.videoDown.roundTripTime=e.roundTripTime,c.rtt=i._recvRTT),s=!0}else if(\"audio\"===e.kind){d.statTS=o,d.streamId=a,d.ssrc=e.ssrc,i._netstat.audioDown.timestamp=e.timestamp,d.timestamp=e.timestamp,i._netstat.audioDown.bitrate=e.bitrate;var r=e.bitrate;d.bitrate=parseInt(r/1024,10),i._netstat.audioDown.packetCount=e.packetCount,d.packetCount=e.packetCount,i._netstat.audioDown.packetsLost=e.packetsLost,d.packetLost=e.packetsLost,i._netstat.audioDown.nackCount=e.nackCount,d.nackCount=e.nackCount,i._netstat.audioDown.pliCount=e.pliCount,d.pliCount=e.pliCount,i._netstat.audioDown.sliCount=e.sliCount,d.sliCount=e.sliCount,i._netstat.audioDown.fractionLost=e.fractionLost,d.fractionLost=e.fractionLost,+d.fractionLost>+l&&(l=+d.fractionLost),void 0!==e.roundTripTime&&(i._netstat.audioDown.roundTripTime=e.roundTripTime,d.rtt=i._recvRTT),u=!0}})),this._summarize.downFractionLost=l,this._setNetQulity(),u&&this._audioRecvStats.set(a,d),s&&this._videoRecvStats.set(a,c),this._cstat.stat.forEach((function(e){\"video\"===e.kind&&\"outbound-rtp\"===e.type&&(e.resolution=t)})),this.consumerState(this._cstat)}},{key:\"setMicStats\",value:function(e,t){var r=this,n=!1,a={},i=(new Date).getTime(),o=0;e.forEach((function(e){if(\"inbound-rtp\"===e.type){a.statTS=i,a.streamId=t,a.ssrc=e.ssrc,r._netstat.audioUp.timestamp=e.timestamp,a.timestamp=e.timestamp,r._netstat.audioUp.bitrate=e.bitrate;var s=e.bitrate;a.bitrate=parseInt(s/1024,10),r._netstat.audioUp.packetCount=e.packetCount,a.packetCount=e.packetCount,r._netstat.audioUp.packetsLost=e.packetsLost,a.packetLost=e.packetsLost,r._netstat.audioUp.nackCount=e.nackCount,a.nackCount=e.nackCount,r._netstat.audioUp.jitter=e.jitter,a.jitter=e.jitter,r._netstat.audioUp.pliCount=e.pliCount,a.pliCount=e.pliCount,r._netstat.audioUp.fractionLost=e.fractionLost,a.fractionLost=e.fractionLost,+a.fractionLost>+o&&(o=+a.fractionLost),void 0!==e.roundTripTime&&(r._netstat.audioUp.roundTripTime=e.roundTripTime,a.rtt=r._sendRTT),n=!0}})),this._summarize.upFractionLost=o,this._setNetQulity(),n&&this._audioSendStats.set(t,a)}},{key:\"setWebcamStats\",value:function(e,t){var r=this,n=!1,a={},i=(new Date).getTime(),o=0;e.forEach((function(e){if(\"inbound-rtp\"===e.type){a.statTS=i,a.streamId=t,a.ssrc=e.ssrc,r._netstat.videoUp.timestamp=e.timestamp,a.timestamp=e.timestamp,r._netstat.videoUp.bitrate=e.bitrate;var s=e.bitrate;a.bitrate=parseInt(s/1024,10),r._netstat.videoUp.packetCount=e.packetCount,a.packetCount=e.packetCount,r._netstat.videoUp.packetsLost=e.packetsLost,a.packetLost=e.packetsLost,r._netstat.videoUp.nackCount=e.nackCount,a.nackCount=e.nackCount,r._netstat.videoUp.jitter=e.jitter,a.jitter=e.jitter,r._netstat.videoUp.pliCount=e.pliCount,a.pliCount=e.pliCount,r._netstat.videoUp.fractionLost=e.fractionLost,a.fractionLost=e.fractionLost,+a.fractionLost>+o&&(o=+a.fractionLost),void 0!==e.roundTripTime&&(r._netstat.videoUp.roundTripTime=e.roundTripTime,a.rtt=r._sendRTT),n=!0}})),this._summarize.upFractionLost=o,this._setNetQulity(),n&&this._videoSendStats.set(t,a)}},{key:\"startHeartBeat\",value:function(){var e=this;this._reportInterval&&(clearInterval(this._reportInterval),this._reportInterval=null),this._reportInterval=setInterval((function(){e._reportWebrtcStats()}),1e4)}},{key:\"stopHeartBeat\",value:function(){this._reportInterval&&(clearInterval(this._reportInterval),this._reportInterval=null)}},{key:\"pushLoggerToServer\",value:function(e,t){if(c.default.logSubmit){var r=\"\";r=e?e+\" \"+(0,n.default)(t):(0,n.default)(t),fetch(u.logserver_url,{method:\"POST\",mode:\"no-cors\",cache:\"no-cache\",headers:{\"Content-Type\":\"text/plain; charset=utf-8\"},redirect:\"follow\",referrer:\"no-referrer\",body:r}).catch((function(e){h.warn(\"pushLoggerToServer() error - \"+e.toString())})).then((function(e){}))}}},{key:\"consumerState\",value:function(e){c.default.privateCloud||fetch(\"https://\"+this._domain+\"/stats/\",{method:\"POST\",mode:\"no-cors\",cache:\"no-cache\",headers:{Accept:\"application/json\",\"Content-Type\":\"application/json\"},redirect:\"follow\",referrer:\"no-referrer\",body:(0,n.default)(e)}).catch((function(e){h.warn(\"consumerState() error - \"+e.toString())})).then((function(e){}))}},{key:\"_setNetQulity\",value:function(){var e=0,t=0,r=0;0!==this._netstat.audioUp.packetCount&&(t++,this._netstat.audioUp.roundTripTime,e+=this._netstat.audioUp.packetsLost/this._netstat.audioUp.packetCount),0!==this._netstat.audioDown.packetCount&&(t++,this._netstat.audioDown.roundTripTime,e+=this._netstat.audioDown.packetsLost/this._netstat.audioDown.packetCount),0!==this._netstat.videoUp.packetCount&&(t++,this._netstat.videoUp.roundTripTime,e+=this._netstat.videoUp.packetsLost/this._netstat.videoUp.packetCount),0!==this._netstat.videoDown.packetCount&&(t++,this._netstat.videoDown.roundTripTime,e+=this._netstat.videoDown.packetsLost/this._netstat.videoDown.packetCount),0!==t&&(r/=t,this._netstat.fractionLost=e/t,this._netstat.roundTripTime=r,this._netstat.quality=1-this._netstat.fractionLost)}},{key:\"sendTimeOutLog\",value:function(e){var t=e.timesOfLinkGW,r=e.linkGWTime,n=e.sendGWTime,a=e.sendEnterTime,i={glbId:d.uuid(),appId:this._appId,userId:this._userId,roomId:this._roomId,connectId:this._connectionId,os:\"WEB\",logTime:(new Date).toISOString().replace(/a-z/gi,\" \"),timesOfLinkIplocal:this._iplocationInfo.reconnectTimes,timesOfLinkGW:t,linkIplocalTime:this._iplocationInfo.connectedTime-this._iplocationInfo.firstConnectTime,sendIplocalTime:this._iplocationInfo.connectedTime,linkGWTime:r,sendGWTime:n,sendEnterTime:a,gwIp:this._gwInfo.sIp};this.pushLoggerToServer(m.ENTER_TIMEOUT,i)}},{key:\"sendFailLog\",value:function(e){var t=e.timesOfLinkGW,r=e.linkGWTime,n=e.sendGWTime,a=e.sendEnterTime,i=e.role,o=e.result,s={glbId:d.uuid(),appId:this._appId,userId:this._userId,roomId:this._roomId,connectId:this._connectionId,os:\"WEB\",role:i,result:o,logTime:(new Date).toISOString().replace(/a-z/gi,\" \"),timesOfLinkIplocal:this._iplocationInfo.reconnectTimes,timesOfLinkGW:t,linkIplocalTime:this._iplocationInfo.connectedTime-this._iplocationInfo.firstConnectTime,sendIplocalTime:this._iplocationInfo.connectedTime,linkGWTime:r,sendGWTime:n,sendEnterTime:a,innerDiff:0,totalDiff:0,gwIp:this._gwInfo.sIp};this.pushLoggerToServer(m.ENTER_FAIL,s)}},{key:\"audioUpStat\",get:function(){var e=this,t=(new Date).getTime();return this._audioSendStats.forEach((function(r,n){t-r.statTS>3e3&&e._audioSendStats.delete(n)})),this._audioSendStats}},{key:\"videoUpStat\",get:function(){var e=this,t=(new Date).getTime();return this._videoSendStats.forEach((function(r,n){t-r.statTS>3e3&&e._videoSendStats.delete(n)})),this._videoSendStats}},{key:\"audioDownStat\",get:function(){var e=this,t=(new Date).getTime();return this._audioRecvStats.forEach((function(r,n){t-r.statTS>3e3&&e._audioRecvStats.delete(n)})),this._audioRecvStats}},{key:\"videoDownStat\",get:function(){var e=this,t=(new Date).getTime();return this._videoRecvStats.forEach((function(r,n){t-r.statTS>3e3&&e._videoRecvStats.delete(n)})),this._videoRecvStats}},{key:\"summarize\",get:function(){return this._summarize}},{key:\"netState\",get:function(){return this._netstat}},{key:\"audioOpen\",set:function(e){this._isAudioOpen=e}},{key:\"videoOpen\",set:function(e){this._isVideoOpen=e}}]),e}();t.default=v},function(e,t,r){e.exports={default:r(226),__esModule:!0}},function(e,t,r){r(227),e.exports=r(7).Object.freeze},function(e,t,r){var n=r(18),a=r(56).onFreeze;r(65)(\"freeze\",(function(e){return function(t){return e&&n(t)?e(a(t)):t}}))},function(e,t,r){\"use strict\";(function(n){var a,i=s(r(26)),o=s(r(40));function s(e){return e&&e.__esModule?e:{default:e}}var c=0,u=function(e,t,r){var a,s=\"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45\";(a=void 0!==n?n:null)&&\"undefined\"==typeof window&&void 0!==n&&(n.navigator={userAgent:s,getUserMedia:function(){}},n.console||(n.console={}),void 0!==n.console.log&&void 0!==n.console.error||(n.console.error=n.console.log=n.console.log||function(){console.log(arguments)}),\"undefined\"==typeof document&&(a.document={documentElement:{appendChild:function(){return\"\"}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return\"\"}};return e},a.HTMLVideoElement=function(){}),\"undefined\"==typeof location&&(a.location={protocol:\"file:\",href:\"\",hash:\"\"}),\"undefined\"==typeof screen&&(a.screen={width:0,height:0}),\"undefined\"==typeof URL&&(a.URL={createObjectURL:function(){return\"\"},revokeObjectURL:function(){return\"\"}}),\"undefined\"==typeof MediaStreamTrack&&(a.MediaStreamTrack=function(){}),void 0===u&&(a.RTCPeerConnection=function(){}),a.window=n);var u=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;\"undefined\"==typeof MediaStreamTrack&&(MediaStreamTrack={});var d=((navigator.connection||{}).type||\"unknown\").toString().toLowerCase(),l={isSafari:!1,encryption:\"sha-256\",audio:{ssrc:[]},video:{ssrc:[]},bandwidth:{systemBandwidth:0,sentPerSecond:0,encodedPerSecond:0,helper:{prevBytesReceived:0,prevBytesSent:0},upSpeed:0,downSpeed:0,rtt:0},results:{},connectionType:{systemNetworkType:d,local:{candidateType:\"\",transport:\"\",ipAddress:\"\",portNumber:\"\",networkType:\"\"},remote:{candidateType:\"\",transport:\"\",ipAddress:\"\",portNumber:\"\"}},internal:{activeConnection:{localCandidate:\"\",remoteCandidate:\"\"},audio:{},video:{},candidates:[]},nomore:function(){h=!0}},p={checkIfOfferer:function(e){\"googLibjingleSession\"===e.type&&(l.isOfferer=e.googInitiator)}},f=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);l.isSafari=f;var m=this;if(!(arguments[0]instanceof u))throw\"1st argument is not instance of RTCPeerConnection.\";m=arguments[0],arguments[1]instanceof MediaStreamTrack&&(e=arguments[1],t=arguments[2],r=arguments[3]),+r<1e3&&(r=1e3),c=r;var h=!1;function v(){_((function(e){if(e&&e.forEach){e.forEach((function(e){(0,o.default)(p).forEach((function(t){if(\"function\"==typeof p[t])try{p[t](e)}catch(e){console.warn(e.message,e.stack,e)}}))}));try{-1!==m.iceConnectionState.search(/failed|closed|disconnected/gi)&&(h=!0)}catch(e){h=!0}!0===h&&(l.datachannel&&(l.datachannel.state=\"close\"),l.ended=!0),l.internal.candidates.forEach((function(e){e&&(e.id===l.internal.activeConnection.localCandidate?(l.connectionType.local.candidateType=e.candidateType,l.connectionType.local.ipAddress=e.ipAddress,l.connectionType.local.portNumber=e.portNumber,l.connectionType.local.networkType=e.networkType,l.connectionType.local.transport=e.transport):e.id===l.internal.activeConnection.remoteCandidate&&(l.connectionType.remote.candidateType=e.candidateType,l.connectionType.remote.ipAddress=e.ipAddress,l.connectionType.remote.portNumber=e.portNumber,l.connectionType.remote.transport=e.transport))})),l.results=e,l.audio.ssrc.forEach((function(e){})),l.video.ssrc.forEach((function(e){})),t(l),h||null!=(void 0===r?\"undefined\":(0,i.default)(r))&&r&&setTimeout(v,r||1e3)}}))}function _(e){void 0!==window.InstallTrigger||f?m.getStats(window.mediaStreamTrack||null).then((function(t){var r=[];t.forEach((function(e){r.push(e)})),e(r)})).catch(e):m.getStats((function(t){var r=[];t.result().forEach((function(e){var t={};e.names().forEach((function(r){t[r]=e.stat(r)})),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,r.push(t)})),e(r)}))}p.datachannel=function(e){\"datachannel\"===e.type&&(l.datachannel={state:e.state})},p.googCertificate=function(e){\"googCertificate\"==e.type&&(l.encryption=e.googFingerprintAlgorithm),\"certificate\"==e.type&&(l.encryption=e.fingerprintAlgorithm)},p.checkAudioTracks=function(e){if(\"ssrc\"===e.type&&\"audio\"===e.mediaType){var t=e.ssrc,r=e.id.split(\"_\").pop();if(!0===e.isRemote&&(r=\"recv\"),!1===e.isRemote&&(r=\"send\"),r){-1===l.audio.ssrc.indexOf(t)&&l.audio.ssrc.push(t),l.audio[t]||(l.audio[t]={},l.audio[t][r]={},l.audio[t][r].codecs=[],l.audio[t][r].tracks=[]),e.googCodecName&&\"\"!==e.googCodecName&&-1===l.audio[t][r].codecs.indexOf(e.googCodecName)&&l.audio[t][r].codecs.push(e.googCodecName),l.internal.audio[t]||(l.internal.audio[t]={}),l.internal.audio[t][r]||(l.internal.audio[t][r]={});var n=0,a=0;\"send\"===r&&void 0!==e.bytesSent&&(l.internal.audio[t][r].prevBytesSent||(l.internal.audio[t][r].prevBytesSent=0),n=e.bytesSent-l.internal.audio[t][r].prevBytesSent,l.internal.audio[t][r].prevBytesSent=e.bytesSent,a=8*n/1024,l.audio[t][r].availableBandwidth=parseInt(a,10),l.audio[t].upSpeedKBPS=parseInt(a,10)),\"recv\"===r&&void 0!==e.bytesReceived&&(l.internal.audio[t][r].prevBytesReceived||(l.internal.audio[t][r].prevBytesReceived=0),n=e.bytesReceived-l.internal.audio[t][r].prevBytesReceived,l.internal.audio[t][r].prevBytesReceived=e.bytesReceived,a=8*n/1024,l.audio[t].downSpeedKBPS=parseInt(a,10)),e.googTrackId&&-1===l.audio[t][r].tracks.indexOf(e.googTrackId)&&l.audio[t][r].tracks.push(e.googTrackId),void 0!==e.googCurrentDelayMs&&(l.internal.audio[t].googCurrentDelayMs=e.googCurrentDelayMs,l.audio[t].latency=parseInt(e.googCurrentDelayMs,10),l.audio[t].latency<0&&(l.audio[t].latency=0));var i=0;if(\"recv\"===r&&void 0!==e.packetsReceived&&(l.internal.audio[t].prevPacketsReceived||(l.internal.audio[t].prevPacketsReceived=0),i=e.packetsReceived-l.internal.audio[t].prevPacketsReceived,l.internal.audio[t].prevPacketsReceived=e.packetsReceived,l.audio[t].packetsReceived=parseInt(i,10),l.audio[t].packetsReceived<0&&(l.audio[t].packetsReceived=0)),\"send\"===r&&void 0!==e.packetsSent&&(l.internal.audio[t].prevPacketsSent||(l.internal.audio[t].prevPacketsSent=0),i=e.packetsSent-l.internal.audio[t].prevPacketsSent,l.internal.audio[t].prevPacketsSent=e.packetsSent,l.audio[t].packetsSent=parseInt(i,10),l.audio[t].packetsSent<0&&(l.audio[t].packetsSent=0)),void 0!==e.packetsLost){l.internal.audio[t].prevPacketsLost||(l.internal.audio[t].prevPacketsLost=0);var o=e.packetsLost-l.internal.audio[t].prevPacketsLost;l.internal.audio[t].prevPacketsLost=e.packetsLost,l.audio[t].packetsLost=parseInt(o,10),l.audio[t].packetsLost<0&&(l.audio[t].packetsLost=0)}}}},p.checkVideoTracks=function(e){if(\"ssrc\"===e.type&&\"video\"===e.mediaType){var t=e.ssrc,r=e.id.split(\"_\").pop();if(!0===e.isRemote&&(r=\"recv\"),!1===e.isRemote&&(r=\"send\"),r){-1===l.video.ssrc.indexOf(t)&&l.video.ssrc.push(t),l.video[t]||(l.video[t]={},l.video[t][r]={},l.video[t][r].codecs=[],l.video[t][r].tracks=[],l.video[t][r].resolutions={}),-1===l.video[t][r].codecs.indexOf(e.googCodecName||\"VP8\")&&l.video[t][r].codecs.push(e.googCodecName||\"VP8\"),l.internal.video[t]||(l.internal.video[t]={},l.internal.video[t][r]={}),l.internal.video[t][r]||(l.internal.video[t][r]={});var n=0,a=0;\"send\"===r&&void 0!==e.bytesSent&&(l.internal.video[t][r].prevBytesSent||(l.internal.video[t][r].prevBytesSent=0),n=e.bytesSent-l.internal.video[t][r].prevBytesSent,l.internal.video[t][r].prevBytesSent=e.bytesSent,a=8*n/1024,l.video[t][r].availableBandwidth=parseInt(a,10),l.video[t].upSpeedKBPS=parseInt(a,10)),\"recv\"===r&&void 0!==e.bytesReceived&&(l.internal.video[t][r].prevBytesReceived||(l.internal.video[t][r].prevBytesReceived=0),n=e.bytesReceived-l.internal.video[t][r].prevBytesReceived,l.internal.video[t][r].prevBytesReceived=e.bytesReceived,a=8*n/1024,l.video[t].downSpeedKBPS=parseInt(a,10)),e.googFrameHeightReceived&&e.googFrameWidthReceived&&(l.video[t][r].resolutions.width=e.googFrameWidthReceived,l.video[t][r].resolutions.height=e.googFrameHeightReceived),e.googFrameHeightSent&&e.googFrameWidthSent&&(l.video[t][r].resolutions.width=e.googFrameWidthSent,l.video[t][r].resolutions.height=e.googFrameHeightSent),e.googTrackId&&-1===l.video[t][r].tracks.indexOf(e.googTrackId)&&l.video[t][r].tracks.push(e.googTrackId),void 0!==e.googCurrentDelayMs&&(l.internal.video[t].googCurrentDelayMs=e.googCurrentDelayMs,l.video[t].latency=parseInt(e.googCurrentDelayMs,10),l.video[t].latency<0&&(l.video[t].latency=0));var i=0;if(\"recv\"===r&&void 0!==e.packetsReceived&&(l.internal.video[t].prevPacketsReceived||(l.internal.video[t].prevPacketsReceived=0),i=e.packetsReceived-l.internal.video[t].prevPacketsReceived,l.internal.video[t].prevPacketsReceived=e.packetsReceived,l.video[t].packetsReceived=parseInt(i,10),l.video[t].packetsReceived<0&&(l.video[t].packetsReceived=0)),\"send\"===r&&void 0!==e.packetsSent&&(l.internal.video[t].prevPacketsSent||(l.internal.video[t].prevPacketsSent=0),i=e.packetsSent-l.internal.video[t].prevPacketsSent,l.internal.video[t].prevPacketsSent=e.packetsSent,l.video[t].packetsSent=parseInt(i,10),l.video[t].packetsSent<0&&(l.video[t].packetsSent=0)),void 0!==e.packetsLost){l.internal.video[t].prevPacketsLost||(l.internal.video[t].prevPacketsLost=0);var o=e.packetsLost-l.internal.video[t].prevPacketsLost;l.internal.video[t].prevPacketsLost=e.packetsLost,l.video[t].packetsLost=parseInt(o,10),l.video[t].packetsLost<0&&(l.video[t].packetsLost=0)}}}},p.bweforvideo=function(e){\"VideoBwe\"===e.type&&(l.bandwidth.availableSendBandwidth=e.googAvailableSendBandwidth,l.bandwidth.googActualEncBitrate=e.googActualEncBitrate,l.bandwidth.googAvailableSendBandwidth=e.googAvailableSendBandwidth,l.bandwidth.googAvailableReceiveBandwidth=e.googAvailableReceiveBandwidth,l.bandwidth.googRetransmitBitrate=e.googRetransmitBitrate,l.bandwidth.googTargetEncBitrate=e.googTargetEncBitrate,l.bandwidth.googBucketDelay=e.googBucketDelay,l.bandwidth.googTransmitBitrate=e.googTransmitBitrate)},p.candidatePair=function(e){if(\"googCandidatePair\"===e.type||\"candidate-pair\"===e.type||\"local-candidate\"===e.type||\"remote-candidate\"===e.type)if(f){if(\"candidate-pair\"!==e.type||!0!==e.nominated||\"succeeded\"!==e.state)return;var t=void 0!==e.availableOutgoingBitrate?\"send\":\"recv\";if(l.internal.activeConnection.remoteCandidate=e.remoteCandidateId,l.internal.activeConnection.localCandidate=e.localCandidateId,l.bandwidth.rtt=1e3*e.currentRoundTripTime,\"send\"===t&&void 0!==e.bytesSent){var r=1e3*(e.bytesSent-l.bandwidth.helper.prevBytesSent)*8/c;l.bandwidth.helper.prevBytesSent=e.bytesSent,r=r>0?r/1024:0,l.bandwidth.upSpeed=parseInt(r,10)}if(\"recv\"===t&&void 0!==e.bytesReceived){var n=1e3*(e.bytesReceived-l.bandwidth.helper.prevBytesReceived)*8/c;l.bandwidth.helper.prevBytesReceived=e.bytesReceived,n=n>0?n/1024:0,l.bandwidth.downSpeed=parseInt(n,10)}e.availableOutgoingBitrate,e.availableIncomingBitrate}else{if(\"true\"==e.googActiveConnection){l.internal.activeConnection.remoteCandidate=e.remoteCandidateId,l.internal.activeConnection.localCandidate=e.localCandidateId,l.connectionType.transport=e.googTransportType,l.bandwidth.rtt=e.googRtt;var a=1e3*(e.bytesReceived-l.bandwidth.helper.prevBytesReceived)*8/c,i=1e3*(e.bytesSent-l.bandwidth.helper.prevBytesSent)*8/c;l.bandwidth.helper.prevBytesReceived=e.bytesReceived,l.bandwidth.helper.prevBytesSent=e.bytesSent,i=i>0?i/1024:0,a=a>0?a/1024:0,l.bandwidth.upSpeed=parseInt(i,10),l.bandwidth.downSpeed=parseInt(a,10)}if(\"candidate-pair\"===e.type&&!0===e.selected&&!0===e.nominated&&\"succeeded\"===e.state)l.internal.candidates[e.remoteCandidateId],l.internal.candidates[e.remoteCandidateId]}},p.localcandidate=function(e){if((\"localcandidate\"===e.type||\"local-candidate\"===e.type)&&e.id){var t={candidateType:e.candidateType,ipAddress:e.ipAddress,portNumber:e.portNumber,networkType:e.networkType,priority:e.priority,transport:e.transport,timestamp:e.timestamp,id:e.id,type:e.type};l.internal.candidates.push(t)}},p.remotecandidate=function(e){if((\"remotecandidate\"===e.type||\"remote-candidate\"===e.type)&&e.id){var t={candidateType:e.candidateType,ipAddress:e.ipAddress,portNumber:e.portNumber,networkType:e.networkType,priority:e.priority,transport:e.transport,timestamp:e.timestamp,id:e.id,type:e.type};l.internal.candidates.push(t)}},p.inboundrtp=function(e){if(f&&\"inbound-rtp\"===e.type){var t=e.mediaType||\"audio\";0;var r=e.ssrc;if(l[t][r]||(l[t][r]={},l[t][r].recv={}),l.internal[t][r]||(l.internal[t][r]={},l.internal[t][r].recv={}),l.internal[t][r].recv||(l.internal[t][r].recv={}),void 0!==e.bytesReceived){var n;l.internal[t][r].recv.prevBytesReceived||(l.internal[t][r].recv.prevBytesReceived=0);var a=e.bytesReceived-l.internal[t][r].recv.prevBytesReceived;l.internal[t][r].recv.prevBytesReceived=e.bytesReceived,n=8*a/1024,l[t][r].downSpeedKBPS=parseInt(n,10)}void 0!==e.jitter&&(l.internal[t][r].jitter=e.jitter,l[t][r].latency=parseInt(e.jitter,10),l[t][r].latency<0&&(l[t][r].latency=0));var i=0;if(void 0!==e.packetsReceived&&(l.internal[t][r].prevPacketsReceived||(l.internal[t][r].prevPacketsReceived=0),i=e.packetsReceived-l.internal[t][r].prevPacketsReceived,l.internal[t][r].prevPacketsReceived=e.packetsReceived,l[t][r].packetsReceived=parseInt(i,10),l[t][r].packetsReceived<0&&(l[t][r].packetsReceived=0)),void 0!==e.packetsLost){l.internal[t][r].prevPacketsLost||(l.internal[t][r].prevPacketsLost=0);var o=e.packetsLost-l.internal[t][r].prevPacketsLost;l.internal[t][r].prevPacketsLost=e.packetsLost,l[t][r].packetsLost=parseInt(o,10),l[t][r].packetsLost<0&&(l[t][r].packetsLost=0)}}},p.outboundrtp=function(e){if(f&&\"outbound-rtp\"===e.type){var t=e.mediaType||\"audio\";0;var r=e.ssrc;if(l[t][r]||(l[t][r]={},l[t][r].send={}),l.internal[t][r]||(l.internal[t][r]={},l.internal[t][r].send={}),l.internal[t][r].send||(l.internal[t][r].send={}),void 0!==e.bytesSent){var n;l.internal[t][r].send.prevBytesSent||(l.internal[t][r].send.prevBytesSent=0);var a=e.bytesSent-l.internal[t][r].send.prevBytesSent;l.internal[t][r].send.prevBytesSent=e.bytesSent,n=8*a/1024,l[t][r].send.availableBandwidth=parseInt(n,10),l[t][r].upSpeedKBPS=parseInt(n,10)}var i=0;if(void 0!==e.packetsSent&&(l.internal[t][r].prevPacketsSent||(l.internal[t][r].prevPacketsSent=0),i=e.packetsSent-l.internal[t][r].prevPacketsSent,l.internal[t][r].prevPacketsSent=e.packetsSent,l[t][r].packetsSent=parseInt(i,10),l[t][r].packetsSent<0&&(l[t][r].packetsSent=0)),void 0!==e.packetsLost){l.internal[t][r].prevPacketsLost||(l.internal[t][r].prevPacketsLost=0);var o=e.packetsLost-l.internal[t][r].prevPacketsLost;l.internal[t][r].prevPacketsLost=e.packetsLost,l[t][r].packetsLost=parseInt(o,10),l[t][r].packetsLost<0&&(l[t][r].packetsLost=0)}}},p.track=function(e){if(f&&\"track\"===e.type){var t=!0===e.remoteSource?\"send\":\"recv\";l.resolutions||(l.resolutions={},l.resolutions[t]={}),l.resolutions[t]||(l.resolutions[t]={}),e.frameWidth&&e.frameHeight&&(l.resolutions[t].width=e.frameWidth,l.resolutions[t].height=e.frameHeight)}};var g={audio:{send:[],recv:[]},video:{send:[],recv:[]}};p.ssrc=function(e){if(e.googCodecName&&(\"video\"===e.mediaType||\"audio\"===e.mediaType)&&\"ssrc\"===e.type){var t=e.id.split(\"_\").pop();-1===g[e.mediaType][t].indexOf(e.ssrc)&&g[e.mediaType][t].push(e.ssrc)}},v()};e.exports=u,void 0===(a=function(){return u}.apply(t,[]))||(e.exports=a)}).call(this,r(43))}])}));\n//# sourceMappingURL=tttwebsdk.js.map\n\n//# sourceURL=webpack:///./lib/tttwebsdk.js?");

/***/ }),

/***/ "./test/av_screen_cdn/js/main.js":
/*!***************************************!*\
  !*** ./test/av_screen_cdn/js/main.js ***!
  \***************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/tttwebsdk */ \"./lib/tttwebsdk.js\");\n/* harmony import */ var _lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0__);\n // import from local tttwebsdk.js\n\nlet RTCObj = new _lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0___default.a();\n\n// \nlet client = null;\n\nlet gStream = null;\nlet gAudioVideoStream = null;\n\nlet videoEle = document.getElementById('screen');\n\nlet tttStatus = 0;\n\nlet remote_stream = new Map();\n\n// \nlet rSeed = (Math.random() * 100000000);\nlet userId = Math.floor(rSeed) + 1;\n\nlet userRole = 1; //   \n\nlet xAppId = 'a967ac491e3acf92eed5e1b5ba641ab7'; // test900572e02867fab8131651339518\n\nconst sdkVersionEle = document.getElementById('sdkVersion');\nif (!!sdkVersionEle)\n{\n\tsdkVersionEle.innerHTML = `sdk version : ${RTCObj.version}`;\n}\n\nconst roomIdEle = document.getElementById('chanid');\nif (!!roomIdEle)\n{\n\trSeed = (Math.random() * 100000000);\n\troomIdEle.value = Math.floor(rSeed) + 1;\n}\n\nconst rtmpUrlEle = document.getElementById('rtmpUrl');\nif (!!rtmpUrlEle)\n{\n\trtmpUrlEle.value = `rtmp://push.3ttest.cn/sdk2/${roomIdEle.value}`;\n}\n\n// \nlet joinChanEle = document.getElementById('joinChan');\nif (!!joinChanEle)\n{\n\tjoinChanEle.addEventListener('click', () =>\n\t{\n\t\tconst rid = roomIdEle.value;\n\t\tjoinChan(xAppId, rid, userId);\n\t})\n}\n\nfunction joinChan(appid, chanid, userid)\n{\n\t// \n\tif (tttStatus === 1)\n\t{\n\t\tconsole.log('');\n\n\t\treturn;\n\t}\n\n\tconst rtmpUrl = (!!rtmpUrlEle) ? rtmpUrlEle.value : '';\n\tclient = RTCObj.createClient({\n\t\trole: userRole,\n\t\trtmpUrl,\n\t});\n\n\tclient.init(appid, userid, () =>\n\t{\n\t\tclient.join('', chanid, () =>\n\t\t{\n\t\t\tconsole.log(`<demo> !! userid: ${userid}`);\n\n\t\t\tdocument.getElementById('loginStatus').innerHTML = `<font color=\"green\"></font>`;\n\t\t\tdocument.getElementById('loginInfo').innerHTML = `-- channelId: ${chanid} - userId: ${userid} - role: ${userRole}<br>`;\n\n\t\t\ttttStatus = 1; // : \n\t\t}, (err) =>\n\t\t{\n\t\t\ttttStatus = 0;\n\n\t\t\tconsole.log(`<demo> login fail - ${err}`);\n\n\t\t\tdocument.getElementById('loginStatus').innerHTML = '<font color=\"red\"></font>';\n\t\t\tdocument.getElementById('loginInfo').innerHTML = '';\n\t\t});\n\t}, (err) =>\n\t{\n\t\tconsole.log(`<demo> init fail - ${err}`);\n\n\t\treturn;\n\t});\n\n\t// \n\tclient.on('screen-published', (evt) =>\n\t{\n\t\tconsole.log(`<demo> - event [screen-published] uid: ${evt.streamId}`);\n\t\tdocument.getElementById('publishScreenCDNStatus').innerHTML = `<font color=\"green\"></font>`;\n\n\t\t// \n\t\t// setLiveMixerLayout();\n\t\tsetScreenSEI();\n\t});\n\n\tclient.on('screen-unpublished', (evt) =>\n\t{\n\t\tconsole.log(`<demo> - event [screen-unpublished] sid: ${evt.streamId}`);\n\t\tdocument.getElementById('publishScreenCDNStatus').innerHTML = `<font color=\"black\"></font>`;\n\n\t\t// TODO : re-layout\n\t});\n\n\t//\n\tclient.on('rtmp-success', (evt) =>\n\t{\n\t\tconsole.log(`<demo> - event [rtmp-success] url: ${evt.url} - channelId: ${evt.channelId}`);\n\n\t\tdocument.getElementById('rtmpStatus').innerHTML = `rtmpUrl: ${evt.url}`;\n\t});\n\n\t//\n\tclient.on('rtmp-failure', (evt) =>\n\t{\n\t\tconsole.log(`<demo> - event [rtmp-failure] url: ${evt.url} - channelId: ${evt.channelId}`);\n\n\t\tdocument.getElementById('rtmpStatus').innerHTML = ' - ';\n\t});\n}\n\n// \nlet leaveChanEle = document.getElementById('leaveChan');\nif (!!leaveChanEle)\n{\n\tleaveChanEle.addEventListener('click', () =>\n\t{\n\t\tleaveChan();\n\t})\n}\n\nfunction leaveChan()\n{\n\tif (tttStatus !== 1)\n\t{\n\t\tconsole.log('<demo> leaveChan while tttStatus is not 1?');\n\t\treturn;\n\t}\n\n\ttttStatus = 0;\n\n\tif (client)\n\t{\n\t\tclient.leave(() => { }, () => { });\n\t\tclient.close();\n\t}\n\n\t// \n\tdocument.getElementById('loginStatus').innerHTML = '<font color=\"red\"></font>';\n\tdocument.getElementById('loginInfo').innerHTML = '';\n\n\tconsole.log('<demo> leaveChan OK');\n}\n\n//  RTMP  URL\nlet setRtmpUrlEle = document.getElementById('setRtmpUrl');\nif (!!setRtmpUrlEle)\n{\n\tsetRtmpUrlEle.addEventListener('click', () =>\n\t{\n\t\tif (!!rtmpUrlEle)\n\t\t{\n\t\t\tconst cdnUrl = rtmpUrlEle.value;\n\t\t\tsetRtmpUrl(cdnUrl);\n\t\t}\n\t})\n}\n\nfunction setRtmpUrl(url)\n{\n\tif (!client)\n\t{\n\t\treturn;\n\t}\n\n\t// \n\tconst pureAudioEle = document.getElementById('pureAudio');\n\n\tclient.setRtmpUrl({ url, avMode: pureAudioEle.checked ? 'audio' : 'av' });\n}\n\n/******************* for Audio/Video Stream */\n//\nlet closeStreamEle = document.getElementById('closeStream');\nif (!!closeStreamEle)\n{\n\tcloseStreamEle.addEventListener('click', () =>\n\t{\n\t\tcloseStream();\n\t})\n}\n\n//\nfunction closeStream()\n{\n\tif (!!gStream)\n\t{\n\t\tgStream.close();\n\t}\n\n\tconst videoId = '3t_local';\n\tlet obj = document.getElementById(videoId);\n\tif (obj)\n\t{\n\t\tconsole.log('<demo> closeStream - obj.remove -- 3t_local');\n\t\tobj.remove();\n\t}\n\n\tgStream = null;\n}\n\n// \nlet publishScreenCDNEle = document.getElementById('publishScreenCDN');\nif (!!publishScreenCDNEle)\n{\n\tpublishScreenCDNEle.addEventListener('click', () =>\n\t{\n\t\tsetTimeout(() =>\n\t\t{\n\t\t\tif (!!gAudioVideoStream)\n\t\t\t{\n\t\t\t\tpublishAudioVideoStream();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcreatePublishAudioVideoStream();\n\t\t\t}\n\t\t}, 1000);\n\n\t\tsetTimeout(() =>\n\t\t{\n\t\t\tif (!!gStream)\n\t\t\t{\n\t\t\t\tpublishScreenStream();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcreatePublishScreenStream();\n\t\t\t}\n\t\t}, 2000);\n\t})\n}\n\nlet unpublishScreenCDNEle = document.getElementById('unpublishScreenCDN');\nif (!!unpublishScreenCDNEle)\n{\n\tunpublishScreenCDNEle.addEventListener('click', () =>\n\t{\n\t\tunpublishStream({});\n\t})\n}\n\n// \nfunction createPublishAudioVideoStream()\n{\n\t// \n\tif (tttStatus !== 1)\n\t{\n\t\tconsole.log('<demo> createPublishAudioVideoStream - []');\n\t\treturn;\n\t}\n\n\t// for Audio stream\n\tgAudioVideoStream = RTCObj.createStream({\n\t\tuserid: +userId,\n\t\taudio: true,\n\t\tvideo: true\n\t});\n\n\tif (!gAudioVideoStream)\n\t{\n\t\treturn;\n\t}\n\n\tgAudioVideoStream.init(() =>\n\t{\n\t\tclient.publish(gAudioVideoStream, () => {}, () => {\n\t\t\t// \n\t\t\tgAudioVideoStream.close();\n\t\t\tgAudioVideoStream = null;\n\t\t});\n\t}, (evt) =>\n\t{\n\t\tconsole.log(`<demo> createPublishAudioVideoStream - Stream.init fail - ${evt}`);\n\t\t\n\t\t// \n\t\tgAudioVideoStream.close();\n\t\tgAudioVideoStream = null;\n\t});\n}\n\nfunction publishAudioVideoStream()\n{\n\t// \n\tif (tttStatus !== 1)\n\t{\n\t\tconsole.log('<demo> publishAudioVideoStream - []');\n\t\treturn;\n\t}\n\n\tif (!gAudioVideoStream)\n\t{\n\t\tconsole.log('<demo> publishAudioVideoStream - gAudioVideoStream is null');\n\t\treturn;\n\t}\n\n\tclient.publish(gAudioVideoStream, () => {}, () => {\n\t\t// \n\t\tgAudioVideoStream.close();\n\t\tgAudioVideoStream = null;\n\t});\n}\n\nfunction createPublishScreenStream()\n{\n\t// for screen stream\n\tgStream = RTCObj.createStream({\n\t\tuserId: +userId,\n\t\taudio: true,\n\t\tscreen: true\n\t});\n\n\tif (!gStream)\n\t{\n\t\treturn;\n\t}\n\n\tgStream.init(() =>\n\t{\n\t\tgStream.on('screen-close', (e) =>\n\t\t{\n\t\t\tconsole.log(`<demo> event [screen-close] - ${e.streamId}`);\n\t\t\tunpublishStream({ trackClosed: true });\n\t\t});\n\n\t\tconst videoId = '3t_local';\n\t\tlet videoE = document.createElement('video');\n\t\tvideoE.id = videoId;\n\t\tvideoE.muted = true;\n\t\tvideoE.autoplay = true;\n\t\tvideoE.controls = true;\n\t\tvideoE.setAttribute('playsinline', '');\n\t\tvideoE.style.cssText = 'height: 300px; width: 300px; background: black; position: relative; display: inline-block;'\n\n\t\tif (!!videoEle)\n\t\t{\n\t\t\tvideoEle.append(videoE);\n\t\t}\n\n\t\tgStream.play(videoId, {}, () => {}, () => {});\n\t\t\n\t\tclient.publishScreen(gStream, () => {}, () => {\n\t\t\t// \n\t\t\tgStream.close();\n\t\t\tgStream = null;\n\t\t});\n\t\t// \n\t}, (evt) =>\n\t{\n\t\tconsole.log(`<demo> createPublishScreenStream - Stream.init fail - ${evt}`);\n\t\t\n\t\t// \n\t\tgStream.close();\n\t\tgStream = null;\n\t});\n}\n\nfunction publishScreenStream()\n{\n\t// \n\tif (tttStatus !== 1)\n\t{\n\t\tconsole.log('<demo> publishScreenStream - []');\n\t\treturn;\n\t}\n\n\tif (!gStream)\n\t{\n\t\tconsole.log('<demo> publishScreenStream - gStream is null');\n\t\treturn;\n\t}\n\n\tclient.publishScreen(gStream, () => {}, () => {\n\t\t// \n\t\tgStream.close();\n\t\tgStream = null;\n\t});\n}\n\n// \nfunction unpublishStream(opts)\n{\n\tconst { trackClosed } = opts;\n\n\t// for Audio stream\n\tclient.unpublish(gAudioVideoStream, () => {}, () => {});\n\n\t// for screen stream\n\tclient.unpublishScreen(gStream, () => {}, () => {}, false/*true*/);\n\n\t// \n\tif (!!trackClosed)\n\t{\n\t\t// for Audio Stream\n\t\tif (!!gAudioVideoStream)\n\t\t{\n\t\t\tgAudioVideoStream.close();\n\t\t\tgAudioVideoStream = null;\n\t\t}\n\n\t\t// for screen stream\n\t\tif (!!gStream)\n\t\t{\n\t\t\tgStream.close();\n\t\t\tgStream = null;\n\t\t}\n\n\t\tconst videoId = '3t_local';\n\t\tlet obj = document.getElementById(videoId);\n\t\tif (obj)\n\t\t{\n\t\t\tconsole.log('<demo> unpublishStream - obj.remove -- 3t_local');\n\t\t\tobj.remove();\n\t\t}\n\t}\n}\n\n// \nlet sei = {\n\tts: '',\n\tver: '20161227',\n\tcanvas: {\n\t\tbgrad: [\n\t\t\t232,\n\t\t\t230,\n\t\t\t232\n\t\t],\n\t\th: 480,\n\t\tw: 640\n\t},\n\tmid: '',\n\tpos: []\n}\n// \nfunction setScreenSEI()\n{\n\tlet position = {\n\t\tid: 0,\n\t\th: 0,\n\t\tw: 0,\n\t\tx: 0,\n\t\ty: 0,\n\t\tz: 1\n\t};\n\n\tsei.mid = gStream.userId;\n\tsei.ts = + new Date();\n\tposition.id = gStream.getId();\n\tposition.x = 0;\n\tposition.y = 0;\n\tposition.w = 1;\n\tposition.h = 1;\n\tposition.z = 0;\n\tposition.renderMode = 'scale';\n\n\tsei.pos.push(position);\n\n\tclient.setSEI(gStream.userId, 'add', true, sei);\n};\n\n// \nconst splitWnd1 = [{ x: 0, y: 0 }];\nconst splitWnd4 = [{ x: 0, y: 0 }, { x: 0.5, y: 0 }, { x: 0, y: 0.5 }, { x: 0.5, y: 0.5 }];\nconst splitWnd9 = [{ x: 0, y: 0 }, { x: 0.33, y: 0 }, { x: 0.66, y: 0 }, { x: 0, y: 0.33 }, { x: 0.33, y: 0.33 }, { x: 0.66, y: 0.33 }, { x: 0, y: 0.66 }, { x: 0.33, y: 0.66 }, { x: 0.66, y: 0.66 }];\n\nfunction setLiveMixerLayout()\n{\n\tif (!client)\n\t{\n\t\treturn;\n\t}\n\n\t// \n\tlet liveMixerLayout = {\n\t\tbackgroundColor: 0x000000,\n\t\twidth: 640,\n\t\theight: 360,\n\t\tusers: []\n\t}\n\n\tlet nCnt = remote_stream.size;\n\n\tif (!!gStream)\n\t{\n\t\tnCnt++;\n\t}\n\n\tlet wh = 1;\n\tlet splitWnd = [];\n\tif (nCnt <= 1)\n\t{\n\t\twh = 1;\n\t\tsplitWnd = splitWnd1;\n\t}\n\telse if (nCnt <= 4)\n\t{\n\t\twh = 0.5\n\t\tsplitWnd = splitWnd4;\n\t}\n\telse if (nCnt <= 9)\n\t{\n\t\twh = 0.33\n\t\tsplitWnd = splitWnd9;\n\t}\n\telse\n\t\t; // TODO : \n\n\tlet nIndex = 0;\n\tif (!!gStream)\n\t{\n\t\tlet user = {};\n\n\t\tuser.userId = gStream.userId;\n\t\tuser.streamId = `${gStream.userId}:screen`;\n\t\tuser.x = splitWnd[nIndex].x;\n\t\tuser.y = splitWnd[nIndex].y;\n\t\tuser.w = wh;\n\t\tuser.h = wh;\n\t\tuser.z = 0;\n\t\tuser.renderMode = 'scale';\n\n\t\tliveMixerLayout.users.push(user);\n\n\t\tnIndex++;\n\t}\n\n\t// \n\tif (!!remote_stream)\n\t{\n\t\tremote_stream.forEach((item) =>\n\t\t{\n\t\t\tif (Boolean(item))\n\t\t\t{\n\t\t\t\tlet user = {};\n\t\t\t\t// \n\t\t\t\tuser.userId = item.userId;\n\t\t\t\tuser.streamId = item.getId();\n\t\t\t\tuser.x = splitWnd[nIndex].x;\n\t\t\t\tuser.y = splitWnd[nIndex].y;\n\t\t\t\tuser.w = wh;\n\t\t\t\tuser.h = wh;\n\t\t\t\tuser.z = 0;\n\t\t\t\tuser.renderMode = 'scale';\n\n\t\t\t\tliveMixerLayout.users.push(user);\n\n\t\t\t\tnIndex++;\n\t\t\t}\n\t\t});\n\t}\n\n\tconsole.log(`<demo> setLiveMixerLayout - liveMixerLayout: ${JSON.stringify(liveMixerLayout)}`);\n\n\tclient.setLiveMixerLayout(liveMixerLayout, () => { }, () => { });\n}\n\n\n//# sourceURL=webpack:///./test/av_screen_cdn/js/main.js?");

/***/ })

/******/ });