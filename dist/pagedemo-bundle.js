/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "/dist";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/demo.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./lib/tttwebsdk.js":
/*!**************************!*\
  !*** ./lib/tttwebsdk.js ***!
  \**************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("!function(e,t){ true?module.exports=t():undefined}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,\"a\",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p=\"\",r(r.s=121)}([function(e,t,r){e.exports={default:r(122),__esModule:!0}},function(e,t,r){e.exports={default:r(124),__esModule:!0}},function(e,t){var r=e.exports={version:\"2.6.11\"};\"number\"==typeof __e&&(__e=r)},function(e,t,r){\"use strict\";t.__esModule=!0;var n=i(r(4)),o=i(r(5)),a=\"function\"==typeof o.default&&\"symbol\"==typeof n.default?function(e){return typeof e}:function(e){return e&&\"function\"==typeof o.default&&e.constructor===o.default&&e!==o.default.prototype?\"symbol\":typeof e};function i(e){return e&&e.__esModule?e:{default:e}}t.default=\"function\"==typeof o.default&&\"symbol\"===a(n.default)?function(e){return void 0===e?\"undefined\":a(e)}:function(e){return e&&\"function\"==typeof o.default&&e.constructor===o.default&&e!==o.default.prototype?\"symbol\":void 0===e?\"undefined\":a(e)}},function(e,t,r){e.exports={default:r(126),__esModule:!0}},function(e,t,r){e.exports={default:r(134),__esModule:!0}},function(e,t,r){e.exports={default:r(139),__esModule:!0}},function(e,t,r){e.exports={default:r(142),__esModule:!0}},function(e,t,r){e.exports={default:r(144),__esModule:!0}},function(e,t,r){\"use strict\";var n,o=r(1),a=(n=o)&&n.__esModule?n:{default:n};Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var i=function(e){return e&&e.__esModule?e:{default:e}}(r(113));function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),(0,a.default)(e,n.key,n)}}var c=\"mediasoup-client\",u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,e),t?(this._debug=(0,i.default)(\"\".concat(c,\":\").concat(t)),this._warn=(0,i.default)(\"\".concat(c,\":WARN:\").concat(t)),this._error=(0,i.default)(\"\".concat(c,\":ERROR:\").concat(t))):(this._debug=(0,i.default)(c),this._warn=(0,i.default)(\"\".concat(c,\":WARN\")),this._error=(0,i.default)(\"\".concat(c,\":ERROR\"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}var t,r,n;return t=e,(r=[{key:\"debug\",get:function(){return this._debug}},{key:\"warn\",get:function(){return this._warn}},{key:\"error\",get:function(){return this._error}}])&&s(t.prototype,r),n&&s(t,n),e}();t.default=u},function(e,t,r){e.exports={default:r(152),__esModule:!0}},function(e,t,r){e.exports={default:r(174),__esModule:!0}},function(e,t,r){\"use strict\";var n,o=r(64),a=(n=o)&&n.__esModule?n:{default:n};Object.defineProperty(t,\"__esModule\",{value:!0}),t.randomNumber=function(){return i()},t.clone=function(e){return JSON.parse((0,a.default)(e))};var i=function(e){return e&&e.__esModule?e:{default:e}}(r(119)).default.generator({min:1e7,max:99999999,integer:!0})},function(e,t,r){var n=r(15),o=r(2),a=r(27),i=r(31),s=r(37),c=function(e,t,r){var u,d,l,f=e&c.F,p=e&c.G,m=e&c.S,h=e&c.P,v=e&c.B,_=e&c.W,y=p?o:o[t]||(o[t]={}),g=y.prototype,b=p?n:m?n[t]:(n[t]||{}).prototype;for(u in p&&(r=t),r)(d=!f&&b&&void 0!==b[u])&&s(y,u)||(l=d?b[u]:r[u],y[u]=p&&\"function\"!=typeof b[u]?r[u]:v&&d?a(l,n):_&&b[u]==l?function(e){var t=function(t,r,n){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,r)}return new e(t,r,n)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(l):h&&\"function\"==typeof l?a(Function.call,l):l,h&&((y.virtual||(y.virtual={}))[u]=l,e&c.R&&g&&!g[u]&&i(g,u,l)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},function(e,t,r){\"use strict\";var n=l(r(8)),o=l(r(7)),a=l(r(0)),i=l(r(6)),s=l(r(1)),c=l(r(4)),u=l(r(3)),d=l(r(5));function l(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var f,p=r(33),m=(f=r(9))&&f.__esModule?f:{default:f};function h(e){return(h=\"function\"==typeof d.default&&\"symbol\"===(0,u.default)(c.default)?function(e){return void 0===e?\"undefined\":(0,u.default)(e)}:function(e){return e&&\"function\"==typeof d.default&&e.constructor===d.default&&e!==d.default.prototype?\"symbol\":void 0===e?\"undefined\":(0,u.default)(e)})(e)}function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),(0,s.default)(e,n.key,n)}}function _(e,t){return!t||\"object\"!==h(t)&&\"function\"!=typeof t?function(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}(e):t}function y(e){return(y=i.default?a.default:function(e){return e.__proto__||(0,a.default)(e)})(e)}function g(e,t){return(g=i.default||function(e,t){return e.__proto__=t,e})(e,t)}var b=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,t),(r=_(this,y(t).call(this))).setMaxListeners(1/0),r._logger=e||new m.default(\"EnhancedEventEmitter\"),r}var r,a,i;return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=(0,o.default)(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(t,e),r=t,(a=[{key:\"safeEmit\",value:function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.emit.apply(this,[e].concat(r))}catch(t){this._logger.error(\"safeEmit() | event listener threw an error [event:%s]:%o\",e,t)}}},{key:\"safeEmitAsPromise\",value:function(e){for(var t=this,r=arguments.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return new n.default((function(r,n){t.safeEmit.apply(t,[e].concat(o,[function(e){r(e)},function(r){t._logger.error(\"safeEmitAsPromise() | errback called [event:%s]:%o\",e,r),n(r)}]))}))}}])&&v(r.prototype,a),i&&v(r,i),t}(p.EventEmitter);t.default=b},function(e,t){var r=e.exports=\"undefined\"!=typeof window&&window.Math==Math?window:\"undefined\"!=typeof self&&self.Math==Math?self:Function(\"return this\")();\"number\"==typeof __g&&(__g=r)},function(e,t){e.exports=function(e){return\"object\"==typeof e?null!==e:\"function\"==typeof e}},function(e,t,r){var n=r(67)(\"wks\"),o=r(58),a=r(15).Symbol,i=\"function\"==typeof a;(e.exports=function(e){return n[e]||(n[e]=i&&a[e]||(i?a:o)(\"Symbol.\"+e))}).store=n},function(e,t,r){\"use strict\";var n,o=r(21),a=(n=o)&&n.__esModule?n:{default:n};function i(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var s,c=function(){var e=s.value,n=(t.rtcpFeedback||[]).find((function(t){return t.type===e.type&&t.parameter===e.parameter}));n&&r.push(n)},u=(0,a.default)(e.rtcpFeedback||[]);!(n=(s=u.next()).done);n=!0)c()}catch(e){o=!0,i=e}finally{try{n||null==u.return||u.return()}finally{if(o)throw i}}return r}Object.defineProperty(t,\"__esModule\",{value:!0}),t.getExtendedRtpCapabilities=function(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=!0,o=!1,s=void 0;try{for(var c,u=function(){var t=c.value;if(\"rtx\"===t.name)return\"continue\";var n=(e.codecs||[]).find((function(e){return function(e,t){var r=e.mimeType.toLowerCase(),n=t.mimeType.toLowerCase();if(r!==n)return!1;if(e.clockRate!==t.clockRate)return!1;if(e.channels!==t.channels)return!1;if(\"video/h264\"===r){var o=(e.parameters||{})[\"packetization-mode\"]||0,a=(t.parameters||{})[\"packetization-mode\"]||0;if(o!==a)return!1}return!0}(e,t)}));if(n){var o={name:t.name,mimeType:t.mimeType,kind:t.kind,clockRate:t.clockRate,sendPayloadType:n.preferredPayloadType,sendRtxPayloadType:null,recvPayloadType:t.preferredPayloadType,recvRtxPayloadType:null,channels:t.channels,rtcpFeedback:i(n,t),parameters:t.parameters};o.channels||delete o.channels,r.codecs.push(o)}},d=(0,a.default)(t.codecs||[]);!(n=(c=d.next()).done);n=!0)u()}catch(e){o=!0,s=e}finally{try{n||null==d.return||d.return()}finally{if(o)throw s}}var l=!0,f=!1,p=void 0;try{for(var m,h=function(){var r=m.value,n=(e.codecs||[]).find((function(e){return\"rtx\"===e.name&&e.parameters.apt===r.sendPayloadType})),o=(t.codecs||[]).find((function(e){return\"rtx\"===e.name&&e.parameters.apt===r.recvPayloadType}));n&&o&&(r.sendRtxPayloadType=n.preferredPayloadType,r.recvRtxPayloadType=o.preferredPayloadType)},v=(0,a.default)(r.codecs||[]);!(l=(m=v.next()).done);l=!0)h()}catch(e){f=!0,p=e}finally{try{l||null==v.return||v.return()}finally{if(f)throw p}}var _=!0,y=!1,g=void 0;try{for(var b,w=function(){var t=b.value,n=(e.headerExtensions||[]).find((function(e){return n=t,!((r=e).kind&&n.kind&&r.kind!==n.kind||r.uri!==n.uri);var r,n}));if(n){var o={kind:t.kind,uri:t.uri,sendId:n.preferredId,recvId:t.preferredId};r.headerExtensions.push(o)}},k=(0,a.default)(t.headerExtensions||[]);!(_=(b=k.next()).done);_=!0)w()}catch(e){y=!0,g=e}finally{try{_||null==k.return||k.return()}finally{if(y)throw g}}return r},t.getRtpCapabilities=function(e){var t={codecs:[],headerExtensions:[],fecMechanisms:[]},r=!0,n=!1,o=void 0;try{for(var i,s=(0,a.default)(e.codecs);!(r=(i=s.next()).done);r=!0){var c=i.value,u={name:c.name,mimeType:c.mimeType,kind:c.kind,clockRate:c.clockRate,preferredPayloadType:c.recvPayloadType,channels:c.channels,rtcpFeedback:c.rtcpFeedback,parameters:c.parameters};if(u.channels||delete u.channels,t.codecs.push(u),c.recvRtxPayloadType){var d={name:\"rtx\",mimeType:\"\".concat(c.kind,\"/rtx\"),kind:c.kind,clockRate:c.clockRate,preferredPayloadType:c.recvRtxPayloadType,parameters:{apt:c.recvPayloadType}};t.codecs.push(d)}}}catch(e){n=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(n)throw o}}var l=!0,f=!1,p=void 0;try{for(var m,h=(0,a.default)(e.headerExtensions);!(l=(m=h.next()).done);l=!0){var v=m.value,_={kind:v.kind,uri:v.uri,preferredId:v.recvId};t.headerExtensions.push(_)}}catch(e){f=!0,p=e}finally{try{l||null==h.return||h.return()}finally{if(f)throw p}}return t.fecMechanisms=e.fecMechanisms,t},t.getUnsupportedCodecs=function(e,t,r){if(!Array.isArray(t))return[];var n=[],o=e.codecs,i=r.codecs,s=!0,c=!1,u=void 0;try{for(var d,l=function(){var e=d.value;if(!i.some((function(t){return t.recvPayloadType===e}))){var t=o.find((function(t){return t.preferredPayloadType===e}));if(!t)throw new Error(\"mandatory codec PT \".concat(e,\" not found in remote codecs\"));n.push(t)}},f=(0,a.default)(t);!(s=(d=f.next()).done);s=!0)l()}catch(e){c=!0,u=e}finally{try{s||null==f.return||f.return()}finally{if(c)throw u}}return n},t.canSend=function(e,t){return t.codecs.some((function(t){return t.kind===e}))},t.canReceive=function(e,t){if(0===e.codecs.length)return!1;var r=e.codecs[0];return t.codecs.some((function(e){return e.recvPayloadType===r.payloadType}))},t.getSendingRtpParameters=function(e,t){var r={muxId:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},n=!0,o=!1,i=void 0;try{for(var s,c=(0,a.default)(t.codecs);!(n=(s=c.next()).done);n=!0){var u=s.value;if(u.kind===e){var d={name:u.name,mimeType:u.mimeType,clockRate:u.clockRate,payloadType:u.sendPayloadType,channels:u.channels,rtcpFeedback:u.rtcpFeedback,parameters:u.parameters};if(d.channels||delete d.channels,r.codecs.push(d),u.sendRtxPayloadType){var l={name:\"rtx\",mimeType:\"\".concat(u.kind,\"/rtx\"),clockRate:u.clockRate,payloadType:u.sendRtxPayloadType,parameters:{apt:u.sendPayloadType}};r.codecs.push(l)}break}}}catch(e){o=!0,i=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw i}}var f=!0,p=!1,m=void 0;try{for(var h,v=(0,a.default)(t.headerExtensions);!(f=(h=v.next()).done);f=!0){var _=h.value;if(!_.kind||_.kind===e){var y={uri:_.uri,id:_.sendId};r.headerExtensions.push(y)}}}catch(e){p=!0,m=e}finally{try{f||null==v.return||v.return()}finally{if(p)throw m}}return r},t.getReceivingFullRtpParameters=function(e,t){var r={muxId:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},n=!0,o=!1,i=void 0;try{for(var s,c=(0,a.default)(t.codecs);!(n=(s=c.next()).done);n=!0){var u=s.value;if(u.kind===e){var d={name:u.name,mimeType:u.mimeType,clockRate:u.clockRate,payloadType:u.recvPayloadType,channels:u.channels,rtcpFeedback:u.rtcpFeedback,parameters:u.parameters};if(d.channels||delete d.channels,r.codecs.push(d),u.recvRtxPayloadType){var l={name:\"rtx\",mimeType:\"\".concat(u.kind,\"/rtx\"),clockRate:u.clockRate,payloadType:u.recvRtxPayloadType,parameters:{apt:u.recvPayloadType}};r.codecs.push(l)}}}}catch(e){o=!0,i=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw i}}var f=!0,p=!1,m=void 0;try{for(var h,v=(0,a.default)(t.headerExtensions);!(f=(h=v.next()).done);f=!0){var _=h.value;if(!_.kind||_.kind===e){var y={uri:_.uri,id:_.recvId};r.headerExtensions.push(y)}}}catch(e){p=!0,m=e}finally{try{f||null==v.return||v.return()}finally{if(p)throw m}}return r}},function(e,t,r){\"use strict\";var n=r(187),o=r(188);t.write=o,t.parse=n.parse,t.parseFmtpConfig=n.parseFmtpConfig,t.parseParams=n.parseParams,t.parsePayloads=n.parsePayloads,t.parseRemoteCandidates=n.parseRemoteCandidates,t.parseImageAttributes=n.parseImageAttributes,t.parseSimulcastStreamList=n.parseSimulcastStreamList},function(e,t,r){e.exports={default:r(179),__esModule:!0}},function(e,t,r){e.exports={default:r(169),__esModule:!0}},function(e,t,r){var n=r(23),o=r(88),a=r(69),i=Object.defineProperty;t.f=r(24)?Object.defineProperty:function(e,t,r){if(n(e),t=a(t,!0),n(r),o)try{return i(e,t,r)}catch(e){}if(\"get\"in r||\"set\"in r)throw TypeError(\"Accessors not supported!\");return\"value\"in r&&(e[t]=r.value),e}},function(e,t,r){var n=r(16);e.exports=function(e){if(!n(e))throw TypeError(e+\" is not an object!\");return e}},function(e,t,r){e.exports=!r(32)((function(){return 7!=Object.defineProperty({},\"a\",{get:function(){return 7}}).a}))},function(e,t,r){e.exports={default:r(182),__esModule:!0}},function(e,t,r){\"use strict\";var n=i(r(20)),o=i(r(21)),a=i(r(10));function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.extractRtpCapabilities=function(e){var t=new a.default,r=[],i=!1,s=!1,u=!0,d=!1,l=void 0;try{for(var f,p=(0,o.default)(e.media);!(u=(f=p.next()).done);u=!0){var m=f.value,h=m.type;switch(h){case\"audio\":if(i)continue;i=!0;break;case\"video\":if(s)continue;s=!0;break;default:continue}var v=!0,_=!1,y=void 0;try{for(var g,b=(0,o.default)(m.rtp);!(v=(g=b.next()).done);v=!0){var w=g.value,k={name:w.codec,mimeType:\"\".concat(h,\"/\").concat(w.codec),kind:h,clockRate:w.rate,preferredPayloadType:w.payload,channels:w.encoding,rtcpFeedback:[],parameters:{}};\"audio\"!==k.kind?delete k.channels:k.channels||(k.channels=1),t.set(k.preferredPayloadType,k)}}catch(e){_=!0,y=e}finally{try{v||null==b.return||b.return()}finally{if(_)throw y}}var P=!0,T=!1,S=void 0;try{for(var R,C=(0,o.default)(m.fmtp||[]);!(P=(R=C.next()).done);P=!0){var x=R.value,E=c.default.parseFmtpConfig(x.config),I=t.get(x.payload);I&&(I.parameters=E)}}catch(e){T=!0,S=e}finally{try{P||null==C.return||C.return()}finally{if(T)throw S}}var D=!0,O=!1,L=void 0;try{for(var j,M=(0,o.default)(m.rtcpFb||[]);!(D=(j=M.next()).done);D=!0){var A=j.value,F=t.get(A.payload);if(F){var N={type:A.type,parameter:A.subtype};N.parameter||delete N.parameter,F.rtcpFeedback.push(N)}}}catch(e){O=!0,L=e}finally{try{D||null==M.return||M.return()}finally{if(O)throw L}}var U=!0,V=!1,B=void 0;try{for(var G,W=(0,o.default)(m.ext||[]);!(U=(G=W.next()).done);U=!0){var q=G.value,z={kind:h,uri:q.uri,preferredId:q.value};r.push(z)}}catch(e){V=!0,B=e}finally{try{U||null==W.return||W.return()}finally{if(V)throw B}}}}catch(e){d=!0,l=e}finally{try{u||null==p.return||p.return()}finally{if(d)throw l}}return{codecs:(0,n.default)(t.values()),headerExtensions:r,fecMechanisms:[]}},t.extractDtlsParameters=function(e){var t,r=function(e){return(e.media||[]).find((function(e){return e.iceUfrag&&0!==e.port}))}(e),n=r.fingerprint||e.fingerprint;switch(r.setup){case\"active\":t=\"client\";break;case\"passive\":t=\"server\";break;case\"actpass\":t=\"auto\"}return{role:t,fingerprints:[{algorithm:n.type,value:n.hash}]}};var s,c=(s=r(19))&&s.__esModule?s:{default:s}},function(e,t,r){var n=r(38);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,o){return e.call(t,r,n,o)}}return function(){return e.apply(t,arguments)}}},function(e,t,r){\"use strict\";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}},function(e,t,r){\"use strict\";t.__esModule=!0;var n,o=r(1),a=(n=o)&&n.__esModule?n:{default:n};t.default=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),(0,a.default)(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}()},function(e,t,r){\"use strict\";var n,o=r(10);var a=new((n=o)&&n.__esModule?n:{default:n}).default([[80,{width:80,height:60}],[120,{width:120,height:90}],[160,{width:160,height:120}],[200,{width:200,height:150}],[240,{width:240,height:180}],[300,{width:300,height:225}],[360,{width:360,height:270}],[480,{width:480,height:360}],[540,{width:720,height:540}],[720,{width:1080,height:720}],[1080,{width:1920,height:1080}]]);e.exports={clientConfig:{mode:\"live\",codec:\"vp8\",proxyServer:\"YOUR NGINX PROXY SERVER IP\",turnServer:{turnServerURL:\"turn:122.68.221.60\",username:\"ttt\",password:\"ttt\",udpport:\"THE UDP PORT YOU WANT TO ADD\",tcpport:\"THE TCP PORT YOU WANT TO ADD\",forceturn:!1},svcRootUrl:\"119_3_245_117.3ttech.cn\",role:\"2\",publish_rtmp_url:\"rtmp://push.3ttech.cn/sdk/?\",subcribe_rtmp_url:\"rtmp://pull.3ttech.cn/sdk/?\"},logLevel:{LOG_NONE:6,LOG_ERROR:5,LOG_WARN:4,LOG_INFO:3,LOG_DEBUG:2,LOG_TRACE:1},authUrl:\"https://apiusercenter.3ttech.cn/authority.php\",videoProfile:{Profile_80p:\"80p\",Profile_120p:\"120p\",Profile_180p:\"180p\",Profile_240p:\"240p\",Profile_360p:\"360p\",Profile_480p:\"480p\",Profile_720p:\"720p\",Profile_1080p:\"1080p\"},audioSpec:{sampleRate:{min:4e3,max:48e3,ideal:8e3},channelCount:{min:1,max:2,ideal:1}},videoSpec:{width:{min:\"80\",ideal:\"640\",max:\"1080\"},height:{min:\"60\",ideal:\"480\",max:\"720\"},bitrate:{min:80,max:300,ideal:200},frameRate:{min:2,ideal:15,max:30},aspectRatio:4/3},mediaServerAddress:\"\",iplocationAddress:\"srtcm1.feinnoonline.com\",iplocationPort:443,logserver_url:\"https://log4websdk.3ttech.cn/webSdk/putInfo\",videoResolution:a,videoAttributes:{sif:[320,160],vga:[640,480],hd720p:[1280,720]},protoo_peer_RETRY_OPTIONS:{retries:3,factor:2,minTimeout:1e3,maxTimeout:8e3},statClient:!1,stat2Server:!0,privateNet:!1,log2Server:!0,screenSpec:{s_frameRate:15,s_720p:{maxWidth:1280,maxHight:720,maxAspectRatio:1.77},s_1080p:{maxWidth:1920,maxHight:1080,maxAspectRatio:1.77},s_2k:{maxWidth:2048,maxHight:1080,maxAspectRatio:1.77},s_4k:{maxWidth:3840,maxHight:2160,maxAspectRatio:1.77},s_8k:{maxWidth:7680,maxHight:4320,maxAspectRatio:1.77}}}},function(e,t,r){var n=r(22),o=r(48);e.exports=r(24)?function(e,t,r){return n.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,r){\"use strict\";var n,o=\"object\"==typeof Reflect?Reflect:null,a=o&&\"function\"==typeof o.apply?o.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};n=o&&\"function\"==typeof o.ownKeys?o.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var c=10;function u(e){if(\"function\"!=typeof e)throw new TypeError('The \"listener\" argument must be of type Function. Received type '+typeof e)}function d(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function l(e,t,r,n){var o,a,i,s;if(u(r),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit(\"newListener\",t,r.listener?r.listener:r),a=e._events),i=a[t]),void 0===i)i=a[t]=r,++e._eventsCount;else if(\"function\"==typeof i?i=a[t]=n?[r,i]:[i,r]:n?i.unshift(r):i.push(r),(o=d(e))>0&&i.length>o&&!i.warned){i.warned=!0;var c=new Error(\"Possible EventEmitter memory leak detected. \"+i.length+\" \"+String(t)+\" listeners added. Use emitter.setMaxListeners() to increase limit\");c.name=\"MaxListenersExceededWarning\",c.emitter=e,c.type=t,c.count=i.length,s=c,console&&console.warn&&console.warn(s)}return e}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},o=f.bind(n);return o.listener=r,n.wrapFn=o,o}function m(e,t,r){var n=e._events;if(void 0===n)return[];var o=n[t];return void 0===o?[]:\"function\"==typeof o?r?[o.listener||o]:[o]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(o):v(o,o.length)}function h(e){var t=this._events;if(void 0!==t){var r=t[e];if(\"function\"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function v(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}Object.defineProperty(s,\"defaultMaxListeners\",{enumerable:!0,get:function(){return c},set:function(e){if(\"number\"!=typeof e||e<0||i(e))throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received '+e+\".\");c=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if(\"number\"!=typeof e||e<0||i(e))throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received '+e+\".\");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return d(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n=\"error\"===e,o=this._events;if(void 0!==o)n=n&&void 0===o.error;else if(!n)return!1;if(n){var i;if(t.length>0&&(i=t[0]),i instanceof Error)throw i;var s=new Error(\"Unhandled error.\"+(i?\" (\"+i.message+\")\":\"\"));throw s.context=i,s}var c=o[e];if(void 0===c)return!1;if(\"function\"==typeof c)a(c,this,t);else{var u=c.length,d=v(c,u);for(r=0;r<u;++r)a(d[r],this,t)}return!0},s.prototype.addListener=function(e,t){return l(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return l(this,e,t,!0)},s.prototype.once=function(e,t){return u(t),this.on(e,p(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,p(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,n,o,a,i;if(u(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit(\"removeListener\",e,r.listener||t));else if(\"function\"!=typeof r){for(o=-1,a=r.length-1;a>=0;a--)if(r[a]===t||r[a].listener===t){i=r[a].listener,o=a;break}if(o<0)return this;0===o?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,o),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit(\"removeListener\",e,i||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var o,a=Object.keys(r);for(n=0;n<a.length;++n)\"removeListener\"!==(o=a[n])&&this.removeAllListeners(o);return this.removeAllListeners(\"removeListener\"),this._events=Object.create(null),this._eventsCount=0,this}if(\"function\"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},s.prototype.listeners=function(e){return m(this,e,!0)},s.prototype.rawListeners=function(e){return m(this,e,!1)},s.listenerCount=function(e,t){return\"function\"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},s.prototype.listenerCount=h,s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t,r){\"use strict\";var n=a(r(28)),o=a(r(29));function a(e){return e&&e.__esModule?e:{default:e}}var i=r(113),s=r(30).logLevel,c=(r(30),\"tttwebsdk\"),u=s.LOG_TRACE,d=function(){function e(t){(0,n.default)(this,e),t?(this._prefix=\"tttwebsdk:\"+t,this._debug=i(\"tttwebsdk:\"+t),this._warn=i(\"tttwebsdk:WARN:\"+t),this._error=i(\"tttwebsdk:ERROR:\"+t)):(this._prefix=\"tttwebsdk\",this._debug=i(c),this._warn=i(\"tttwebsdk:WARN\"),this._error=i(\"tttwebsdk:ERROR\")),this._debug=this._log_debug.bind(this),this._warn=this._log_warn.bind(this),this._error=this._log_error.bind(this),this._setLoggerLevel=this.setLoggerLevel}return(0,o.default)(e,[{key:\"setLoggerLevel\",value:function(t){e.logLevel=t}},{key:\"_log_debug\",value:function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];e.logLevel<=s.LOG_INFO&&console.log.apply(console,r),this._log.apply(this,r)}},{key:\"_log_error\",value:function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];e.logLevel<=s.LOG_ERROR&&console.error.apply(console,r),this._log.apply(this,r)}},{key:\"_log_warn\",value:function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];e.logLevel<=s.LOG_WARN&&console.warn.apply(console,r),this._log.apply(this,r)}},{key:\"_log\",value:function(){}},{key:\"debug\",get:function(){return this._debug}},{key:\"warn\",get:function(){return this._warn}},{key:\"error\",get:function(){return this._error}}],[{key:\"logLevel\",get:function(){return u},set:function(e){switch(e){case\"LOG_NONE\":u=s.LOG_NONE;break;case\"LOG_ERROR\":u=s.LOG_ERROR;break;case\"LOG_WARN\":u=s.LOG_WARN;break;case\"LOG_INFO\":u=s.LOG_INFO;break;case\"LOG_DEBUG\":u=s.LOG_DEBUG;break;case\"LOG_TRACE\":u=s.LOG_TRACE;break;default:throw TypeError(\"parameter error. must be: LOG_NONE, LOG_ERROR, LOG_WARN, LOG_INFO, LOG_DEBUG, LOG_TRACE\")}}}]),e}();e.exports=d,e.exports=function(e){return new d(e)}},function(e,t,r){e.exports={default:r(167),__esModule:!0}},function(e,t,r){var n=r(65);e.exports=function(e){return Object(n(e))}},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t){e.exports=function(e){if(\"function\"!=typeof e)throw TypeError(e+\" is not a function!\");return e}},function(e,t,r){var n=r(72),o=r(65);e.exports=function(e){return n(o(e))}},function(e,t,r){\"use strict\";t.__esModule=!0;var n,o=r(3),a=(n=o)&&n.__esModule?n:{default:n};t.default=function(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!==(void 0===t?\"undefined\":(0,a.default)(t))&&\"function\"!=typeof t?e:t}},function(e,t,r){\"use strict\";var n=r(127)(!0);r(71)(String,\"String\",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=n(t,r),this._i+=e.length,{value:e,done:!1})}))},function(e,t,r){\"use strict\";t.__esModule=!0;var n=i(r(6)),o=i(r(7)),a=i(r(3));function i(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+(void 0===t?\"undefined\":(0,a.default)(t)));e.prototype=(0,o.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(n.default?(0,n.default)(e,t):e.__proto__=t)}},function(e,t,r){\"use strict\";var n=i(r(10)),o=i(r(25)),a=i(r(21));function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var s,c=(0,a.default)(e);!(n=(s=c.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw i}}return r}(e,t)||function(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}()}function c(e,t,r){var n;if(null!=r){if(r=String(r),!(n=(e.media||[]).find((function(e){return String(e.mid)===r}))))throw new Error(\"SDP section with mid=\".concat(r,\" not found\"))}else if(!(n=(e.media||[]).find((function(e){return e.type===t.kind&&e.msid&&e.msid.split(\" \")[1]===t.id}))))throw new Error(\"SDP section with a=msid containing track.id=\".concat(t.id,\" not found\"));return n}Object.defineProperty(t,\"__esModule\",{value:!0}),t.fillRtpParametersForTrack=function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},u=i.mid,d=void 0===u?null:u,l=i.planBSimulcast,f=void 0!==l&&l,p=c(t,r,d);null!=d&&(e.muxId=String(d));e.rtcp={cname:null,reducedSize:!0,mux:!0};var m=(p.ssrcs||[]).find((function(e){return\"cname\"===e.attribute}));if(!m)throw new Error(\"CNAME value not found\");if(e.rtcp.cname=m.value,f){var h,v=new o.default,_=!0,y=!1,g=void 0;try{for(var b,w=(0,a.default)(p.ssrcs||[]);!(_=(b=w.next()).done);_=!0){var k=b.value;if(\"msid\"===k.attribute){var P=k.id;v.add(P),h||(h=P)}}}catch(e){y=!0,g=e}finally{try{_||null==w.return||w.return()}finally{if(y)throw g}}if(0===v.size)throw new Error(\"no a=ssrc lines found\");var T=new n.default,S=!0,R=!1,C=void 0;try{for(var x,E=(0,a.default)(p.ssrcGroups||[]);!(S=(x=E.next()).done);S=!0){var I=x.value;if(\"FID\"===I.semantics){var D=I.ssrcs.split(/\\s+/),O=s(D,2),L=O[0],j=O[1];L=Number(L),j=Number(j),v.has(L)&&(v.delete(L),v.delete(j),T.set(L,j))}}}catch(e){R=!0,C=e}finally{try{S||null==E.return||E.return()}finally{if(R)throw C}}var M=!0,A=!1,F=void 0;try{for(var N,U=(0,a.default)(v);!(M=(N=U.next()).done);M=!0){var V=N.value;T.set(V,null)}}catch(e){A=!0,F=e}finally{try{M||null==U.return||U.return()}finally{if(A)throw F}}e.encodings=[];var B=T.size>1,G=[\"low\",\"medium\",\"high\"],W=!0,q=!1,z=void 0;try{for(var K,H=(0,a.default)(T);!(W=(K=H.next()).done);W=!0){var J=s(K.value,2),Y=J[0],Q=(j=J[1],{ssrc:Y});j&&(Q.rtx={ssrc:j}),B&&(Q.profile=G.shift()),e.encodings.push(Q)}}catch(e){q=!0,z=e}finally{try{W||null==H.return||H.return()}finally{if(q)throw z}}}else{var $=m.id,Z=[],X=!0,ee=!1,te=void 0;try{for(var re,ne=(0,a.default)(p.rids||[]);!(X=(re=ne.next()).done);X=!0){var oe=re.value;\"send\"===oe.direction&&(/^low/.test(oe.id)?Z.push({rid:oe.id,profile:\"low\"}):/^medium/.test(oe.id)&&Z.push({rid:oe.id,profile:\"medium\"}),/^high/.test(oe.id)&&Z.push({rid:oe.id,profile:\"high\"}))}}catch(e){ee=!0,te=e}finally{try{X||null==ne.return||ne.return()}finally{if(ee)throw te}}if(e.encodings=[],0===Z.length){var ae={ssrc:$};e.encodings.push(ae)}else for(var ie=0;ie<Z.length;ie++){var se=Z[ie],ce={encodingId:se.rid,profile:se.profile};e.encodings.push(ce)}}},t.addPlanBSimulcast=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.mid,o=void 0===n?null:n,a=c(e,t,o),i=(a.ssrcs||[]).find((function(e){return\"msid\"===e.attribute}));if(!i)throw new Error(\"a=ssrc line with msid information not found\");var s,u=i.id,d=i.value.split(\" \")[0];(a.ssrcGroups||[]).some((function(e){if(\"FID\"===e.semantics){var t=e.ssrcs.split(/\\s+/);return Number(t[0])===u?(s=Number(t[1]),!0):void 0}}));var l=a.ssrcs.find((function(e){return\"cname\"===e.attribute&&e.id===u}));if(!l)throw new Error(\"CNAME line not found\");var f=l.value,p=u+1,m=u+2;if(a.ssrcGroups=[],a.ssrcs=[],a.ssrcGroups.push({semantics:\"SIM\",ssrcs:\"\".concat(u,\" \").concat(p,\" \").concat(m)}),a.ssrcs.push({id:u,attribute:\"cname\",value:f}),a.ssrcs.push({id:u,attribute:\"msid\",value:\"\".concat(d,\" \").concat(t.id)}),a.ssrcs.push({id:p,attribute:\"cname\",value:f}),a.ssrcs.push({id:p,attribute:\"msid\",value:\"\".concat(d,\" \").concat(t.id)}),a.ssrcs.push({id:m,attribute:\"cname\",value:f}),a.ssrcs.push({id:m,attribute:\"msid\",value:\"\".concat(d,\" \").concat(t.id)}),s){var h=s+1,v=s+2;a.ssrcGroups.push({semantics:\"FID\",ssrcs:\"\".concat(u,\" \").concat(s)}),a.ssrcs.push({id:s,attribute:\"cname\",value:f}),a.ssrcs.push({id:s,attribute:\"msid\",value:\"\".concat(d,\" \").concat(t.id)}),a.ssrcGroups.push({semantics:\"FID\",ssrcs:\"\".concat(p,\" \").concat(h)}),a.ssrcs.push({id:h,attribute:\"cname\",value:f}),a.ssrcs.push({id:h,attribute:\"msid\",value:\"\".concat(d,\" \").concat(t.id)}),a.ssrcGroups.push({semantics:\"FID\",ssrcs:\"\".concat(m,\" \").concat(v)}),a.ssrcs.push({id:v,attribute:\"cname\",value:f}),a.ssrcs.push({id:v,attribute:\"msid\",value:\"\".concat(d,\" \").concat(t.id)})}}},function(e,t,r){\"use strict\";var n=p(r(35)),o=p(r(21)),a=p(r(7)),i=p(r(0)),s=p(r(6)),c=p(r(4)),u=p(r(3)),d=p(r(5)),l=p(r(11)),f=p(r(1));function p(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var m=_(r(19)),h=_(r(9)),v=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=f.default&&l.default?(0,l.default)(e,r):{};n.get||n.set?(0,f.default)(t,r,n):t[r]=e[r]}return t.default=e,t}(r(12));function _(e){return e&&e.__esModule?e:{default:e}}function y(e){return(y=\"function\"==typeof d.default&&\"symbol\"===(0,u.default)(c.default)?function(e){return void 0===e?\"undefined\":(0,u.default)(e)}:function(e){return e&&\"function\"==typeof d.default&&e.constructor===d.default&&e!==d.default.prototype?\"symbol\":void 0===e?\"undefined\":(0,u.default)(e)})(e)}function g(e,t){return!t||\"object\"!==y(t)&&\"function\"!=typeof t?function(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}(e):t}function b(e){return(b=s.default?i.default:function(e){return e.__proto__||(0,i.default)(e)})(e)}function w(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=(0,a.default)(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}function k(e,t){return(k=s.default||function(e,t){return e.__proto__=t,e})(e,t)}function P(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function T(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),(0,f.default)(e,n.key,n)}}function S(e,t,r){return t&&T(e.prototype,t),r&&T(e,r),e}var R=new h.default(\"RemoteUnifiedPlanSdp\"),C=function(){function e(t){P(this,e),this._rtpParametersByKind=t,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:v.randomNumber(),version:0}}return S(e,[{key:\"setTransportLocalParameters\",value:function(e){R.debug(\"setTransportLocalParameters() [transportLocalParameters:%o]\",e),this._transportLocalParameters=e}},{key:\"setTransportRemoteParameters\",value:function(e){R.debug(\"setTransportRemoteParameters() [transportRemoteParameters:%o]\",e),this._transportRemoteParameters=e}},{key:\"updateTransportRemoteIceParameters\",value:function(e){R.debug(\"updateTransportRemoteIceParameters() [remoteIceParameters:%o]\",e),this._transportRemoteParameters.iceParameters=e}}]),e}(),x=function(e){function t(e){return P(this,t),g(this,b(t).call(this,e))}return w(t,e),S(t,[{key:\"createAnswerSdp\",value:function(e){if(R.debug(\"createAnswerSdp()\"),!this._transportLocalParameters)throw new Error(\"no transport local parameters\");if(!this._transportRemoteParameters)throw new Error(\"no transport remote parameters\");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,a=this._transportRemoteParameters.dtlsParameters,i={},s=(e.media||[]).filter((function(e){return e.hasOwnProperty(\"mid\")})).map((function(e){return String(e.mid)}));this._sdpGlobalFields.version++,i.version=0,i.origin={address:\"0.0.0.0\",ipVer:4,netType:\"IN\",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:\"mediasoup-client\"},i.name=\"-\",i.timing={start:0,stop:0},i.icelite=t.iceLite?\"ice-lite\":null,i.msidSemantic={semantic:\"WMS\",token:\"*\"},s.length>0&&(i.groups=[{type:\"BUNDLE\",mids:s.join(\" \")}]),i.media=[];var c=a.fingerprints.length;i.fingerprint={type:a.fingerprints[c-1].algorithm,hash:a.fingerprints[c-1].value};var u=!0,d=!1,l=void 0;try{for(var f,p=(0,o.default)(e.media||[]);!(u=(f=p.next()).done);u=!0){var h=f.value,v=\"inactive\"===h.direction,_=h.type,y=this._rtpParametersByKind[_].codecs,g=this._rtpParametersByKind[_].headerExtensions,b={};b.type=h.type,b.port=7,b.protocol=\"RTP/SAVPF\",b.connection={ip:\"127.0.0.1\",version:4},b.mid=h.mid,b.iceUfrag=t.usernameFragment,b.icePwd=t.password,b.candidates=[];var w=!0,k=!1,P=void 0;try{for(var T,S=(0,o.default)(r);!(w=(T=S.next()).done);w=!0){var C=T.value,x={component:1};x.foundation=C.foundation,x.ip=C.ip,x.port=C.port,x.priority=C.priority,x.transport=C.protocol,x.type=C.type,C.tcpType&&(x.tcptype=C.tcpType),b.candidates.push(x)}}catch(e){k=!0,P=e}finally{try{w||null==S.return||S.return()}finally{if(k)throw P}}switch(b.endOfCandidates=\"end-of-candidates\",b.iceOptions=\"renomination\",a.role){case\"client\":b.setup=\"active\";break;case\"server\":b.setup=\"passive\"}switch(h.direction){case\"sendrecv\":case\"sendonly\":b.direction=\"recvonly\";break;case\"recvonly\":case\"inactive\":b.direction=\"inactive\"}b.rtp=[],b.rtcpFb=[],b.fmtp=[];var E=!0,I=!1,D=void 0;try{for(var O,L=(0,o.default)(y);!(E=(O=L.next()).done);E=!0){var j=O.value,M={payload:j.payloadType,codec:j.name,rate:j.clockRate};if(j.channels>1&&(M.encoding=j.channels),b.rtp.push(M),j.parameters){for(var A={payload:j.payloadType,config:\"\"},F=(0,n.default)(j.parameters),N=0;N<F.length;N++){var U=F[N];A.config&&(A.config+=\";\"),A.config+=\"\".concat(U,\"=\").concat(j.parameters[U])}A.config&&b.fmtp.push(A)}if(j.rtcpFeedback){var V=!0,B=!1,G=void 0;try{for(var W,q=(0,o.default)(j.rtcpFeedback);!(V=(W=q.next()).done);V=!0){var z=W.value;b.rtcpFb.push({payload:j.payloadType,type:z.type,subtype:z.parameter||\"\"})}}catch(e){B=!0,G=e}finally{try{V||null==q.return||q.return()}finally{if(B)throw G}}}}}catch(e){I=!0,D=e}finally{try{E||null==L.return||L.return()}finally{if(I)throw D}}if(b.payloads=y.map((function(e){return e.payloadType})).join(\" \"),!v){b.ext=[];var K=!0,H=!1,J=void 0;try{for(var Y,Q=function(){var e=Y.value;if(!(h.ext||[]).find((function(t){return t.uri===e.uri})))return\"continue\";b.ext.push({uri:e.uri,value:e.id})},$=(0,o.default)(g);!(K=(Y=$.next()).done);K=!0)Q()}catch(e){H=!0,J=e}finally{try{K||null==$.return||$.return()}finally{if(H)throw J}}}if(h.simulcast_03){b.simulcast_03={value:h.simulcast_03.value.replace(/send/g,\"recv\")},b.rids=[];var Z=!0,X=!1,ee=void 0;try{for(var te,re=(0,o.default)(h.rids||[]);!(Z=(te=re.next()).done);Z=!0){var ne=te.value;\"send\"===ne.direction&&b.rids.push({id:ne.id,direction:\"recv\"})}}catch(e){X=!0,ee=e}finally{try{Z||null==re.return||re.return()}finally{if(X)throw ee}}}b.rtcpMux=\"rtcp-mux\",b.rtcpRsize=\"rtcp-rsize\",i.media.push(b)}}catch(e){d=!0,l=e}finally{try{u||null==p.return||p.return()}finally{if(d)throw l}}return m.default.write(i)}}]),t}(C),E=function(e){function t(e){return P(this,t),g(this,b(t).call(this,e))}return w(t,e),S(t,[{key:\"createOfferSdp\",value:function(e){if(R.debug(\"createOfferSdp()\"),!this._transportRemoteParameters)throw new Error(\"no transport remote parameters\");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,a=this._transportRemoteParameters.dtlsParameters,i={},s=e.map((function(e){return String(e.mid)}));this._sdpGlobalFields.version++,i.version=0,i.origin={address:\"0.0.0.0\",ipVer:4,netType:\"IN\",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:\"mediasoup-client\"},i.name=\"-\",i.timing={start:0,stop:0},i.icelite=t.iceLite?\"ice-lite\":null,i.msidSemantic={semantic:\"WMS\",token:\"*\"},s.length>0&&(i.groups=[{type:\"BUNDLE\",mids:s.join(\" \")}]),i.media=[];var c=a.fingerprints.length;i.fingerprint={type:a.fingerprints[c-1].algorithm,hash:a.fingerprints[c-1].value};var u=!0,d=!1,l=void 0;try{for(var f,p=(0,o.default)(e);!(u=(f=p.next()).done);u=!0){var h=f.value,v=h.closed,_=h.kind,y=void 0,g=void 0;\"application\"!==h.kind&&(y=this._rtpParametersByKind[_].codecs,g=this._rtpParametersByKind[_].headerExtensions);var b={};\"application\"!==h.kind?(b.type=_,b.port=7,b.protocol=\"RTP/SAVPF\",b.connection={ip:\"127.0.0.1\",version:4},b.mid=h.mid,b.msid=\"\".concat(h.streamId,\" \").concat(h.trackId)):(b.type=_,b.port=9,b.protocol=\"DTLS/SCTP\",b.connection={ip:\"127.0.0.1\",version:4},b.mid=h.mid),b.iceUfrag=t.usernameFragment,b.icePwd=t.password,b.candidates=[];var w=!0,k=!1,P=void 0;try{for(var T,S=(0,o.default)(r);!(w=(T=S.next()).done);w=!0){var C=T.value,x={component:1};x.foundation=C.foundation,x.ip=C.ip,x.port=C.port,x.priority=C.priority,x.transport=C.protocol,x.type=C.type,C.tcpType&&(x.tcptype=C.tcpType),b.candidates.push(x)}}catch(e){k=!0,P=e}finally{try{w||null==S.return||S.return()}finally{if(k)throw P}}if(b.endOfCandidates=\"end-of-candidates\",b.iceOptions=\"renomination\",b.setup=\"actpass\",\"application\"!==h.kind){b.direction=v?\"inactive\":\"sendonly\",b.rtp=[],b.rtcpFb=[],b.fmtp=[];var E=!0,I=!1,D=void 0;try{for(var O,L=(0,o.default)(y);!(E=(O=L.next()).done);E=!0){var j=O.value,M={payload:j.payloadType,codec:j.name,rate:j.clockRate};if(j.channels>1&&(M.encoding=j.channels),b.rtp.push(M),j.parameters){for(var A={payload:j.payloadType,config:\"\"},F=(0,n.default)(j.parameters),N=0;N<F.length;N++){var U=F[N];A.config&&(A.config+=\";\"),A.config+=\"\".concat(U,\"=\").concat(j.parameters[U])}A.config&&b.fmtp.push(A)}if(j.rtcpFeedback){var V=!0,B=!1,G=void 0;try{for(var W,q=(0,o.default)(j.rtcpFeedback);!(V=(W=q.next()).done);V=!0){var z=W.value;b.rtcpFb.push({payload:j.payloadType,type:z.type,subtype:z.parameter||\"\"})}}catch(e){B=!0,G=e}finally{try{V||null==q.return||q.return()}finally{if(B)throw G}}}}}catch(e){I=!0,D=e}finally{try{E||null==L.return||L.return()}finally{if(I)throw D}}if(b.payloads=y.map((function(e){return e.payloadType})).join(\" \"),!v){b.ext=[];var K=!0,H=!1,J=void 0;try{for(var Y,Q=(0,o.default)(g);!(K=(Y=Q.next()).done);K=!0){var $=Y.value;\"urn:ietf:params:rtp-hdrext:sdes:mid\"!==$.uri&&b.ext.push({uri:$.uri,value:$.id})}}catch(e){H=!0,J=e}finally{try{K||null==Q.return||Q.return()}finally{if(H)throw J}}}b.rtcpMux=\"rtcp-mux\",b.rtcpRsize=\"rtcp-rsize\",v||(b.ssrcs=[],b.ssrcGroups=[],b.ssrcs.push({id:h.ssrc,attribute:\"cname\",value:h.cname}),h.rtxSsrc&&(b.ssrcs.push({id:h.rtxSsrc,attribute:\"cname\",value:h.cname}),b.ssrcGroups.push({semantics:\"FID\",ssrcs:\"\".concat(h.ssrc,\" \").concat(h.rtxSsrc)})))}else b.payloads=5e3,b.sctpmap={app:\"webrtc-datachannel\",maxMessageSize:256,sctpmapNumber:5e3};i.media.push(b)}}catch(e){d=!0,l=e}finally{try{u||null==p.return||p.return()}finally{if(d)throw l}}return m.default.write(i)}}]),t}(C);t.default=function e(t,r){switch(P(this,e),R.debug(\"constructor() [direction:%s, rtpParametersByKind:%o]\",t,r),t){case\"send\":return new x(r);case\"recv\":return new E(r)}}},function(e,t,r){\"use strict\";var n=i(r(10)),o=i(r(25)),a=i(r(21));function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var s,c=(0,a.default)(e);!(n=(s=c.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw i}}return r}(e,t)||function(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}()}Object.defineProperty(t,\"__esModule\",{value:!0}),t.fillRtpParametersForTrack=function(e,t,r){var i,c=r.kind,u={cname:null,reducedSize:!0,mux:!0},d=(t.media||[]).find((function(e){return e.type===c}));if(!d)throw new Error(\"m=\".concat(c,\" section not found\"));var l=new o.default,f=!0,p=!1,m=void 0;try{for(var h,v=(0,a.default)(d.ssrcs||[]);!(f=(h=v.next()).done);f=!0){var _=h.value;if(\"msid\"===_.attribute)if(_.value.split(\" \")[1]===r.id){var y=_.id;l.add(y),i||(i=y)}}}catch(e){p=!0,m=e}finally{try{f||null==v.return||v.return()}finally{if(p)throw m}}if(0===l.size)throw new Error(\"a=ssrc line not found for local track [track.id:\".concat(r.id,\"]\"));var g=new n.default,b=!0,w=!1,k=void 0;try{for(var P,T=(0,a.default)(d.ssrcGroups||[]);!(b=(P=T.next()).done);b=!0){var S=P.value;if(\"FID\"===S.semantics){var R=s(S.ssrcs.split(/\\s+/),2),C=R[0],x=R[1];C=Number(C),x=Number(x),l.has(C)&&(l.delete(C),l.delete(x),g.set(C,x))}}}catch(e){w=!0,k=e}finally{try{b||null==T.return||T.return()}finally{if(w)throw k}}var E=!0,I=!1,D=void 0;try{for(var O,L=(0,a.default)(l);!(E=(O=L.next()).done);E=!0){var j=O.value;g.set(j,null)}}catch(e){I=!0,D=e}finally{try{E||null==L.return||L.return()}finally{if(I)throw D}}var M=d.ssrcs.find((function(e){return\"cname\"===e.attribute&&e.id===i}));M&&(u.cname=M.value);e.rtcp=u,e.encodings=[];var A=g.size>1,F=[\"low\",\"medium\",\"high\"],N=!0,U=!1,V=void 0;try{for(var B,G=(0,a.default)(g);!(N=(B=G.next()).done);N=!0){var W=s(B.value,2),q=W[0],z=(x=W[1],{ssrc:q});x&&(z.rtx={ssrc:x}),A&&(z.profile=F.shift()),e.encodings.push(z)}}catch(e){U=!0,V=e}finally{try{N||null==G.return||G.return()}finally{if(U)throw V}}},t.addSimulcastForTrack=function(e,t){var r,n,o,a=t.kind,i=(e.media||[]).find((function(e){return e.type===a}));if(!i)throw new Error(\"m=\".concat(a,\" section not found\"));if(!(i.ssrcs||[]).find((function(e){return\"msid\"===e.attribute&&(e.value.split(\" \")[1]===t.id?(r=e.id,o=e.value.split(\" \")[0],!0):void 0)})))throw new Error(\"a=ssrc line not found for local track [track.id:\".concat(t.id,\"]\"));(i.ssrcGroups||[]).some((function(e){if(\"FID\"===e.semantics){var t=e.ssrcs.split(/\\s+/);return Number(t[0])===r?(n=Number(t[1]),!0):void 0}}));var s=i.ssrcs.find((function(e){return\"cname\"===e.attribute&&e.id===r}));if(!s)throw new Error(\"CNAME line not found for local track [track.id:\".concat(t.id,\"]\"));var c=s.value,u=r+1,d=r+2;if(i.ssrcGroups=i.ssrcGroups||[],i.ssrcGroups.push({semantics:\"SIM\",ssrcs:\"\".concat(r,\" \").concat(u,\" \").concat(d)}),i.ssrcs.push({id:u,attribute:\"cname\",value:c}),i.ssrcs.push({id:u,attribute:\"msid\",value:\"\".concat(o,\" \").concat(t.id)}),i.ssrcs.push({id:d,attribute:\"cname\",value:c}),i.ssrcs.push({id:d,attribute:\"msid\",value:\"\".concat(o,\" \").concat(t.id)}),n){var l=n+1,f=n+2;i.ssrcGroups.push({semantics:\"FID\",ssrcs:\"\".concat(u,\" \").concat(l)}),i.ssrcs.push({id:l,attribute:\"cname\",value:c}),i.ssrcs.push({id:l,attribute:\"msid\",value:\"\".concat(o,\" \").concat(t.id)}),i.ssrcGroups.push({semantics:\"FID\",ssrcs:\"\".concat(d,\" \").concat(f)}),i.ssrcs.push({id:f,attribute:\"cname\",value:c}),i.ssrcs.push({id:f,attribute:\"msid\",value:\"\".concat(o,\" \").concat(t.id)})}}},function(e,t,r){\"use strict\";var n=p(r(35)),o=p(r(21)),a=p(r(7)),i=p(r(0)),s=p(r(6)),c=p(r(4)),u=p(r(3)),d=p(r(5)),l=p(r(11)),f=p(r(1));function p(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var m=_(r(19)),h=_(r(9)),v=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=f.default&&l.default?(0,l.default)(e,r):{};n.get||n.set?(0,f.default)(t,r,n):t[r]=e[r]}return t.default=e,t}(r(12));function _(e){return e&&e.__esModule?e:{default:e}}function y(e){return(y=\"function\"==typeof d.default&&\"symbol\"===(0,u.default)(c.default)?function(e){return void 0===e?\"undefined\":(0,u.default)(e)}:function(e){return e&&\"function\"==typeof d.default&&e.constructor===d.default&&e!==d.default.prototype?\"symbol\":void 0===e?\"undefined\":(0,u.default)(e)})(e)}function g(e,t){return!t||\"object\"!==y(t)&&\"function\"!=typeof t?function(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}(e):t}function b(e){return(b=s.default?i.default:function(e){return e.__proto__||(0,i.default)(e)})(e)}function w(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=(0,a.default)(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}function k(e,t){return(k=s.default||function(e,t){return e.__proto__=t,e})(e,t)}function P(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function T(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),(0,f.default)(e,n.key,n)}}function S(e,t,r){return t&&T(e.prototype,t),r&&T(e,r),e}var R=new h.default(\"RemotePlanBSdp\"),C=function(){function e(t){P(this,e),this._rtpParametersByKind=t,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:v.randomNumber(),version:0}}return S(e,[{key:\"setTransportLocalParameters\",value:function(e){R.debug(\"setTransportLocalParameters() [transportLocalParameters:%o]\",e),this._transportLocalParameters=e}},{key:\"setTransportRemoteParameters\",value:function(e){R.debug(\"setTransportRemoteParameters() [transportRemoteParameters:%o]\",e),this._transportRemoteParameters=e}},{key:\"updateTransportRemoteIceParameters\",value:function(e){R.debug(\"updateTransportRemoteIceParameters() [remoteIceParameters:%o]\",e),this._transportRemoteParameters.iceParameters=e}}]),e}(),x=function(e){function t(e){return P(this,t),g(this,b(t).call(this,e))}return w(t,e),S(t,[{key:\"createAnswerSdp\",value:function(e){if(R.debug(\"createAnswerSdp()\"),!this._transportLocalParameters)throw new Error(\"no transport local parameters\");if(!this._transportRemoteParameters)throw new Error(\"no transport remote parameters\");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,a=this._transportRemoteParameters.dtlsParameters,i={},s=(e.media||[]).map((function(e){return String(e.mid)}));this._sdpGlobalFields.version++,i.version=0,i.origin={address:\"0.0.0.0\",ipVer:4,netType:\"IN\",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:\"mediasoup-client\"},i.name=\"-\",i.timing={start:0,stop:0},i.icelite=t.iceLite?\"ice-lite\":null,i.msidSemantic={semantic:\"WMS\",token:\"*\"},i.groups=[{type:\"BUNDLE\",mids:s.join(\" \")}],i.media=[];var c=a.fingerprints.length;i.fingerprint={type:a.fingerprints[c-1].algorithm,hash:a.fingerprints[c-1].value};var u=!0,d=!1,l=void 0;try{for(var f,p=(0,o.default)(e.media||[]);!(u=(f=p.next()).done);u=!0){var h=f.value,v=h.type,_=this._rtpParametersByKind[v].codecs,y=this._rtpParametersByKind[v].headerExtensions,g={};g.type=h.type,g.port=7,g.protocol=\"RTP/SAVPF\",g.connection={ip:\"127.0.0.1\",version:4},g.mid=h.mid,g.iceUfrag=t.usernameFragment,g.icePwd=t.password,g.candidates=[];var b=!0,w=!1,k=void 0;try{for(var P,T=(0,o.default)(r);!(b=(P=T.next()).done);b=!0){var S=P.value,C={component:1};C.foundation=S.foundation,C.ip=S.ip,C.port=S.port,C.priority=S.priority,C.transport=S.protocol,C.type=S.type,S.tcpType&&(C.tcptype=S.tcpType),g.candidates.push(C)}}catch(e){w=!0,k=e}finally{try{b||null==T.return||T.return()}finally{if(w)throw k}}switch(g.endOfCandidates=\"end-of-candidates\",g.iceOptions=\"renomination\",a.role){case\"client\":g.setup=\"active\";break;case\"server\":g.setup=\"passive\"}switch(h.direction){case\"sendrecv\":case\"sendonly\":g.direction=\"recvonly\";break;case\"recvonly\":case\"inactive\":g.direction=\"inactive\"}\"video\"===v&&(g.xGoogleFlag=\"conference\"),g.rtp=[],g.rtcpFb=[],g.fmtp=[];var x=!0,E=!1,I=void 0;try{for(var D,O=(0,o.default)(_);!(x=(D=O.next()).done);x=!0){var L=D.value,j={payload:L.payloadType,codec:L.name,rate:L.clockRate};if(L.channels>1&&(j.encoding=L.channels),g.rtp.push(j),L.parameters){for(var M={payload:L.payloadType,config:\"\"},A=(0,n.default)(L.parameters),F=0;F<A.length;F++){var N=A[F];M.config&&(M.config+=\";\"),M.config+=\"\".concat(N,\"=\").concat(L.parameters[N])}M.config&&g.fmtp.push(M)}if(L.rtcpFeedback){var U=!0,V=!1,B=void 0;try{for(var G,W=(0,o.default)(L.rtcpFeedback);!(U=(G=W.next()).done);U=!0){var q=G.value;g.rtcpFb.push({payload:L.payloadType,type:q.type,subtype:q.parameter||\"\"})}}catch(e){V=!0,B=e}finally{try{U||null==W.return||W.return()}finally{if(V)throw B}}}}}catch(e){E=!0,I=e}finally{try{x||null==O.return||O.return()}finally{if(E)throw I}}g.payloads=_.map((function(e){return e.payloadType})).join(\" \"),g.ext=[];var z=!0,K=!1,H=void 0;try{for(var J,Y=function(){var e=J.value;if(!(h.ext||[]).find((function(t){return t.uri===e.uri})))return\"continue\";g.ext.push({uri:e.uri,value:e.id})},Q=(0,o.default)(y);!(z=(J=Q.next()).done);z=!0)Y()}catch(e){K=!0,H=e}finally{try{z||null==Q.return||Q.return()}finally{if(K)throw H}}g.rtcpMux=\"rtcp-mux\",g.rtcpRsize=\"rtcp-rsize\",i.media.push(g)}}catch(e){d=!0,l=e}finally{try{u||null==p.return||p.return()}finally{if(d)throw l}}return m.default.write(i)}}]),t}(C),E=function(e){function t(e){return P(this,t),g(this,b(t).call(this,e))}return w(t,e),S(t,[{key:\"createOfferSdp\",value:function(e,t){var r=this;if(R.debug(\"createOfferSdp()\"),!this._transportRemoteParameters)throw new Error(\"no transport remote parameters\");var a=this._transportRemoteParameters.iceParameters,i=this._transportRemoteParameters.iceCandidates,s=this._transportRemoteParameters.dtlsParameters,c={},u=e;this._sdpGlobalFields.version++,c.version=0,c.origin={address:\"0.0.0.0\",ipVer:4,netType:\"IN\",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:\"mediasoup-client\"},c.name=\"-\",c.timing={start:0,stop:0},c.icelite=a.iceLite?\"ice-lite\":null,c.msidSemantic={semantic:\"WMS\",token:\"*\"},c.groups=[{type:\"BUNDLE\",mids:u.join(\" \")}],c.media=[];var d=s.fingerprints.length;c.fingerprint={type:s.fingerprints[d-1].algorithm,hash:s.fingerprints[d-1].value};var l=!0,f=!1,p=void 0;try{for(var h,v=function(){var e=h.value,s=r._rtpParametersByKind[e].codecs,u=r._rtpParametersByKind[e].headerExtensions,d={};d.type=e,d.port=7,d.protocol=\"RTP/SAVPF\",d.connection={ip:\"127.0.0.1\",version:4},d.mid=e,d.iceUfrag=a.usernameFragment,d.icePwd=a.password,d.candidates=[];var l=!0,f=!1,p=void 0;try{for(var m,v=(0,o.default)(i);!(l=(m=v.next()).done);l=!0){var _=m.value,y={component:1};y.foundation=_.foundation,y.ip=_.ip,y.port=_.port,y.priority=_.priority,y.transport=_.protocol,y.type=_.type,_.tcpType&&(y.tcptype=_.tcpType),d.candidates.push(y)}}catch(e){f=!0,p=e}finally{try{l||null==v.return||v.return()}finally{if(f)throw p}}d.endOfCandidates=\"end-of-candidates\",d.iceOptions=\"renomination\",d.setup=\"actpass\",t.some((function(t){return t.kind===e}))?d.direction=\"sendonly\":d.direction=\"inactive\",d.rtp=[],d.rtcpFb=[],d.fmtp=[];var g=!0,b=!1,w=void 0;try{for(var k,P=(0,o.default)(s);!(g=(k=P.next()).done);g=!0){var T=k.value,S={payload:T.payloadType,codec:T.name,rate:T.clockRate};if(T.channels>1&&(S.encoding=T.channels),d.rtp.push(S),T.parameters){for(var R={payload:T.payloadType,config:\"\"},C=(0,n.default)(T.parameters),x=0;x<C.length;x++){var E=C[x];R.config&&(R.config+=\";\"),R.config+=\"\".concat(E,\"=\").concat(T.parameters[E])}R.config&&d.fmtp.push(R)}if(T.rtcpFeedback){var I=!0,D=!1,O=void 0;try{for(var L,j=(0,o.default)(T.rtcpFeedback);!(I=(L=j.next()).done);I=!0){var M=L.value;d.rtcpFb.push({payload:T.payloadType,type:M.type,subtype:M.parameter||\"\"})}}catch(e){D=!0,O=e}finally{try{I||null==j.return||j.return()}finally{if(D)throw O}}}}}catch(e){b=!0,w=e}finally{try{g||null==P.return||P.return()}finally{if(b)throw w}}d.payloads=s.map((function(e){return e.payloadType})).join(\" \"),d.ext=[];var A=!0,F=!1,N=void 0;try{for(var U,V=(0,o.default)(u);!(A=(U=V.next()).done);A=!0){var B=U.value;\"urn:ietf:params:rtp-hdrext:sdes:mid\"!==B.uri&&d.ext.push({uri:B.uri,value:B.id})}}catch(e){F=!0,N=e}finally{try{A||null==V.return||V.return()}finally{if(F)throw N}}d.rtcpMux=\"rtcp-mux\",d.rtcpRsize=\"rtcp-rsize\",d.ssrcs=[],d.ssrcGroups=[];var G=!0,W=!1,q=void 0;try{for(var z,K=(0,o.default)(t);!(G=(z=K.next()).done);G=!0){var H=z.value;H.kind===e&&(d.ssrcs.push({id:H.ssrc,attribute:\"msid\",value:\"\".concat(H.streamId,\" \").concat(H.trackId)}),d.ssrcs.push({id:H.ssrc,attribute:\"mslabel\",value:H.streamId}),d.ssrcs.push({id:H.ssrc,attribute:\"label\",value:H.trackId}),d.ssrcs.push({id:H.ssrc,attribute:\"cname\",value:H.cname}),H.rtxSsrc&&(d.ssrcs.push({id:H.rtxSsrc,attribute:\"msid\",value:\"\".concat(H.streamId,\" \").concat(H.trackId)}),d.ssrcs.push({id:H.rtxSsrc,attribute:\"mslabel\",value:H.streamId}),d.ssrcs.push({id:H.rtxSsrc,attribute:\"label\",value:H.trackId}),d.ssrcs.push({id:H.rtxSsrc,attribute:\"cname\",value:H.cname}),d.ssrcGroups.push({semantics:\"FID\",ssrcs:\"\".concat(H.ssrc,\" \").concat(H.rtxSsrc)})))}}catch(e){W=!0,q=e}finally{try{G||null==K.return||K.return()}finally{if(W)throw q}}c.media.push(d)},_=(0,o.default)(e);!(l=(h=_.next()).done);l=!0)v()}catch(e){f=!0,p=e}finally{try{l||null==_.return||_.return()}finally{if(f)throw p}}return m.default.write(c)}}]),t}(C);t.default=function e(t,r){switch(P(this,e),R.debug(\"constructor() [direction:%s, rtpParametersByKind:%o]\",t,r),t){case\"send\":return new x(r);case\"recv\":return new E(r)}}},function(e,t){e.exports=!0},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){e.exports={}},function(e,t,r){var n=r(23),o=r(129),a=r(73),i=r(66)(\"IE_PROTO\"),s=function(){},c=function(){var e,t=r(68)(\"iframe\"),n=a.length;for(t.style.display=\"none\",r(91).appendChild(t),t.src=\"javascript:\",(e=t.contentWindow.document).open(),e.write(\"<script>document.F=Object<\\/script>\"),e.close(),c=e.F;n--;)delete c.prototype[a[n]];return c()};e.exports=Object.create||function(e,t){var r;return null!==e?(s.prototype=n(e),r=new s,s.prototype=null,r[i]=e):r=c(),void 0===t?r:o(r,t)}},function(e,t,r){var n=r(90),o=r(73);e.exports=Object.keys||function(e){return n(e,o)}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,r){var n=r(22).f,o=r(37),a=r(17)(\"toStringTag\");e.exports=function(e,t,r){e&&!o(e=r?e:e.prototype,a)&&n(e,a,{configurable:!0,value:t})}},function(e,t,r){r(132);for(var n=r(15),o=r(31),a=r(49),i=r(17)(\"toStringTag\"),s=\"CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList\".split(\",\"),c=0;c<s.length;c++){var u=s[c],d=n[u],l=d&&d.prototype;l&&!l[i]&&o(l,i,u),a[u]=a.Array}},function(e,t,r){var n=r(27),o=r(97),a=r(98),i=r(23),s=r(60),c=r(80),u={},d={};(t=e.exports=function(e,t,r,l,f){var p,m,h,v,_=f?function(){return e}:c(e),y=n(r,l,t?2:1),g=0;if(\"function\"!=typeof _)throw TypeError(e+\" is not iterable!\");if(a(_)){for(p=s(e.length);p>g;g++)if((v=t?y(i(m=e[g])[0],m[1]):y(e[g]))===u||v===d)return v}else for(h=_.call(e);!(m=h.next()).done;)if((v=o(h,y,m.value,t))===u||v===d)return v}).BREAK=u,t.RETURN=d},function(e,t,r){\"use strict\";var n=l(r(0)),o=l(r(6)),a=l(r(205)),i=l(r(10)),s=l(r(7)),c=l(r(4)),u=l(r(3)),d=l(r(5));function l(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f=\"function\"==typeof d.default&&\"symbol\"===(0,u.default)(c.default)?function(e){return void 0===e?\"undefined\":(0,u.default)(e)}:function(e){return e&&\"function\"==typeof d.default&&e.constructor===d.default&&e!==d.default.prototype?\"symbol\":void 0===e?\"undefined\":(0,u.default)(e)})(e)}function p(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function m(e,t){return!t||\"object\"!==f(t)&&\"function\"!=typeof t?v(e):t}function h(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=(0,s.default)(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}function v(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}function _(e){var t=\"function\"==typeof i.default?new i.default:void 0;return(_=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf(\"[native code]\")))return e;var r;if(\"function\"!=typeof e)throw new TypeError(\"Super expression must either be null or a function\");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return g(e,arguments,w(this).constructor)}return n.prototype=(0,s.default)(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),b(n,e)})(e)}function y(){if(\"undefined\"==typeof Reflect||!a.default)return!1;if(a.default.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Date.prototype.toString.call((0,a.default)(Date,[],(function(){}))),!0}catch(e){return!1}}function g(e,t,r){return(g=y()?a.default:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&b(o,r.prototype),o}).apply(null,arguments)}function b(e,t){return(b=o.default||function(e,t){return e.__proto__=t,e})(e,t)}function w(e){return(w=o.default?n.default:function(e){return e.__proto__||(0,n.default)(e)})(e)}Object.defineProperty(t,\"__esModule\",{value:!0}),t.UnsupportedError=t.TimeoutError=t.InvalidStateError=void 0;var k=function(e){function t(e){var r;return p(this,t),(r=m(this,w(t).call(this,e))).name=\"InvalidStateError\",Error.hasOwnProperty(\"captureStackTrace\")?Error.captureStackTrace(v(v(r)),t):r.stack=new Error(e).stack,r}return h(t,e),t}(_(Error));t.InvalidStateError=k;var P=function(e){function t(e){var r;return p(this,t),(r=m(this,w(t).call(this,e))).name=\"TimeoutError\",Error.hasOwnProperty(\"captureStackTrace\")?Error.captureStackTrace(v(v(r)),t):r.stack=new Error(e).stack,r}return h(t,e),t}(_(Error));t.TimeoutError=P;var T=function(e){function t(e,r){var n;return p(this,t),(n=m(this,w(t).call(this,e))).name=\"UnsupportedError\",Error.hasOwnProperty(\"captureStackTrace\")?Error.captureStackTrace(v(v(n)),t):n.stack=new Error(e).stack,n.data=r,n}return h(t,e),t}(_(Error));t.UnsupportedError=T},function(e,t){var r;r=function(){return this}();try{r=r||new Function(\"return this\")()}catch(e){\"object\"==typeof window&&(r=window)}e.exports=r},function(e,t){var r=0,n=Math.random();e.exports=function(e){return\"Symbol(\".concat(void 0===e?\"\":e,\")_\",(++r+n).toString(36))}},function(e,t,r){var n=r(13),o=r(2),a=r(32);e.exports=function(e,t){var r=(o.Object||{})[e]||Object[e],i={};i[e]=t(r),n(n.S+n.F*a((function(){r(1)})),\"Object\",i)}},function(e,t,r){var n=r(70),o=Math.min;e.exports=function(e){return e>0?o(n(e),9007199254740991):0}},function(e,t,r){var n=r(58)(\"meta\"),o=r(16),a=r(37),i=r(22).f,s=0,c=Object.isExtensible||function(){return!0},u=!r(32)((function(){return c(Object.preventExtensions({}))})),d=function(e){i(e,n,{value:{i:\"O\"+ ++s,w:{}}})},l=e.exports={KEY:n,NEED:!1,fastKey:function(e,t){if(!o(e))return\"symbol\"==typeof e?e:(\"string\"==typeof e?\"S\":\"P\")+e;if(!a(e,n)){if(!c(e))return\"F\";if(!t)return\"E\";d(e)}return e[n].i},getWeak:function(e,t){if(!a(e,n)){if(!c(e))return!0;if(!t)return!1;d(e)}return e[n].w},onFreeze:function(e){return u&&l.NEED&&c(e)&&!a(e,n)&&d(e),e}}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t){},function(e,t,r){e.exports={default:r(171),__esModule:!0}},function(e,t){e.exports=function(e){if(null==e)throw TypeError(\"Can't call method on  \"+e);return e}},function(e,t,r){var n=r(67)(\"keys\"),o=r(58);e.exports=function(e){return n[e]||(n[e]=o(e))}},function(e,t,r){var n=r(2),o=r(15),a=o[\"__core-js_shared__\"]||(o[\"__core-js_shared__\"]={});(e.exports=function(e,t){return a[e]||(a[e]=void 0!==t?t:{})})(\"versions\",[]).push({version:n.version,mode:r(47)?\"pure\":\"global\",copyright:\" 2019 Denis Pushkarev (zloirock.ru)\"})},function(e,t,r){var n=r(16),o=r(15).document,a=n(o)&&n(o.createElement);e.exports=function(e){return a?o.createElement(e):{}}},function(e,t,r){var n=r(16);e.exports=function(e,t){if(!n(e))return e;var r,o;if(t&&\"function\"==typeof(r=e.toString)&&!n(o=r.call(e)))return o;if(\"function\"==typeof(r=e.valueOf)&&!n(o=r.call(e)))return o;if(!t&&\"function\"==typeof(r=e.toString)&&!n(o=r.call(e)))return o;throw TypeError(\"Can't convert object to primitive value\")}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:r)(e)}},function(e,t,r){\"use strict\";var n=r(47),o=r(13),a=r(89),i=r(31),s=r(49),c=r(128),u=r(53),d=r(87),l=r(17)(\"iterator\"),f=!([].keys&&\"next\"in[].keys()),p=function(){return this};e.exports=function(e,t,r,m,h,v,_){c(r,t,m);var y,g,b,w=function(e){if(!f&&e in S)return S[e];switch(e){case\"keys\":case\"values\":return function(){return new r(this,e)}}return function(){return new r(this,e)}},k=t+\" Iterator\",P=\"values\"==h,T=!1,S=e.prototype,R=S[l]||S[\"@@iterator\"]||h&&S[h],C=R||w(h),x=h?P?w(\"entries\"):C:void 0,E=\"Array\"==t&&S.entries||R;if(E&&(b=d(E.call(new e)))!==Object.prototype&&b.next&&(u(b,k,!0),n||\"function\"==typeof b[l]||i(b,l,p)),P&&R&&\"values\"!==R.name&&(T=!0,C=function(){return R.call(this)}),n&&!_||!f&&!T&&S[l]||i(S,l,C),s[t]=C,s[k]=p,h)if(y={values:P?C:w(\"values\"),keys:v?C:w(\"keys\"),entries:x},_)for(g in y)g in S||a(S,g,y[g]);else o(o.P+o.F*(f||T),t,y);return y}},function(e,t,r){var n=r(52);e.exports=Object(\"z\").propertyIsEnumerable(0)?Object:function(e){return\"String\"==n(e)?e.split(\"\"):Object(e)}},function(e,t){e.exports=\"constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf\".split(\",\")},function(e,t,r){t.f=r(17)},function(e,t,r){var n=r(15),o=r(2),a=r(47),i=r(74),s=r(22).f;e.exports=function(e){var t=o.Symbol||(o.Symbol=a?{}:n.Symbol||{});\"_\"==e.charAt(0)||e in t||s(t,e,{value:i.f(e)})}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,r){var n=r(62),o=r(48),a=r(39),i=r(69),s=r(37),c=r(88),u=Object.getOwnPropertyDescriptor;t.f=r(24)?u:function(e,t){if(e=a(e),t=i(t,!0),c)try{return u(e,t)}catch(e){}if(s(e,t))return o(!n.f.call(e,t),e[t])}},function(e,t,r){var n=r(52),o=r(17)(\"toStringTag\"),a=\"Arguments\"==n(function(){return arguments}());e.exports=function(e){var t,r,i;return void 0===e?\"Undefined\":null===e?\"Null\":\"string\"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),o))?r:a?n(t):\"Object\"==(i=n(t))&&\"function\"==typeof t.callee?\"Arguments\":i}},function(e,t){e.exports=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+\": incorrect invocation!\");return e}},function(e,t,r){var n=r(78),o=r(17)(\"iterator\"),a=r(49);e.exports=r(2).getIteratorMethod=function(e){if(null!=e)return e[o]||e[\"@@iterator\"]||a[n(e)]}},function(e,t,r){\"use strict\";var n=r(38);function o(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError(\"Bad Promise constructor\");t=e,r=n})),this.resolve=n(t),this.reject=n(r)}e.exports.f=function(e){return new o(e)}},function(e,t,r){var n=r(31);e.exports=function(e,t,r){for(var o in t)r&&e[o]?e[o]=t[o]:n(e,o,t[o]);return e}},function(e,t,r){var n=r(16);e.exports=function(e,t){if(!n(e)||e._t!==t)throw TypeError(\"Incompatible receiver, \"+t+\" required!\");return e}},function(e,t,r){\"use strict\";(function(e){var n,o=r(1),a=(n=o)&&n.__esModule?n:{default:n};Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var i=g(r(176)),s=g(r(9)),c=g(r(178)),u=g(r(189)),d=g(r(190)),l=g(r(191)),f=g(r(192)),p=g(r(193)),m=g(r(194)),h=g(r(196)),v=g(r(197)),_=g(r(198)),y=g(r(200));function g(e){return e&&e.__esModule?e:{default:e}}function b(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),(0,a.default)(e,n.key,n)}}var w=new s.default(\"Device\"),k=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,t)}var r,n,o;return r=t,o=[{key:\"setHandler\",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t._detected=!0,t._handlerClass=e,t._flag=r.flag,t._name=r.name,t._version=r.version,t._bowser=r.bowser||{}}},{key:\"getFlag\",value:function(){return t._detected||t._detect(),t._flag}},{key:\"getName\",value:function(){return t._detected||t._detect(),t._name}},{key:\"getVersion\",value:function(){return t._detected||t._detect(),t._version}},{key:\"getBowser\",value:function(){return t._detected||t._detect(),t._bowser}},{key:\"isSupported\",value:function(){return t._detected||t._detect(),Boolean(t._handlerClass)}},{key:\"_detect\",value:function(){if(t._detected=!0,e.navigator&&\"ReactNative\"===e.navigator.product)t._flag=\"react-native\",t._name=\"ReactNative\",t._version=void 0,t._bowser={},t._handlerClass=y.default;else if(e.navigator&&\"string\"==typeof e.navigator.userAgent){var r=e.navigator.userAgent,n=i.default.detect(r);if(t._flag=void 0,t._name=n.name||void 0,t._version=n.version||void 0,t._bowser=n,t._handlerClass=null,i.default.check({chrome:\"70\",chromium:\"70\"},!0,r))t._flag=\"chrome\",t._handlerClass=c.default;else if(i.default.check({chrome:\"69\",chromium:\"69\"},!0,r))t._flag=\"chrome\",t._handlerClass=u.default;else if(i.default.check({chrome:\"67\",chromium:\"67\"},!0,r))t._flag=\"chrome\",t._handlerClass=d.default;else if(i.default.check({chrome:\"55\",chromium:\"55\"},!0,r))t._flag=\"chrome\",t._handlerClass=l.default;else if(i.default.check({chrome:\"49\",chromium:\"49\"},!0,r)&&e.adapter)t._flag=\"chrome\",t._handlerClass=l.default;else if(i.default.check({firefox:\"65\"},!0,r))t._flag=\"firefox\",t._handlerClass=m.default;else if(i.default.check({firefox:\"59\"},!0,r))t._flag=\"firefox\",t._handlerClass=h.default;else if(i.default.check({firefox:\"50\"},!0,r))t._flag=\"firefox\",t._handlerClass=v.default;else if(i.default.check({safari:\"12.1\"},!0,r))t._flag=\"safari\",t._handlerClass=f.default;else if(i.default.check({safari:\"11\"},!0,r))t._flag=\"safari\",t._handlerClass=p.default;else if(i.default.check({msedge:\"11\"},!0,r))t._flag=\"msedge\",t._handlerClass=_.default;else if(i.default.check({opera:\"57\"},!0,r))t._flag=\"opera\",t._handlerClass=c.default;else if(i.default.check({opera:\"44\"},!0,r))t._flag=\"opera\",t._handlerClass=l.default;else if(n.chromium||n.blink||n.webkit){w.debug('best effort Chrome based browser detection [name:\"%s\"]',n.name),t._flag=\"chrome\";var o=r.match(/(?:(?:Chrome|Chromium))[ /](\\w+)/i);if(o){var a=Number(o[1]);t._handlerClass=a>=70?c.default:a>=69?u.default:a>=67?d.default:l.default}else t._handlerClass=c.default}t.isSupported()?w.debug('browser supported [flag:%s, name:\"%s\", version:%s, handler:%s]',t._flag,t._name,t._version,t._handlerClass.tag):w.warn(\"browser not supported [name:%s, version:%s]\",t._name,t._version)}else w.warn(\"device not supported\")}},{key:\"Handler\",get:function(){return t._detected||t._detect(),t._handlerClass}}],(n=null)&&b(r.prototype,n),o&&b(r,o),t}();t.default=k,k._detected=!1,k._flag=void 0,k._name=void 0,k._version=void 0,k._bowser=void 0,k._handlerClass=null}).call(this,r(57))},function(e,t,r){e.exports={default:r(195),__esModule:!0}},function(e,t,r){e.exports={default:r(202),__esModule:!0}},function(e,t,r){var n=r(37),o=r(36),a=r(66)(\"IE_PROTO\"),i=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=o(e),n(e,a)?e[a]:\"function\"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?i:null}},function(e,t,r){e.exports=!r(24)&&!r(32)((function(){return 7!=Object.defineProperty(r(68)(\"div\"),\"a\",{get:function(){return 7}}).a}))},function(e,t,r){e.exports=r(31)},function(e,t,r){var n=r(37),o=r(39),a=r(130)(!1),i=r(66)(\"IE_PROTO\");e.exports=function(e,t){var r,s=o(e),c=0,u=[];for(r in s)r!=i&&n(s,r)&&u.push(r);for(;t.length>c;)n(s,r=t[c++])&&(~a(u,r)||u.push(r));return u}},function(e,t,r){var n=r(15).document;e.exports=n&&n.documentElement},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,r){\"use strict\";var n=r(15),o=r(37),a=r(24),i=r(13),s=r(89),c=r(61).KEY,u=r(32),d=r(67),l=r(53),f=r(58),p=r(17),m=r(74),h=r(75),v=r(135),_=r(94),y=r(23),g=r(16),b=r(36),w=r(39),k=r(69),P=r(48),T=r(50),S=r(136),R=r(77),C=r(76),x=r(22),E=r(51),I=R.f,D=x.f,O=S.f,L=n.Symbol,j=n.JSON,M=j&&j.stringify,A=p(\"_hidden\"),F=p(\"toPrimitive\"),N={}.propertyIsEnumerable,U=d(\"symbol-registry\"),V=d(\"symbols\"),B=d(\"op-symbols\"),G=Object.prototype,W=\"function\"==typeof L&&!!C.f,q=n.QObject,z=!q||!q.prototype||!q.prototype.findChild,K=a&&u((function(){return 7!=T(D({},\"a\",{get:function(){return D(this,\"a\",{value:7}).a}})).a}))?function(e,t,r){var n=I(G,t);n&&delete G[t],D(e,t,r),n&&e!==G&&D(G,t,n)}:D,H=function(e){var t=V[e]=T(L.prototype);return t._k=e,t},J=W&&\"symbol\"==typeof L.iterator?function(e){return\"symbol\"==typeof e}:function(e){return e instanceof L},Y=function(e,t,r){return e===G&&Y(B,t,r),y(e),t=k(t,!0),y(r),o(V,t)?(r.enumerable?(o(e,A)&&e[A][t]&&(e[A][t]=!1),r=T(r,{enumerable:P(0,!1)})):(o(e,A)||D(e,A,P(1,{})),e[A][t]=!0),K(e,t,r)):D(e,t,r)},Q=function(e,t){y(e);for(var r,n=v(t=w(t)),o=0,a=n.length;a>o;)Y(e,r=n[o++],t[r]);return e},$=function(e){var t=N.call(this,e=k(e,!0));return!(this===G&&o(V,e)&&!o(B,e))&&(!(t||!o(this,e)||!o(V,e)||o(this,A)&&this[A][e])||t)},Z=function(e,t){if(e=w(e),t=k(t,!0),e!==G||!o(V,t)||o(B,t)){var r=I(e,t);return!r||!o(V,t)||o(e,A)&&e[A][t]||(r.enumerable=!0),r}},X=function(e){for(var t,r=O(w(e)),n=[],a=0;r.length>a;)o(V,t=r[a++])||t==A||t==c||n.push(t);return n},ee=function(e){for(var t,r=e===G,n=O(r?B:w(e)),a=[],i=0;n.length>i;)!o(V,t=n[i++])||r&&!o(G,t)||a.push(V[t]);return a};W||(s((L=function(){if(this instanceof L)throw TypeError(\"Symbol is not a constructor!\");var e=f(arguments.length>0?arguments[0]:void 0),t=function(r){this===G&&t.call(B,r),o(this,A)&&o(this[A],e)&&(this[A][e]=!1),K(this,e,P(1,r))};return a&&z&&K(G,e,{configurable:!0,set:t}),H(e)}).prototype,\"toString\",(function(){return this._k})),R.f=Z,x.f=Y,r(95).f=S.f=X,r(62).f=$,C.f=ee,a&&!r(47)&&s(G,\"propertyIsEnumerable\",$,!0),m.f=function(e){return H(p(e))}),i(i.G+i.W+i.F*!W,{Symbol:L});for(var te=\"hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables\".split(\",\"),re=0;te.length>re;)p(te[re++]);for(var ne=E(p.store),oe=0;ne.length>oe;)h(ne[oe++]);i(i.S+i.F*!W,\"Symbol\",{for:function(e){return o(U,e+=\"\")?U[e]:U[e]=L(e)},keyFor:function(e){if(!J(e))throw TypeError(e+\" is not a symbol!\");for(var t in U)if(U[t]===e)return t},useSetter:function(){z=!0},useSimple:function(){z=!1}}),i(i.S+i.F*!W,\"Object\",{create:function(e,t){return void 0===t?T(e):Q(T(e),t)},defineProperty:Y,defineProperties:Q,getOwnPropertyDescriptor:Z,getOwnPropertyNames:X,getOwnPropertySymbols:ee});var ae=u((function(){C.f(1)}));i(i.S+i.F*ae,\"Object\",{getOwnPropertySymbols:function(e){return C.f(b(e))}}),j&&i(i.S+i.F*(!W||u((function(){var e=L();return\"[null]\"!=M([e])||\"{}\"!=M({a:e})||\"{}\"!=M(Object(e))}))),\"JSON\",{stringify:function(e){for(var t,r,n=[e],o=1;arguments.length>o;)n.push(arguments[o++]);if(r=t=n[1],(g(t)||void 0!==e)&&!J(e))return _(t)||(t=function(e,t){if(\"function\"==typeof r&&(t=r.call(this,e,t)),!J(t))return t}),n[1]=t,M.apply(j,n)}}),L.prototype[F]||r(31)(L.prototype,F,L.prototype.valueOf),l(L,\"Symbol\"),l(Math,\"Math\",!0),l(n.JSON,\"JSON\",!0)},function(e,t,r){var n=r(52);e.exports=Array.isArray||function(e){return\"Array\"==n(e)}},function(e,t,r){var n=r(90),o=r(73).concat(\"length\",\"prototype\");t.f=Object.getOwnPropertyNames||function(e){return n(e,o)}},function(e,t,r){\"use strict\";(function(t){var n=l(r(8)),o=l(r(106)),a=l(r(107)),i=l(r(0)),s=l(r(28)),c=l(r(29)),u=l(r(40)),d=l(r(42));function l(e){return e&&e.__esModule?e:{default:e}}var f=r(30),p=r(161),m=r(34)(\"Stream\"),h=function(e){function r(e){(0,s.default)(this,r);var t=(0,u.default)(this,(r.__proto__||(0,i.default)(r)).call(this));return t._spec=e,t._streamObj=null,t._streamID=e.streamID,t._volume=0,t._isLocalStream=!1,t._isMobile=!/windows/i.test(navigator.userAgent),t}var l,h;return(0,d.default)(r,e),(0,c.default)(r,[{key:\"init\",value:(h=(0,a.default)(o.default.mark((function e(r,n){var a,i,s,c,u=this;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this,i=null,(this._spec.video||this._spec.screen)&&(this._enableVideoTrack=!0),s={width:{min:f.videoSpec.width.min,ideal:f.videoSpec.width.ideal,max:f.videoSpec.width.max},height:{min:f.videoSpec.height.min,ideal:f.videoSpec.height.ideal,max:f.videoSpec.height.max},frameRate:{min:f.videoSpec.frameRate.min,ideal:f.videoSpec.frameRate.ideal,max:f.videoSpec.frameRate.max}},this._isMobile&&(s.facingMode=this._spec.useBackCam?{exact:\"environment\"}:\"user\"),this._spec.attributes&&(this._spec.attributes.resolution&&(\"HD720P\"===this._spec.attributes.resolution.toUpperCase()&&(s.width=f.videoAttributes.hd720p[0],s.height=f.videoAttributes.hd720p[1]),\"VGA\"===this._spec.attributes.resolution.toUpperCase()&&(s.width=f.videoAttributes.vga[0],s.height=f.videoAttributes.vga[1]),\"SIF\"===this._spec.attributes.resolution.toUpperCase()&&(s.width=f.videoAttributes.sif[0],s.height=f.videoAttributes.sif[1])),this._spec.attributes.minFrameRate&&this._spec.attributes.maxFrameRate&&(s.frameRate.min=this._spec.attributes.minFrameRate,s.frameRate.max=this._spec.attributes.maxFrameRate,s.frameRate.ideal=Math.floor((this._spec.attributes.maxFrameRate-this._spec.attributes.minFrameRate)/2+this._spec.attributes.minFrameRate))),!this._spec.video||!this._spec.audio){e.next=12;break}i={video:s},this._spec.microphoneId?i.audio={deviceId:this._spec.microphoneId?{exact:this._spec.microphoneId}:void 0,sampleRate:f.audioSpec.sampleRate,channelCount:f.audioSpec.channelCount}:i.audio={audio:!0},this._spec.cameraId&&(i.video.deviceId=this._spec.cameraId?{exact:this._spec.cameraId}:void 0),e.next=33;break;case 12:if(!this._spec.audio||this._spec.screen||this._spec.video){e.next=17;break}i={video:!1},this._spec.microphoneId?i.audio={deviceId:this._spec.microphoneId?{exact:this._spec.microphoneId}:void 0}:i.audio={audio:!0},e.next=33;break;case 17:if(!this._spec.video||this._spec.audio||this._spec.screen){e.next=22;break}i={audio:!1,video:s},this._spec.cameraId&&(i.video.deviceId=this._spec.cameraId?{exact:this._spec.cameraId}:void 0),e.next=33;break;case 22:if(!this._spec.screen){e.next=33;break}if(\"undefined\"!==t.g_deviceInfo&&null!==t.g_deviceInfo){e.next=25;break}throw Error(\"please create client object first.\");case 25:if(c=!1,\"chrome\"!==t.g_deviceInfo.flag.toLowerCase()){e.next=31;break}if(!(parseInt(t.g_deviceInfo.version,10)>=72)){e.next=31;break}return c=!0,e.next=31,this._startScreenCapture().then((function(e){u.streamObj=e,a._isLocalStream=!0,u._streamEnded(e),r()})).catch((function(e){return m.error(\"screen capture error\",e.message),n(e)}));case 31:return c||getScreenId((function(e,t,o){if(t&&\"firefox\"!=t){if(o={video:{mandatory:{chromeMediaSource:\"screen\",maxWidth:1920,maxHeight:1080,minAspectRatio:1.77}}},\"permission-denied\"===e)return alert(\"Permission is denied.\");if(\"not-chrome\"===e)return alert(\"Please use chrome.\");!e&&t&&(o.video.mandatory.chromeMediaSource=\"desktop\",o.video.mandatory.chromeMediaSourceId=t)}navigator.getUserMedia=navigator.mozGetUserMedia||navigator.webkitGetUserMedia,navigator.getUserMedia(o,(function(e){a._streamObj=e,a._isLocalStream=!0,r()}),(function(e){m.error(\"getScreenId error\",e),n(e)}))}),!!a._spec.audio),e.abrupt(\"return\");case 33:(this._spec.video||this._spec.audio)&&navigator.mediaDevices.getUserMedia(i).then((function(e){a.streamObj=e,a._isLocalStream=!0,r()})).catch((function(e){m.error(\"getUserMedia Error: \",e),n(e)}));case 34:case\"end\":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:\"_speechEvents\",value:function(e){var t=this;this._speach=new p(e,{});var r=this;this._speach.on(\"volume_change\",(function(e,n){e<n||(r._volume=Math.round(-10*(e-n)/n),t.emit(\"volume-change\",{streamID:t.streamID,volume:r._volume}))})),this._speach.on(\"speaking\",(function(){t.emit(\"speacking\",{streamID:t.streamID})})),this._speach.on(\"stopped_speaking\",(function(){t.emit(\"stopped-speaking\",{streamID:t.streamID})}))}},{key:\"getId\",value:function(){return this._streamID}},{key:\"getAttributes\",value:function(){}},{key:\"getAudioLevel\",value:function(){return this._volume.toFixed(2)}},{key:\"hasVideo\",value:function(){return!!this._streamObj.getVideoTracks().length}},{key:\"hasAudio\",value:function(){return!!this._streamObj.getAudioTracks().length}},{key:\"enableVideo\",value:function(){if(!this._isLocalStream)throw Error(\"only local stream can enalbe video, you can utilize subscribe function.\");null!==t.g_client&&t.g_client.resumeWebcam()}},{key:\"disableVideo\",value:function(){if(!this._isLocalStream)throw Error(\"only local stream can enalbe video, you can utilize unsubscribe function.\");null!==t.g_client&&t.g_client.pauseWebcam()}},{key:\"enableAudio\",value:function(){if(!this._isLocalStream)throw Error(\"only local stream can enalbe video, you can utilize subscribe function.\");null!==t.g_client&&t.g_client.resumeMic()}},{key:\"disableAudio\",value:function(){if(!this._isLocalStream)throw Error(\"only local stream can enalbe video, you can utilize unsubscribe function.\");null!==t.g_client&&t.g_client.pauseMic()}},{key:\"enableVideoAndAudio\",value:function(){null!==t.g_client&&(t.g_client.resumeMic(),t.g_client.resumeWebcam())}},{key:\"disableVideoAndAudio\",value:function(){null!==t.g_client&&(t.g_client.pauseMic(),t.g_client.pauseWebcam())}},{key:\"setVideoProfile\",value:function(e,t,r){if(null===this._streamObj)throw Error(\"stream is null, please init it at first.\");if(!this._isLocalStream)throw Error(\"only local stream can set video profile.\");if(\"function\"!=typeof t)throw TypeError(\"onSuccess have to be a function.\");if(\"function\"!=typeof t)throw TypeError(\"onFailure have to be a function.\");var n=this._streamObj.getVideoTracks();if(n.length<=0)m.error(\"have no video track.\");else{var o,a=n[0],i=320,s=1.333;switch(e.toLowerCase()){case f.videoProfile.Profile_80p:i=80,s=80/60;break;case f.videoProfile.Profile_120p:i=160,s=160/120;break;case f.videoProfile.Profile_180p:i=320,s=320/180;break;case f.videoProfile.Profile_240p:i=320,s=320/240;break;case f.videoProfile.Profile_360p:i=640,s=2;break;case f.videoProfile.Profile_480p:i=640,s=640/480;break;case f.videoProfile.Profile_720p:i=1280,s=1280/720;break;case f.videoProfile.Profile_1080p:i=1920,s=1920/1080}o={width:{exact:i},aspectRatio:{exact:s}},a.applyConstraints(o).then((function(){t(\"applyConstraint success\")})).catch((function(e){r(e)}))}}},{key:\"getVideoProfile\",value:function(){if(!this.streamObj)return m.error(\"stream is null\"),{};var e=this._streamObj.getVideoTracks();if(e.length<=0)return m.error(\"no video track\"),{};var t=e[0].getSettings();return{width:t.width,height:t.height}}},{key:\"setScreenProfile\",value:function(){}},{key:\"play\",value:function(e,t){if(!this._streamObj)throw Error(\"stream is null, please init it at first.\");if(this._video=document.getElementById(e),!this._video)throw Error(\"video id can not find \"+e);this._streamObj.active||m.debug(\"stream active is false\"),this._video.srcObject=this._streamObj}},{key:\"stop\",value:function(){}},{key:\"close\",value:function(){this._streamObj?(this._streamObj.getTracks().forEach((function(e){return e.stop()})),this._streamObj=null,this.removeAllListeners(),this._video&&(this._video.srcObject=null)):m.error(\"stream is null, please init it at first.\")}},{key:\"_startScreenCapture\",value:function(){var e={video:{aspectRatio:f.screenSpec.s_1080p.maxAspectRatio,frameRate:f.screenSpec.s_frameRate,height:f.screenSpec.s_1080p.maxHight,resizeMode:\"crop-and-scale\",width:f.screenSpec.s_1080p.maxWidth,cursor:\"always\"}},t=null;try{t=JS_GlobalVal.g_is_client}catch(e){t=null}return t?(navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.getUserMedia,new n.default((function(e,t){navigator.getUserMedia({video:{mandatory:{chromeMediaSource:\"screen\"}}},(function(t){e(t)}),(function(e){t(e)}))}))):navigator.getDisplayMedia?navigator.getDisplayMedia(e):navigator.mediaDevices.getDisplayMedia?navigator.mediaDevices.getDisplayMedia(e):navigator.mediaDevices.getUserMedia({video:{mediaSource:\"screen\"}})}},{key:\"_streamEnded\",value:(l=(0,a.default)(o.default.mark((function e(t){var r=this;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.getVideoTracks()[0].onended=function(e){r.emit(\"screen-close\",{stream:t})};case 2:case\"end\":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:\"capture\",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(new Date).toISOString().replace(/[-:TZ.]/g,\"\")+this._streamID,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Function;if(!this._streamObj)throw Error(\"stream is null, please init it at first.\");if(!this._video)throw Error(\"this stream has not be played: \"+this._streamObj);if(!/[\\\\\\/\\*\\:\\<\\>\\|\\?\\\"]/g.test(t)&&t.length>255)throw Error(\"illegal filename \");var n=document.createElement(\"canvas\");n.width=this._video.videoWidth,n.height=this._video.videoHeight;var o=n.getContext(\"2d\");o.drawImage(this._video,0,0,n.width,n.height),\"file\"===e?n.toBlob((function(e){r(new File([e],t+\".jpeg\",{type:\"image/jpeg\"}))})):r(n.toDataURL(\"image/jpeg\"))}},{key:\"streamObj\",set:function(e){this._streamObj=e,e&&(e.getAudioTracks().length<=0||this._speechEvents(e))},get:function(){return this._streamObj}},{key:\"audioTracks\",set:function(e){if(null==e)return new TypeError(\"track\");if(\"audio\"!==e.kind)return new TypeError(\"track is not audio kind\");if(null===this._streamObj)throw new Error(\"stream object is null.\");this._streamObj.addTrack(e),void 0!==this._video&&null!==this._video&&(this._video.srcObject=this._streamObj),this._speechEvents(this._streamObj)}},{key:\"videoTracks\",set:function(e){if(null==e)return new TypeError(\"track\");if(\"video\"!==e.kind)return new TypeError(\"track is not video kind\");if(null===this._streamObj)throw new Error(\"stream object is null.\");this._streamObj.addTrack(e),void 0!==this._video&&null!==this._video&&(this._video.srcObject=this._streamObj)}},{key:\"streamID\",set:function(e){this._streamID=e},get:function(){return this._streamID}}]),r}(r(33).EventEmitter);e.exports=h}).call(this,r(57))},function(e,t,r){var n=r(23);e.exports=function(e,t,r,o){try{return o?t(n(r)[0],r[1]):t(r)}catch(t){var a=e.return;throw void 0!==a&&n(a.call(e)),t}}},function(e,t,r){var n=r(49),o=r(17)(\"iterator\"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(n.Array===e||a[o]===e)}},function(e,t,r){var n=r(23),o=r(38),a=r(17)(\"species\");e.exports=function(e,t){var r,i=n(e).constructor;return void 0===i||null==(r=n(i)[a])?t:o(r)}},function(e,t,r){var n,o,a,i=r(27),s=r(101),c=r(91),u=r(68),d=r(15),l=d.process,f=d.setImmediate,p=d.clearImmediate,m=d.MessageChannel,h=d.Dispatch,v=0,_={},y=function(){var e=+this;if(_.hasOwnProperty(e)){var t=_[e];delete _[e],t()}},g=function(e){y.call(e.data)};f&&p||(f=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return _[++v]=function(){s(\"function\"==typeof e?e:Function(e),t)},n(v),v},p=function(e){delete _[e]},\"process\"==r(52)(l)?n=function(e){l.nextTick(i(y,e,1))}:h&&h.now?n=function(e){h.now(i(y,e,1))}:m?(a=(o=new m).port2,o.port1.onmessage=g,n=i(a.postMessage,a,1)):d.addEventListener&&\"function\"==typeof postMessage&&!d.importScripts?(n=function(e){d.postMessage(e+\"\",\"*\")},d.addEventListener(\"message\",g,!1)):n=\"onreadystatechange\"in u(\"script\")?function(e){c.appendChild(u(\"script\")).onreadystatechange=function(){c.removeChild(this),y.call(e)}}:function(e){setTimeout(i(y,e,1),0)}),e.exports={set:f,clear:p}},function(e,t){e.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,r){var n=r(23),o=r(16),a=r(81);e.exports=function(e,t){if(n(e),o(t)&&t.constructor===e)return t;var r=a.f(e);return(0,r.resolve)(t),r.promise}},function(e,t,r){\"use strict\";var n=r(15),o=r(2),a=r(22),i=r(24),s=r(17)(\"species\");e.exports=function(e){var t=\"function\"==typeof o[e]?o[e]:n[e];i&&t&&!t[s]&&a.f(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,r){var n=r(17)(\"iterator\"),o=!1;try{var a=[7][n]();a.return=function(){o=!0},Array.from(a,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!o)return!1;var r=!1;try{var a=[7],i=a[n]();i.next=function(){return{done:r=!0}},a[n]=function(){return i},e(a)}catch(e){}return r}},function(e,t,r){e.exports=r(150)},function(e,t,r){\"use strict\";t.__esModule=!0;var n,o=r(8),a=(n=o)&&n.__esModule?n:{default:n};t.default=function(e){return function(){var t=e.apply(this,arguments);return new a.default((function(e,r){return function n(o,i){try{var s=t[o](i),c=s.value}catch(e){return void r(e)}if(!s.done)return a.default.resolve(c).then((function(e){n(\"next\",e)}),(function(e){n(\"throw\",e)}));e(c)}(\"next\")}))}}},function(e,t,r){\"use strict\";var n=r(22).f,o=r(50),a=r(82),i=r(27),s=r(79),c=r(55),u=r(71),d=r(92),l=r(104),f=r(24),p=r(61).fastKey,m=r(83),h=f?\"_s\":\"size\",v=function(e,t){var r,n=p(t);if(\"F\"!==n)return e._i[n];for(r=e._f;r;r=r.n)if(r.k==t)return r};e.exports={getConstructor:function(e,t,r,u){var d=e((function(e,n){s(e,d,t,\"_i\"),e._t=t,e._i=o(null),e._f=void 0,e._l=void 0,e[h]=0,null!=n&&c(n,r,e[u],e)}));return a(d.prototype,{clear:function(){for(var e=m(this,t),r=e._i,n=e._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete r[n.i];e._f=e._l=void 0,e[h]=0},delete:function(e){var r=m(this,t),n=v(r,e);if(n){var o=n.n,a=n.p;delete r._i[n.i],n.r=!0,a&&(a.n=o),o&&(o.p=a),r._f==n&&(r._f=o),r._l==n&&(r._l=a),r[h]--}return!!n},forEach:function(e){m(this,t);for(var r,n=i(e,arguments.length>1?arguments[1]:void 0,3);r=r?r.n:this._f;)for(n(r.v,r.k,this);r&&r.r;)r=r.p},has:function(e){return!!v(m(this,t),e)}}),f&&n(d.prototype,\"size\",{get:function(){return m(this,t)[h]}}),d},def:function(e,t,r){var n,o,a=v(e,t);return a?a.v=r:(e._l=a={i:o=p(t,!0),k:t,v:r,p:n=e._l,n:void 0,r:!1},e._f||(e._f=a),n&&(n.n=a),e[h]++,\"F\"!==o&&(e._i[o]=a)),e},getEntry:v,setStrong:function(e,t,r){u(e,t,(function(e,r){this._t=m(e,t),this._k=r,this._l=void 0}),(function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?d(0,\"keys\"==e?t.k:\"values\"==e?t.v:[t.k,t.v]):(this._t=void 0,d(1))}),r?\"entries\":\"values\",!r,!0),l(t)}}},function(e,t,r){\"use strict\";var n=r(15),o=r(13),a=r(61),i=r(32),s=r(31),c=r(82),u=r(55),d=r(79),l=r(16),f=r(53),p=r(22).f,m=r(154)(0),h=r(24);e.exports=function(e,t,r,v,_,y){var g=n[e],b=g,w=_?\"set\":\"add\",k=b&&b.prototype,P={};return h&&\"function\"==typeof b&&(y||k.forEach&&!i((function(){(new b).entries().next()})))?(b=t((function(t,r){d(t,b,e,\"_c\"),t._c=new g,null!=r&&u(r,_,t[w],t)})),m(\"add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON\".split(\",\"),(function(e){var t=\"add\"==e||\"set\"==e;e in k&&(!y||\"clear\"!=e)&&s(b.prototype,e,(function(r,n){if(d(this,b,e),!t&&y&&!l(r))return\"get\"==e&&void 0;var o=this._c[e](0===r?0:r,n);return t?this:o}))})),y||p(b.prototype,\"size\",{get:function(){return this._c.size}})):(b=v.getConstructor(t,e,_,w),c(b.prototype,r),a.NEED=!0),f(b,e),P[e]=b,o(o.G+o.W+o.F,P),y||v.setStrong(b,e,_),b}},function(e,t,r){var n=r(78),o=r(158);e.exports=function(e){return function(){if(n(this)!=e)throw TypeError(e+\"#toJSON isn't generic\");return o(this)}}},function(e,t,r){\"use strict\";var n=r(13);e.exports=function(e){n(n.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},function(e,t,r){\"use strict\";var n=r(13),o=r(38),a=r(27),i=r(55);e.exports=function(e){n(n.S,e,{from:function(e){var t,r,n,s,c=arguments[1];return o(this),(t=void 0!==c)&&o(c),null==e?new this:(r=[],t?(n=0,s=a(c,arguments[2],2),i(e,!1,(function(e){r.push(s(e,n++))}))):i(e,!1,r.push,r),new this(r))}})}},function(e,t,r){(function(n){t.log=function(...e){return\"object\"==typeof console&&console.log&&console.log(...e)},t.formatArgs=function(t){if(t[0]=(this.useColors?\"%c\":\"\")+this.namespace+(this.useColors?\" %c\":\" \")+t[0]+(this.useColors?\"%c \":\" \")+\"+\"+e.exports.humanize(this.diff),!this.useColors)return;const r=\"color: \"+this.color;t.splice(1,0,r,\"color: inherit\");let n=0,o=0;t[0].replace(/%[a-zA-Z%]/g,e=>{\"%%\"!==e&&(n++,\"%c\"===e&&(o=n))}),t.splice(o,0,r)},t.save=function(e){try{e?t.storage.setItem(\"debug\",e):t.storage.removeItem(\"debug\")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem(\"debug\")}catch(e){}!e&&void 0!==n&&\"env\"in n&&(e=n.env.DEBUG);return e},t.useColors=function(){if(\"undefined\"!=typeof window&&window.process&&(\"renderer\"===window.process.type||window.process.__nwjs))return!0;if(\"undefined\"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\\/(\\d+)/))return!1;return\"undefined\"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||\"undefined\"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||\"undefined\"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/)&&parseInt(RegExp.$1,10)>=31||\"undefined\"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=[\"#0000CC\",\"#0000FF\",\"#0033CC\",\"#0033FF\",\"#0066CC\",\"#0066FF\",\"#0099CC\",\"#0099FF\",\"#00CC00\",\"#00CC33\",\"#00CC66\",\"#00CC99\",\"#00CCCC\",\"#00CCFF\",\"#3300CC\",\"#3300FF\",\"#3333CC\",\"#3333FF\",\"#3366CC\",\"#3366FF\",\"#3399CC\",\"#3399FF\",\"#33CC00\",\"#33CC33\",\"#33CC66\",\"#33CC99\",\"#33CCCC\",\"#33CCFF\",\"#6600CC\",\"#6600FF\",\"#6633CC\",\"#6633FF\",\"#66CC00\",\"#66CC33\",\"#9900CC\",\"#9900FF\",\"#9933CC\",\"#9933FF\",\"#99CC00\",\"#99CC33\",\"#CC0000\",\"#CC0033\",\"#CC0066\",\"#CC0099\",\"#CC00CC\",\"#CC00FF\",\"#CC3300\",\"#CC3333\",\"#CC3366\",\"#CC3399\",\"#CC33CC\",\"#CC33FF\",\"#CC6600\",\"#CC6633\",\"#CC9900\",\"#CC9933\",\"#CCCC00\",\"#CCCC33\",\"#FF0000\",\"#FF0033\",\"#FF0066\",\"#FF0099\",\"#FF00CC\",\"#FF00FF\",\"#FF3300\",\"#FF3333\",\"#FF3366\",\"#FF3399\",\"#FF33CC\",\"#FF33FF\",\"#FF6600\",\"#FF6633\",\"#FF9900\",\"#FF9933\",\"#FFCC00\",\"#FFCC33\"],e.exports=r(164)(t);const{formatters:o}=e.exports;o.j=function(e){try{return JSON.stringify(e)}catch(e){return\"[UnexpectedJSONParseError]: \"+e.message}}}).call(this,r(163))},function(e,t,r){\"use strict\";var n=u(r(64)),o=u(r(0)),a=u(r(28)),i=u(r(29)),s=u(r(40)),c=u(r(42));function u(e){return e&&e.__esModule?e:{default:e}}var d=r(33),l=r(115),f=r(116).uuid,p=r(34)(\"IPLocation\"),m=r(30).iplocationAddress,h=r(30).iplocationPort,v=r(30).mediaServerAddress,_=l.operation({retries:4,factor:2,minTimeout:1e3,maxTimeout:2e3,randomize:!0}),y=function(e){function t(e,r,n,i){(0,a.default)(this,t);var c=(0,s.default)(this,(t.__proto__||(0,o.default)(t)).call(this));return c.appId=e,c.connectId=f(),c._url=\"wss://\"+m+\":\"+h+\"/iplocation/\",p.debug(\"constructor: \"+c._url),c._wsjson={eType:1,sSEQID:\"111111111\",mProtocolMsg:{sVersion:\"Test_4.2.0.777\",bLoadBalance:!1,bReConnect:!1,bVipUser:!1,sIDentify:\"7B4FCDBC0914E7182B8EC357F07498F1\",sSecret:\"c052cd055acfabc5\",sVerifyCode:\"abcd\",sAppID:e,nUserID:+r,sClientVer:\"web_1.0\",sConnectID:c.connectId,mIpAddrMsg:{bFec:!1,sIp:m,nPort:0}}},c._ws=null,c._closed=!1,c._successcb=n,c._failcb=i,c.reconnectTimes=1,c.firstConnectTime=Date.now(),c.connectedTime=0,c._hasSolve=!1,c._sendRetry={retry:5,timer:0},c._setWebSocket(),c}return(0,c.default)(t,e),(0,i.default)(t,[{key:\"getIpLocationVar\",value:function(){return this.svcHost}},{key:\"close\",value:function(){this._closed=!0,null!==this._ws&&(this._ws.close(),this._ws=null)}},{key:\"_setWebSocket\",value:function(){var e=this,t=l.operation(_),r=!1;t.attempt((function(o){e._closed?t.stop():(p.debug(\"_setWebSocket() connecting... [currentAttempt: \"+o),e._ws=new WebSocket(e._url),e._ws.onopen=function(){e._closed||(r=!0,e.connectedTime=Date.now(),e._ws.send((0,n.default)(e._wsjson)),e._sendRetry.timer=setInterval((function(){e._hasSolve||(0===e._sendRetry.retry&&(e._ws.close(),t.retry(!0),clearInterval(e._sendRetry.timer)),e._ws.send((0,n.default)(e._wsjson)),--e._sendRetry.retry)}),500),p.debug(\"WebSocket event [open]\"))},e._ws.onclose=function(o){if(!e._closed)if(p.warn(\"WebSocket event [close] -- \"+(0,n.default)(o)),4e3===o.code)e._closed=!0;else{if(r){if(t.stop(),e._closed)return;return void e._setWebSocket()}if(e._closed)return;t.retry(!0)&&++e.reconnectTimes}},e._ws.onerror=function(t){e._closed||p.error(\"WebSocket event [error] - error \"+t.toString()+\" - nothing todo.\")},e._ws.onmessage=function(t){if(!e._closed){var r=JSON.parse(t.data);if(1!==r.eResult)return e._failcb(\"msg.eResult: \"+r.eResult),void e.close();var n=r.mProtocolMsg.mIpAddrMsg;e.svcHost={ip:n.sIp,domain:n.sDomain,port:n.nPort},\"\"!==v&&(e.svcHost={ip:n.sIp,domain:v,port:n.nPort}),e._sendRetry.timer&&(clearInterval(e._sendRetry.timer),e._sendRetry.timer=0),e._hasSolve=!0,e._successcb(e.svcHost,r.mProtocolMsg.mGWIpAddrMsgList),e.close()}})}))}}],[{key:\"IplocationAddress\",set:function(e){p.debug(\"set IplocationAddress: \"+e),m=e},get:function(){return m}},{key:\"IplocationPort\",set:function(e){p.debug(\"set IplocationPort: \"+e),/^[1-9][0-9]{2,4}$/.test(\"\"+e)&&(h=e)},get:function(){return h}},{key:\"MediaServerAddress\",set:function(e){v=e},get:function(){return v}}]),t}(d.EventEmitter);e.exports=y},function(e,t,r){e.exports=r(172)},function(e,t,r){\"use strict\";e.exports={getProtooUrl:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:\"\",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:\"\",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3443,a=\"wss://\"+n+\":\"+o+\"/?peerName=\"+e+\"&roomId=\"+t+\"_\"+r;return a},uuid:function(){for(var e=[],t=0;t<36;t++)e[t]=\"0123456789abcdef\".substr(Math.floor(16*Math.random()),1);return e[14]=\"4\",e[19]=\"0123456789abcdef\".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]=\"-\",e.join(\"\")}}},function(e,t,r){\"use strict\";var n=i(r(8)),o=i(r(11)),a=i(r(1));function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.setDeviceHandler=function(e,t){c.default.setHandler(e,t)},t.isDeviceSupported=function(){return c.default.isSupported()},t.getDeviceInfo=function(){return{flag:c.default.getFlag(),name:c.default.getName(),version:c.default.getVersion(),bowser:c.default.getBowser()}},t.checkCapabilitiesForRoom=function(e){return c.default.isSupported()?c.default.Handler.getNativeRtpCapabilities().then((function(t){var r=s.getExtendedRtpCapabilities(t,e);return{audio:s.canSend(\"audio\",r),video:s.canSend(\"video\",r)}})):n.default.reject(new Error(\"current browser/device not supported\"))},Object.defineProperty(t,\"Room\",{enumerable:!0,get:function(){return u.default}}),t.internals=void 0;var s=f(r(18)),c=l(r(84)),u=l(r(201)),d=f(r(214));function l(e){return e&&e.__esModule?e:{default:e}}function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=a.default&&o.default?(0,o.default)(e,r):{};n.get||n.set?(0,a.default)(t,r,n):t[r]=e[r]}return t.default=e,t}t.internals=d},function(e,t,r){\"use strict\";var n,o=r(35),a=(n=o)&&n.__esModule?n:{default:n};var i=e.exports={v:[{name:\"version\",reg:/^(\\d*)$/}],o:[{name:\"origin\",reg:/^(\\S*) (\\d*) (\\d*) (\\S*) IP(\\d) (\\S*)/,names:[\"username\",\"sessionId\",\"sessionVersion\",\"netType\",\"ipVer\",\"address\"],format:\"%s %s %d %s IP%d %s\"}],s:[{name:\"name\"}],i:[{name:\"description\"}],u:[{name:\"uri\"}],e:[{name:\"email\"}],p:[{name:\"phone\"}],z:[{name:\"timezones\"}],r:[{name:\"repeats\"}],t:[{name:\"timing\",reg:/^(\\d*) (\\d*)/,names:[\"start\",\"stop\"],format:\"%d %d\"}],c:[{name:\"connection\",reg:/^IN IP(\\d) (\\S*)/,names:[\"version\",\"ip\"],format:\"IN IP%d %s\"}],b:[{push:\"bandwidth\",reg:/^(TIAS|AS|CT|RR|RS):(\\d*)/,names:[\"type\",\"limit\"],format:\"%s:%s\"}],m:[{reg:/^(\\w*) (\\d*) ([\\w\\/]*)(?: (.*))?/,names:[\"type\",\"port\",\"protocol\",\"payloads\"],format:\"%s %d %s %s\"}],a:[{push:\"rtp\",reg:/^rtpmap:(\\d*) ([\\w\\-\\.]*)(?:\\s*\\/(\\d*)(?:\\s*\\/(\\S*))?)?/,names:[\"payload\",\"codec\",\"rate\",\"encoding\"],format:function(e){return e.encoding?\"rtpmap:%d %s/%s/%s\":e.rate?\"rtpmap:%d %s/%s\":\"rtpmap:%d %s\"}},{push:\"fmtp\",reg:/^fmtp:(\\d*) ([\\S| ]*)/,names:[\"payload\",\"config\"],format:\"fmtp:%d %s\"},{name:\"control\",reg:/^control:(.*)/,format:\"control:%s\"},{name:\"rtcp\",reg:/^rtcp:(\\d*)(?: (\\S*) IP(\\d) (\\S*))?/,names:[\"port\",\"netType\",\"ipVer\",\"address\"],format:function(e){return null!=e.address?\"rtcp:%d %s IP%d %s\":\"rtcp:%d\"}},{push:\"rtcpFbTrrInt\",reg:/^rtcp-fb:(\\*|\\d*) trr-int (\\d*)/,names:[\"payload\",\"value\"],format:\"rtcp-fb:%d trr-int %d\"},{push:\"rtcpFb\",reg:/^rtcp-fb:(\\*|\\d*) ([\\w-_]*)(?: ([\\w-_]*))?/,names:[\"payload\",\"type\",\"subtype\"],format:function(e){return null!=e.subtype?\"rtcp-fb:%s %s %s\":\"rtcp-fb:%s %s\"}},{push:\"ext\",reg:/^extmap:(\\d+)(?:\\/(\\w+))? (\\S*)(?: (\\S*))?/,names:[\"value\",\"direction\",\"uri\",\"config\"],format:function(e){return\"extmap:%d\"+(e.direction?\"/%s\":\"%v\")+\" %s\"+(e.config?\" %s\":\"\")}},{push:\"crypto\",reg:/^crypto:(\\d*) ([\\w_]*) (\\S*)(?: (\\S*))?/,names:[\"id\",\"suite\",\"config\",\"sessionConfig\"],format:function(e){return null!=e.sessionConfig?\"crypto:%d %s %s %s\":\"crypto:%d %s %s\"}},{name:\"setup\",reg:/^setup:(\\w*)/,format:\"setup:%s\"},{name:\"mid\",reg:/^mid:([^\\s]*)/,format:\"mid:%s\"},{name:\"msid\",reg:/^msid:(.*)/,format:\"msid:%s\"},{name:\"ptime\",reg:/^ptime:(\\d*)/,format:\"ptime:%d\"},{name:\"maxptime\",reg:/^maxptime:(\\d*)/,format:\"maxptime:%d\"},{name:\"direction\",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:\"icelite\",reg:/^(ice-lite)/},{name:\"iceUfrag\",reg:/^ice-ufrag:(\\S*)/,format:\"ice-ufrag:%s\"},{name:\"icePwd\",reg:/^ice-pwd:(\\S*)/,format:\"ice-pwd:%s\"},{name:\"fingerprint\",reg:/^fingerprint:(\\S*) (\\S*)/,names:[\"type\",\"hash\"],format:\"fingerprint:%s %s\"},{push:\"candidates\",reg:/^candidate:(\\S*) (\\d*) (\\S*) (\\d*) (\\S*) (\\d*) typ (\\S*)(?: raddr (\\S*) rport (\\d*))?(?: tcptype (\\S*))?(?: generation (\\d*))?(?: network-id (\\d*))?(?: network-cost (\\d*))?/,names:[\"foundation\",\"component\",\"transport\",\"priority\",\"ip\",\"port\",\"type\",\"raddr\",\"rport\",\"tcptype\",\"generation\",\"network-id\",\"network-cost\"],format:function(e){var t=\"candidate:%s %d %s %d %s %d typ %s\";return t+=null!=e.raddr?\" raddr %s rport %d\":\"%v%v\",t+=null!=e.tcptype?\" tcptype %s\":\"%v\",null!=e.generation&&(t+=\" generation %d\"),t+=null!=e[\"network-id\"]?\" network-id %d\":\"%v\",t+=null!=e[\"network-cost\"]?\" network-cost %d\":\"%v\"}},{name:\"endOfCandidates\",reg:/^(end-of-candidates)/},{name:\"remoteCandidates\",reg:/^remote-candidates:(.*)/,format:\"remote-candidates:%s\"},{name:\"iceOptions\",reg:/^ice-options:(\\S*)/,format:\"ice-options:%s\"},{push:\"ssrcs\",reg:/^ssrc:(\\d*) ([\\w_-]*)(?::(.*))?/,names:[\"id\",\"attribute\",\"value\"],format:function(e){var t=\"ssrc:%d\";return null!=e.attribute&&(t+=\" %s\",null!=e.value&&(t+=\":%s\")),t}},{push:\"ssrcGroups\",reg:/^ssrc-group:([\\x21\\x23\\x24\\x25\\x26\\x27\\x2A\\x2B\\x2D\\x2E\\w]*) (.*)/,names:[\"semantics\",\"ssrcs\"],format:\"ssrc-group:%s %s\"},{name:\"msidSemantic\",reg:/^msid-semantic:\\s?(\\w*) (\\S*)/,names:[\"semantic\",\"token\"],format:\"msid-semantic: %s %s\"},{push:\"groups\",reg:/^group:(\\w*) (.*)/,names:[\"type\",\"mids\"],format:\"group:%s %s\"},{name:\"rtcpMux\",reg:/^(rtcp-mux)/},{name:\"rtcpRsize\",reg:/^(rtcp-rsize)/},{name:\"sctpmap\",reg:/^sctpmap:([\\w_\\/]*) (\\S*)(?: (\\S*))?/,names:[\"sctpmapNumber\",\"app\",\"maxMessageSize\"],format:function(e){return null!=e.maxMessageSize?\"sctpmap:%s %s %s\":\"sctpmap:%s %s\"}},{name:\"xGoogleFlag\",reg:/^x-google-flag:([^\\s]*)/,format:\"x-google-flag:%s\"},{push:\"rids\",reg:/^rid:([\\d\\w]+) (\\w+)(?: ([\\S| ]*))?/,names:[\"id\",\"direction\",\"params\"],format:function(e){return e.params?\"rid:%s %s %s\":\"rid:%s %s\"}},{push:\"imageattrs\",reg:new RegExp(\"^imageattr:(\\\\d+|\\\\*)[\\\\s\\\\t]+(send|recv)[\\\\s\\\\t]+(\\\\*|\\\\[\\\\S+\\\\](?:[\\\\s\\\\t]+\\\\[\\\\S+\\\\])*)(?:[\\\\s\\\\t]+(recv|send)[\\\\s\\\\t]+(\\\\*|\\\\[\\\\S+\\\\](?:[\\\\s\\\\t]+\\\\[\\\\S+\\\\])*))?\"),names:[\"pt\",\"dir1\",\"attrs1\",\"dir2\",\"attrs2\"],format:function(e){return\"imageattr:%s %s %s\"+(e.dir2?\" %s %s\":\"\")}},{name:\"simulcast\",reg:new RegExp(\"^simulcast:(send|recv) ([a-zA-Z0-9\\\\-_~;,]+)(?:\\\\s?(send|recv) ([a-zA-Z0-9\\\\-_~;,]+))?$\"),names:[\"dir1\",\"list1\",\"dir2\",\"list2\"],format:function(e){return\"simulcast:%s %s\"+(e.dir2?\" %s %s\":\"\")}},{name:\"simulcast_03\",reg:/^simulcast:[\\s\\t]+([\\S+\\s\\t]+)$/,names:[\"value\"],format:\"simulcast: %s\"},{name:\"framerate\",reg:/^framerate:(\\d+(?:$|\\.\\d+))/,format:\"framerate:%s\"},{name:\"sourceFilter\",reg:/^source-filter: *(excl|incl) (\\S*) (IP4|IP6|\\*) (\\S*) (.*)/,names:[\"filterMode\",\"netType\",\"addressTypes\",\"destAddress\",\"srcList\"],format:\"source-filter: %s %s %s %s %s\"},{name:\"bundleOnly\",reg:/^(bundle-only)/},{name:\"label\",reg:/^label:(.+)/,format:\"label:%s\"},{name:\"sctpPort\",reg:/^sctp-port:(\\d+)$/,format:\"sctp-port:%s\"},{name:\"maxMessageSize\",reg:/^max-message-size:(\\d+)$/,format:\"max-message-size:%s\"},{push:\"invalid\",names:[\"value\"]}]};(0,a.default)(i).forEach((function(e){i[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format=\"%s\")}))}))},function(e,t){!function(t){function r(e){var t=(e=e||{}).min,r=e.max,n=e.integer||!1;if(null==t&&null==r?(t=0,r=1):null==t?t=r-1:null==r&&(r=t+1),r<t)throw new Error(\"invalid options, max must be >= min\");return{min:t,max:r,integer:n}}function n(e){if((e=r(e)).max===e.min)return e.min;var t=Math.random()*(e.max-e.min+Number(!!e.integer))+e.min;return e.integer?Math.floor(t):t}e.exports=n,e.exports.generator=function(e){return e=r(e),function(t,r,o){return e.min=null!=t?t:e.min,e.max=null!=r?r:e.max,e.integer=null!=o?o:e.integer,n(e)}},e.exports.defaults=r}()},function(e,t,r){\"use strict\";var n=i(r(3)),o=i(r(28)),a=i(r(29));function i(e){return e&&e.__esModule?e:{default:e}}var s=r(34)(\"Message\"),c=r(219),u=function(){function e(){(0,o.default)(this,e)}return(0,a.default)(e,null,[{key:\"parse\",value:function(e){var t=void 0,r={};try{t=JSON.parse(e)}catch(e){return void s.error(\"parse() | invalid JSON: %s\",e)}if(\"object\"===(void 0===t?\"undefined\":(0,n.default)(t))&&!Array.isArray(t)){if(t.request){if(r.request=!0,\"string\"!=typeof t.method)return void s.error(\"parse() | missing/invalid method field\");if(\"number\"!=typeof t.id)return void s.error(\"parse() | missing/invalid id field\");r.id=t.id,r.method=t.method,r.data=t.data||{}}else if(t.response){if(r.response=!0,\"number\"!=typeof t.id)return void s.error(\"parse() | missing/invalid id field\");r.id=t.id,t.ok?(r.ok=!0,r.data=t.data||{}):(r.errorCode=t.errorCode,r.errorReason=t.errorReason)}else{if(!t.notification)return void s.error(\"parse() | missing request/response field\");if(r.notification=!0,\"string\"!=typeof t.method)return void s.error(\"parse() | missing/invalid method field\");r.method=t.method,r.data=t.data||{}}return r}s.error(\"parse() | not an object\")}},{key:\"requestFactory\",value:function(e,t){return{request:!0,id:c.randomNumber(),method:e,data:t||{}}}},{key:\"successResponseFactory\",value:function(e,t){return{response:!0,id:e.id,ok:!0,data:t||{}}}},{key:\"errorResponseFactory\",value:function(e,t,r){return{response:!0,id:e.id,errorCode:t,errorReason:r}}},{key:\"notificationFactory\",value:function(e,t){return{notification:!0,method:e,data:t||{}}}}]),e}();e.exports=u},function(e,t,r){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0});var n=c(r(0)),o=c(r(28)),a=c(r(29)),i=c(r(40)),s=c(r(42));function c(e){return e&&e.__esModule?e:{default:e}}var u=r(33).EventEmitter,d=r(96),l=r(166),f=r(117),p=(r(30),r(34)(\"TTTRtcWeb\")),m=r(114),h=r(230),v=function(t){function r(){(0,o.default)(this,r);var t=(0,i.default)(this,(r.__proto__||(0,n.default)(r)).call(this));return t._client=null,t._stream=null,t._isAuth=!1,e.g_client=null,e.g_tttRtcWeb=t,t}return(0,s.default)(r,t),(0,a.default)(r,[{key:\"checkSystemRequirements\",value:function(){return RTCPeerConnection&&navigator.mediaDevices.getUserMedia&&f.isDeviceSupported()}},{key:\"getDevices\",value:function(e,t){\"function\"==typeof e?\"function\"==typeof t?navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then((function(t){e(t)})).catch((function(e){t(e)})):p.error(\"enumerateDevices() not supported.\"):p.error(\"API getDevices() error - parameter: onFailure invalid\"):p.error(\"API getDevices() error - parameter: onSuccess invalid\")}},{key:\"setLogLevel\",value:function(e){p._setLoggerLevel(e)}},{key:\"getVersion\",value:function(){return h.version+\"-\"+h.buildDate}},{key:\"createStream\",value:function(e){return this.checkSystemRequirements()?(this._stream=new d(e),this._stream):(p.error(\"createClient() - checkSystemRequirements not supported.\"),null)}},{key:\"createClient\",value:function(t){return this.checkSystemRequirements()?(this._client=new l(t),e.g_client=this._client,this._client):(p.error(\"createClient() - checkSystemRequirements not supported.\"),null)}},{key:\"getStats\",value:function(){return null==this._client?{}:this._client.getNetState()}},{key:\"setServerUrl\",value:function(e){e&&\"\"!==e.trim()&&(m.MediaServerAddress=e)}},{key:\"setIpLocationAddress\",value:function(e){e&&\"\"!==e.trim()&&(m.IplocationAddress=e)}},{key:\"setIpLocationPort\",value:function(e){m.IplocationPort=e}},{key:\"setTurnConf\",value:function(e){l.TurnConf=e}}]),r}(u);t.default=v}).call(this,r(57))},function(e,t,r){r(123),e.exports=r(2).Object.getPrototypeOf},function(e,t,r){var n=r(36),o=r(87);r(59)(\"getPrototypeOf\",(function(){return function(e){return o(n(e))}}))},function(e,t,r){r(125);var n=r(2).Object;e.exports=function(e,t,r){return n.defineProperty(e,t,r)}},function(e,t,r){var n=r(13);n(n.S+n.F*!r(24),\"Object\",{defineProperty:r(22).f})},function(e,t,r){r(41),r(54),e.exports=r(74).f(\"iterator\")},function(e,t,r){var n=r(70),o=r(65);e.exports=function(e){return function(t,r){var a,i,s=String(o(t)),c=n(r),u=s.length;return c<0||c>=u?e?\"\":void 0:(a=s.charCodeAt(c))<55296||a>56319||c+1===u||(i=s.charCodeAt(c+1))<56320||i>57343?e?s.charAt(c):a:e?s.slice(c,c+2):i-56320+(a-55296<<10)+65536}}},function(e,t,r){\"use strict\";var n=r(50),o=r(48),a=r(53),i={};r(31)(i,r(17)(\"iterator\"),(function(){return this})),e.exports=function(e,t,r){e.prototype=n(i,{next:o(1,r)}),a(e,t+\" Iterator\")}},function(e,t,r){var n=r(22),o=r(23),a=r(51);e.exports=r(24)?Object.defineProperties:function(e,t){o(e);for(var r,i=a(t),s=i.length,c=0;s>c;)n.f(e,r=i[c++],t[r]);return e}},function(e,t,r){var n=r(39),o=r(60),a=r(131);e.exports=function(e){return function(t,r,i){var s,c=n(t),u=o(c.length),d=a(i,u);if(e&&r!=r){for(;u>d;)if((s=c[d++])!=s)return!0}else for(;u>d;d++)if((e||d in c)&&c[d]===r)return e||d||0;return!e&&-1}}},function(e,t,r){var n=r(70),o=Math.max,a=Math.min;e.exports=function(e,t){return(e=n(e))<0?o(e+t,0):a(e,t)}},function(e,t,r){\"use strict\";var n=r(133),o=r(92),a=r(49),i=r(39);e.exports=r(71)(Array,\"Array\",(function(e,t){this._t=i(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,o(1)):o(0,\"keys\"==t?r:\"values\"==t?e[r]:[r,e[r]])}),\"values\"),a.Arguments=a.Array,n(\"keys\"),n(\"values\"),n(\"entries\")},function(e,t){e.exports=function(){}},function(e,t,r){r(93),r(63),r(137),r(138),e.exports=r(2).Symbol},function(e,t,r){var n=r(51),o=r(76),a=r(62);e.exports=function(e){var t=n(e),r=o.f;if(r)for(var i,s=r(e),c=a.f,u=0;s.length>u;)c.call(e,i=s[u++])&&t.push(i);return t}},function(e,t,r){var n=r(39),o=r(95).f,a={}.toString,i=\"object\"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return i&&\"[object Window]\"==a.call(e)?function(e){try{return o(e)}catch(e){return i.slice()}}(e):o(n(e))}},function(e,t,r){r(75)(\"asyncIterator\")},function(e,t,r){r(75)(\"observable\")},function(e,t,r){r(140),e.exports=r(2).Object.setPrototypeOf},function(e,t,r){var n=r(13);n(n.S,\"Object\",{setPrototypeOf:r(141).set})},function(e,t,r){var n=r(16),o=r(23),a=function(e,t){if(o(e),!n(t)&&null!==t)throw TypeError(t+\": can't set as prototype!\")};e.exports={set:Object.setPrototypeOf||(\"__proto__\"in{}?function(e,t,n){try{(n=r(27)(Function.call,r(77).f(Object.prototype,\"__proto__\").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,r){return a(e,r),t?e.__proto__=r:n(e,r),e}}({},!1):void 0),check:a}},function(e,t,r){r(143);var n=r(2).Object;e.exports=function(e,t){return n.create(e,t)}},function(e,t,r){var n=r(13);n(n.S,\"Object\",{create:r(50)})},function(e,t,r){r(63),r(41),r(54),r(145),r(148),r(149),e.exports=r(2).Promise},function(e,t,r){\"use strict\";var n,o,a,i,s=r(47),c=r(15),u=r(27),d=r(78),l=r(13),f=r(16),p=r(38),m=r(79),h=r(55),v=r(99),_=r(100).set,y=r(146)(),g=r(81),b=r(102),w=r(147),k=r(103),P=c.TypeError,T=c.process,S=T&&T.versions,R=S&&S.v8||\"\",C=c.Promise,x=\"process\"==d(T),E=function(){},I=o=g.f,D=!!function(){try{var e=C.resolve(1),t=(e.constructor={})[r(17)(\"species\")]=function(e){e(E,E)};return(x||\"function\"==typeof PromiseRejectionEvent)&&e.then(E)instanceof t&&0!==R.indexOf(\"6.6\")&&-1===w.indexOf(\"Chrome/66\")}catch(e){}}(),O=function(e){var t;return!(!f(e)||\"function\"!=typeof(t=e.then))&&t},L=function(e,t){if(!e._n){e._n=!0;var r=e._c;y((function(){for(var n=e._v,o=1==e._s,a=0,i=function(t){var r,a,i,s=o?t.ok:t.fail,c=t.resolve,u=t.reject,d=t.domain;try{s?(o||(2==e._h&&A(e),e._h=1),!0===s?r=n:(d&&d.enter(),r=s(n),d&&(d.exit(),i=!0)),r===t.promise?u(P(\"Promise-chain cycle\")):(a=O(r))?a.call(r,c,u):c(r)):u(n)}catch(e){d&&!i&&d.exit(),u(e)}};r.length>a;)i(r[a++]);e._c=[],e._n=!1,t&&!e._h&&j(e)}))}},j=function(e){_.call(c,(function(){var t,r,n,o=e._v,a=M(e);if(a&&(t=b((function(){x?T.emit(\"unhandledRejection\",o,e):(r=c.onunhandledrejection)?r({promise:e,reason:o}):(n=c.console)&&n.error&&n.error(\"Unhandled promise rejection\",o)})),e._h=x||M(e)?2:1),e._a=void 0,a&&t.e)throw t.v}))},M=function(e){return 1!==e._h&&0===(e._a||e._c).length},A=function(e){_.call(c,(function(){var t;x?T.emit(\"rejectionHandled\",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})}))},F=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),L(t,!0))},N=function(e){var t,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===e)throw P(\"Promise can't be resolved itself\");(t=O(e))?y((function(){var n={_w:r,_d:!1};try{t.call(e,u(N,n,1),u(F,n,1))}catch(e){F.call(n,e)}})):(r._v=e,r._s=1,L(r,!1))}catch(e){F.call({_w:r,_d:!1},e)}}};D||(C=function(e){m(this,C,\"Promise\",\"_h\"),p(e),n.call(this);try{e(u(N,this,1),u(F,this,1))}catch(e){F.call(this,e)}},(n=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r(82)(C.prototype,{then:function(e,t){var r=I(v(this,C));return r.ok=\"function\"!=typeof e||e,r.fail=\"function\"==typeof t&&t,r.domain=x?T.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&L(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),a=function(){var e=new n;this.promise=e,this.resolve=u(N,e,1),this.reject=u(F,e,1)},g.f=I=function(e){return e===C||e===i?new a(e):o(e)}),l(l.G+l.W+l.F*!D,{Promise:C}),r(53)(C,\"Promise\"),r(104)(\"Promise\"),i=r(2).Promise,l(l.S+l.F*!D,\"Promise\",{reject:function(e){var t=I(this);return(0,t.reject)(e),t.promise}}),l(l.S+l.F*(s||!D),\"Promise\",{resolve:function(e){return k(s&&this===i?C:this,e)}}),l(l.S+l.F*!(D&&r(105)((function(e){C.all(e).catch(E)}))),\"Promise\",{all:function(e){var t=this,r=I(t),n=r.resolve,o=r.reject,a=b((function(){var r=[],a=0,i=1;h(e,!1,(function(e){var s=a++,c=!1;r.push(void 0),i++,t.resolve(e).then((function(e){c||(c=!0,r[s]=e,--i||n(r))}),o)})),--i||n(r)}));return a.e&&o(a.v),r.promise},race:function(e){var t=this,r=I(t),n=r.reject,o=b((function(){h(e,!1,(function(e){t.resolve(e).then(r.resolve,n)}))}));return o.e&&n(o.v),r.promise}})},function(e,t,r){var n=r(15),o=r(100).set,a=n.MutationObserver||n.WebKitMutationObserver,i=n.process,s=n.Promise,c=\"process\"==r(52)(i);e.exports=function(){var e,t,r,u=function(){var n,o;for(c&&(n=i.domain)&&n.exit();e;){o=e.fn,e=e.next;try{o()}catch(n){throw e?r():t=void 0,n}}t=void 0,n&&n.enter()};if(c)r=function(){i.nextTick(u)};else if(!a||n.navigator&&n.navigator.standalone)if(s&&s.resolve){var d=s.resolve(void 0);r=function(){d.then(u)}}else r=function(){o.call(n,u)};else{var l=!0,f=document.createTextNode(\"\");new a(u).observe(f,{characterData:!0}),r=function(){f.data=l=!l}}return function(n){var o={fn:n,next:void 0};t&&(t.next=o),e||(e=o,r()),t=o}}},function(e,t,r){var n=r(15).navigator;e.exports=n&&n.userAgent||\"\"},function(e,t,r){\"use strict\";var n=r(13),o=r(2),a=r(15),i=r(99),s=r(103);n(n.P+n.R,\"Promise\",{finally:function(e){var t=i(this,o.Promise||a.Promise),r=\"function\"==typeof e;return this.then(r?function(r){return s(t,e()).then((function(){return r}))}:e,r?function(r){return s(t,e()).then((function(){throw r}))}:e)}})},function(e,t,r){\"use strict\";var n=r(13),o=r(81),a=r(102);n(n.S,\"Promise\",{try:function(e){var t=o.f(this),r=a(e);return(r.e?t.reject:t.resolve)(r.v),t.promise}})},function(e,t,r){var n=function(){return this}()||Function(\"return this\")(),o=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf(\"regeneratorRuntime\")>=0,a=o&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,e.exports=r(151),o)n.regeneratorRuntime=a;else try{delete n.regeneratorRuntime}catch(e){n.regeneratorRuntime=void 0}},function(e,t){!function(t){\"use strict\";var r=Object.prototype,n=r.hasOwnProperty,o=\"function\"==typeof Symbol?Symbol:{},a=o.iterator||\"@@iterator\",i=o.asyncIterator||\"@@asyncIterator\",s=o.toStringTag||\"@@toStringTag\",c=\"object\"==typeof e,u=t.regeneratorRuntime;if(u)c&&(e.exports=u);else{(u=t.regeneratorRuntime=c?e.exports:{}).wrap=h;var d={},l={};l[a]=function(){return this};var f=Object.getPrototypeOf,p=f&&f(f(R([])));p&&p!==r&&n.call(p,a)&&(l=p);var m=g.prototype=_.prototype=Object.create(l);y.prototype=m.constructor=g,g.constructor=y,g[s]=y.displayName=\"GeneratorFunction\",u.isGeneratorFunction=function(e){var t=\"function\"==typeof e&&e.constructor;return!!t&&(t===y||\"GeneratorFunction\"===(t.displayName||t.name))},u.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,s in e||(e[s]=\"GeneratorFunction\")),e.prototype=Object.create(m),e},u.awrap=function(e){return{__await:e}},b(w.prototype),w.prototype[i]=function(){return this},u.AsyncIterator=w,u.async=function(e,t,r,n){var o=new w(h(e,t,r,n));return u.isGeneratorFunction(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(m),m[s]=\"Generator\",m[a]=function(){return this},m.toString=function(){return\"[object Generator]\"},u.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},u.values=R,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method=\"next\",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)\"t\"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if(\"throw\"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return i.type=\"throw\",i.arg=e,t.next=r,n&&(t.method=\"next\",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if(\"root\"===a.tryLoc)return r(\"end\");if(a.tryLoc<=this.prev){var s=n.call(a,\"catchLoc\"),c=n.call(a,\"finallyLoc\");if(s&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error(\"try statement without catch or finally\");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,\"finallyLoc\")&&this.prev<o.finallyLoc){var a=o;break}}a&&(\"break\"===e||\"continue\"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method=\"next\",this.next=a.finallyLoc,d):this.complete(i)},complete:function(e,t){if(\"throw\"===e.type)throw e.arg;return\"break\"===e.type||\"continue\"===e.type?this.next=e.arg:\"return\"===e.type?(this.rval=this.arg=e.arg,this.method=\"return\",this.next=\"end\"):\"normal\"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if(\"throw\"===n.type){var o=n.arg;T(r)}return o}}throw new Error(\"illegal catch attempt\")},delegateYield:function(e,t,r){return this.delegate={iterator:R(e),resultName:t,nextLoc:r},\"next\"===this.method&&(this.arg=void 0),d}}}function h(e,t,r,n){var o=t&&t.prototype instanceof _?t:_,a=Object.create(o.prototype),i=new S(n||[]);return a._invoke=function(e,t,r){var n=\"suspendedStart\";return function(o,a){if(\"executing\"===n)throw new Error(\"Generator is already running\");if(\"completed\"===n){if(\"throw\"===o)throw a;return C()}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var s=k(i,r);if(s){if(s===d)continue;return s}}if(\"next\"===r.method)r.sent=r._sent=r.arg;else if(\"throw\"===r.method){if(\"suspendedStart\"===n)throw n=\"completed\",r.arg;r.dispatchException(r.arg)}else\"return\"===r.method&&r.abrupt(\"return\",r.arg);n=\"executing\";var c=v(e,t,r);if(\"normal\"===c.type){if(n=r.done?\"completed\":\"suspendedYield\",c.arg===d)continue;return{value:c.arg,done:r.done}}\"throw\"===c.type&&(n=\"completed\",r.method=\"throw\",r.arg=c.arg)}}}(e,r,i),a}function v(e,t,r){try{return{type:\"normal\",arg:e.call(t,r)}}catch(e){return{type:\"throw\",arg:e}}}function _(){}function y(){}function g(){}function b(e){[\"next\",\"throw\",\"return\"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function w(e){var t;this._invoke=function(r,o){function a(){return new Promise((function(t,a){!function t(r,o,a,i){var s=v(e[r],e,o);if(\"throw\"!==s.type){var c=s.arg,u=c.value;return u&&\"object\"==typeof u&&n.call(u,\"__await\")?Promise.resolve(u.__await).then((function(e){t(\"next\",e,a,i)}),(function(e){t(\"throw\",e,a,i)})):Promise.resolve(u).then((function(e){c.value=e,a(c)}),i)}i(s.arg)}(r,o,t,a)}))}return t=t?t.then(a,a):a()}}function k(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,\"throw\"===t.method){if(e.iterator.return&&(t.method=\"return\",t.arg=void 0,k(e,t),\"throw\"===t.method))return d;t.method=\"throw\",t.arg=new TypeError(\"The iterator does not provide a 'throw' method\")}return d}var n=v(r,e.iterator,t.arg);if(\"throw\"===n.type)return t.method=\"throw\",t.arg=n.arg,t.delegate=null,d;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,\"return\"!==t.method&&(t.method=\"next\",t.arg=void 0),t.delegate=null,d):o:(t.method=\"throw\",t.arg=new TypeError(\"iterator result is not an object\"),t.delegate=null,d)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type=\"normal\",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:\"root\"}],e.forEach(P,this),this.reset(!0)}function R(e){if(e){var t=e[a];if(t)return t.call(e);if(\"function\"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:C}}function C(){return{value:void 0,done:!0}}}(function(){return this}()||Function(\"return this\")())},function(e,t,r){r(63),r(41),r(54),r(153),r(157),r(159),r(160),e.exports=r(2).Map},function(e,t,r){\"use strict\";var n=r(108),o=r(83);e.exports=r(109)(\"Map\",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=n.getEntry(o(this,\"Map\"),e);return t&&t.v},set:function(e,t){return n.def(o(this,\"Map\"),0===e?0:e,t)}},n,!0)},function(e,t,r){var n=r(27),o=r(72),a=r(36),i=r(60),s=r(155);e.exports=function(e,t){var r=1==e,c=2==e,u=3==e,d=4==e,l=6==e,f=5==e||l,p=t||s;return function(t,s,m){for(var h,v,_=a(t),y=o(_),g=n(s,m,3),b=i(y.length),w=0,k=r?p(t,b):c?p(t,0):void 0;b>w;w++)if((f||w in y)&&(v=g(h=y[w],w,_),e))if(r)k[w]=v;else if(v)switch(e){case 3:return!0;case 5:return h;case 6:return w;case 2:k.push(h)}else if(d)return!1;return l?-1:u||d?d:k}}},function(e,t,r){var n=r(156);e.exports=function(e,t){return new(n(e))(t)}},function(e,t,r){var n=r(16),o=r(94),a=r(17)(\"species\");e.exports=function(e){var t;return o(e)&&(\"function\"!=typeof(t=e.constructor)||t!==Array&&!o(t.prototype)||(t=void 0),n(t)&&null===(t=t[a])&&(t=void 0)),void 0===t?Array:t}},function(e,t,r){var n=r(13);n(n.P+n.R,\"Map\",{toJSON:r(110)(\"Map\")})},function(e,t,r){var n=r(55);e.exports=function(e,t){var r=[];return n(e,!1,r.push,r,t),r}},function(e,t,r){r(111)(\"Map\")},function(e,t,r){r(112)(\"Map\")},function(e,t,r){var n,o=r(162);\"undefined\"!=typeof window&&(n=window.AudioContext||window.webkitAudioContext);var a=null;e.exports=function(e,t){var r=new o;if(!n)return r;var i,s,c,u=(t=t||{}).smoothing||.1,d=t.interval||50,l=t.threshold,f=t.play,p=t.history||10,m=!0;a=t.audioContext||a||new n,(c=a.createAnalyser()).fftSize=512,c.smoothingTimeConstant=u,s=new Float32Array(c.frequencyBinCount),e.jquery&&(e=e[0]),e instanceof HTMLAudioElement||e instanceof HTMLVideoElement?(i=a.createMediaElementSource(e),void 0===f&&(f=!0),l=l||-50):(i=a.createMediaStreamSource(e),l=l||-50),i.connect(c),f&&c.connect(a.destination),r.speaking=!1,r.suspend=function(){return a.suspend()},r.resume=function(){return a.resume()},Object.defineProperty(r,\"state\",{get:function(){return a.state}}),a.onstatechange=function(){r.emit(\"state_change\",a.state)},r.setThreshold=function(e){l=e},r.setInterval=function(e){d=e},r.stop=function(){m=!1,r.emit(\"volume_change\",-100,l),r.speaking&&(r.speaking=!1,r.emit(\"stopped_speaking\")),c.disconnect(),i.disconnect()},r.speakingHistory=[];for(var h=0;h<p;h++)r.speakingHistory.push(0);var v=function(){setTimeout((function(){if(m){var e=function(e,t){var r=-1/0;e.getFloatFrequencyData(t);for(var n=4,o=t.length;n<o;n++)t[n]>r&&t[n]<0&&(r=t[n]);return r}(c,s);r.emit(\"volume_change\",e,l);var t=0;if(e>l&&!r.speaking){for(var n=r.speakingHistory.length-3;n<r.speakingHistory.length;n++)t+=r.speakingHistory[n];t>=2&&(r.speaking=!0,r.emit(\"speaking\"))}else if(e<l&&r.speaking){for(n=0;n<r.speakingHistory.length;n++)t+=r.speakingHistory[n];0==t&&(r.speaking=!1,r.emit(\"stopped_speaking\"))}r.speakingHistory.shift(),r.speakingHistory.push(0+(e>l)),v()}}),d)};return v(),r}},function(e,t){function r(){}e.exports=r,r.mixin=function(e){var t=e.prototype||e;t.isWildEmitter=!0,t.on=function(e,t,r){this.callbacks=this.callbacks||{};var n=3===arguments.length,o=n?arguments[1]:void 0,a=n?arguments[2]:arguments[1];return a._groupName=o,(this.callbacks[e]=this.callbacks[e]||[]).push(a),this},t.once=function(e,t,r){var n=this,o=3===arguments.length,a=o?arguments[1]:void 0,i=o?arguments[2]:arguments[1];function s(){n.off(e,s),i.apply(this,arguments)}return this.on(e,a,s),this},t.releaseGroup=function(e){var t,r,n,o;for(t in this.callbacks=this.callbacks||{},this.callbacks)for(r=0,n=(o=this.callbacks[t]).length;r<n;r++)o[r]._groupName===e&&(o.splice(r,1),r--,n--);return this},t.off=function(e,t){this.callbacks=this.callbacks||{};var r,n=this.callbacks[e];return n?1===arguments.length?(delete this.callbacks[e],this):(-1!==(r=n.indexOf(t))&&(n.splice(r,1),0===n.length&&delete this.callbacks[e]),this):this},t.emit=function(e){this.callbacks=this.callbacks||{};var t,r,n,o=[].slice.call(arguments,1),a=this.callbacks[e],i=this.getWildcardCallbacks(e);if(a)for(t=0,r=(n=a.slice()).length;t<r&&n[t];++t)n[t].apply(this,o);if(i)for(r=i.length,t=0,r=(n=i.slice()).length;t<r&&n[t];++t)n[t].apply(this,[e].concat(o));return this},t.getWildcardCallbacks=function(e){this.callbacks=this.callbacks||{};var t,r,n=[];for(t in this.callbacks)r=t.split(\"*\"),(\"*\"===t||2===r.length&&e.slice(0,r[0].length)===r[0])&&(n=n.concat(this.callbacks[t]));return n}},r.mixin(r)},function(e,t){var r,n,o=e.exports={};function a(){throw new Error(\"setTimeout has not been defined\")}function i(){throw new Error(\"clearTimeout has not been defined\")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r=\"function\"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{n=\"function\"==typeof clearTimeout?clearTimeout:i}catch(e){n=i}}();var c,u=[],d=!1,l=-1;function f(){d&&c&&(d=!1,c.length?u=c.concat(u):l=-1,u.length&&p())}function p(){if(!d){var e=s(f);d=!0;for(var t=u.length;t;){for(c=u,u=[];++l<t;)c&&c[l].run();l=-1,t=u.length}c=null,d=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function h(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new m(e,t)),1!==u.length||d||s(p)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title=\"browser\",o.browser=!0,o.env={},o.argv=[],o.version=\"\",o.versions={},o.on=h,o.addListener=h,o.once=h,o.off=h,o.removeListener=h,o.removeAllListeners=h,o.emit=h,o.prependListener=h,o.prependOnceListener=h,o.listeners=function(e){return[]},o.binding=function(e){throw new Error(\"process.binding is not supported\")},o.cwd=function(){return\"/\"},o.chdir=function(e){throw new Error(\"process.chdir is not supported\")},o.umask=function(){return 0}},function(e,t,r){e.exports=function(e){function t(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return n.colors[Math.abs(t)%n.colors.length]}function n(e){let r;function i(...e){if(!i.enabled)return;const t=i,o=Number(new Date),a=o-(r||o);t.diff=a,t.prev=r,t.curr=o,r=o,e[0]=n.coerce(e[0]),\"string\"!=typeof e[0]&&e.unshift(\"%O\");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(r,o)=>{if(\"%%\"===r)return r;s++;const a=n.formatters[o];if(\"function\"==typeof a){const n=e[s];r=a.call(t,n),e.splice(s,1),s--}return r}),n.formatArgs.call(t,e),(t.log||n.log).apply(t,e)}return i.namespace=e,i.enabled=n.enabled(e),i.useColors=n.useColors(),i.color=t(e),i.destroy=o,i.extend=a,\"function\"==typeof n.init&&n.init(i),n.instances.push(i),i}function o(){const e=n.instances.indexOf(this);return-1!==e&&(n.instances.splice(e,1),!0)}function a(e,t){const r=n(this.namespace+(void 0===t?\":\":t)+e);return r.log=this.log,r}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\\.\\*\\?$/,\"*\")}return n.debug=n,n.default=n,n.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},n.disable=function(){const e=[...n.names.map(i),...n.skips.map(i).map(e=>\"-\"+e)].join(\",\");return n.enable(\"\"),e},n.enable=function(e){let t;n.save(e),n.names=[],n.skips=[];const r=(\"string\"==typeof e?e:\"\").split(/[\\s,]+/),o=r.length;for(t=0;t<o;t++)r[t]&&(\"-\"===(e=r[t].replace(/\\*/g,\".*?\"))[0]?n.skips.push(new RegExp(\"^\"+e.substr(1)+\"$\")):n.names.push(new RegExp(\"^\"+e+\"$\")));for(t=0;t<n.instances.length;t++){const e=n.instances[t];e.enabled=n.enabled(e.namespace)}},n.enabled=function(e){if(\"*\"===e[e.length-1])return!0;let t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=r(165),Object.keys(e).forEach(t=>{n[t]=e[t]}),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=t,n.enable(n.load()),n}},function(e,t){var r=1e3,n=6e4,o=36e5,a=24*o;function i(e,t,r,n){var o=t>=1.5*r;return Math.round(e/r)+\" \"+n+(o?\"s\":\"\")}e.exports=function(e,t){t=t||{};var s=typeof e;if(\"string\"===s&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var i=parseFloat(t[1]);switch((t[2]||\"ms\").toLowerCase()){case\"years\":case\"year\":case\"yrs\":case\"yr\":case\"y\":return 315576e5*i;case\"weeks\":case\"week\":case\"w\":return 6048e5*i;case\"days\":case\"day\":case\"d\":return i*a;case\"hours\":case\"hour\":case\"hrs\":case\"hr\":case\"h\":return i*o;case\"minutes\":case\"minute\":case\"mins\":case\"min\":case\"m\":return i*n;case\"seconds\":case\"second\":case\"secs\":case\"sec\":case\"s\":return i*r;case\"milliseconds\":case\"millisecond\":case\"msecs\":case\"msec\":case\"ms\":return i;default:return}}(e);if(\"number\"===s&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=a)return i(e,t,a,\"day\");if(t>=o)return i(e,t,o,\"hour\");if(t>=n)return i(e,t,n,\"minute\");if(t>=r)return i(e,t,r,\"second\");return e+\" ms\"}(e):function(e){var t=Math.abs(e);if(t>=a)return Math.round(e/a)+\"d\";if(t>=o)return Math.round(e/o)+\"h\";if(t>=n)return Math.round(e/n)+\"m\";if(t>=r)return Math.round(e/r)+\"s\";return e+\"ms\"}(e);throw new Error(\"val is not a non-empty string or a valid number. val=\"+JSON.stringify(e))}},function(e,t,r){\"use strict\";(function(t){var n=h(r(35)),o=h(r(106)),a=h(r(107)),i=h(r(8)),s=h(r(21)),c=h(r(64)),u=h(r(10)),d=h(r(0)),l=h(r(28)),f=h(r(29)),p=h(r(40)),m=h(r(42));function h(e){return e&&e.__esModule?e:{default:e}}var v=r(114),_=r(30),y=r(116),g=r(96),b=r(117),w=r(33).EventEmitter,k=r(217),P=r(226),T=r(34)(\"Client\"),S={},R=function(e){function r(e){(0,l.default)(this,r);var n=(0,p.default)(this,(r.__proto__||(0,d.default)(r)).call(this));return n._spy=!1,n._closed=!1,n._peerName=\"\",n._sendTransport=null,n._recvTransport=null,n._micProducer=null,n._webcamProducer=null,n._screenProducer=null,n._peers=new u.default,n._stats=new P,n._interval=3e3,n._ip,n._port=3443,n._config=e,n._useSimulcast=!1,n._joined=!1,n._rtmpUrl=e.rtmpUrl,n._disableRtmpVideo=Boolean(e.disableRtmpVideo),t.g_appid=\"\",t.g_userid=\"\",t.g_roomid=\"\",t.g_deviceInfo=b.getDeviceInfo(),n}var h,w;return(0,m.default)(r,e),(0,f.default)(r,[{key:\"init\",value:function(e,r,n,o){var a=this;_.authUrl;if(void 0===e)throw new TypeError(\"must be set appid\");if(null===e)throw new TypeError(\"must be set appid\");if(\"\"===(\"\"+e).trim())throw new TypeError(\"must be set appid\");if(void 0===r)throw new TypeError(\"must be set userId\");if(null===r)throw new TypeError(\"must be set userId\");if(\"\"===(\"\"+r).trim())throw new TypeError(\"must be set userId\");if(this._uid=\"\"+r,\"function\"!=typeof n)throw new TypeError(\"onSuccess parameter must be a function.\");if(\"function\"!=typeof o)throw new TypeError(\"onFailure parameter must be a function.\");if(this._valid_rtmp_url=\"\",null!==this._rtmpUrl&&void 0!==this._rtmpUrl&&\"\"!==this._rtmpUrl.trim()){if(!new RegExp(\"^(rtmp?:\\\\/\\\\/)?((([a-z\\\\d]([a-z\\\\d-]*[a-z\\\\d])*)\\\\.)+[a-z]{2,}|((\\\\d{1,3}\\\\.){3}\\\\d{1,3}))(\\\\:\\\\d+)?(\\\\/[-a-z\\\\d%_.~+]*)*(\\\\?[;&a-z\\\\d%_.~+=-]*)?(\\\\#[-a-z\\\\d_]*)?$\",\"i\").test(this._rtmpUrl))throw new TypeError(\"rmtp url is invalid\");this._valid_rtmp_url=this._rtmpUrl}t.g_appid=e,t.g_userid=this._uid,T.debug(\"client.init calling\",\"appId\",e,\"uid\",r),this._appId=e;var i=v.MediaServerAddress;if((i=i.trim())&&\"\"!==i)return this._ip=i,T.debug(\"API init() success - server: \"+this._ip),n();var s=v.IplocationAddress;if(!(s=s.trim())||\"\"===s)return T.warn(\"API init() fail - need set IplocationAddress\"),o(\"need set IplocationAddress\");this._stats.setAppid(e),this._ipLocation=new v(e,+r,(function(e){a._stats.setDomain(e.domain),a._ip=e.domain;var t=parseInt(e.port,10);return a._port=t-25e3+3443,n()}),(function(){return o(\"ip location error.\")}))}},{key:\"join\",value:function(e,r,n){if(void 0===e)throw new TypeError(\"roomId must be set\");if(null===e)throw new TypeError(\"roomId must be set\");if(\"\"===(e=\"\"+e).trim())throw new TypeError(\"roomId must be set\");if(\"function\"!=typeof r)throw new TypeError(\"onSuccess parameter must be a function.\");if(\"function\"!=typeof n)throw new TypeError(\"onFailure parameter must be a function.\");var o=2;if(null===this._config&&void 0===this._config||null===this._config.role&&void 0===this._config.role||(o=this._config.role),+o>3||+o<0)throw new TypeError(\"role must be set as 1: master, 2: vice 3: audience\");this._role=\"\"+o,T.debug(\"client.join function calling. params channel=\"+e+\" role=\"+this._role);var a=this._uid,i=\"\"+e;t.g_roomid=i,this._stats.setRoomId(i),this._stats.setUserId(a),this._stats.setRoleType(0);var s=b.getDeviceInfo();this._stats.setDeviceInfo(s),this._peerName=a;var c=y.getProtooUrl(a,i,this._appId,this._ip,this._port),u=new k.WebSocketTransport(c);this._protoo=new k.Peer(u),_.privateNet&&void 0!==S.urls&&null!==S.urls||(S.urls=\"turn:\"+this._ip+\":3478\",S.credential=_.clientConfig.turnServer.password,S.username=_.clientConfig.turnServer.username),this._room=new b.Room({requestTimeout:3e4,transportOptions:{udp:!0,tcp:Boolean(!1)},spy:this._spy,turnServers:[{urls:S.urls,credential:S.credential,username:S.username}]}),this._onSuccess=r,this._onFailure=n,this._join({displayName:a,device:\"webcam\"})}},{key:\"_join\",value:function(e){var t=this,r=e.displayName,n=e.device;this._protoo.on(\"open\",(function(){T.debug('protoo Peer \"open\" event'),t._stats.setWsState(\"open\"),t._joinRoom({displayName:r,device:n})})),this._protoo.on(\"disconnected\",(function(){T.warn('protoo Peer \"disconnected\" event'),t._stats.setWsState(\"disconnected\");try{t._room.remoteClose({cause:\"protoo disconnected\"})}catch(e){T.error(\"_room.remoteClose error\",(0,c.default)(e))}})),this._protoo.on(\"close\",(function(){t._stats.setWsState(\"close\"),t._closed||(T.warn('protoo Peer \"close\" event'),t.emit(\"disconnected\"),t.close())})),this._protoo.on(\"request\",(function(e,r,n){switch(e.method){case\"mediasoup-notification\":r();var o=e.data;null!==t._room&&t._room.receiveNotification(o);break;case\"active-speaker\":r();var a=e.data.peerName;T.debug(\"RoomActiveSpeaker\",a);break;case\"display-name-changed\":r();var i=e.data,s=i.peerName,c=i.displayName;i.oldDisplayName;if(null!==t._room){var u=t._room.getPeerByName(s);if(!u){T.error(\"display-name-changed peer not found\");break}u.appData.displayName=c,T.debug(\"display-name-changed\",c,s)}break;case\"3T_applySpeak\":r(),t._protoo.send(\"approveSpeak\",e.data);break;default:T.error('protoo.requst event. unknown protoo method \"%s\"',e.method),n(404,\"unknown method\")}})),this._protoo.on(\"notification\",(function(e){switch(e.method){case\"3T_sessionid\":var r=e.data.sessionId;t._stats.setSessionId(r);break;case\"3T_connectid\":var n=e.data.connectId;t._stats.setConnectionId(n),t._onSuccess&&(t._onSuccess(\"You are in the room\"),t._onSuccess=null,t._onFailure=null),T.debug(\"3T_connectid: \",n),t._joined=!0,clearTimeout(t._jointimer);break;case\"3T_kickout\":T.debug(\"recv 3T_kickout\"),t.emit(\"kickout\",e.data),t.close();break;case\"3T_CDN_URL\":var o=e.data.CDN_url;t.emit({CDN_url:o});break;default:T.warn('unknown protoo method \"%s\"',e.method)}}))}},{key:\"_joinRoom\",value:function(e){var t=this,n=e.displayName,o=e.device;T.debug(\"_joinRoom() calling\"),this._room.removeAllListeners(),this._room.on(\"close\",(function(e,r){if(\"remote\"===e)return T.warn(\"mediasoup Peer/Room remotely closed [appData:%o]\",r),void t._stats.stopPushing()})),this._room.on(\"request\",(function(e,r,n){T.debug(\"sending mediasoup request [method:%s]:%o\",e.method,e),t._protoo.send(\"mediasoup-request\",e).then(r).catch(n)})),this._room.on(\"notify\",(function(e){T.debug(\"sending mediasoup notification [method:%s]:%o\",e.method,e),t._protoo.send(\"mediasoup-notification\",e).catch((function(e){T.warn(\"could not send mediasoup notification:%o\",e)}))})),this._room.on(\"newpeer\",(function(e){T.debug('room \"newpeer\" event [name:\"%s\", peer:%o]',e.name,e),t._handlePeer(e)})),this._jointimer=setTimeout((function(){T.debug(\"join room timeout (\"+r.JOIN_ROOM_TIME_OUT+\")\"),t._joined||(t._jointimer=null,t.close(),t._onFailure(\"join room timeout, out of \"+r.JOIN_ROOM_TIME_OUT+\" seconds.\"),t._onSuccess=null,t._onFailure=null)}),r.JOIN_ROOM_TIME_OUT);var a={displayName:n,device:o,role:this._role};1==+this._role&&\"\"!==this._valid_rtmp_url&&(a.rtmpUrl=this._valid_rtmp_url,a.disableRtmpVideo=this._disableRtmpVideo),this._room.join(this._peerName,a).then((function(){t._spy||(t._sendTransport=t._room.createTransport(\"send\",{media:\"SEND_MIC_WEBCAM\"}),t._sendTransport.on(\"close\",(function(e){T.debug('Transport \"close\" event [originator:%s]',e)})),t._sendTransport.on(\"connectionstatechange\",(function(e){\"disconnected\"===e&&(T.warn(\"sendTransport disconnected.\"),setTimeout((function(){\"connected\"!==t._sendTransport.connectionState&&(t.closed||(t.emit(\"disconnected\"),t.close()))}),r.TIMEOUT_ICE_DISCONNECTED)),\"failed\"===e&&T.warn(\"sendTransport failed.\"),T.debug(\"_sendTransport connectionstatechange: \",e),t._stats.setSendIceState(e)}))),t._recvTransport=t._room.createTransport(\"recv\",{media:\"RECV\"}),t._recvTransport.on(\"close\",(function(e){T.debug('receiving Transport \"close\" event [originator:%s]',e)})),t._recvTransport.on(\"connectionstatechange\",(function(e){\"disconnected\"===e&&(T.warn(\"recvTransport disconnected.\"),setTimeout((function(){\"connected\"!==t._sendTransport.connectionState&&(t.closed||(t.emit(\"disconnected\"),t.close()))}),r.TIMEOUT_ICE_DISCONNECTED)),\"failed\"===e&&T.warn(\"recvTransport failed.\"),T.debug(\"_recvTransport connectionstatechange: \",e),t._stats.setRecvIceState(e)}))})).then((function(){t._spy})).then((function(){T.debug(\"_joinRoom() connected\");var e=t._room.peers,r=!0,n=!1,o=void 0;try{for(var a,i=(0,s.default)(e);!(r=(a=i.next()).done);r=!0){var c=a.value;t._handlePeer(c,{notify:!1})}}catch(e){n=!0,o=e}finally{try{!r&&i.return&&i.return()}finally{if(n)throw o}}t._stats.startPushing()})).catch((function(e){T.error(\"_joinRoom() failed:%o\",e),t.close(),t._onFailure({type:\"error\",text:\"Could not join the room: \"+e.toString()}),t._onSuccess=null,t._onFailure=null}))}},{key:\"leave\",value:function(e,t){if(this.close(),e)return e();throw TypeError(\"onSuccess is not a fucntion.\")}},{key:\"publish\",value:function(e,t,r){var n=this;if(!e||!e.streamObj)return T.error(\"publish stream is null\"),void r(\"stream param error\");if(\"function\"!=typeof t)throw new TypeError(\"onSuccess parameter must be a function.\");if(\"function\"!=typeof r)throw new TypeError(\"onFailure parameter must be a function.\");T.debug(\"publish calling\"),this._spy?r(\"your spy\"):\"3\"!==this._role?(null!==this._micProducer&&this.resumeMic(),null!==this._webcamProducer&&this.resumeWebcam(),null==this._webcamProducer&&null==this._micProducer?e.streamObj.getAudioTracks()[0]||e.streamObj.getVideoTracks()[0]?i.default.resolve().then((function(){n._room.canSend(\"audio\")&&e.streamObj.getAudioTracks()[0]&&n._setMicProducer(e.streamObj).catch((function(){}))})).then((function(){n._room.canSend(\"video\")&&(e.streamObj.getVideoTracks()[0]?(n._setWebcamProducer(e).catch((function(){})),n.emit(\"stream-published\",{stream:e}),t()):t())})):r(\"no audio and video kind track\"):t()):r(\"your audience\")}},{key:\"unpublish\",value:function(e,t,r){T.debug(\"unpublish calling\"),this._micProducer&&this.pauseMic(),this._webcamProducer&&this.pauseWebcam(),this.emit(\"stream-unpublished\",{stream:e}),t()}},{key:\"publishScreen\",value:function(e,t,r){var n=this;if(!e||!e.streamObj)return T.error(\"publish stream is null\"),void r(\"stream param error\");if(\"function\"!=typeof t)throw TypeError(\"onSuccess is not function.\");if(\"function\"!=typeof r)throw TypeError(\"onSuccess is not function.\");this._spy?r(\"your spy\"):\"3\"!==this._role?(T.debug(\"publish screen calling\"),null===this._screenProducer?i.default.resolve().then((function(){n._room.canSend(\"video\")&&(n._setScreenProducer(e).catch((function(){})),n.emit(\"screen-published\"),t())})):this.resumeScreen()):r(\"your audience\")}},{key:\"unpublishScreen\",value:function(e,t,r){if(!e||!e.streamObj)return T.error(\"unpublish stream is null\"),void r(\"stream param error\");if(\"function\"!=typeof t)throw TypeError(\"onSuccess is not function.\");if(\"function\"!=typeof r)throw TypeError(\"onSuccess is not function.\");return T.debug(\"unpublish screen calling\"),this._screenProducer&&this._screenProducer.close(),this.emit(\"screen-unpublished\",{stream:e}),this._screenProducer=null,t()}},{key:\"subscribe\",value:function(e,t,r){if(!e)throw Error(\"stream\");T.debug(\"subscribe calling\");var n=this._peers.get(e.streamID);if(!n)return r(\"Can not found this peer\");n.consumers.forEach((function(e){e.resume()}));var o={stream:n.stream};t(e),this.emit(\"stream-subscribed\",o)}},{key:\"unsubscribe\",value:function(e,t,r){if(!e)throw Error(\"stream\");T.debug(\"unsubscribe calling\");var n=this._peers.get(e.streamID);if(!n)return r(\"Can not found this peer\");n.consumers.forEach((function(e){e.pause()}));var o={stream:n.stream};t(e),this.emit(\"stream-unsubscribed\",o)}},{key:\"pauseMic\",value:function(){T.debug(\"pauseMic calling\"),null!==this._micProducer&&this._micProducer.pause()}},{key:\"resumeMic\",value:function(){T.debug(\"resumeMic calling\"),null!==this._micProducer&&this._micProducer.resume()}},{key:\"pauseWebcam\",value:function(){T.debug(\"pauseWebcam calling\"),null!==this._webcamProducer&&this._webcamProducer.pause()}},{key:\"resumeWebcam\",value:function(){T.debug(\"resumeWebcam calling\"),null!==this._webcamProducer&&this._webcamProducer.resume()}},{key:\"pauseScreen\",value:function(){T.debug(\"pauseScreen calling\"),null!==this._screenProducer&&this._screenProducer.pause()}},{key:\"resumeScreen\",value:function(){T.debug(\"resumeScreen calling\"),null!==this._screenProducer&&this._screenProducer.resume()}},{key:\"renewChannelKey\",value:function(e,t,r){}},{key:\"enableDualStream\",value:function(){}},{key:\"setRemoteVideoStreamType\",value:function(e,t){}},{key:\"setLowStreamParameter\",value:function(){}},{key:\"disableDualStream\",value:function(e,t){}},{key:\"setProxyServer\",value:function(e){}},{key:\"setTurnServer\",value:function(e){}},{key:\"setEncryptionSecret\",value:function(){}},{key:\"setEncryptionMode\",value:function(){}},{key:\"close\",value:function(){var e=this;this._closed||(this._closed=!0,T.debug(\"client.close()\"),this._room&&(this._room.leave(),this._room=null),this._peers.clear(),setTimeout((function(){e._protoo&&e._protoo.close()}),200),this._stats.stopPushing(),this.removeAllListeners())}},{key:\"_handlePeer\",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(r.notify,e.appData.displayName);this.emit(\"peer-join\",e),this._peers.set(e.name,e),T.debug(\"addPeer:\",{name:e.name,displayName:n,device:e.appData.device,consumers:[]});var o=!0,a=!1,i=void 0;try{for(var c,u=(0,s.default)(e.consumers);!(o=(c=u.next()).done);o=!0){var d=c.value;this._handleConsumer(d)}}catch(e){a=!0,i=e}finally{try{!o&&u.return&&u.return()}finally{if(a)throw i}}e.on(\"close\",(function(r){T.debug('peer \"close\" event [name:\"%s\", originator:%s]',e.name,r),t._peers.delete(e.name),t._closed||t.emit(\"peer-leave\",e)})),e.on(\"newconsumer\",(function(r){T.debug('peer \"newconsumer\" event [name:\"%s\", id:%s, consumer:%o]',e.name,r.id,r),t._handleConsumer(r)}))}},{key:\"_handleConsumer\",value:(w=(0,a.default)(o.default.mark((function e(t){var r,n=this;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.rtpParameters.codecs[0],T.debug({id:t.id,peerName:t.peer.name,source:t.appData.source,supported:t.supported,locallyPaused:t.locallyPaused,remotelyPaused:t.remotelyPaused,track:null,codec:r?r.name:null},t.peer.name),t.on(\"close\",(function(e){T.debug('consumer \"close\" event [id:%s, originator:%s, consumer:%o]',t.id,e,t),clearInterval(n._intervalStats)})),t.on(\"pause\",(function(e){T.debug('consumer \"pause\" event [id:%s, originator:%s, consumer:%o]',t.id,e,t);var r=\"audio-mute\";\"audio\"===t.kind&&(r=\"audio-mute\"),\"video\"===t.kind&&(r=\"video-mute\"),\"remote\"===e&&n.emit(r,{stream:t.peer.stream})})),t.on(\"resume\",(function(e){T.debug('consumer \"resume\" event [id:%s, originator:%s, consumer:%o]',t.id,e,t);var r=\"audio-unmute\";\"audio\"===t.kind&&(r=\"audio-unmute\"),\"video\"===t.kind&&(r=\"video-unmute\"),\"remote\"===e&&n.emit(r,{stream:t.peer.stream})})),t.on(\"effectiveprofilechange\",(function(e){T.debug('consumer \"effectiveprofilechange\" event [id:%s, consumer:%o, profile:%s]',t.id,t,e)})),t.on(\"stats\",(function(e){t.getStats(t.track).then((function(r){var o={};\"video\"===t.track.kind&&(o=n._extractResolution(r)),n._stats.setConsumeStats(e,o,t.peer.name,t.id)})).catch((function(e){T.error(e)}))})),t.enableStats(this._interval),t.supported&&(null==t.peer.stream&&(t.peer.stream=new g({streamID:t.peer.name}),t.peer.stream.streamObj=new MediaStream),t.receive(this._recvTransport).then((function(e){\"screen\"!=t.appData.source&&(T.debug(\"consumer.receive, consumer.name=%s, track.kind=%s \",t.peer.name,e.kind),\"audio\"===e.kind&&(t.peer.stream.audioTracks=e,setTimeout((function(){n.emit(\"audio-added\",{peer:t.peer})}),100)),\"video\"===e.kind&&(t.peer.stream.videoTracks=e,setTimeout((function(){n.emit(\"video-added\",{peer:t.peer})}),100)),1==t.peer.stream.streamObj.getTracks().length&&setTimeout((function(){n.emit(\"stream-added\",{stream:t.peer.stream})}),500))})).catch((function(e){T.error(\"unexpected error while receiving a new Consumer:%o\",e)})),\"screen\"===t.appData.source&&(T.debug(\"consumer.appData.source=screen is pasued.\"),t.pause()));case 9:case\"end\":return e.stop()}}),e,this)}))),function(e){return w.apply(this,arguments)})},{key:\"_setMicProducer\",value:function(e){var t=this;if(!this._room.canSend(\"audio\"))return i.default.reject(new Error(\"cannot send audio\"));if(this._micProducer)return i.default.reject(new Error(\"mic Producer already exists\"));var r=void 0;return i.default.resolve().then((function(){var n=e.getAudioTracks()[0];return(r=t._room.createProducer(n,null,{source:\"mic\"})).send(t._sendTransport)})).then((function(){t._micProducer=r,t._micProducer.enableStats(t._interval),T.debug({id:r.id,source:\"mic\",locallyPaused:r.locallyPaused,remotelyPaused:r.remotelyPaused,track:r.track,codec:r.rtpParameters.codecs[0].name}),r.on(\"close\",(function(e){T.debug('mic Producer \"close\" event [originator:%s]',e),\"remote\"===e&&T.debug(\"producer close\")})),r.on(\"pause\",(function(e){T.debug('mic Producer \"pause\" event [originator:%s]',e)})),r.on(\"resume\",(function(e){T.debug('mic Producer \"resume\" event [originator:%s]',e)})),r.on(\"handled\",(function(){T.debug('mic Producer \"handled\" event')})),r.on(\"unhandled\",(function(){T.debug('mic Producer \"unhandled\" event')})),r.on(\"stats\",(function(e){t._stats.setMicStats(e)}))})).then((function(){T.debug(\"_setMicProducer() succeeded\")})).catch((function(e){throw T.error(\"_setMicProducer() failed:%o\",e),r&&r.close(),e}))}},{key:\"_setWebcamProducer\",value:function(e){var t=this;if(!this._room.canSend(\"video\"))return i.default.reject(new Error(\"cannot send video\"));if(this._webcamProducer)return i.default.reject(new Error(\"webcam Producer already exists\"));var r=void 0;return i.default.resolve().then((function(){var n=e.streamObj.getVideoTracks()[0];return(r=t._room.createProducer(n,{simulcast:t._useSimulcast},{source:\"webcam_\"+e.streamID})).send(t._sendTransport)})).then((function(){t._webcamProducer=r,t._webcamProducer.enableStats(t._interval),T.debug({id:r.id,source:\"webcam\",deviceLabel:\"device.webcam\",type:\"front/rear\",locallyPaused:r.locallyPaused,remotelyPaused:r.remotelyPaused,track:r.track,codec:r.rtpParameters.codecs[0].name}),r.on(\"close\",(function(e){T.debug('webcam Producer \"close\" event [originator:%s]',e),t._webcamProducer=null})),r.on(\"pause\",(function(e){T.debug('webcam Producer \"pause\" event [originator:%s]',e)})),r.on(\"resume\",(function(e){T.debug('webcam Producer \"resume\" event [originator:%s]',e)})),r.on(\"handled\",(function(){T.debug('webcam Producer \"handled\" event')})),r.on(\"unhandled\",(function(){T.debug('webcam Producer \"unhandled\" event')})),r.on(\"stats\",(function(e){t._stats.setWebcamStats(e)}))})).then((function(){T.debug(\"_setWebcamProducer() succeeded\")})).catch((function(e){throw T.error(\"_setWebcamProducer() failed:%o\",e),r&&r.close(),e}))}},{key:\"_setScreenProducer\",value:function(e){var t=this;if(!this._room.canSend(\"video\"))return i.default.reject(new Error(\"cannot send video\"));if(this._screenProducer)return i.default.reject(new Error(\"screen Producer already exists\"));var r=void 0;return i.default.resolve().then((function(){var n=e.streamObj.getVideoTracks()[0];return(r=t._room.createProducer(n,{simulcast:t._useSimulcast},{source:\"screen\"})).send(t._sendTransport)})).then((function(){t._screenProducer=r,t._screenProducer.enableStats(t._interval),T.debug({id:r.id,source:\"screen\",deviceLabel:\"device.screen\",type:\"front\",locallyPaused:r.locallyPaused,remotelyPaused:r.remotelyPaused,track:r.track,codec:r.rtpParameters.codecs[0].name}),r.on(\"close\",(function(e){T.debug('screen Producer \"close\" event [originator:%s]',e),t._screenProducer=null})),r.on(\"pause\",(function(e){T.debug('screen Producer \"pause\" event [originator:%s]',e)})),r.on(\"resume\",(function(e){T.debug('screen Producer \"resume\" event [originator:%s]',e)})),r.on(\"handled\",(function(){T.debug('screen Producer \"handled\" event')})),r.on(\"unhandled\",(function(){T.debug('screen Producer \"unhandled\" event')})),r.on(\"stats\",(function(e){t._stats.setWebcamStats(e)}))})).then((function(){T.debug(\"_setScreenProducer() succeeded\")})).catch((function(e){throw T.error(\"_setScreenProducer() failed:%o\",e),r&&r.close(),e}))}},{key:\"_delay\",value:function(e){var t,r,n=new i.default((function(n,o){t=setTimeout(n,e),r=o}));return n.cancel=function(){clearTimeout(t),r(Error(\"Cancelled\"))},n}},{key:\"_retryRestartIce\",value:function(){var e=this;if(this._protoo&&!this._protoo.closed)var t=this,r=setInterval((function(){e._protoo&&!e._protoo.closed?e._restartIce(r).then((function(){setTimeout((function(){\"connected\"===t._sendTransport.connectionState&&clearInterval(r)}),200)})).catch((function(e){T.warn(\"retry restartIce error\")})):clearInterval(r)}),3e3)}},{key:\"_restartIce\",value:(h=(0,a.default)(o.default.mark((function e(t){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,T.debug(\"retry restartIce\"),this._room.restartIce(),e.next=9;break;case 5:throw e.prev=5,e.t0=e.catch(0),T.error(\"restartIce() | failed:%o\",e.t0),e.t0;case 9:case\"end\":return e.stop()}}),e,this,[[0,5]])}))),function(e){return h.apply(this,arguments)})},{key:\"getNetState\",value:function(){return this._stats.getNetState()}},{key:\"setSEI\",value:function(e,t,r,n){var o=this;if(\"1\"!==this._role)throw T.error(\"setSEI error! You are not master in the room\"),Error(\"setSEI error. Role error.\");var a=\";\";if(\"add\"===t.toLocaleLowerCase()&&(a=\"add\"),\"del\"===t.toLocaleLowerCase()&&(a=\"del\"),\"\"===a)throw TypeError(\"type\");var s={type:a,peerId:\"\"+e,devId:\"\"};r&&(s.devId=e+\":screen\",n.pos.length>0&&(n.pos[0].id.endsWith(\"screen\")||(n.pos[0].id+=\":screen\"))),i.default.resolve().then((function(){T.debug(\"setMixer\",s),o._protoo.send(\"setMixer\",s)})).then((function(){T.debug(\"setSEI\",n),o._protoo.send(\"setSEI\",{sei:n})})).catch((function(e){T.error(\"setSEI error \",e)}))}},{key:\"kickOut\",value:function(e){if(null==e||\"\"===e.trim())throw TypeError(\"peerName\");if(\"1\"!==this._role)throw Error(\"You not master so no permision of kickout.\");if(!this._peers.get(e))throw Error(\"no this peer \"+e);T.debug(\"kickout peerName=\"+e),this._protoo.send(\"kickout\",{peerId:e})}},{key:\"_extractResolution\",value:function(e){var t={frameHeight:0,frameWidth:0},r={};return e.forEach((function(e){(0,n.default)(e).forEach((function(r){\"frameheight\"===r.toLocaleLowerCase()&&(t.frameHeight=e[r]),\"framewidth\"===r.toLocaleLowerCase()&&(t.frameWidth=e[r])}));try{if(0!==t.frameWidth)throw r}catch(e){if(e!==r)throw e}})),t}},{key:\"closed\",get:function(){return this._closed}}],[{key:\"JOIN_ROOM_TIME_OUT\",get:function(){return 5e3}},{key:\"TIMEOUT_ICE_DISCONNECTED\",get:function(){return 1e4}},{key:\"TurnConf\",set:function(e){if(null==e)throw new TypeError(\"turn configure\");if(\"\"===e.trim())throw new TypeError(\"turn configure\");try{S.urls=e.urls,S.credential=e.credential,S.username=e.username}catch(e){throw e}}}]),r}(w);e.exports=R}).call(this,r(57))},function(e,t,r){r(168),e.exports=r(2).Object.keys},function(e,t,r){var n=r(36),o=r(51);r(59)(\"keys\",(function(){return function(e){return o(n(e))}}))},function(e,t,r){r(54),r(41),e.exports=r(170)},function(e,t,r){var n=r(23),o=r(80);e.exports=r(2).getIterator=function(e){var t=o(e);if(\"function\"!=typeof t)throw TypeError(e+\" is not iterable!\");return n(t.call(e))}},function(e,t,r){var n=r(2),o=n.JSON||(n.JSON={stringify:JSON.stringify});e.exports=function(e){return o.stringify.apply(o,arguments)}},function(e,t,r){var n=r(173);t.operation=function(e){var r=t.timeouts(e);return new n(r,{forever:e&&e.forever,unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error(\"minTimeout is greater than maxTimeout\");for(var n=[],o=0;o<t.retries;o++)n.push(this.createTimeout(o,t));return e&&e.forever&&!n.length&&n.push(this.createTimeout(o,t)),n.sort((function(e,t){return e-t})),n},t.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,n=Math.round(r*t.minTimeout*Math.pow(t.factor,e));return n=Math.min(n,t.maxTimeout)},t.wrap=function(e,r,n){if(r instanceof Array&&(n=r,r=null),!n)for(var o in n=[],e)\"function\"==typeof e[o]&&n.push(o);for(var a=0;a<n.length;a++){var i=n[a],s=e[i];e[i]=function(n){var o=t.operation(r),a=Array.prototype.slice.call(arguments,1),i=a.pop();a.push((function(e){o.retry(e)||(e&&(arguments[0]=o.mainError()),i.apply(this,arguments))})),o.attempt((function(){n.apply(e,a)}))}.bind(e,s),e[i].options=r}}},function(e,t){function r(e,t){\"boolean\"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=r,r.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},r.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},r.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error(\"RetryOperation timeout occurred\")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),r=this._timeouts.shift()}var n=this,o=setTimeout((function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout((function(){n._operationTimeoutCb(n._attempts)}),n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)}),r);return this._options.unref&&o.unref(),!0},r.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},r.prototype.try=function(e){console.log(\"Using RetryOperation.try() is deprecated\"),this.attempt(e)},r.prototype.start=function(e){console.log(\"Using RetryOperation.start() is deprecated\"),this.attempt(e)},r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,n=0;n<this._errors.length;n++){var o=this._errors[n],a=o.message,i=(e[a]||0)+1;e[a]=i,i>=r&&(t=o,r=i)}return t}},function(e,t,r){r(175);var n=r(2).Object;e.exports=function(e,t){return n.getOwnPropertyDescriptor(e,t)}},function(e,t,r){var n=r(39),o=r(77).f;r(59)(\"getOwnPropertyDescriptor\",(function(){return function(e,t){return o(n(e),t)}}))},function(e,t,r){var n;n=function(){var e=!0;function t(t){function r(e){var r=t.match(e);return r&&r.length>1&&r[1]||\"\"}function n(e){var r=t.match(e);return r&&r.length>1&&r[2]||\"\"}var o,i=r(/(ipod|iphone|ipad)/i).toLowerCase(),s=!/like android/i.test(t)&&/android/i.test(t),c=/nexus\\s*[0-6]\\s*/i.test(t),u=!c&&/nexus\\s*[0-9]+/i.test(t),d=/CrOS/.test(t),l=/silk/i.test(t),f=/sailfish/i.test(t),p=/tizen/i.test(t),m=/(web|hpw)(o|0)s/i.test(t),h=/windows phone/i.test(t),v=(/SamsungBrowser/i.test(t),!h&&/windows/i.test(t)),_=!i&&!l&&/macintosh/i.test(t),y=!s&&!f&&!p&&!m&&/linux/i.test(t),g=n(/edg([ea]|ios)\\/(\\d+(\\.\\d+)?)/i),b=r(/version\\/(\\d+(\\.\\d+)?)/i),w=/tablet/i.test(t)&&!/tablet pc/i.test(t),k=!w&&/[^-]mobi/i.test(t),P=/xbox/i.test(t);/opera/i.test(t)?o={name:\"Opera\",opera:e,version:b||r(/(?:opera|opr|opios)[\\s\\/](\\d+(\\.\\d+)?)/i)}:/opr\\/|opios/i.test(t)?o={name:\"Opera\",opera:e,version:r(/(?:opr|opios)[\\s\\/](\\d+(\\.\\d+)?)/i)||b}:/SamsungBrowser/i.test(t)?o={name:\"Samsung Internet for Android\",samsungBrowser:e,version:b||r(/(?:SamsungBrowser)[\\s\\/](\\d+(\\.\\d+)?)/i)}:/Whale/i.test(t)?o={name:\"NAVER Whale browser\",whale:e,version:r(/(?:whale)[\\s\\/](\\d+(?:\\.\\d+)+)/i)}:/MZBrowser/i.test(t)?o={name:\"MZ Browser\",mzbrowser:e,version:r(/(?:MZBrowser)[\\s\\/](\\d+(?:\\.\\d+)+)/i)}:/coast/i.test(t)?o={name:\"Opera Coast\",coast:e,version:b||r(/(?:coast)[\\s\\/](\\d+(\\.\\d+)?)/i)}:/focus/i.test(t)?o={name:\"Focus\",focus:e,version:r(/(?:focus)[\\s\\/](\\d+(?:\\.\\d+)+)/i)}:/yabrowser/i.test(t)?o={name:\"Yandex Browser\",yandexbrowser:e,version:b||r(/(?:yabrowser)[\\s\\/](\\d+(\\.\\d+)?)/i)}:/ucbrowser/i.test(t)?o={name:\"UC Browser\",ucbrowser:e,version:r(/(?:ucbrowser)[\\s\\/](\\d+(?:\\.\\d+)+)/i)}:/mxios/i.test(t)?o={name:\"Maxthon\",maxthon:e,version:r(/(?:mxios)[\\s\\/](\\d+(?:\\.\\d+)+)/i)}:/epiphany/i.test(t)?o={name:\"Epiphany\",epiphany:e,version:r(/(?:epiphany)[\\s\\/](\\d+(?:\\.\\d+)+)/i)}:/puffin/i.test(t)?o={name:\"Puffin\",puffin:e,version:r(/(?:puffin)[\\s\\/](\\d+(?:\\.\\d+)?)/i)}:/sleipnir/i.test(t)?o={name:\"Sleipnir\",sleipnir:e,version:r(/(?:sleipnir)[\\s\\/](\\d+(?:\\.\\d+)+)/i)}:/k-meleon/i.test(t)?o={name:\"K-Meleon\",kMeleon:e,version:r(/(?:k-meleon)[\\s\\/](\\d+(?:\\.\\d+)+)/i)}:h?(o={name:\"Windows Phone\",osname:\"Windows Phone\",windowsphone:e},g?(o.msedge=e,o.version=g):(o.msie=e,o.version=r(/iemobile\\/(\\d+(\\.\\d+)?)/i))):/msie|trident/i.test(t)?o={name:\"Internet Explorer\",msie:e,version:r(/(?:msie |rv:)(\\d+(\\.\\d+)?)/i)}:d?o={name:\"Chrome\",osname:\"Chrome OS\",chromeos:e,chromeBook:e,chrome:e,version:r(/(?:chrome|crios|crmo)\\/(\\d+(\\.\\d+)?)/i)}:/edg([ea]|ios)/i.test(t)?o={name:\"Microsoft Edge\",msedge:e,version:g}:/vivaldi/i.test(t)?o={name:\"Vivaldi\",vivaldi:e,version:r(/vivaldi\\/(\\d+(\\.\\d+)?)/i)||b}:f?o={name:\"Sailfish\",osname:\"Sailfish OS\",sailfish:e,version:r(/sailfish\\s?browser\\/(\\d+(\\.\\d+)?)/i)}:/seamonkey\\//i.test(t)?o={name:\"SeaMonkey\",seamonkey:e,version:r(/seamonkey\\/(\\d+(\\.\\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(t)?(o={name:\"Firefox\",firefox:e,version:r(/(?:firefox|iceweasel|fxios)[ \\/](\\d+(\\.\\d+)?)/i)},/\\((mobile|tablet);[^\\)]*rv:[\\d\\.]+\\)/i.test(t)&&(o.firefoxos=e,o.osname=\"Firefox OS\")):l?o={name:\"Amazon Silk\",silk:e,version:r(/silk\\/(\\d+(\\.\\d+)?)/i)}:/phantom/i.test(t)?o={name:\"PhantomJS\",phantom:e,version:r(/phantomjs\\/(\\d+(\\.\\d+)?)/i)}:/slimerjs/i.test(t)?o={name:\"SlimerJS\",slimer:e,version:r(/slimerjs\\/(\\d+(\\.\\d+)?)/i)}:/blackberry|\\bbb\\d+/i.test(t)||/rim\\stablet/i.test(t)?o={name:\"BlackBerry\",osname:\"BlackBerry OS\",blackberry:e,version:b||r(/blackberry[\\d]+\\/(\\d+(\\.\\d+)?)/i)}:m?(o={name:\"WebOS\",osname:\"WebOS\",webos:e,version:b||r(/w(?:eb)?osbrowser\\/(\\d+(\\.\\d+)?)/i)},/touchpad\\//i.test(t)&&(o.touchpad=e)):/bada/i.test(t)?o={name:\"Bada\",osname:\"Bada\",bada:e,version:r(/dolfin\\/(\\d+(\\.\\d+)?)/i)}:p?o={name:\"Tizen\",osname:\"Tizen\",tizen:e,version:r(/(?:tizen\\s?)?browser\\/(\\d+(\\.\\d+)?)/i)||b}:/qupzilla/i.test(t)?o={name:\"QupZilla\",qupzilla:e,version:r(/(?:qupzilla)[\\s\\/](\\d+(?:\\.\\d+)+)/i)||b}:/chromium/i.test(t)?o={name:\"Chromium\",chromium:e,version:r(/(?:chromium)[\\s\\/](\\d+(?:\\.\\d+)?)/i)||b}:/chrome|crios|crmo/i.test(t)?o={name:\"Chrome\",chrome:e,version:r(/(?:chrome|crios|crmo)\\/(\\d+(\\.\\d+)?)/i)}:s?o={name:\"Android\",version:b}:/safari|applewebkit/i.test(t)?(o={name:\"Safari\",safari:e},b&&(o.version=b)):i?(o={name:\"iphone\"==i?\"iPhone\":\"ipad\"==i?\"iPad\":\"iPod\"},b&&(o.version=b)):o=/googlebot/i.test(t)?{name:\"Googlebot\",googlebot:e,version:r(/googlebot\\/(\\d+(\\.\\d+))/i)||b}:{name:r(/^(.*)\\/(.*) /),version:n(/^(.*)\\/(.*) /)},!o.msedge&&/(apple)?webkit/i.test(t)?(/(apple)?webkit\\/537\\.36/i.test(t)?(o.name=o.name||\"Blink\",o.blink=e):(o.name=o.name||\"Webkit\",o.webkit=e),!o.version&&b&&(o.version=b)):!o.opera&&/gecko\\//i.test(t)&&(o.name=o.name||\"Gecko\",o.gecko=e,o.version=o.version||r(/gecko\\/(\\d+(\\.\\d+)?)/i)),o.windowsphone||!s&&!o.silk?!o.windowsphone&&i?(o[i]=e,o.ios=e,o.osname=\"iOS\"):_?(o.mac=e,o.osname=\"macOS\"):P?(o.xbox=e,o.osname=\"Xbox\"):v?(o.windows=e,o.osname=\"Windows\"):y&&(o.linux=e,o.osname=\"Linux\"):(o.android=e,o.osname=\"Android\");var T=\"\";o.windows?T=function(e){switch(e){case\"NT\":return\"NT\";case\"XP\":return\"XP\";case\"NT 5.0\":return\"2000\";case\"NT 5.1\":return\"XP\";case\"NT 5.2\":return\"2003\";case\"NT 6.0\":return\"Vista\";case\"NT 6.1\":return\"7\";case\"NT 6.2\":return\"8\";case\"NT 6.3\":return\"8.1\";case\"NT 10.0\":return\"10\";default:return}}(r(/Windows ((NT|XP)( \\d\\d?.\\d)?)/i)):o.windowsphone?T=r(/windows phone (?:os)?\\s?(\\d+(\\.\\d+)*)/i):o.mac?T=(T=r(/Mac OS X (\\d+([_\\.\\s]\\d+)*)/i)).replace(/[_\\s]/g,\".\"):i?T=(T=r(/os (\\d+([_\\s]\\d+)*) like mac os x/i)).replace(/[_\\s]/g,\".\"):s?T=r(/android[ \\/-](\\d+(\\.\\d+)*)/i):o.webos?T=r(/(?:web|hpw)os\\/(\\d+(\\.\\d+)*)/i):o.blackberry?T=r(/rim\\stablet\\sos\\s(\\d+(\\.\\d+)*)/i):o.bada?T=r(/bada\\/(\\d+(\\.\\d+)*)/i):o.tizen&&(T=r(/tizen[\\/\\s](\\d+(\\.\\d+)*)/i)),T&&(o.osversion=T);var S=!o.windows&&T.split(\".\")[0];return w||u||\"ipad\"==i||s&&(3==S||S>=4&&!k)||o.silk?o.tablet=e:(k||\"iphone\"==i||\"ipod\"==i||s||c||o.blackberry||o.webos||o.bada)&&(o.mobile=e),o.msedge||o.msie&&o.version>=10||o.yandexbrowser&&o.version>=15||o.vivaldi&&o.version>=1||o.chrome&&o.version>=20||o.samsungBrowser&&o.version>=4||o.whale&&1===a([o.version,\"1.0\"])||o.mzbrowser&&1===a([o.version,\"6.0\"])||o.focus&&1===a([o.version,\"1.0\"])||o.firefox&&o.version>=20||o.safari&&o.version>=6||o.opera&&o.version>=10||o.ios&&o.osversion&&o.osversion.split(\".\")[0]>=6||o.blackberry&&o.version>=10.1||o.chromium&&o.version>=20?o.a=e:o.msie&&o.version<10||o.chrome&&o.version<20||o.firefox&&o.version<20||o.safari&&o.version<6||o.opera&&o.version<10||o.ios&&o.osversion&&o.osversion.split(\".\")[0]<6||o.chromium&&o.version<20?o.c=e:o.x=e,o}var r=t(\"undefined\"!=typeof navigator&&navigator.userAgent||\"\");function n(e){return e.split(\".\").length}function o(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r++)n.push(t(e[r]));return n}function a(e){for(var t=Math.max(n(e[0]),n(e[1])),r=o(e,(function(e){var r=t-n(e);return o((e+=new Array(r+1).join(\".0\")).split(\".\"),(function(e){return new Array(20-e.length).join(\"0\")+e})).reverse()}));--t>=0;){if(r[0][t]>r[1][t])return 1;if(r[0][t]!==r[1][t])return-1;if(0===t)return 0}}function i(e,n,o){var i=r;\"string\"==typeof n&&(o=n,n=void 0),void 0===n&&(n=!1),o&&(i=t(o));var s=\"\"+i.version;for(var c in e)if(e.hasOwnProperty(c)&&i[c]){if(\"string\"!=typeof e[c])throw new Error(\"Browser version in the minVersion map should be a string: \"+c+\": \"+String(e));return a([s,e[c]])<0}return n}return r.test=function(e){for(var t=0;t<e.length;++t){var n=e[t];if(\"string\"==typeof n&&n in r)return!0}return!1},r.isUnsupportedBrowser=i,r.compareVersions=a,r.check=function(e,t,r){return!i(e,t,r)},r._detect=t,r.detect=t,r},e.exports?e.exports=n():r(177)(\"bowser\",n)},function(e,t){e.exports=function(){throw new Error(\"define cannot be used indirect\")}},function(e,t,r){\"use strict\";var n=h(r(20)),o=h(r(10)),a=h(r(8)),i=h(r(25)),s=h(r(7)),c=h(r(0)),u=h(r(6)),d=h(r(4)),l=h(r(3)),f=h(r(5)),p=h(r(11)),m=h(r(1));function h(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var v=S(r(19)),_=S(r(9)),y=S(r(14)),g=T(r(12)),b=T(r(18)),w=T(r(26)),k=T(r(43)),P=S(r(44));function T(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=m.default&&p.default?(0,p.default)(e,r):{};n.get||n.set?(0,m.default)(t,r,n):t[r]=e[r]}return t.default=e,t}function S(e){return e&&e.__esModule?e:{default:e}}function R(e){return(R=\"function\"==typeof f.default&&\"symbol\"===(0,l.default)(d.default)?function(e){return void 0===e?\"undefined\":(0,l.default)(e)}:function(e){return e&&\"function\"==typeof f.default&&e.constructor===f.default&&e!==f.default.prototype?\"symbol\":void 0===e?\"undefined\":(0,l.default)(e)})(e)}function C(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function x(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),(0,m.default)(e,n.key,n)}}function E(e,t,r){return t&&x(e.prototype,t),r&&x(e,r),e}function I(e,t){return!t||\"object\"!==R(t)&&\"function\"!=typeof t?function(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}(e):t}function D(e){return(D=u.default?c.default:function(e){return e.__proto__||(0,c.default)(e)})(e)}function O(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=(0,s.default)(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}function L(e,t){return(L=u.default||function(e,t){return e.__proto__=t,e})(e,t)}var j=new _.default(\"Chrome70\"),M=function(e){function t(e,r,n){var o;return C(this,t),(o=I(this,D(t).call(this,j)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\",sdpSemantics:\"unified-plan\"}),o._rtpParametersByKind=r,o._remoteSdp=new P.default(e,r),o._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(o._pc.iceConnectionState){case\"checking\":o.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":o.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":o.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":o.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":o.emit(\"@connectionstatechange\",\"closed\")}})),o}return O(t,e),E(t,[{key:\"close\",value:function(){j.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){j.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(y.default),A=function(e){function t(e,r){var n;return C(this,t),(n=I(this,D(t).call(this,\"send\",e,r)))._transportReady=!1,n._trackIds=new i.default,n}return O(t,e),E(t,[{key:\"addProducer\",value:function(e){var t,r,n=this,o=e.track;return j.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,o.id),this._trackIds.has(o.id)?a.default.reject(new Error(\"track already added\")):(this._trackIds.add(o.id),a.default.resolve().then((function(){if(t=n._pc.getTransceivers().find((function(e){return e.receiver.track.kind===o.kind&&\"inactive\"===e.direction})))return j.debug(\"addProducer() | reusing an inactive transceiver\"),t.direction=\"sendonly\",t.sender.replaceTrack(o);t=n._pc.addTransceiver(o,{direction:\"sendonly\"})})).then((function(){return n._pc.createOffer()})).then((function(r){if(e.simulcast){j.debug(\"addProducer() | enabling simulcast\");var a=v.default.parse(r.sdp);k.addPlanBSimulcast(a,o,{mid:t.mid}),r={type:\"offer\",sdp:v.default.write(a)}}return j.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",r),n._pc.setLocalDescription(r)})).then((function(){if(!n._transportReady)return n._setupTransport()})).then((function(){r=v.default.parse(n._pc.localDescription.sdp);var e={type:\"answer\",sdp:n._remoteSdp.createAnswerSdp(r)};return j.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",e),n._pc.setRemoteDescription(e)})).then((function(){var a=g.clone(n._rtpParametersByKind[e.kind]);return k.fillRtpParametersForTrack(a,r,o,{mid:t.mid,planBSimulcast:!0}),a})).catch((function(e){try{t.direction=\"inactive\"}catch(e){}throw n._trackIds.delete(o.id),e})))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;return this._trackIds.has(r.id)?(j.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),a.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error(\"local track not found\");return t._pc.removeTrack(e),t._trackIds.delete(r.id),t._pc.createOffer()})).then((function(e){return j.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=v.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return j.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))):a.default.reject(new Error(\"track not found\"))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;j.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=e.track;return a.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error(\"local track not found\");return e.replaceTrack(t)})).then((function(){r._trackIds.delete(n.id),r._trackIds.add(t.id)}))}},{key:\"restartIce\",value:function(e){var t=this;return j.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),a.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return j.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=v.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return j.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return j.debug(\"_setupTransport()\"),a.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=v.default.parse(r),o=w.extractDtlsParameters(n);return o.role=\"server\",t.dtlsParameters=o,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:\"getPCStats\",value:function(e){return j.debug(\"getPCStats of revc\",e),this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(M),F=function(e){function t(e,r){var n;return C(this,t),(n=I(this,D(t).call(this,\"recv\",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new o.default,n}return O(t,e),E(t,[{key:\"addConsumer\",value:function(e){var t=this;if(j.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return a.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],o=e.rtpParameters.rtcp.cname,i={mid:\"\".concat(e.kind[0]).concat(e.id),kind:e.kind,closed:e.closed,streamId:\"recv-stream-\".concat(e.id),trackId:\"consumer-\".concat(e.kind,\"-\").concat(e.id),ssrc:r.ssrc,cname:o};return r.rtx&&r.rtx.ssrc&&(i.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,i),a.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return j.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return j.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getTransceivers().find((function(e){return e.mid===i.mid}));if(!e)throw new Error(\"remote track not found\");return e.receiver.track}))}},{key:\"removeConsumer\",value:function(e){var t=this;j.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,a.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return j.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return j.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):a.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return j.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),a.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return j.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return j.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return j.debug(\"_setupTransport()\"),a.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){j.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=v.default.parse(e),r={dtlsParameters:w.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}},{key:\"getPCStats\",value:function(e){return j.debug(\"getPCStats of revc\",e),this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(M),N=function(){function e(t,r,n){var o;switch(C(this,e),j.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r),t){case\"send\":return o={audio:b.getSendingRtpParameters(\"audio\",r),video:b.getSendingRtpParameters(\"video\",r)},new A(o,n);case\"recv\":return o={audio:b.getReceivingFullRtpParameters(\"audio\",r),video:b.getReceivingFullRtpParameters(\"video\",r)},new F(o,n)}}return E(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){j.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\",sdpSemantics:\"unified-plan\"});return e.addTransceiver(\"audio\"),e.addTransceiver(\"video\"),e.createOffer().then((function(t){try{e.close()}catch(e){}var r=v.default.parse(t.sdp);return w.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:\"tag\",get:function(){return\"Chrome70\"}}]),e}();t.default=N},function(e,t,r){r(41),r(180),e.exports=r(2).Array.from},function(e,t,r){\"use strict\";var n=r(27),o=r(13),a=r(36),i=r(97),s=r(98),c=r(60),u=r(181),d=r(80);o(o.S+o.F*!r(105)((function(e){Array.from(e)})),\"Array\",{from:function(e){var t,r,o,l,f=a(e),p=\"function\"==typeof this?this:Array,m=arguments.length,h=m>1?arguments[1]:void 0,v=void 0!==h,_=0,y=d(f);if(v&&(h=n(h,m>2?arguments[2]:void 0,2)),null==y||p==Array&&s(y))for(r=new p(t=c(f.length));t>_;_++)u(r,_,v?h(f[_],_):f[_]);else for(l=y.call(f),r=new p;!(o=l.next()).done;_++)u(r,_,v?i(l,h,[o.value,_],!0):o.value);return r.length=_,r}})},function(e,t,r){\"use strict\";var n=r(22),o=r(48);e.exports=function(e,t,r){t in e?n.f(e,t,o(0,r)):e[t]=r}},function(e,t,r){r(63),r(41),r(54),r(183),r(184),r(185),r(186),e.exports=r(2).Set},function(e,t,r){\"use strict\";var n=r(108),o=r(83);e.exports=r(109)(\"Set\",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return n.def(o(this,\"Set\"),e=0===e?0:e,e)}},n)},function(e,t,r){var n=r(13);n(n.P+n.R,\"Set\",{toJSON:r(110)(\"Set\")})},function(e,t,r){r(111)(\"Set\")},function(e,t,r){r(112)(\"Set\")},function(e,t,r){\"use strict\";var n=function(e){return String(Number(e))===e?Number(e):e},o=function(e,t,r){var o=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:o&&!t[e.name]&&(t[e.name]={});var a=e.push?{}:o?t[e.name]:t;!function(e,t,r,o){if(o&&!r)t[o]=n(e[1]);else for(var a=0;a<r.length;a+=1)null!=e[a+1]&&(t[r[a]]=n(e[a+1]))}(r.match(e.reg),a,e.names,e.name),e.push&&t[e.push].push(a)},a=r(118),i=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],n=t;return e.split(/(\\r\\n|\\r|\\n)/).filter(i).forEach((function(e){var t=e[0],i=e.slice(2);\"m\"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var s=0;s<(a[t]||[]).length;s+=1){var c=a[t][s];if(c.reg.test(i))return o(c,n,i)}})),t.media=r,t};var s=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=n(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};t.parseParams=function(e){return e.split(/\\;\\s?/).reduce(s,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.split(\" \").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(\" \").map(n),o=0;o<r.length;o+=3)t.push({component:r[o],ip:r[o+1],port:r[o+2]});return t},t.parseImageAttributes=function(e){return e.split(\" \").map((function(e){return e.substring(1,e.length-1).split(\",\").reduce(s,{})}))},t.parseSimulcastStreamList=function(e){return e.split(\";\").map((function(e){return e.split(\",\").map((function(e){var t,r=!1;return\"~\"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}}))}))}},function(e,t,r){\"use strict\";var n=r(118),o=/%[sdv%]/g,a=function(e){var t=1,r=arguments,n=r.length;return e.replace(o,(function(e){if(t>=n)return e;var o=r[t];switch(t+=1,e){case\"%%\":return\"%\";case\"%s\":return String(o);case\"%d\":return Number(o);case\"%v\":return\"\"}}))},i=function(e,t,r){var n=[e+\"=\"+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var i=t.names[o];t.name?n.push(r[t.name][i]):n.push(r[t.names[o]])}else n.push(r[t.name]);return a.apply(null,n)},s=[\"v\",\"o\",\"s\",\"i\",\"u\",\"e\",\"p\",\"c\",\"b\",\"t\",\"r\",\"z\",\"a\"],c=[\"i\",\"c\",\"b\",\"a\"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=\" \"),e.media.forEach((function(e){null==e.payloads&&(e.payloads=\"\")}));var r=t.outerOrder||s,o=t.innerOrder||c,a=[];return r.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?a.push(i(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){a.push(i(t,r,e))}))}))})),e.media.forEach((function(e){a.push(i(\"m\",n.m[0],e)),o.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?a.push(i(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){a.push(i(t,r,e))}))}))}))})),a.join(\"\\r\\n\")+\"\\r\\n\"}},function(e,t,r){\"use strict\";var n=h(r(20)),o=h(r(10)),a=h(r(25)),i=h(r(8)),s=h(r(7)),c=h(r(0)),u=h(r(6)),d=h(r(4)),l=h(r(3)),f=h(r(5)),p=h(r(11)),m=h(r(1));function h(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var v=S(r(19)),_=S(r(9)),y=S(r(14)),g=T(r(12)),b=T(r(18)),w=T(r(26)),k=T(r(45)),P=S(r(46));function T(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=m.default&&p.default?(0,p.default)(e,r):{};n.get||n.set?(0,m.default)(t,r,n):t[r]=e[r]}return t.default=e,t}function S(e){return e&&e.__esModule?e:{default:e}}function R(e){return(R=\"function\"==typeof f.default&&\"symbol\"===(0,l.default)(d.default)?function(e){return void 0===e?\"undefined\":(0,l.default)(e)}:function(e){return e&&\"function\"==typeof f.default&&e.constructor===f.default&&e!==f.default.prototype?\"symbol\":void 0===e?\"undefined\":(0,l.default)(e)})(e)}function C(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function x(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),(0,m.default)(e,n.key,n)}}function E(e,t,r){return t&&x(e.prototype,t),r&&x(e,r),e}function I(e,t){return!t||\"object\"!==R(t)&&\"function\"!=typeof t?function(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}(e):t}function D(e){return(D=u.default?c.default:function(e){return e.__proto__||(0,c.default)(e)})(e)}function O(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=(0,s.default)(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}function L(e,t){return(L=u.default||function(e,t){return e.__proto__=t,e})(e,t)}var j=new _.default(\"Chrome69\"),M=function(e){function t(e,r,n){var o;return C(this,t),(o=I(this,D(t).call(this,j)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\",sdpSemantics:\"plan-b\"}),o._rtpParametersByKind=r,o._remoteSdp=new P.default(e,r),o._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(o._pc.iceConnectionState){case\"checking\":o.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":o.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":o.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":o.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":o.emit(\"@connectionstatechange\",\"closed\")}})),o}return O(t,e),E(t,[{key:\"close\",value:function(){j.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){j.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(y.default),A=function(e){function t(e,r){var n;return C(this,t),(n=I(this,D(t).call(this,\"send\",e,r)))._transportReady=!1,n._stream=new MediaStream,n}return O(t,e),E(t,[{key:\"addProducer\",value:function(e){var t,r,n=this,o=e.track;return j.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,o.id),this._stream.getTrackById(o.id)?i.default.reject(new Error(\"track already added\")):i.default.resolve().then((function(){return n._stream.addTrack(o),t=n._pc.addTrack(o,n._stream),n._pc.createOffer()})).then((function(t){if(e.simulcast){j.debug(\"addProducer() | enabling simulcast\");var r=v.default.parse(t.sdp);k.addSimulcastForTrack(r,o),t={type:\"offer\",sdp:v.default.write(r)}}return j.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",t),n._pc.setLocalDescription(t)})).then((function(){if(!n._transportReady)return n._setupTransport()})).then((function(){r=v.default.parse(n._pc.localDescription.sdp);var e={type:\"answer\",sdp:n._remoteSdp.createAnswerSdp(r)};return j.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",e),n._pc.setRemoteDescription(e)})).then((function(){var t=g.clone(n._rtpParametersByKind[e.kind]);return k.fillRtpParametersForTrack(t,r,o),t})).catch((function(e){try{n._pc.removeTrack(t)}catch(e){}throw n._stream.removeTrack(o),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;return j.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),i.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error(\"RTCRtpSender not found\");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()})).then((function(e){return j.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).catch((function(e){if(0!==t._stream.getTracks().length)throw e;j.warn(\"removeProducer() | ignoring expected error due no sending tracks: %s\",e.toString())})).then((function(){if(\"stable\"!==t._pc.signalingState){var e=v.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return j.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;j.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=e.track;return i.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error(\"local track not found\");return e.replaceTrack(t)})).then((function(){r._stream.removeTrack(n),r._stream.addTrack(t)}))}},{key:\"restartIce\",value:function(e){var t=this;return j.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),i.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return j.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=v.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return j.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return j.debug(\"_setupTransport()\"),i.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=v.default.parse(r),o=w.extractDtlsParameters(n);return o.role=\"server\",t.dtlsParameters=o,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:\"getPCStats\",value:function(e){return j.debug(\"getPCStats of revc\",e),this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(M),F=function(e){function t(e,r){var n;return C(this,t),(n=I(this,D(t).call(this,\"recv\",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._kinds=new a.default,n._consumerInfos=new o.default,n}return O(t,e),E(t,[{key:\"addConsumer\",value:function(e){var t=this;if(j.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return i.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],o=e.rtpParameters.rtcp.cname,a={kind:e.kind,streamId:\"recv-stream-\".concat(e.id),trackId:\"consumer-\".concat(e.kind,\"-\").concat(e.id),ssrc:r.ssrc,cname:o};return r.rtx&&r.rtx.ssrc&&(a.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,a),this._kinds.add(e.kind),i.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return j.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return j.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getReceivers().find((function(e){var t=e.track;return!!t&&t.id===a.trackId}));if(!e)throw new Error(\"remote track not found\");return e.track}))}},{key:\"removeConsumer\",value:function(e){var t=this;return j.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),i.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return j.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return j.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):i.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return j.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),i.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return j.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return j.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return j.debug(\"_setupTransport()\"),i.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){j.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=v.default.parse(e),r={dtlsParameters:w.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}},{key:\"getPCStats\",value:function(e){return j.debug(\"getPCStats of revc\",e),this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(M),N=function(){function e(t,r,n){var o;switch(C(this,e),j.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r),t){case\"send\":return o={audio:b.getSendingRtpParameters(\"audio\",r),video:b.getSendingRtpParameters(\"video\",r)},new A(o,n);case\"recv\":return o={audio:b.getReceivingFullRtpParameters(\"audio\",r),video:b.getReceivingFullRtpParameters(\"video\",r)},new F(o,n)}}return E(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){j.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\",sdpSemantics:\"plan-b\"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(t){try{e.close()}catch(e){}var r=v.default.parse(t.sdp);return w.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:\"tag\",get:function(){return\"Chrome69\"}}]),e}();t.default=N},function(e,t,r){\"use strict\";var n=h(r(20)),o=h(r(10)),a=h(r(25)),i=h(r(8)),s=h(r(7)),c=h(r(0)),u=h(r(6)),d=h(r(4)),l=h(r(3)),f=h(r(5)),p=h(r(11)),m=h(r(1));function h(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var v=S(r(19)),_=S(r(9)),y=S(r(14)),g=T(r(12)),b=T(r(18)),w=T(r(26)),k=T(r(45)),P=S(r(46));function T(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=m.default&&p.default?(0,p.default)(e,r):{};n.get||n.set?(0,m.default)(t,r,n):t[r]=e[r]}return t.default=e,t}function S(e){return e&&e.__esModule?e:{default:e}}function R(e){return(R=\"function\"==typeof f.default&&\"symbol\"===(0,l.default)(d.default)?function(e){return void 0===e?\"undefined\":(0,l.default)(e)}:function(e){return e&&\"function\"==typeof f.default&&e.constructor===f.default&&e!==f.default.prototype?\"symbol\":void 0===e?\"undefined\":(0,l.default)(e)})(e)}function C(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function x(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),(0,m.default)(e,n.key,n)}}function E(e,t,r){return t&&x(e.prototype,t),r&&x(e,r),e}function I(e,t){return!t||\"object\"!==R(t)&&\"function\"!=typeof t?function(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}(e):t}function D(e){return(D=u.default?c.default:function(e){return e.__proto__||(0,c.default)(e)})(e)}function O(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=(0,s.default)(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}function L(e,t){return(L=u.default||function(e,t){return e.__proto__=t,e})(e,t)}var j=new _.default(\"Chrome67\"),M=function(e){function t(e,r,n){var o;return C(this,t),(o=I(this,D(t).call(this,j)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\",sdpSemantics:\"plan-b\"}),o._rtpParametersByKind=r,o._remoteSdp=new P.default(e,r),o._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(o._pc.iceConnectionState){case\"checking\":o.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":o.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":o.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":o.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":o.emit(\"@connectionstatechange\",\"closed\")}})),o}return O(t,e),E(t,[{key:\"close\",value:function(){j.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){j.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(y.default),A=function(e){function t(e,r){var n;return C(this,t),(n=I(this,D(t).call(this,\"send\",e,r)))._transportReady=!1,n._stream=new MediaStream,n}return O(t,e),E(t,[{key:\"addProducer\",value:function(e){var t,r=this,n=e.track;return j.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,n.id),this._stream.getTrackById(n.id)?i.default.reject(new Error(\"track already added\")):i.default.resolve().then((function(){return r._stream.addTrack(n),r._pc.addTrack(n,r._stream),r._pc.createOffer()})).then((function(t){if(e.simulcast){j.debug(\"addProducer() | enabling simulcast\");var o=v.default.parse(t.sdp);k.addSimulcastForTrack(o,n),t={type:\"offer\",sdp:v.default.write(o)}}return j.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",t),r._pc.setLocalDescription(t)})).then((function(){if(!r._transportReady)return r._setupTransport()})).then((function(){t=v.default.parse(r._pc.localDescription.sdp);var e={type:\"answer\",sdp:r._remoteSdp.createAnswerSdp(t)};return j.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",e),r._pc.setRemoteDescription(e)})).then((function(){var o=g.clone(r._rtpParametersByKind[e.kind]);return k.fillRtpParametersForTrack(o,t,n),o})).catch((function(e){throw r._stream.removeTrack(n),r._pc.addStream(r._stream),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;return j.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),i.default.resolve().then((function(){return t._stream.removeTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()})).then((function(e){return j.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).catch((function(e){if(0!==t._stream.getTracks().length)throw e;j.warn(\"removeProducer() | ignoring expected error due no sending tracks: %s\",e.toString())})).then((function(){if(\"stable\"!==t._pc.signalingState){var e=v.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return j.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;j.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=e.track;return i.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error(\"local track not found\");return e.replaceTrack(t)})).then((function(){r._stream.removeTrack(n),r._stream.addTrack(t)}))}},{key:\"restartIce\",value:function(e){var t=this;return j.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),i.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return j.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=v.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return j.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return j.debug(\"_setupTransport()\"),i.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=v.default.parse(r),o=w.extractDtlsParameters(n);return o.role=\"server\",t.dtlsParameters=o,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:\"getPCStats\",value:function(e){return j.debug(\"getPCStats of revc\",e),this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(M),F=function(e){function t(e,r){var n;return C(this,t),(n=I(this,D(t).call(this,\"recv\",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._kinds=new a.default,n._consumerInfos=new o.default,n}return O(t,e),E(t,[{key:\"addConsumer\",value:function(e){var t=this;if(j.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return i.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],o=e.rtpParameters.rtcp.cname,a={kind:e.kind,streamId:\"recv-stream-\".concat(e.id),trackId:\"consumer-\".concat(e.kind,\"-\").concat(e.id),ssrc:r.ssrc,cname:o};return r.rtx&&r.rtx.ssrc&&(a.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,a),this._kinds.add(e.kind),i.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return j.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return j.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getRemoteStreams().find((function(e){return e.id===a.streamId})).getTrackById(a.trackId);if(!e)throw new Error(\"remote track not found\");return e}))}},{key:\"removeConsumer\",value:function(e){var t=this;return j.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),i.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return j.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return j.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):i.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return j.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),i.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return j.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return j.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return j.debug(\"_setupTransport()\"),i.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){j.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=v.default.parse(e),r={dtlsParameters:w.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}},{key:\"getPCStats\",value:function(e){return j.debug(\"getPCStats of revc\",e),this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(M),N=function(){function e(t,r,n){var o;switch(C(this,e),j.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r),t){case\"send\":return o={audio:b.getSendingRtpParameters(\"audio\",r),video:b.getSendingRtpParameters(\"video\",r)},new A(o,n);case\"recv\":return o={audio:b.getReceivingFullRtpParameters(\"audio\",r),video:b.getReceivingFullRtpParameters(\"video\",r)},new F(o,n)}}return E(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){j.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\",sdpSemantics:\"plan-b\"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(t){try{e.close()}catch(e){}var r=v.default.parse(t.sdp);return w.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:\"tag\",get:function(){return\"Chrome67\"}}]),e}();t.default=N},function(e,t,r){\"use strict\";var n=h(r(20)),o=h(r(10)),a=h(r(25)),i=h(r(8)),s=h(r(7)),c=h(r(0)),u=h(r(6)),d=h(r(4)),l=h(r(3)),f=h(r(5)),p=h(r(11)),m=h(r(1));function h(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var v=S(r(19)),_=S(r(9)),y=S(r(14)),g=T(r(12)),b=T(r(18)),w=T(r(26)),k=T(r(45)),P=S(r(46));function T(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=m.default&&p.default?(0,p.default)(e,r):{};n.get||n.set?(0,m.default)(t,r,n):t[r]=e[r]}return t.default=e,t}function S(e){return e&&e.__esModule?e:{default:e}}function R(e){return(R=\"function\"==typeof f.default&&\"symbol\"===(0,l.default)(d.default)?function(e){return void 0===e?\"undefined\":(0,l.default)(e)}:function(e){return e&&\"function\"==typeof f.default&&e.constructor===f.default&&e!==f.default.prototype?\"symbol\":void 0===e?\"undefined\":(0,l.default)(e)})(e)}function C(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function x(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),(0,m.default)(e,n.key,n)}}function E(e,t,r){return t&&x(e.prototype,t),r&&x(e,r),e}function I(e,t){return!t||\"object\"!==R(t)&&\"function\"!=typeof t?function(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}(e):t}function D(e){return(D=u.default?c.default:function(e){return e.__proto__||(0,c.default)(e)})(e)}function O(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=(0,s.default)(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}function L(e,t){return(L=u.default||function(e,t){return e.__proto__=t,e})(e,t)}var j=new _.default(\"Chrome55\"),M=function(e){function t(e,r,n){var o;return C(this,t),(o=I(this,D(t).call(this,j)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"}),o._rtpParametersByKind=r,o._remoteSdp=new P.default(e,r),o._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(o._pc.iceConnectionState){case\"checking\":o.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":o.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":o.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":o.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":o.emit(\"@connectionstatechange\",\"closed\")}})),o}return O(t,e),E(t,[{key:\"close\",value:function(){j.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){j.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(y.default),A=function(e){function t(e,r){var n;return C(this,t),(n=I(this,D(t).call(this,\"send\",e,r)))._transportReady=!1,n._stream=new MediaStream,n}return O(t,e),E(t,[{key:\"addProducer\",value:function(e){var t,r=this,n=e.track;return j.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,n.id),this._stream.getTrackById(n.id)?i.default.reject(new Error(\"track already added\")):i.default.resolve().then((function(){return r._stream.addTrack(n),r._pc.addTrack(n,r._stream),r._pc.createOffer()})).then((function(t){if(e.simulcast){j.debug(\"addProducer() | enabling simulcast\");var o=v.default.parse(t.sdp);k.addSimulcastForTrack(o,n),t={type:\"offer\",sdp:v.default.write(o)}}return j.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",t),r._pc.setLocalDescription(t)})).then((function(){if(!r._transportReady)return r._setupTransport()})).then((function(){t=v.default.parse(r._pc.localDescription.sdp);var e={type:\"answer\",sdp:r._remoteSdp.createAnswerSdp(t)};return j.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",e),r._pc.setRemoteDescription(e)})).then((function(){var o=g.clone(r._rtpParametersByKind[e.kind]);return k.fillRtpParametersForTrack(o,t,n),o})).catch((function(e){throw r._stream.removeTrack(n),r._pc.addStream(r._stream),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;return j.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),i.default.resolve().then((function(){return t._stream.removeTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()})).then((function(e){return j.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).catch((function(e){if(0!==t._stream.getTracks().length)throw e;j.warn(\"removeProducer() | ignoring expected error due no sending tracks: %s\",e.toString())})).then((function(){if(\"stable\"!==t._pc.signalingState){var e=v.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return j.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;j.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n,o=e.track;return i.default.resolve().then((function(){return r._stream.removeTrack(o),r._stream.addTrack(t),r._pc.addStream(r._stream),r._pc.createOffer()})).then((function(n){if(e.simulcast){j.debug(\"addProducer() | enabling simulcast\");var o=v.default.parse(n.sdp);k.addSimulcastForTrack(o,t),n={type:\"offer\",sdp:v.default.write(o)}}return j.debug(\"replaceProducerTrack() | calling pc.setLocalDescription() [offer:%o]\",n),r._pc.setLocalDescription(n)})).then((function(){n=v.default.parse(r._pc.localDescription.sdp);var e={type:\"answer\",sdp:r._remoteSdp.createAnswerSdp(n)};return j.debug(\"replaceProducerTrack() | calling pc.setRemoteDescription() [answer:%o]\",e),r._pc.setRemoteDescription(e)})).then((function(){var o=g.clone(r._rtpParametersByKind[e.kind]);k.fillRtpParametersForTrack(o,n,t),r.safeEmit(\"@needupdateproducer\",e,o)})).catch((function(e){throw r._stream.removeTrack(t),r._stream.addTrack(o),r._pc.addStream(r._stream),e}))}},{key:\"restartIce\",value:function(e){var t=this;return j.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),i.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return j.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=v.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return j.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return j.debug(\"_setupTransport()\"),i.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=v.default.parse(r),o=w.extractDtlsParameters(n);return o.role=\"server\",t.dtlsParameters=o,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}},{key:\"getPCStats\",value:function(e){return j.debug(\"getPCStats of revc\",e),this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(M),F=function(e){function t(e,r){var n;return C(this,t),(n=I(this,D(t).call(this,\"recv\",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._kinds=new a.default,n._consumerInfos=new o.default,n}return O(t,e),E(t,[{key:\"addConsumer\",value:function(e){var t=this;if(j.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return i.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],o=e.rtpParameters.rtcp.cname,a={kind:e.kind,streamId:\"recv-stream-\".concat(e.id),trackId:\"consumer-\".concat(e.kind,\"-\").concat(e.id),ssrc:r.ssrc,cname:o};return r.rtx&&r.rtx.ssrc&&(a.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,a),this._kinds.add(e.kind),i.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return j.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return j.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getRemoteStreams().find((function(e){return e.id===a.streamId})).getTrackById(a.trackId);if(!e)throw new Error(\"remote track not found\");return e}))}},{key:\"removeConsumer\",value:function(e){var t=this;return j.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),i.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return j.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return j.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):i.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return j.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),i.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return j.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return j.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return j.debug(\"_setupTransport()\"),i.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){j.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=v.default.parse(e),r={dtlsParameters:w.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}},{key:\"getPCStats\",value:function(e){return j.debug(\"getPCStats of revc\",e),this._pc.getStats(e).then((function(e){return e})).catch((function(e){throw e}))}}]),t}(M),N=function(){function e(t,r,n){var o;switch(C(this,e),j.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r),t){case\"send\":return o={audio:b.getSendingRtpParameters(\"audio\",r),video:b.getSendingRtpParameters(\"video\",r)},new A(o,n);case\"recv\":return o={audio:b.getReceivingFullRtpParameters(\"audio\",r),video:b.getReceivingFullRtpParameters(\"video\",r)},new F(o,n)}}return E(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){j.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(t){try{e.close()}catch(e){}var r=v.default.parse(t.sdp);return w.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:\"tag\",get:function(){return\"Chrome55\"}}]),e}();t.default=N},function(e,t,r){\"use strict\";var n=h(r(20)),o=h(r(10)),a=h(r(8)),i=h(r(25)),s=h(r(7)),c=h(r(0)),u=h(r(6)),d=h(r(4)),l=h(r(3)),f=h(r(5)),p=h(r(11)),m=h(r(1));function h(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var v=S(r(19)),_=S(r(9)),y=S(r(14)),g=T(r(12)),b=T(r(18)),w=T(r(26)),k=T(r(43)),P=S(r(44));function T(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=m.default&&p.default?(0,p.default)(e,r):{};n.get||n.set?(0,m.default)(t,r,n):t[r]=e[r]}return t.default=e,t}function S(e){return e&&e.__esModule?e:{default:e}}function R(e){return(R=\"function\"==typeof f.default&&\"symbol\"===(0,l.default)(d.default)?function(e){return void 0===e?\"undefined\":(0,l.default)(e)}:function(e){return e&&\"function\"==typeof f.default&&e.constructor===f.default&&e!==f.default.prototype?\"symbol\":void 0===e?\"undefined\":(0,l.default)(e)})(e)}function C(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function x(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),(0,m.default)(e,n.key,n)}}function E(e,t,r){return t&&x(e.prototype,t),r&&x(e,r),e}function I(e,t){return!t||\"object\"!==R(t)&&\"function\"!=typeof t?function(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}(e):t}function D(e){return(D=u.default?c.default:function(e){return e.__proto__||(0,c.default)(e)})(e)}function O(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=(0,s.default)(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}function L(e,t){return(L=u.default||function(e,t){return e.__proto__=t,e})(e,t)}var j=new _.default(\"Safari12\"),M=function(e){function t(e,r,n){var o;return C(this,t),(o=I(this,D(t).call(this,j)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"}),o._rtpParametersByKind=r,o._remoteSdp=new P.default(e,r),o._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(o._pc.iceConnectionState){case\"checking\":o.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":o.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":o.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":o.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":o.emit(\"@connectionstatechange\",\"closed\")}})),o}return O(t,e),E(t,[{key:\"close\",value:function(){j.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){j.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(y.default),A=function(e){function t(e,r){var n;return C(this,t),(n=I(this,D(t).call(this,\"send\",e,r)))._transportReady=!1,n._trackIds=new i.default,n}return O(t,e),E(t,[{key:\"addProducer\",value:function(e){var t,r,n=this,o=e.track;return j.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,o.id),this._trackIds.has(o.id)?a.default.reject(new Error(\"track already added\")):(this._trackIds.add(o.id),a.default.resolve().then((function(){if(t=n._pc.getTransceivers().find((function(e){return e.receiver.track.kind===o.kind&&\"inactive\"===e.direction})))return j.debug(\"addProducer() | reusing an inactive transceiver\"),t.direction=\"sendonly\",t.sender.replaceTrack(o);t=n._pc.addTransceiver(o,{direction:\"sendonly\"})})).then((function(){return n._pc.createOffer()})).then((function(r){if(e.simulcast){j.debug(\"addProducer() | enabling simulcast\");var a=v.default.parse(r.sdp);k.addPlanBSimulcast(a,o,{mid:t.mid}),r={type:\"offer\",sdp:v.default.write(a)}}return j.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",r),n._pc.setLocalDescription(r)})).then((function(){if(!n._transportReady)return n._setupTransport()})).then((function(){r=v.default.parse(n._pc.localDescription.sdp);var e={type:\"answer\",sdp:n._remoteSdp.createAnswerSdp(r)};return j.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",e),n._pc.setRemoteDescription(e)})).then((function(){var a=g.clone(n._rtpParametersByKind[e.kind]);return k.fillRtpParametersForTrack(a,r,o,{mid:t.mid,planBSimulcast:!0}),a})).catch((function(e){try{t.direction=\"inactive\"}catch(e){}throw n._trackIds.delete(o.id),e})))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;return this._trackIds.has(r.id)?(j.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),a.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error(\"local track not found\");return t._pc.removeTrack(e),t._trackIds.delete(r.id),t._pc.createOffer()})).then((function(e){return j.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=v.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return j.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))):a.default.reject(new Error(\"track not found\"))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;j.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=e.track;return a.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error(\"local track not found\");return e.replaceTrack(t)})).then((function(){r._trackIds.delete(n.id),r._trackIds.add(t.id)}))}},{key:\"restartIce\",value:function(e){var t=this;return j.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),a.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return j.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=v.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return j.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return j.debug(\"_setupTransport()\"),a.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=v.default.parse(r),o=w.extractDtlsParameters(n);return o.role=\"server\",t.dtlsParameters=o,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}}]),t}(M),F=function(e){function t(e,r){var n;return C(this,t),(n=I(this,D(t).call(this,\"recv\",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new o.default,n}return O(t,e),E(t,[{key:\"addConsumer\",value:function(e){var t=this;if(j.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return a.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],o=e.rtpParameters.rtcp.cname,i={mid:\"\".concat(e.kind[0]).concat(e.id),kind:e.kind,closed:e.closed,streamId:\"recv-stream-\".concat(e.id),trackId:\"consumer-\".concat(e.kind,\"-\").concat(e.id),ssrc:r.ssrc,cname:o};return r.rtx&&r.rtx.ssrc&&(i.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,i),a.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return j.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return j.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getTransceivers().find((function(e){return e.mid===i.mid}));if(!e)throw new Error(\"remote track not found\");return e.receiver.track}))}},{key:\"removeConsumer\",value:function(e){var t=this;j.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,a.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return j.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return j.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):a.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return j.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),a.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return j.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return j.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return j.debug(\"_setupTransport()\"),a.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){j.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=v.default.parse(e),r={dtlsParameters:w.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}}]),t}(M),N=function(){function e(t,r,n){var o;switch(C(this,e),j.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r),t){case\"send\":return o={audio:b.getSendingRtpParameters(\"audio\",r),video:b.getSendingRtpParameters(\"video\",r)},new A(o,n);case\"recv\":return o={audio:b.getReceivingFullRtpParameters(\"audio\",r),video:b.getReceivingFullRtpParameters(\"video\",r)},new F(o,n)}}return E(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){j.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"});return e.addTransceiver(\"audio\"),e.addTransceiver(\"video\"),e.createOffer().then((function(t){try{e.close()}catch(e){}var r=v.default.parse(t.sdp);return w.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:\"tag\",get:function(){return\"Safari12\"}}]),e}();t.default=N},function(e,t,r){\"use strict\";var n=h(r(20)),o=h(r(10)),a=h(r(25)),i=h(r(8)),s=h(r(7)),c=h(r(0)),u=h(r(6)),d=h(r(4)),l=h(r(3)),f=h(r(5)),p=h(r(11)),m=h(r(1));function h(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var v=S(r(19)),_=S(r(9)),y=S(r(14)),g=T(r(12)),b=T(r(18)),w=T(r(26)),k=T(r(45)),P=S(r(46));function T(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=m.default&&p.default?(0,p.default)(e,r):{};n.get||n.set?(0,m.default)(t,r,n):t[r]=e[r]}return t.default=e,t}function S(e){return e&&e.__esModule?e:{default:e}}function R(e){return(R=\"function\"==typeof f.default&&\"symbol\"===(0,l.default)(d.default)?function(e){return void 0===e?\"undefined\":(0,l.default)(e)}:function(e){return e&&\"function\"==typeof f.default&&e.constructor===f.default&&e!==f.default.prototype?\"symbol\":void 0===e?\"undefined\":(0,l.default)(e)})(e)}function C(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function x(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),(0,m.default)(e,n.key,n)}}function E(e,t,r){return t&&x(e.prototype,t),r&&x(e,r),e}function I(e,t){return!t||\"object\"!==R(t)&&\"function\"!=typeof t?function(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}(e):t}function D(e){return(D=u.default?c.default:function(e){return e.__proto__||(0,c.default)(e)})(e)}function O(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=(0,s.default)(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}function L(e,t){return(L=u.default||function(e,t){return e.__proto__=t,e})(e,t)}var j=new _.default(\"Safari11\"),M=function(e){function t(e,r,n){var o;return C(this,t),(o=I(this,D(t).call(this,j)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"}),o._rtpParametersByKind=r,o._remoteSdp=new P.default(e,r),o._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(o._pc.iceConnectionState){case\"checking\":o.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":o.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":o.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":o.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":o.emit(\"@connectionstatechange\",\"closed\")}})),o}return O(t,e),E(t,[{key:\"close\",value:function(){j.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){j.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(y.default),A=function(e){function t(e,r){var n;return C(this,t),(n=I(this,D(t).call(this,\"send\",e,r)))._transportReady=!1,n._stream=new MediaStream,n}return O(t,e),E(t,[{key:\"addProducer\",value:function(e){var t,r,n=this,o=e.track;return j.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,o.id),this._stream.getTrackById(o.id)?i.default.reject(new Error(\"track already added\")):i.default.resolve().then((function(){return n._stream.addTrack(o),t=n._pc.addTrack(o,n._stream),n._pc.createOffer()})).then((function(e){return j.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",e),n._pc.setLocalDescription(e)})).then((function(){if(!n._transportReady)return n._setupTransport()})).then((function(){r=v.default.parse(n._pc.localDescription.sdp);var e={type:\"answer\",sdp:n._remoteSdp.createAnswerSdp(r)};return j.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",e),n._pc.setRemoteDescription(e)})).then((function(){var t=g.clone(n._rtpParametersByKind[e.kind]);return k.fillRtpParametersForTrack(t,r,o),t})).catch((function(e){try{n._pc.removeTrack(t)}catch(e){}throw n._stream.removeTrack(o),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;return j.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),i.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error(\"RTCRtpSender not found\");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()})).then((function(e){return j.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).catch((function(e){if(0!==t._stream.getTracks().length)throw e;j.warn(\"removeProducer() | ignoring expected error due no sending tracks: %s\",e.toString())})).then((function(){if(\"stable\"!==t._pc.signalingState){var e=v.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return j.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;j.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=e.track;return i.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error(\"local track not found\");return e.replaceTrack(t)})).then((function(){r._stream.removeTrack(n),r._stream.addTrack(t)}))}},{key:\"restartIce\",value:function(e){var t=this;return j.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),i.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return j.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=v.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return j.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return j.debug(\"_setupTransport()\"),i.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=v.default.parse(r),o=w.extractDtlsParameters(n);return o.role=\"server\",t.dtlsParameters=o,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}}]),t}(M),F=function(e){function t(e,r){var n;return C(this,t),(n=I(this,D(t).call(this,\"recv\",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._kinds=new a.default,n._consumerInfos=new o.default,n}return O(t,e),E(t,[{key:\"addConsumer\",value:function(e){var t=this;if(j.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return i.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],o=e.rtpParameters.rtcp.cname,a={kind:e.kind,streamId:\"recv-stream-\".concat(e.id),trackId:\"consumer-\".concat(e.kind,\"-\").concat(e.id),ssrc:r.ssrc,cname:o};return r.rtx&&r.rtx.ssrc&&(a.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,a),this._kinds.add(e.kind),i.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return j.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return j.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getReceivers().find((function(e){var t=e.track;return!!t&&t.id===a.trackId}));if(!e)throw new Error(\"remote track not found\");return e.track}))}},{key:\"removeConsumer\",value:function(e){var t=this;return j.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),i.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return j.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return j.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):i.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return j.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),i.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};return j.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return j.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return j.debug(\"_setupTransport()\"),i.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){j.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=v.default.parse(e),r={dtlsParameters:w.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}}]),t}(M),N=function(){function e(t,r,n){var o;switch(C(this,e),j.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r),t){case\"send\":return o={audio:b.getSendingRtpParameters(\"audio\",r),video:b.getSendingRtpParameters(\"video\",r)},new A(o,n);case\"recv\":return o={audio:b.getReceivingFullRtpParameters(\"audio\",r),video:b.getReceivingFullRtpParameters(\"video\",r)},new F(o,n)}}return E(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){j.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"});return e.addTransceiver(\"audio\"),e.addTransceiver(\"video\"),e.createOffer().then((function(t){try{e.close()}catch(e){}var r=v.default.parse(t.sdp);return w.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:\"tag\",get:function(){return\"Safari11\"}}]),e}();t.default=N},function(e,t,r){\"use strict\";var n=_(r(20)),o=_(r(10)),a=_(r(8)),i=_(r(25)),s=_(r(7)),c=_(r(0)),u=_(r(6)),d=_(r(4)),l=_(r(3)),f=_(r(5)),p=_(r(85)),m=_(r(35)),h=_(r(11)),v=_(r(1));function _(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var y=C(r(19)),g=C(r(9)),b=C(r(14)),w=R(r(12)),k=R(r(18)),P=R(r(26)),T=R(r(43)),S=C(r(44));function R(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=v.default&&h.default?(0,h.default)(e,r):{};n.get||n.set?(0,v.default)(t,r,n):t[r]=e[r]}return t.default=e,t}function C(e){return e&&e.__esModule?e:{default:e}}function x(e,t,r){return t in e?(0,v.default)(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function E(e){return(E=\"function\"==typeof f.default&&\"symbol\"===(0,l.default)(d.default)?function(e){return void 0===e?\"undefined\":(0,l.default)(e)}:function(e){return e&&\"function\"==typeof f.default&&e.constructor===f.default&&e!==f.default.prototype?\"symbol\":void 0===e?\"undefined\":(0,l.default)(e)})(e)}function I(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function D(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),(0,v.default)(e,n.key,n)}}function O(e,t,r){return t&&D(e.prototype,t),r&&D(e,r),e}function L(e,t){return!t||\"object\"!==E(t)&&\"function\"!=typeof t?function(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}(e):t}function j(e){return(j=u.default?c.default:function(e){return e.__proto__||(0,c.default)(e)})(e)}function M(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=(0,s.default)(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}function A(e,t){return(A=u.default||function(e,t){return e.__proto__=t,e})(e,t)}var F=new g.default(\"Firefox65\"),N=function(e){function t(e,r,n){var o;return I(this,t),(o=L(this,j(t).call(this,F)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"}),o._rtpParametersByKind=r,o._remoteSdp=new S.default(e,r),o._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(o._pc.iceConnectionState){case\"checking\":o.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":o.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":o.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":o.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":o.emit(\"@connectionstatechange\",\"closed\")}})),o}return M(t,e),O(t,[{key:\"close\",value:function(){F.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){F.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(b.default),U=function(e){function t(e,r){var n;return I(this,t),(n=L(this,j(t).call(this,\"send\",e,r)))._transportReady=!1,n._trackIds=new i.default,n._nextRid=1,n}return M(t,e),O(t,[{key:\"addProducer\",value:function(e){var t,r,n=this,o=e.track;return F.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,o.id),this._trackIds.has(o.id)?a.default.reject(new Error(\"track already added\")):(this._trackIds.add(o.id),a.default.resolve().then((function(){if(t=n._pc.getTransceivers().find((function(e){return e.receiver.track.kind===o.kind&&\"inactive\"===e.direction})))return F.debug(\"addProducer() | reusing an inactive transceiver\"),t.direction=\"sendonly\",t.sender.replaceTrack(o);t=n._pc.addTransceiver(o,{direction:\"sendonly\"})})).then((function(){var r=t.sender,o=[];e.simulcast&&(F.debug(\"addProducer() | enabling simulcast\"),e.simulcast.high&&o.push({rid:\"high\".concat(n._nextRid),active:!0,priority:\"low\",maxBitrate:e.simulcast.high}),e.simulcast.medium&&o.push({rid:\"medium\".concat(n._nextRid),active:!0,priority:\"medium\",maxBitrate:e.simulcast.medium}),e.simulcast.low&&o.push({rid:\"low\".concat(n._nextRid),active:!0,priority:\"high\",maxBitrate:e.simulcast.low}),n._nextRid++);var a=r.getParameters();return r.setParameters(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=(0,m.default)(r);\"function\"==typeof p.default&&(n=n.concat((0,p.default)(r).filter((function(e){return(0,h.default)(r,e).enumerable})))),n.forEach((function(t){x(e,t,r[t])}))}return e}({},a,{encodings:o}))})).then((function(){return n._pc.createOffer()})).then((function(e){return F.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",e),n._pc.setLocalDescription(e)})).then((function(){if(!n._transportReady)return n._setupTransport()})).then((function(){r=y.default.parse(n._pc.localDescription.sdp);var e={type:\"answer\",sdp:n._remoteSdp.createAnswerSdp(r)};return F.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",e),n._pc.setRemoteDescription(e)})).then((function(){var a=w.clone(n._rtpParametersByKind[e.kind]);return T.fillRtpParametersForTrack(a,r,o,{mid:t.mid}),a})).catch((function(e){try{t.direction=\"inactive\"}catch(e){}throw n._trackIds.delete(o.id),e})))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;return this._trackIds.has(r.id)?(F.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),a.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error(\"local track not found\");return t._pc.removeTrack(e),t._trackIds.delete(r.id),t._pc.createOffer()})).then((function(e){return F.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=y.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return F.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))):a.default.reject(new Error(\"track not found\"))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;F.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=e.track;return a.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error(\"local track not found\");return e.replaceTrack(t)})).then((function(){r._trackIds.delete(n.id),r._trackIds.add(t.id)}))}},{key:\"restartIce\",value:function(e){var t=this;return F.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),a.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return F.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=y.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return F.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return F.debug(\"_setupTransport()\"),a.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=y.default.parse(r),o=P.extractDtlsParameters(n);return o.role=\"server\",t.dtlsParameters=o,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}}]),t}(N),V=function(e){function t(e,r){var n;return I(this,t),(n=L(this,j(t).call(this,\"recv\",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new o.default,n}return M(t,e),O(t,[{key:\"addConsumer\",value:function(e){var t=this;if(F.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return a.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],o=e.rtpParameters.rtcp.cname,i={mid:\"\".concat(e.kind[0]).concat(e.id),kind:e.kind,closed:e.closed,streamId:\"recv-stream-\".concat(e.id),trackId:\"consumer-\".concat(e.kind,\"-\").concat(e.id),ssrc:r.ssrc,cname:o};return r.rtx&&r.rtx.ssrc&&(i.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,i),a.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return F.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return F.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getTransceivers().find((function(e){return e.mid===i.mid}));if(!e)throw new Error(\"remote track not found\");return e.receiver.track}))}},{key:\"removeConsumer\",value:function(e){var t=this;F.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,a.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return F.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return F.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):a.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return F.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),a.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return F.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return F.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return F.debug(\"_setupTransport()\"),a.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){F.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=y.default.parse(e),r={dtlsParameters:P.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}}]),t}(N),B=function(){function e(t,r,n){var o;switch(I(this,e),F.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r),t){case\"send\":return o={audio:k.getSendingRtpParameters(\"audio\",r),video:k.getSendingRtpParameters(\"video\",r)},new U(o,n);case\"recv\":return o={audio:k.getReceivingFullRtpParameters(\"audio\",r),video:k.getReceivingFullRtpParameters(\"video\",r)},new V(o,n)}}return O(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){F.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"}),t=document.createElement(\"canvas\");t.getContext(\"2d\");var r=t.captureStream(),n=r.getVideoTracks()[0];return e.addTrack(n,r).setParameters({encodings:[{rid:\"RID1\",maxBitrate:4e4},{rid:\"RID2\",maxBitrate:1e4}]}),e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(r){try{t.remove()}catch(e){}try{n.stop()}catch(e){}try{e.close()}catch(e){}var o=y.default.parse(r.sdp);return P.extractRtpCapabilities(o)})).catch((function(r){try{t.remove()}catch(e){}try{n.stop()}catch(e){}try{e.close()}catch(e){}throw r}))}},{key:\"tag\",get:function(){return\"Firefox65\"}}]),e}();t.default=B},function(e,t,r){r(93),e.exports=r(2).Object.getOwnPropertySymbols},function(e,t,r){\"use strict\";var n=v(r(20)),o=v(r(10)),a=v(r(8)),i=v(r(7)),s=v(r(0)),c=v(r(6)),u=v(r(4)),d=v(r(3)),l=v(r(5)),f=v(r(85)),p=v(r(35)),m=v(r(11)),h=v(r(1));function v(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var _=R(r(19)),y=R(r(9)),g=R(r(14)),b=S(r(12)),w=S(r(18)),k=S(r(26)),P=S(r(43)),T=R(r(44));function S(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=h.default&&m.default?(0,m.default)(e,r):{};n.get||n.set?(0,h.default)(t,r,n):t[r]=e[r]}return t.default=e,t}function R(e){return e&&e.__esModule?e:{default:e}}function C(e,t,r){return t in e?(0,h.default)(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function x(e){return(x=\"function\"==typeof l.default&&\"symbol\"===(0,d.default)(u.default)?function(e){return void 0===e?\"undefined\":(0,d.default)(e)}:function(e){return e&&\"function\"==typeof l.default&&e.constructor===l.default&&e!==l.default.prototype?\"symbol\":void 0===e?\"undefined\":(0,d.default)(e)})(e)}function E(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function I(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),(0,h.default)(e,n.key,n)}}function D(e,t,r){return t&&I(e.prototype,t),r&&I(e,r),e}function O(e,t){return!t||\"object\"!==x(t)&&\"function\"!=typeof t?function(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}(e):t}function L(e){return(L=c.default?s.default:function(e){return e.__proto__||(0,s.default)(e)})(e)}function j(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=(0,i.default)(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}function M(e,t){return(M=c.default||function(e,t){return e.__proto__=t,e})(e,t)}var A=new y.default(\"Firefox59\"),F=function(e){function t(e,r,n){var o;return E(this,t),(o=O(this,L(t).call(this,A)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"}),o._rtpParametersByKind=r,o._remoteSdp=new T.default(e,r),o._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(o._pc.iceConnectionState){case\"checking\":o.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":o.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":o.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":o.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":o.emit(\"@connectionstatechange\",\"closed\")}})),o}return j(t,e),D(t,[{key:\"close\",value:function(){A.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){A.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(g.default),N=function(e){function t(e,r){var n;return E(this,t),(n=O(this,L(t).call(this,\"send\",e,r)))._transportReady=!1,n._stream=new MediaStream,n._nextRid=1,n}return j(t,e),D(t,[{key:\"addProducer\",value:function(e){var t,r,n=this,o=e.track;return A.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,o.id),this._stream.getTrackById(o.id)?a.default.reject(new Error(\"track already added\")):a.default.resolve().then((function(){n._stream.addTrack(o),t=n._pc.addTrack(o,n._stream)})).then((function(){var r=[];e.simulcast&&(A.debug(\"addProducer() | enabling simulcast\"),e.simulcast.high&&r.push({rid:\"high\".concat(n._nextRid),active:!0,priority:\"low\",maxBitrate:e.simulcast.high}),e.simulcast.medium&&r.push({rid:\"medium\".concat(n._nextRid),active:!0,priority:\"medium\",maxBitrate:e.simulcast.medium}),e.simulcast.low&&r.push({rid:\"low\".concat(n._nextRid),active:!0,priority:\"high\",maxBitrate:e.simulcast.low}),n._nextRid++);var o=t.getParameters();return t.setParameters(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=(0,p.default)(r);\"function\"==typeof f.default&&(n=n.concat((0,f.default)(r).filter((function(e){return(0,m.default)(r,e).enumerable})))),n.forEach((function(t){C(e,t,r[t])}))}return e}({},o,{encodings:r}))})).then((function(){return n._pc.createOffer()})).then((function(e){return A.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",e),n._pc.setLocalDescription(e)})).then((function(){if(!n._transportReady)return n._setupTransport()})).then((function(){r=_.default.parse(n._pc.localDescription.sdp);var e={type:\"answer\",sdp:n._remoteSdp.createAnswerSdp(r)};return A.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",e),n._pc.setRemoteDescription(e)})).then((function(){var t=b.clone(n._rtpParametersByKind[e.kind]);return P.fillRtpParametersForTrack(t,r,o),t})).catch((function(e){try{n._pc.removeTrack(t)}catch(e){}throw n._stream.removeTrack(o),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;return A.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),a.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error(\"RTCRtpSender not found\");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()})).then((function(e){return A.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=_.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return A.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;A.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=e.track;return a.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error(\"local track not found\");return e.replaceTrack(t)})).then((function(){r._stream.removeTrack(n),r._stream.addTrack(t)}))}},{key:\"restartIce\",value:function(e){var t=this;return A.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),a.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return A.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=_.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return A.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return A.debug(\"_setupTransport()\"),a.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=_.default.parse(r),o=k.extractDtlsParameters(n);return o.role=\"server\",t.dtlsParameters=o,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}}]),t}(F),U=function(e){function t(e,r){var n;return E(this,t),(n=O(this,L(t).call(this,\"recv\",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new o.default,n}return j(t,e),D(t,[{key:\"addConsumer\",value:function(e){var t=this;if(A.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return a.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],o=e.rtpParameters.rtcp.cname,i={mid:\"\".concat(e.kind[0]).concat(e.id),kind:e.kind,closed:e.closed,streamId:\"recv-stream-\".concat(e.id),trackId:\"consumer-\".concat(e.kind,\"-\").concat(e.id),ssrc:r.ssrc,cname:o};return r.rtx&&r.rtx.ssrc&&(i.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,i),a.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return A.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return A.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getTransceivers().find((function(e){var t=e.receiver;return!!t&&(!!t.track&&e.mid===i.mid)}));if(!e)throw new Error(\"remote track not found\");return e.receiver.track}))}},{key:\"removeConsumer\",value:function(e){var t=this;A.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,a.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return A.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return A.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):a.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return A.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),a.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return A.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return A.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return A.debug(\"_setupTransport()\"),a.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){A.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=_.default.parse(e),r={dtlsParameters:k.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}}]),t}(F),V=function(){function e(t,r,n){var o;switch(E(this,e),A.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r),t){case\"send\":return o={audio:w.getSendingRtpParameters(\"audio\",r),video:w.getSendingRtpParameters(\"video\",r)},new N(o,n);case\"recv\":return o={audio:w.getReceivingFullRtpParameters(\"audio\",r),video:w.getReceivingFullRtpParameters(\"video\",r)},new U(o,n)}}return D(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){A.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"}),t=document.createElement(\"canvas\");t.getContext(\"2d\");var r=t.captureStream(),n=r.getVideoTracks()[0];return e.addTrack(n,r).setParameters({encodings:[{rid:\"RID1\",maxBitrate:4e4},{rid:\"RID2\",maxBitrate:1e4}]}),e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(r){try{t.remove()}catch(e){}try{n.stop()}catch(e){}try{e.close()}catch(e){}var o=_.default.parse(r.sdp);return k.extractRtpCapabilities(o)})).catch((function(r){try{t.remove()}catch(e){}try{n.stop()}catch(e){}try{e.close()}catch(e){}throw r}))}},{key:\"tag\",get:function(){return\"Firefox59\"}}]),e}();t.default=V},function(e,t,r){\"use strict\";var n=v(r(20)),o=v(r(10)),a=v(r(8)),i=v(r(7)),s=v(r(0)),c=v(r(6)),u=v(r(4)),d=v(r(3)),l=v(r(5)),f=v(r(85)),p=v(r(35)),m=v(r(11)),h=v(r(1));function v(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var _=R(r(19)),y=R(r(9)),g=R(r(14)),b=S(r(12)),w=S(r(18)),k=S(r(26)),P=S(r(43)),T=R(r(44));function S(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=h.default&&m.default?(0,m.default)(e,r):{};n.get||n.set?(0,h.default)(t,r,n):t[r]=e[r]}return t.default=e,t}function R(e){return e&&e.__esModule?e:{default:e}}function C(e,t,r){return t in e?(0,h.default)(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function x(e){return(x=\"function\"==typeof l.default&&\"symbol\"===(0,d.default)(u.default)?function(e){return void 0===e?\"undefined\":(0,d.default)(e)}:function(e){return e&&\"function\"==typeof l.default&&e.constructor===l.default&&e!==l.default.prototype?\"symbol\":void 0===e?\"undefined\":(0,d.default)(e)})(e)}function E(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function I(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),(0,h.default)(e,n.key,n)}}function D(e,t,r){return t&&I(e.prototype,t),r&&I(e,r),e}function O(e,t){return!t||\"object\"!==x(t)&&\"function\"!=typeof t?function(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}(e):t}function L(e){return(L=c.default?s.default:function(e){return e.__proto__||(0,s.default)(e)})(e)}function j(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=(0,i.default)(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}function M(e,t){return(M=c.default||function(e,t){return e.__proto__=t,e})(e,t)}var A=new y.default(\"Firefox50\"),F=function(e){function t(e,r,n){var o;return E(this,t),(o=O(this,L(t).call(this,A)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"}),o._rtpParametersByKind=r,o._remoteSdp=new T.default(e,r),o._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(o._pc.iceConnectionState){case\"checking\":o.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":o.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":o.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":o.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":o.emit(\"@connectionstatechange\",\"closed\")}})),o}return j(t,e),D(t,[{key:\"close\",value:function(){A.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){A.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(g.default),N=function(e){function t(e,r){var n;return E(this,t),(n=O(this,L(t).call(this,\"send\",e,r)))._transportReady=!1,n._stream=new MediaStream,n._nextRid=1,n}return j(t,e),D(t,[{key:\"addProducer\",value:function(e){var t,r,n=this,o=e.track;return A.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,o.id),this._stream.getTrackById(o.id)?a.default.reject(new Error(\"track already added\")):a.default.resolve().then((function(){n._stream.addTrack(o),t=n._pc.addTrack(o,n._stream)})).then((function(){var r=[];e.simulcast&&(A.debug(\"addProducer() | enabling simulcast\"),e.simulcast.high&&r.push({rid:\"high\".concat(n._nextRid),active:!0,priority:\"low\",maxBitrate:e.simulcast.high}),e.simulcast.medium&&r.push({rid:\"medium\".concat(n._nextRid),active:!0,priority:\"medium\",maxBitrate:e.simulcast.medium}),e.simulcast.low&&r.push({rid:\"low\".concat(n._nextRid),active:!0,priority:\"high\",maxBitrate:e.simulcast.low}),n._nextRid++);var o=t.getParameters();return t.setParameters(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=(0,p.default)(r);\"function\"==typeof f.default&&(n=n.concat((0,f.default)(r).filter((function(e){return(0,m.default)(r,e).enumerable})))),n.forEach((function(t){C(e,t,r[t])}))}return e}({},o,{encodings:r}))})).then((function(){return n._pc.createOffer()})).then((function(e){return A.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",e),n._pc.setLocalDescription(e)})).then((function(){if(!n._transportReady)return n._setupTransport()})).then((function(){r=_.default.parse(n._pc.localDescription.sdp);var e={type:\"answer\",sdp:n._remoteSdp.createAnswerSdp(r)};return A.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",e),n._pc.setRemoteDescription(e)})).then((function(){var t=b.clone(n._rtpParametersByKind[e.kind]);return P.fillRtpParametersForTrack(t,r,o),t})).catch((function(e){try{n._pc.removeTrack(t)}catch(e){}throw n._stream.removeTrack(o),e}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;return A.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),a.default.resolve().then((function(){var e=t._pc.getSenders().find((function(e){return e.track===r}));if(!e)throw new Error(\"RTCRtpSender not found\");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()})).then((function(e){return A.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=_.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return A.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;A.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id);var n=e.track;return a.default.resolve().then((function(){var e=r._pc.getSenders().find((function(e){return e.track===n}));if(!e)throw new Error(\"local track not found\");return e.replaceTrack(t)})).then((function(){r._stream.removeTrack(n),r._stream.addTrack(t)}))}},{key:\"restartIce\",value:function(e){var t=this;return A.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),a.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return A.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=_.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};return A.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r),t._pc.setRemoteDescription(r)}))}},{key:\"_setupTransport\",value:function(){var e=this;return A.debug(\"_setupTransport()\"),a.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=_.default.parse(r),o=k.extractDtlsParameters(n);return o.role=\"server\",t.dtlsParameters=o,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}}]),t}(F),U=function(e){function t(e,r){var n;E(this,t),(n=O(this,L(t).call(this,\"recv\",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new o.default;return n._consumerInfos.set(555,{mid:\"fake-dc\",kind:\"application\",closed:!1,cname:null}),n}return j(t,e),D(t,[{key:\"addConsumer\",value:function(e){var t=this;if(A.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return a.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],o=e.rtpParameters.rtcp.cname,i={mid:\"\".concat(e.kind[0]).concat(e.id),kind:e.kind,closed:e.closed,streamId:\"recv-stream-\".concat(e.id),trackId:\"consumer-\".concat(e.kind,\"-\").concat(e.id),ssrc:r.ssrc,cname:o};return r.rtx&&r.rtx.ssrc&&(i.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,i),a.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return A.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return A.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getReceivers().find((function(e){var t=e.track;return!!t&&t.id===i.trackId}));if(!e)throw new Error(\"remote track not found\");return e.track}))}},{key:\"removeConsumer\",value:function(e){var t=this;A.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,a.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return A.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return A.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):a.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return A.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),a.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._consumerInfos.values()))};return A.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e),t._pc.setRemoteDescription(e)})).then((function(){return t._pc.createAnswer()})).then((function(e){return A.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return A.debug(\"_setupTransport()\"),a.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){A.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=_.default.parse(e),r={dtlsParameters:k.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}}]),t}(F),V=function(){function e(t,r,n){var o;switch(E(this,e),A.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r),t){case\"send\":return o={audio:w.getSendingRtpParameters(\"audio\",r),video:w.getSendingRtpParameters(\"video\",r)},new N(o,n);case\"recv\":return o={audio:w.getReceivingFullRtpParameters(\"audio\",r),video:w.getReceivingFullRtpParameters(\"video\",r)},new U(o,n)}}return D(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){A.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"}),t=document.createElement(\"canvas\");t.getContext(\"2d\");var r=t.captureStream(),n=r.getVideoTracks()[0];return e.addTrack(n,r).setParameters({encodings:[{rid:\"RID1\",maxBitrate:4e4},{rid:\"RID2\",maxBitrate:1e4}]}),e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(r){try{t.remove()}catch(e){}try{n.stop()}catch(e){}try{e.close()}catch(e){}var o=_.default.parse(r.sdp);return k.extractRtpCapabilities(o)})).catch((function(r){try{t.remove()}catch(e){}try{n.stop()}catch(e){}try{e.close()}catch(e){}throw r}))}},{key:\"tag\",get:function(){return\"Firefox50\"}}]),e}();t.default=V},function(e,t,r){\"use strict\";var n=m(r(21)),o=m(r(10)),a=m(r(8)),i=m(r(7)),s=m(r(0)),c=m(r(6)),u=m(r(4)),d=m(r(3)),l=m(r(5)),f=m(r(11)),p=m(r(1));function m(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var h=w(r(9)),v=w(r(14)),_=b(r(12)),y=b(r(18)),g=b(r(199));function b(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=p.default&&f.default?(0,f.default)(e,r):{};n.get||n.set?(0,p.default)(t,r,n):t[r]=e[r]}return t.default=e,t}function w(e){return e&&e.__esModule?e:{default:e}}function k(e){return(k=\"function\"==typeof l.default&&\"symbol\"===(0,d.default)(u.default)?function(e){return void 0===e?\"undefined\":(0,d.default)(e)}:function(e){return e&&\"function\"==typeof l.default&&e.constructor===l.default&&e!==l.default.prototype?\"symbol\":void 0===e?\"undefined\":(0,d.default)(e)})(e)}function P(e,t){return!t||\"object\"!==k(t)&&\"function\"!=typeof t?function(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}(e):t}function T(e){return(T=c.default?s.default:function(e){return e.__proto__||(0,s.default)(e)})(e)}function S(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),(0,p.default)(e,n.key,n)}}function R(e,t,r){return t&&S(e.prototype,t),r&&S(e,r),e}function C(e,t){return(C=c.default||function(e,t){return e.__proto__=t,e})(e,t)}var x=\"CNAME-EDGE-\".concat(_.randomNumber()),E=new h.default(\"Edge11\"),I=function(e){function t(e,r,n){var a;return function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,t),a=P(this,T(t).call(this,E)),E.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",e,r),a._rtpParametersByKind={audio:y.getSendingRtpParameters(\"audio\",r),video:y.getSendingRtpParameters(\"video\",r)},a._transportReady=!1,a._iceGatherer=null,a._iceTransport=null,a._dtlsTransport=null,a._rtpSenders=new o.default,a._rtpReceivers=new o.default,a._transportRemoteParameters=null,a._setIceGatherer(n),a._setIceTransport(),a._setDtlsTransport(),a}return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=(0,i.default)(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(t,e),R(t,null,[{key:\"getNativeRtpCapabilities\",value:function(){return E.debug(\"getNativeRtpCapabilities()\"),a.default.resolve(g.getCapabilities())}},{key:\"tag\",get:function(){return\"Edge11\"}}]),R(t,[{key:\"close\",value:function(){E.debug(\"close()\");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}var e=!0,t=!1,r=void 0;try{for(var o,a=(0,n.default)(this._rtpSenders.values());!(e=(o=a.next()).done);e=!0){var i=o.value;try{i.stop()}catch(e){}}}catch(e){t=!0,r=e}finally{try{e||null==a.return||a.return()}finally{if(t)throw r}}var s=!0,c=!1,u=void 0;try{for(var d,l=(0,n.default)(this._rtpReceivers.values());!(s=(d=l.next()).done);s=!0){var f=d.value;try{f.stop()}catch(e){}}}catch(e){c=!0,u=e}finally{try{s||null==l.return||l.return()}finally{if(c)throw u}}}},{key:\"remoteClosed\",value:function(){E.debug(\"remoteClosed()\"),this._transportReady=!1}},{key:\"addProducer\",value:function(e){var t=this,r=e.track;return E.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),this._rtpSenders.has(e.id)?a.default.reject(new Error(\"Producer already added\")):a.default.resolve().then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){E.debug(\"addProducer() | calling new RTCRtpSender()\");var n=new RTCRtpSender(r,t._dtlsTransport),o=_.clone(t._rtpParametersByKind[e.kind]),a={ssrc:_.randomNumber()};o.codecs.some((function(e){return\"rtx\"===e.name}))&&(a.rtx={ssrc:_.randomNumber()}),o.encodings.push(a),o.rtcp={cname:x,reducedSize:!0,mux:!0};var i=g.mangleRtpParameters(o);return E.debug(\"addProducer() | calling rtpSender.send() [params:%o]\",i),n.send(i),t._rtpSenders.set(e.id,n),o}))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;return E.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),a.default.resolve().then((function(){var r=t._rtpSenders.get(e.id);if(!r)throw new Error(\"RTCRtpSender not found\");t._rtpSenders.delete(e.id);try{E.debug(\"removeProducer() | calling rtpSender.stop()\"),r.stop()}catch(e){E.warn(\"rtpSender.stop() failed:%o\",e)}}))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;return E.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id),a.default.resolve().then((function(){var n=r._rtpSenders.get(e.id);if(!n)throw new Error(\"RTCRtpSender not found\");n.setTrack(t)}))}},{key:\"addConsumer\",value:function(e){var t=this;return E.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._rtpReceivers.has(e.id)?a.default.reject(new Error(\"Consumer already added\")):a.default.resolve().then((function(){if(!t._transportReady)return t._setupTransport()})).then((function(){E.debug(\"addConsumer() | calling new RTCRtpReceiver()\");var r=new RTCRtpReceiver(t._dtlsTransport,e.kind);r.addEventListener(\"error\",(function(e){E.error('iceGatherer \"error\" event [event:%o]',e)}));var n=g.mangleRtpParameters(e.rtpParameters);return n.headerExtensions=n.headerExtensions.filter((function(e){return\"urn:ietf:params:rtp-hdrext:sdes:mid\"!==e.uri})),E.debug(\"addConsumer() | calling rtpReceiver.receive() [params:%o]\",n),r.receive(n),t._rtpReceivers.set(e.id,r),r.track}))}},{key:\"removeConsumer\",value:function(e){var t=this;return E.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind),a.default.resolve().then((function(){var r=t._rtpReceivers.get(e.id);if(!r)throw new Error(\"RTCRtpReceiver not found\");t._rtpReceivers.delete(e.id);try{E.debug(\"removeConsumer() | calling rtpReceiver.stop()\"),r.stop()}catch(e){E.warn(\"rtpReceiver.stop() failed:%o\",e)}}))}},{key:\"restartIce\",value:function(e){var t=this;E.debug(\"restartIce()\"),a.default.resolve().then((function(){t._transportRemoteParameters.iceParameters=e;var r=t._transportRemoteParameters.iceCandidates;E.debug(\"restartIce() | calling iceTransport.start()\"),t._iceTransport.start(t._iceGatherer,e,\"controlling\");var o=!0,a=!1,i=void 0;try{for(var s,c=(0,n.default)(r);!(o=(s=c.next()).done);o=!0){var u=s.value;t._iceTransport.addRemoteCandidate(u)}}catch(e){a=!0,i=e}finally{try{o||null==c.return||c.return()}finally{if(a)throw i}}t._iceTransport.addRemoteCandidate({})}))}},{key:\"_setIceGatherer\",value:function(e){var t=new RTCIceGatherer({iceServers:e.turnServers||[],gatherPolicy:e.iceTransportPolicy});t.addEventListener(\"error\",(function(e){E.error('iceGatherer \"error\" event [event:%o]',e)}));try{t.gather()}catch(e){E.debug(\"iceGatherer.gather() failed: %s\",e.toString())}this._iceGatherer=t}},{key:\"_setIceTransport\",value:function(){var e=this,t=new RTCIceTransport(this._iceGatherer);t.addEventListener(\"statechange\",(function(){switch(t.state){case\"checking\":e.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":e.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":e.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":e.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":e.emit(\"@connectionstatechange\",\"closed\")}})),t.addEventListener(\"icestatechange\",(function(){switch(t.state){case\"checking\":e.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":e.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":e.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":e.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":e.emit(\"@connectionstatechange\",\"closed\")}})),t.addEventListener(\"candidatepairchange\",(function(e){E.debug('iceTransport \"candidatepairchange\" event [pair:%o]',e.pair)})),this._iceTransport=t}},{key:\"_setDtlsTransport\",value:function(){var e=this,t=new RTCDtlsTransport(this._iceTransport);t.addEventListener(\"statechange\",(function(){E.debug('dtlsTransport \"statechange\" event [state:%s]',t.state)})),t.addEventListener(\"dtlsstatechange\",(function(){E.debug('dtlsTransport \"dtlsstatechange\" event [state:%s]',t.state),\"closed\"===t.state&&e.emit(\"@connectionstatechange\",\"closed\")})),t.addEventListener(\"error\",(function(e){E.error('dtlsTransport \"error\" event [event:%o]',e)})),this._dtlsTransport=t}},{key:\"_setupTransport\",value:function(){var e=this;return E.debug(\"_setupTransport()\"),a.default.resolve().then((function(){var t={},r=e._dtlsTransport.getLocalParameters();return r.role=\"server\",t.dtlsParameters=r,e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._transportRemoteParameters=t;var r=t.iceParameters,o=t.iceCandidates,a=t.dtlsParameters;e._iceTransport.start(e._iceGatherer,r,\"controlling\");var i=!0,s=!1,c=void 0;try{for(var u,d=(0,n.default)(o);!(i=(u=d.next()).done);i=!0){var l=u.value;e._iceTransport.addRemoteCandidate(l)}}catch(e){s=!0,c=e}finally{try{i||null==d.return||d.return()}finally{if(s)throw c}}e._iceTransport.addRemoteCandidate({}),a.fingerprints=a.fingerprints.filter((function(e){return\"sha-256\"===e.algorithm||\"sha-384\"===e.algorithm||\"sha-512\"===e.algorithm})),e._dtlsTransport.start(a),e._transportReady=!0}))}}]),t}(v.default);t.default=I},function(e,t,r){\"use strict\";var n=i(r(21)),o=i(r(11)),a=i(r(1));function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.getCapabilities=function(){var e=RTCRtpReceiver.getCapabilities(),t=s.clone(e),r=!0,o=!1,a=void 0;try{for(var i,c=(0,n.default)(t.codecs);!(r=(i=c.next()).done);r=!0){var u=i.value;if(u.channels=u.numChannels,delete u.numChannels,\"audio\"!==u.kind?delete u.channels:u.channels||(u.channels=1),u.mimeType=\"\".concat(u.kind,\"/\").concat(u.name),u.parameters){var d=u.parameters;d.apt&&(d.apt=Number(d.apt)),d[\"packetization-mode\"]&&(d[\"packetization-mode\"]=Number(d[\"packetization-mode\"]))}var l=!0,f=!1,p=void 0;try{for(var m,h=(0,n.default)(u.rtcpFeedback||[]);!(l=(m=h.next()).done);l=!0){var v=m.value;v.parameter||delete v.parameter}}catch(e){f=!0,p=e}finally{try{l||null==h.return||h.return()}finally{if(f)throw p}}}}catch(e){o=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return t},t.mangleRtpParameters=function(e){var t=s.clone(e),r=!0,o=!1,a=void 0;try{for(var i,c=(0,n.default)(t.codecs);!(r=(i=c.next()).done);r=!0){var u=i.value;u.channels&&(u.numChannels=u.channels,delete u.channels),delete u.mimeType}}catch(e){o=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return t};var s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=a.default&&o.default?(0,o.default)(e,r):{};n.get||n.set?(0,a.default)(t,r,n):t[r]=e[r]}return t.default=e,t}(r(12))},function(e,t,r){\"use strict\";var n=h(r(20)),o=h(r(10)),a=h(r(8)),i=h(r(25)),s=h(r(7)),c=h(r(0)),u=h(r(6)),d=h(r(4)),l=h(r(3)),f=h(r(5)),p=h(r(11)),m=h(r(1));function h(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var v=S(r(19)),_=S(r(9)),y=S(r(14)),g=T(r(12)),b=T(r(18)),w=T(r(26)),k=T(r(45)),P=S(r(46));function T(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=m.default&&p.default?(0,p.default)(e,r):{};n.get||n.set?(0,m.default)(t,r,n):t[r]=e[r]}return t.default=e,t}function S(e){return e&&e.__esModule?e:{default:e}}function R(e){return(R=\"function\"==typeof f.default&&\"symbol\"===(0,l.default)(d.default)?function(e){return void 0===e?\"undefined\":(0,l.default)(e)}:function(e){return e&&\"function\"==typeof f.default&&e.constructor===f.default&&e!==f.default.prototype?\"symbol\":void 0===e?\"undefined\":(0,l.default)(e)})(e)}function C(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function x(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),(0,m.default)(e,n.key,n)}}function E(e,t,r){return t&&x(e.prototype,t),r&&x(e,r),e}function I(e,t){return!t||\"object\"!==R(t)&&\"function\"!=typeof t?function(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}(e):t}function D(e){return(D=u.default?c.default:function(e){return e.__proto__||(0,c.default)(e)})(e)}function O(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=(0,s.default)(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}function L(e,t){return(L=u.default||function(e,t){return e.__proto__=t,e})(e,t)}var j=new _.default(\"ReactNative\"),M=function(e){function t(e,r,n){var o;return C(this,t),(o=I(this,D(t).call(this,j)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"}),o._rtpParametersByKind=r,o._remoteSdp=new P.default(e,r),o._pc.addEventListener(\"iceconnectionstatechange\",(function(){switch(o._pc.iceConnectionState){case\"checking\":o.emit(\"@connectionstatechange\",\"connecting\");break;case\"connected\":case\"completed\":o.emit(\"@connectionstatechange\",\"connected\");break;case\"failed\":o.emit(\"@connectionstatechange\",\"failed\");break;case\"disconnected\":o.emit(\"@connectionstatechange\",\"disconnected\");break;case\"closed\":o.emit(\"@connectionstatechange\",\"closed\")}})),o}return O(t,e),E(t,[{key:\"close\",value:function(){j.debug(\"close()\");try{this._pc.close()}catch(e){}}},{key:\"remoteClosed\",value:function(){j.debug(\"remoteClosed()\"),this._transportReady=!1,this._transportUpdated&&(this._transportUpdated=!1)}}]),t}(y.default),A=function(e){function t(e,r){var n;return C(this,t),(n=I(this,D(t).call(this,\"send\",e,r)))._transportReady=!1,n._tracks=new i.default,n}return O(t,e),E(t,[{key:\"addProducer\",value:function(e){var t,r,n=this,o=e.track;return j.debug(\"addProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,o.id),this._tracks.has(o)?a.default.reject(new Error(\"track already added\")):o.streamReactTag?a.default.resolve().then((function(){return n._tracks.add(o),(t=new MediaStream(o.streamReactTag)).addTrack(o),n._pc.addStream(t),n._pc.createOffer()})).then((function(t){if(e.simulcast){j.debug(\"addProducer() | enabling simulcast\");var r=v.default.parse(t.sdp);k.addSimulcastForTrack(r,o),t={type:\"offer\",sdp:v.default.write(r)}}j.debug(\"addProducer() | calling pc.setLocalDescription() [offer:%o]\",t);var a=new RTCSessionDescription(t);return n._pc.setLocalDescription(a)})).then((function(){if(!n._transportReady)return n._setupTransport()})).then((function(){r=v.default.parse(n._pc.localDescription.sdp);var e={type:\"answer\",sdp:n._remoteSdp.createAnswerSdp(r)};j.debug(\"addProducer() | calling pc.setRemoteDescription() [answer:%o]\",e);var t=new RTCSessionDescription(e);return n._pc.setRemoteDescription(t)})).then((function(){var t=g.clone(n._rtpParametersByKind[e.kind]);return k.fillRtpParametersForTrack(t,r,o),t})).catch((function(e){throw n._tracks.delete(o),t.removeTrack(o),n._pc.removeStream(t),e})):a.default.reject(new Error(\"no track.streamReactTag property\"))}},{key:\"removeProducer\",value:function(e){var t=this,r=e.track;return j.debug(\"removeProducer() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,r.id),r.streamReactTag?a.default.resolve().then((function(){t._tracks.delete(r);var e=new MediaStream(r.streamReactTag);return e.addTrack(r),t._pc.removeStream(e),t._pc.createOffer()})).then((function(e){return j.debug(\"removeProducer() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).catch((function(e){if(0!==t._tracks.size)throw e;j.warn(\"removeProducer() | ignoring expected error due no sending tracks: %s\",e.toString())})).then((function(){if(\"stable\"!==t._pc.signalingState){var e=v.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};j.debug(\"removeProducer() | calling pc.setRemoteDescription() [answer:%o]\",r);var n=new RTCSessionDescription(r);return t._pc.setRemoteDescription(n)}})):a.default.reject(new Error(\"no track.streamReactTag property\"))}},{key:\"replaceProducerTrack\",value:function(e,t){var r=this;if(j.debug(\"replaceProducerTrack() [id:%s, kind:%s, trackId:%s]\",e.id,e.kind,t.id),!t.streamReactTag)return a.default.reject(new Error(\"no track.streamReactTag property\"));var n,o,i=e.track;return a.default.resolve().then((function(){return r._tracks.add(t),r._tracks.delete(i),(n=new MediaStream(t.streamReactTag)).addTrack(t),n.removeTrack(i),r._pc.addStream(n),r._pc.createOffer()})).then((function(n){if(e.simulcast){j.debug(\"addProducer() | enabling simulcast\");var o=v.default.parse(n.sdp);k.addSimulcastForTrack(o,t),n={type:\"offer\",sdp:v.default.write(o)}}j.debug(\"replaceProducerTrack() | calling pc.setLocalDescription() [offer:%o]\",n);var a=new RTCSessionDescription(n);return r._pc.setLocalDescription(a)})).then((function(){o=v.default.parse(r._pc.localDescription.sdp);var e={type:\"answer\",sdp:r._remoteSdp.createAnswerSdp(o)};j.debug(\"replaceProducerTrack() | calling pc.setRemoteDescription() [answer:%o]\",e);var t=new RTCSessionDescription(e);return r._pc.setRemoteDescription(t)})).then((function(){var n=g.clone(r._rtpParametersByKind[e.kind]);k.fillRtpParametersForTrack(n,o,t),r.safeEmit(\"@needupdateproducer\",e,n)})).catch((function(e){throw r._tracks.delete(t),n.removeTrack(t),r._pc.addStream(n),e}))}},{key:\"restartIce\",value:function(e){var t=this;return j.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),a.default.resolve().then((function(){return t._pc.createOffer({iceRestart:!0})})).then((function(e){return j.debug(\"restartIce() | calling pc.setLocalDescription() [offer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){var e=v.default.parse(t._pc.localDescription.sdp),r={type:\"answer\",sdp:t._remoteSdp.createAnswerSdp(e)};j.debug(\"restartIce() | calling pc.setRemoteDescription() [answer:%o]\",r);var n=new RTCSessionDescription(r);return t._pc.setRemoteDescription(n)}))}},{key:\"_setupTransport\",value:function(){var e=this;return j.debug(\"_setupTransport()\"),a.default.resolve().then((function(){var t={},r=e._pc.localDescription.sdp,n=v.default.parse(r),o=w.extractDtlsParameters(n);return o.role=\"server\",t.dtlsParameters=o,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise(\"@needcreatetransport\",t)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0}))}}]),t}(M),F=function(e){function t(e,r){var n;return C(this,t),(n=I(this,D(t).call(this,\"recv\",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._kinds=new i.default,n._consumerInfos=new o.default,n}return O(t,e),E(t,[{key:\"addConsumer\",value:function(e){var t=this;if(j.debug(\"addConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id))return a.default.reject(new Error(\"Consumer already added\"));var r=e.rtpParameters.encodings[0],o=e.rtpParameters.rtcp.cname,i={kind:e.kind,streamId:\"recv-stream-\".concat(e.id),trackId:\"consumer-\".concat(e.kind,\"-\").concat(e.id),ssrc:r.ssrc,cname:o};return r.rtx&&r.rtx.ssrc&&(i.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,i),this._kinds.add(e.kind),a.default.resolve().then((function(){if(!t._transportCreated)return t._setupTransport()})).then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};j.debug(\"addConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e);var r=new RTCSessionDescription(e);return t._pc.setRemoteDescription(r)})).then((function(){return t._pc.createAnswer()})).then((function(e){return j.debug(\"addConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)})).then((function(){if(!t._transportUpdated)return t._updateTransport()})).then((function(){var e=t._pc.getRemoteStreams().find((function(e){return e.id===i.streamId})),r=e.getTrackById(i.trackId);if(r.streamReactTag=e.reactTag,!r)throw new Error(\"remote track not found\");return r}))}},{key:\"removeConsumer\",value:function(e){var t=this;return j.debug(\"removeConsumer() [id:%s, kind:%s]\",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),a.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};j.debug(\"removeConsumer() | calling pc.setRemoteDescription() [offer:%o]\",e);var r=new RTCSessionDescription(e);return t._pc.setRemoteDescription(r)})).then((function(){return t._pc.createAnswer()})).then((function(e){return j.debug(\"removeConsumer() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))):a.default.reject(new Error(\"Consumer not found\"))}},{key:\"restartIce\",value:function(e){var t=this;return j.debug(\"restartIce()\"),this._remoteSdp.updateTransportRemoteIceParameters(e),a.default.resolve().then((function(){var e={type:\"offer\",sdp:t._remoteSdp.createOfferSdp((0,n.default)(t._kinds),(0,n.default)(t._consumerInfos.values()))};j.debug(\"restartIce() | calling pc.setRemoteDescription() [offer:%o]\",e);var r=new RTCSessionDescription(e);return t._pc.setRemoteDescription(r)})).then((function(){return t._pc.createAnswer()})).then((function(e){return j.debug(\"restartIce() | calling pc.setLocalDescription() [answer:%o]\",e),t._pc.setLocalDescription(e)}))}},{key:\"_setupTransport\",value:function(){var e=this;return j.debug(\"_setupTransport()\"),a.default.resolve().then((function(){return e.safeEmitAsPromise(\"@needcreatetransport\",null)})).then((function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0}))}},{key:\"_updateTransport\",value:function(){j.debug(\"_updateTransport()\");var e=this._pc.localDescription.sdp,t=v.default.parse(e),r={dtlsParameters:w.extractDtlsParameters(t)};this.safeEmit(\"@needupdatetransport\",r),this._transportUpdated=!0}}]),t}(M),N=function(){function e(t,r,n){var o;switch(C(this,e),j.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",t,r),t){case\"send\":return o={audio:b.getSendingRtpParameters(\"audio\",r),video:b.getSendingRtpParameters(\"video\",r)},new A(o,n);case\"recv\":return o={audio:b.getReceivingFullRtpParameters(\"audio\",r),video:b.getReceivingFullRtpParameters(\"video\",r)},new F(o,n)}}return E(e,null,[{key:\"getNativeRtpCapabilities\",value:function(){j.debug(\"getNativeRtpCapabilities()\");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:\"all\",bundlePolicy:\"max-bundle\",rtcpMuxPolicy:\"require\"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(t){try{e.close()}catch(e){}var r=v.default.parse(t.sdp);return w.extractRtpCapabilities(r)})).catch((function(t){try{e.close()}catch(e){}throw t}))}},{key:\"tag\",get:function(){return\"ReactNative\"}}]),e}();t.default=N},function(e,t,r){\"use strict\";var n=v(r(20)),o=v(r(86)),a=v(r(21)),i=v(r(8)),s=v(r(10)),c=v(r(7)),u=v(r(0)),d=v(r(6)),l=v(r(4)),f=v(r(3)),p=v(r(5)),m=v(r(11)),h=v(r(1));function v(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var _=R(r(9)),y=R(r(14)),g=r(56),b=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=h.default&&m.default?(0,m.default)(e,r):{};n.get||n.set?(0,h.default)(t,r,n):t[r]=e[r]}return t.default=e,t}(r(18)),w=R(r(84)),k=R(r(209)),P=R(r(211)),T=R(r(212)),S=R(r(213));function R(e){return e&&e.__esModule?e:{default:e}}function C(e){return(C=\"function\"==typeof p.default&&\"symbol\"===(0,f.default)(l.default)?function(e){return void 0===e?\"undefined\":(0,f.default)(e)}:function(e){return e&&\"function\"==typeof p.default&&e.constructor===p.default&&e!==p.default.prototype?\"symbol\":void 0===e?\"undefined\":(0,f.default)(e)})(e)}function x(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),(0,h.default)(e,n.key,n)}}function E(e,t){return!t||\"object\"!==C(t)&&\"function\"!=typeof t?function(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}(e):t}function I(e){return(I=d.default?u.default:function(e){return e.__proto__||(0,u.default)(e)})(e)}function D(e,t){return(D=d.default||function(e,t){return e.__proto__=t,e})(e,t)}var O=new _.default(\"Room\"),L=\"new\",j=\"joining\",M=\"joined\",A=\"closed\",F=function(e){function t(e){var r;if(function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,t),r=E(this,I(t).call(this,O)),O.debug(\"constructor() [options:%o]\",e),!w.default.isSupported())throw new Error(\"current browser/device not supported\");return e=e||{},r._settings={roomSettings:e.roomSettings,requestTimeout:e.requestTimeout||3e4,transportOptions:e.transportOptions||{},turnServers:e.turnServers||[],iceTransportPolicy:e.iceTransportPolicy||\"all\",spy:Boolean(e.spy)},r._state=L,r._peerName=null,r._transports=new s.default,r._producers=new s.default,r._peers=new s.default,r._extendedRtpCapabilities=null,r._canSendByKind={audio:!1,video:!1},r}var r,u,d;return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=(0,c.default)(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&D(e,t)}(t,e),r=t,(u=[{key:\"getTransportById\",value:function(e){return this._transports.get(e)}},{key:\"getProducerById\",value:function(e){return this._producers.get(e)}},{key:\"getPeerByName\",value:function(e){return this._peers.get(e)}},{key:\"join\",value:function(e,t){var r,n=this;return O.debug('join() [peerName:\"%s\"]',e),\"string\"!=typeof e?i.default.reject(new TypeError(\"invalid peerName\")):this._state!==L&&this._state!==A?i.default.reject(new g.InvalidStateError('invalid state \"'.concat(this._state,'\"'))):(this._peerName=e,this._state=j,i.default.resolve().then((function(){return n._settings.roomSettings?void(r=n._settings.roomSettings):n._sendRequest(\"queryRoom\",{target:\"room\"}).then((function(e){r=e,O.debug(\"join() | got Room settings:%o\",r)}))})).then((function(){return w.default.Handler.getNativeRtpCapabilities()})).then((function(e){O.debug(\"join() | native RTP capabilities:%o\",e),n._extendedRtpCapabilities=b.getExtendedRtpCapabilities(e,r.rtpCapabilities),O.debug(\"join() | extended RTP capabilities:%o\",n._extendedRtpCapabilities);var o=b.getUnsupportedCodecs(r.rtpCapabilities,r.mandatoryCodecPayloadTypes,n._extendedRtpCapabilities);if(o.length>0)throw O.error(\"%s mandatory room codecs not supported:%o\",o.length,o),new g.UnsupportedError(\"mandatory room codecs not supported\",o);n._canSendByKind.audio=b.canSend(\"audio\",n._extendedRtpCapabilities),n._canSendByKind.video=b.canSend(\"video\",n._extendedRtpCapabilities);var a=b.getRtpCapabilities(n._extendedRtpCapabilities);O.debug(\"join() | effective local RTP capabilities for receiving:%o\",a);var i={target:\"room\",peerName:n._peerName,rtpCapabilities:a,spy:n._settings.spy,appData:t};return n._sendRequest(\"join\",i).then((function(e){return e.peers}))})).then((function(e){var t=!0,r=!1,o=void 0;try{for(var i,s=(0,a.default)(e||[]);!(t=(i=s.next()).done);t=!0){var c=i.value;try{n._handlePeerData(c)}catch(e){O.error(\"join() | error handling Peer:%o\",e)}}}catch(e){r=!0,o=e}finally{try{t||null==s.return||s.return()}finally{if(r)throw o}}return n._state=M,O.debug(\"join() | joined the Room\"),n.peers})).catch((function(e){throw n._state=L,e})))}},{key:\"leave\",value:function(e){if(O.debug(\"leave()\"),!this.closed){this._sendNotification(\"leave\",{appData:e}),this._state=A,this.safeEmit(\"close\",\"local\",e);var t=!0,r=!1,n=void 0;try{for(var o,i=(0,a.default)(this._transports.values());!(t=(o=i.next()).done);t=!0)o.value.close()}catch(e){r=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}var s=!0,c=!1,u=void 0;try{for(var d,l=(0,a.default)(this._producers.values());!(s=(d=l.next()).done);s=!0)d.value.close()}catch(e){c=!0,u=e}finally{try{s||null==l.return||l.return()}finally{if(c)throw u}}var f=!0,p=!1,m=void 0;try{for(var h,v=(0,a.default)(this._peers.values());!(f=(h=v.next()).done);f=!0)h.value.close()}catch(e){p=!0,m=e}finally{try{f||null==v.return||v.return()}finally{if(p)throw m}}}}},{key:\"remoteClose\",value:function(e){if(O.debug(\"remoteClose()\"),!this.closed){this._state=A,this.safeEmit(\"close\",\"remote\",e);var t=!0,r=!1,n=void 0;try{for(var o,i=(0,a.default)(this._transports.values());!(t=(o=i.next()).done);t=!0)o.value.remoteClose(null,{destroy:!0})}catch(e){r=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}var s=!0,c=!1,u=void 0;try{for(var d,l=(0,a.default)(this._producers.values());!(s=(d=l.next()).done);s=!0)d.value.remoteClose()}catch(e){c=!0,u=e}finally{try{s||null==l.return||l.return()}finally{if(c)throw u}}var f=!0,p=!1,m=void 0;try{for(var h,v=(0,a.default)(this._peers.values());!(f=(h=v.next()).done);f=!0)h.value.remoteClose()}catch(e){p=!0,m=e}finally{try{f||null==v.return||v.return()}finally{if(p)throw m}}}}},{key:\"canSend\",value:function(e){if(\"audio\"!==e&&\"video\"!==e)throw new TypeError('invalid kind \"'.concat(e,'\"'));return!(!this.joined||this._settings.spy)&&this._canSendByKind[e]}},{key:\"createTransport\",value:function(e,t){var r=this;if(O.debug(\"createTransport() [direction:%s]\",e),!this.joined)throw new g.InvalidStateError('invalid state \"'.concat(this._state,'\"'));if(\"send\"!==e&&\"recv\"!==e)throw new TypeError('invalid direction \"'.concat(e,'\"'));if(\"send\"===e&&this._settings.spy)throw new TypeError(\"a spy peer cannot send media to the room\");var n=new k.default(e,this._extendedRtpCapabilities,this._settings,t);return this._transports.set(n.id,n),n.on(\"@request\",(function(e,t,n,o){r._sendRequest(e,t).then(n).catch(o)})),n.on(\"@notify\",(function(e,t){r._sendNotification(e,t)})),n.on(\"@close\",(function(){r._transports.delete(n.id)})),n}},{key:\"createProducer\",value:function(e,t,r){var n=this;if(O.debug(\"createProducer() [track:%o, options:%o]\",e,t),!this.joined)throw new g.InvalidStateError('invalid state \"'.concat(this._state,'\"'));if(this._settings.spy)throw new Error(\"a spy peer cannot send media to the room\");if(!e)throw new TypeError(\"no track given\");if(!this._canSendByKind[e.kind])throw new Error(\"cannot send \".concat(e.kind));if(\"ended\"===e.readyState)throw new Error('track.readyState is \"ended\"');t=t||{};var o=new P.default(e,t,r);return this._producers.set(o.id,o),o.on(\"@close\",(function(){n._producers.delete(o.id)})),o}},{key:\"restartIce\",value:function(){if(this.joined){var e=!0,t=!1,r=void 0;try{for(var n,o=(0,a.default)(this._transports.values());!(e=(n=o.next()).done);e=!0)n.value.restartIce()}catch(e){t=!0,r=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw r}}}else O.warn('restartIce() | invalid state \"'.concat(this._state,'\"'))}},{key:\"receiveNotification\",value:function(e){var t=this;if(this.closed)return i.default.reject(new g.InvalidStateError(\"Room closed\"));if(\"object\"!==C(e))return i.default.reject(new TypeError(\"wrong notification Object\"));if(!0!==e.notification)return i.default.reject(new TypeError(\"not a notification\"));if(\"string\"!=typeof e.method)return i.default.reject(new TypeError(\"wrong/missing notification method\"));var r=e.method;return O.debug(\"receiveNotification() [method:%s, notification:%o]\",r,e),i.default.resolve().then((function(){switch(r){case\"closed\":var n=e.appData;t.remoteClose(n);break;case\"transportClosed\":var o=e.id,a=e.appData,i=t._transports.get(o);if(!i)throw new Error('Transport not found [id:\"'.concat(o,'\"]'));i.remoteClose(a,{destroy:!1});break;case\"transportStats\":var s=e.id,c=e.stats,u=t._transports.get(s);if(!u)throw new Error(\"Transport not found [id:\".concat(s,\"]\"));u.remoteStats(c);break;case\"newPeer\":var d=e.name;if(t._peers.has(d))throw new Error('Peer already exists [name:\"'.concat(d,'\"]'));var l=e;t._handlePeerData(l);break;case\"peerClosed\":var f=e.name,p=e.appData,m=t._peers.get(f);if(!m)throw new Error('no Peer found [name:\"'.concat(f,'\"]'));m.remoteClose(p);break;case\"producerPaused\":var h=e.id,v=e.appData,_=t._producers.get(h);if(!_)throw new Error(\"Producer not found [id:\".concat(h,\"]\"));_.remotePause(v);break;case\"producerResumed\":var y=e.id,g=e.appData,b=t._producers.get(y);if(!b)throw new Error(\"Producer not found [id:\".concat(y,\"]\"));b.remoteResume(g);break;case\"producerClosed\":var w=e.id,k=e.appData,P=t._producers.get(w);if(!P)throw new Error(\"Producer not found [id:\".concat(w,\"]\"));P.remoteClose(k);break;case\"producerStats\":var T=e.id,S=e.stats,R=t._producers.get(T);if(!R)throw new Error(\"Producer not found [id:\".concat(T,\"]\"));R.remoteStats(S);break;case\"newConsumer\":var C=e.peerName,x=t._peers.get(C);if(!x)throw new Error('no Peer found [name:\"'.concat(C,'\"]'));var E=e;t._handleConsumerData(E,x);break;case\"consumerClosed\":var I=e.id,D=e.peerName,O=e.appData,L=t._peers.get(D);if(!L)throw new Error('no Peer found [name:\"'.concat(D,'\"]'));var j=L.getConsumerById(I);if(!j)throw new Error(\"Consumer not found [id:\".concat(I,\"]\"));j.remoteClose(O);break;case\"consumerPaused\":var M=e.id,A=e.peerName,F=e.appData,N=t._peers.get(A);if(!N)throw new Error('no Peer found [name:\"'.concat(A,'\"]'));var U=N.getConsumerById(M);if(!U)throw new Error(\"Consumer not found [id:\".concat(M,\"]\"));U.remotePause(F);break;case\"consumerResumed\":var V=e.id,B=e.peerName,G=e.appData,W=t._peers.get(B);if(!W)throw new Error('no Peer found [name:\"'.concat(B,'\"]'));var q=W.getConsumerById(V);if(!q)throw new Error(\"Consumer not found [id:\".concat(V,\"]\"));q.remoteResume(G);break;case\"consumerPreferredProfileSet\":var z=e.id,K=e.peerName,H=e.profile,J=t._peers.get(K);if(!J)throw new Error('no Peer found [name:\"'.concat(K,'\"]'));var Y=J.getConsumerById(z);if(!Y)throw new Error(\"Consumer not found [id:\".concat(z,\"]\"));Y.remoteSetPreferredProfile(H);break;case\"consumerEffectiveProfileChanged\":var Q=e.id,$=e.peerName,Z=e.profile,X=t._peers.get($);if(!X)throw new Error('no Peer found [name:\"'.concat($,'\"]'));var ee=X.getConsumerById(Q);if(!ee)throw new Error(\"Consumer not found [id:\".concat(Q,\"]\"));ee.remoteEffectiveProfileChanged(Z);break;case\"consumerStats\":var te=e.id,re=e.peerName,ne=e.stats,oe=t._peers.get(re);if(!oe)throw new Error('no Peer found [name:\"'.concat(re,'\"]'));var ae=oe.getConsumerById(te);if(!ae)throw new Error(\"Consumer not found [id:\".concat(te,\"]\"));ae.remoteStats(ne);break;default:throw new Error('unknown notification method \"'.concat(r,'\"'))}})).catch((function(t){O.error(\"receiveNotification() failed [notification:%o]: %s\",e,t)}))}},{key:\"_sendRequest\",value:function(e,t){var r=this,n=(0,o.default)({method:e,target:\"peer\"},t);return this.closed?(O.error(\"_sendRequest() | Room closed [method:%s, request:%o]\",e,n),i.default.reject(new g.InvalidStateError(\"Room closed\"))):(O.debug(\"_sendRequest() [method:%s, request:%o]\",e,n),new i.default((function(t,o){var a=!1,i=setTimeout((function(){O.error(\"request failed [method:%s]: timeout\",e),a=!0,o(new g.TimeoutError(\"timeout\"))}),r._settings.requestTimeout);r.safeEmit(\"request\",n,(function(n){if(!a){if(a=!0,clearTimeout(i),r.closed)return O.error(\"request failed [method:%s]: Room closed\",e),void o(new Error(\"Room closed\"));O.debug(\"request succeeded [method:%s, response:%o]\",e,n),t(n)}}),(function(t){if(!a){if(a=!0,clearTimeout(i),r.closed)return O.error(\"request failed [method:%s]: Room closed\",e),void o(new Error(\"Room closed\"));t instanceof Error||(t=new Error(String(t))),O.error(\"request failed [method:%s]:%o\",e,t),o(t)}}))})))}},{key:\"_sendNotification\",value:function(e,t){if(!this.closed){var r=(0,o.default)({method:e,target:\"peer\",notification:!0},t);O.debug(\"_sendNotification() [method:%s, notification:%o]\",e,r),this.safeEmit(\"notify\",r)}}},{key:\"_handlePeerData\",value:function(e){var t=this,r=e.name,n=e.consumers,o=e.appData,i=new T.default(r,o);this._peers.set(i.name,i),i.on(\"@close\",(function(){t._peers.delete(i.name)}));var s=!0,c=!1,u=void 0;try{for(var d,l=(0,a.default)(n);!(s=(d=l.next()).done);s=!0){var f=d.value;try{this._handleConsumerData(f,i)}catch(e){O.error(\"error handling existing Consumer in Peer:%o\",e)}}}catch(e){c=!0,u=e}finally{try{s||null==l.return||l.return()}finally{if(c)throw u}}this.joined&&this.safeEmit(\"newpeer\",i)}},{key:\"_handleConsumerData\",value:function(e,t){var r=e.id,n=e.kind,o=e.rtpParameters,a=e.paused,i=e.appData,s=new S.default(r,n,o,t,i);b.canReceive(s.rtpParameters,this._extendedRtpCapabilities)&&s.setSupported(!0),a&&s.remotePause(),t.addConsumer(s)}},{key:\"joined\",get:function(){return this._state===M}},{key:\"closed\",get:function(){return this._state===A}},{key:\"peerName\",get:function(){return this._peerName}},{key:\"transports\",get:function(){return(0,n.default)(this._transports.values())}},{key:\"producers\",get:function(){return(0,n.default)(this._producers.values())}},{key:\"peers\",get:function(){return(0,n.default)(this._peers.values())}}])&&x(r.prototype,u),d&&x(r,d),t}(y.default);t.default=F},function(e,t,r){r(203),e.exports=r(2).Object.assign},function(e,t,r){var n=r(13);n(n.S+n.F,\"Object\",{assign:r(204)})},function(e,t,r){\"use strict\";var n=r(24),o=r(51),a=r(76),i=r(62),s=r(36),c=r(72),u=Object.assign;e.exports=!u||r(32)((function(){var e={},t={},r=Symbol(),n=\"abcdefghijklmnopqrst\";return e[r]=7,n.split(\"\").forEach((function(e){t[e]=e})),7!=u({},e)[r]||Object.keys(u({},t)).join(\"\")!=n}))?function(e,t){for(var r=s(e),u=arguments.length,d=1,l=a.f,f=i.f;u>d;)for(var p,m=c(arguments[d++]),h=l?o(m).concat(l(m)):o(m),v=h.length,_=0;v>_;)p=h[_++],n&&!f.call(m,p)||(r[p]=m[p]);return r}:u},function(e,t,r){e.exports={default:r(206),__esModule:!0}},function(e,t,r){r(207),e.exports=r(2).Reflect.construct},function(e,t,r){var n=r(13),o=r(50),a=r(38),i=r(23),s=r(16),c=r(32),u=r(208),d=(r(15).Reflect||{}).construct,l=c((function(){function e(){}return!(d((function(){}),[],e)instanceof e)})),f=!c((function(){d((function(){}))}));n(n.S+n.F*(l||f),\"Reflect\",{construct:function(e,t){a(e),i(t);var r=arguments.length<3?e:a(arguments[2]);if(f&&!l)return d(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return n.push.apply(n,t),new(u.apply(e,n))}var c=r.prototype,p=o(s(c)?c:Object.prototype),m=Function.apply.call(e,p,t);return s(m)?m:p}})},function(e,t,r){\"use strict\";var n=r(38),o=r(16),a=r(101),i=[].slice,s={},c=function(e,t,r){if(!(t in s)){for(var n=[],o=0;o<t;o++)n[o]=\"a[\"+o+\"]\";s[t]=Function(\"F,a\",\"return new F(\"+n.join(\",\")+\")\")}return s[t](e,r)};e.exports=Function.bind||function(e){var t=n(this),r=i.call(arguments,1),s=function(){var n=r.concat(i.call(arguments));return this instanceof s?c(t,n.length,n):a(t,n,e)};return o(t.prototype)&&(s.prototype=t.prototype),s}},function(e,t,r){\"use strict\";var n=f(r(8)),o=f(r(7)),a=f(r(0)),i=f(r(6)),s=f(r(4)),c=f(r(3)),u=f(r(5)),d=f(r(11)),l=f(r(1));function f(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var p=g(r(9)),m=g(r(14)),h=r(56),v=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=l.default&&d.default?(0,d.default)(e,r):{};n.get||n.set?(0,l.default)(t,r,n):t[r]=e[r]}return t.default=e,t}(r(12)),_=g(r(84)),y=g(r(210));function g(e){return e&&e.__esModule?e:{default:e}}function b(e){return(b=\"function\"==typeof u.default&&\"symbol\"===(0,c.default)(s.default)?function(e){return void 0===e?\"undefined\":(0,c.default)(e)}:function(e){return e&&\"function\"==typeof u.default&&e.constructor===u.default&&e!==u.default.prototype?\"symbol\":void 0===e?\"undefined\":(0,c.default)(e)})(e)}function w(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),(0,l.default)(e,n.key,n)}}function k(e){return(k=i.default?a.default:function(e){return e.__proto__||(0,a.default)(e)})(e)}function P(e,t){return(P=i.default||function(e,t){return e.__proto__=t,e})(e,t)}function T(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}var S=new p.default(\"Transport\"),R=function(e){function t(e,r,n,o){var a;return function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,t),a=function(e,t){return!t||\"object\"!==b(t)&&\"function\"!=typeof t?T(e):t}(this,k(t).call(this,S)),S.debug(\"constructor() [direction:%s, extendedRtpCapabilities:%o]\",e,r),a._id=v.randomNumber(),a._closed=!1,a._direction=e,a._settings=n,a._appData=o,a._statsEnabled=!1,a._commandQueue=new y.default,a._handler=new _.default.Handler(e,r,n),a._connectionState=\"new\",a._commandQueue.on(\"exec\",a._execCommand.bind(T(T(a)))),a._handleHandler(),a}var r,a,i;return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=(0,o.default)(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(t,e),r=t,(a=[{key:\"close\",value:function(e){S.debug(\"close()\"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.disableStats()),this.safeEmit(\"@notify\",\"closeTransport\",{id:this._id,appData:e}),this.emit(\"@close\"),this.safeEmit(\"close\",\"local\",e),this._destroy())}},{key:\"remoteClose\",value:function(e,t){var r=t.destroy;S.debug(\"remoteClose() [destroy:%s]\",r),this._closed||(r?(this._closed=!0,this.emit(\"@close\"),this.safeEmit(\"close\",\"remote\",e),this._destroy()):this._handler.remoteClosed())}},{key:\"_destroy\",value:function(){this._commandQueue.close(),this._handler.close()}},{key:\"restartIce\",value:function(){var e=this;S.debug(\"restartIce()\"),this._closed||\"new\"!==this._connectionState&&n.default.resolve().then((function(){var t={id:e._id};return e.safeEmitAsPromise(\"@request\",\"restartTransport\",t)})).then((function(t){var r=t.iceParameters;return e._commandQueue.push(\"restartIce\",{remoteIceParameters:r})})).catch((function(e){S.error(\"restartIce() | failed: %o\",e)}))}},{key:\"enableStats\",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;S.debug(\"enableStats() [interval:%s]\",e),(\"number\"!=typeof e||e<1e3)&&(e=1e3),this._statsEnabled=!0;var t={id:this._id,interval:e};this.safeEmit(\"@notify\",\"enableTransportStats\",t)}},{key:\"disableStats\",value:function(){S.debug(\"disableStats()\"),this._statsEnabled=!1;var e={id:this._id};this.safeEmit(\"@notify\",\"disableTransportStats\",e)}},{key:\"_handleHandler\",value:function(){var e=this,t=this._handler;t.on(\"@connectionstatechange\",(function(t){e._connectionState!==t&&(S.debug(\"Transport connection state changed to %s\",t),e._connectionState=t,e._closed||e.safeEmit(\"connectionstatechange\",t))})),t.on(\"@needcreatetransport\",(function(t,r,n){var o={id:e._id,direction:e._direction,options:e._settings.transportOptions,appData:e._appData};t&&(t.dtlsParameters?o.dtlsParameters=t.dtlsParameters:t.plainRtpParameters&&(o.plainRtpParameters=t.plainRtpParameters)),e.safeEmit(\"@request\",\"createTransport\",o,r,n)})),t.on(\"@needupdatetransport\",(function(t){var r={id:e._id};t&&(t.dtlsParameters?r.dtlsParameters=t.dtlsParameters:t.plainRtpParameters&&(r.plainRtpParameters=t.plainRtpParameters)),e.safeEmit(\"@notify\",\"updateTransport\",r)})),t.on(\"@needupdateproducer\",(function(t,r){var n={id:t.id,rtpParameters:r};t.setRtpParameters(r),e.safeEmit(\"@notify\",\"updateProducer\",n)}))}},{key:\"addProducer\",value:function(e){return S.debug(\"addProducer() [producer:%o]\",e),this._closed?n.default.reject(new h.InvalidStateError(\"Transport closed\")):\"send\"!==this._direction?n.default.reject(new Error(\"not a sending Transport\")):this._commandQueue.push(\"addProducer\",{producer:e})}},{key:\"removeProducer\",value:function(e,t,r){S.debug(\"removeProducer() [producer:%o]\",e),this._closed||this._commandQueue.push(\"removeProducer\",{producer:e}).catch((function(){})),\"local\"===t&&this.safeEmit(\"@notify\",\"closeProducer\",{id:e.id,appData:r})}},{key:\"pauseProducer\",value:function(e,t){S.debug(\"pauseProducer() [producer:%o]\",e);var r={id:e.id,appData:t};this.safeEmit(\"@notify\",\"pauseProducer\",r)}},{key:\"resumeProducer\",value:function(e,t){S.debug(\"resumeProducer() [producer:%o]\",e);var r={id:e.id,appData:t};this.safeEmit(\"@notify\",\"resumeProducer\",r)}},{key:\"replaceProducerTrack\",value:function(e,t){return S.debug(\"replaceProducerTrack() [producer:%o]\",e),this._commandQueue.push(\"replaceProducerTrack\",{producer:e,track:t})}},{key:\"enableProducerStats\",value:function(e,t){S.debug(\"enableProducerStats() [producer:%o]\",e);var r={id:e.id,interval:t};this.safeEmit(\"@notify\",\"enableProducerStats\",r)}},{key:\"disableProducerStats\",value:function(e){S.debug(\"disableProducerStats() [producer:%o]\",e);var t={id:e.id};this.safeEmit(\"@notify\",\"disableProducerStats\",t)}},{key:\"addConsumer\",value:function(e){return S.debug(\"addConsumer() [consumer:%o]\",e),this._closed?n.default.reject(new h.InvalidStateError(\"Transport closed\")):\"recv\"!==this._direction?n.default.reject(new Error(\"not a receiving Transport\")):this._commandQueue.push(\"addConsumer\",{consumer:e})}},{key:\"removeConsumer\",value:function(e){S.debug(\"removeConsumer() [consumer:%o]\",e),this._commandQueue.push(\"removeConsumer\",{consumer:e}).catch((function(){}))}},{key:\"pauseConsumer\",value:function(e,t){S.debug(\"pauseConsumer() [consumer:%o]\",e);var r={id:e.id,appData:t};this.safeEmit(\"@notify\",\"pauseConsumer\",r)}},{key:\"resumeConsumer\",value:function(e,t){S.debug(\"resumeConsumer() [consumer:%o]\",e);var r={id:e.id,appData:t};this.safeEmit(\"@notify\",\"resumeConsumer\",r)}},{key:\"setConsumerPreferredProfile\",value:function(e,t){S.debug(\"setConsumerPreferredProfile() [consumer:%o]\",e);var r={id:e.id,profile:t};this.safeEmit(\"@notify\",\"setConsumerPreferredProfile\",r)}},{key:\"enableConsumerStats\",value:function(e,t){S.debug(\"enableConsumerStats() [consumer:%o]\",e);var r={id:e.id,interval:t};this.safeEmit(\"@notify\",\"enableConsumerStats\",r)}},{key:\"disableConsumerStats\",value:function(e){S.debug(\"disableConsumerStats() [consumer:%o]\",e);var t={id:e.id};this.safeEmit(\"@notify\",\"disableConsumerStats\",t)}},{key:\"remoteStats\",value:function(e){this.safeEmit(\"stats\",e)}},{key:\"getStats\",value:function(e){return this._handler.getPCStats(e)}},{key:\"_execCommand\",value:function(e,t){var r;try{switch(e.method){case\"addProducer\":var o=e.producer;r=this._execAddProducer(o);break;case\"removeProducer\":var a=e.producer;r=this._execRemoveProducer(a);break;case\"replaceProducerTrack\":var i=e.producer,s=e.track;r=this._execReplaceProducerTrack(i,s);break;case\"addConsumer\":var c=e.consumer;r=this._execAddConsumer(c);break;case\"removeConsumer\":var u=e.consumer;r=this._execRemoveConsumer(u);break;case\"restartIce\":var d=e.remoteIceParameters;r=this._execRestartIce(d);break;default:r=n.default.reject(new Error('unknown command method \"'.concat(e.method,'\"')))}}catch(e){r=n.default.reject(e)}t.promise=r}},{key:\"_execAddProducer\",value:function(e){var t,r=this;return S.debug(\"_execAddProducer()\"),n.default.resolve().then((function(){return r._handler.addProducer(e)})).then((function(n){t=n;var o={id:e.id,kind:e.kind,transportId:r._id,rtpParameters:n,paused:e.locallyPaused,appData:e.appData};return r.safeEmitAsPromise(\"@request\",\"createProducer\",o)})).then((function(){e.setRtpParameters(t)}))}},{key:\"_execRemoveProducer\",value:function(e){return S.debug(\"_execRemoveProducer()\"),this._handler.removeProducer(e)}},{key:\"_execReplaceProducerTrack\",value:function(e,t){return S.debug(\"_execReplaceProducerTrack()\"),this._handler.replaceProducerTrack(e,t)}},{key:\"_execAddConsumer\",value:function(e){var t,r=this;return S.debug(\"_execAddConsumer()\"),n.default.resolve().then((function(){return r._handler.addConsumer(e)})).then((function(n){t=n;var o={id:e.id,transportId:r.id,paused:e.locallyPaused,preferredProfile:e.preferredProfile};return r.safeEmitAsPromise(\"@request\",\"enableConsumer\",o)})).then((function(r){var n=r.paused,o=r.preferredProfile,a=r.effectiveProfile;return n&&e.remotePause(),o&&e.remoteSetPreferredProfile(o),a&&e.remoteEffectiveProfileChanged(a),t}))}},{key:\"_execRemoveConsumer\",value:function(e){return S.debug(\"_execRemoveConsumer()\"),this._handler.removeConsumer(e)}},{key:\"_execRestartIce\",value:function(e){return S.debug(\"_execRestartIce()\"),this._handler.restartIce(e)}},{key:\"id\",get:function(){return this._id}},{key:\"closed\",get:function(){return this._closed}},{key:\"direction\",get:function(){return this._direction}},{key:\"appData\",get:function(){return this._appData}},{key:\"connectionState\",get:function(){return this._connectionState}},{key:\"handler\",get:function(){return this._handler}}])&&w(r.prototype,a),i&&w(r,i),t}(m.default);t.default=R},function(e,t,r){\"use strict\";var n=f(r(8)),o=f(r(86)),a=f(r(7)),i=f(r(0)),s=f(r(6)),c=f(r(1)),u=f(r(4)),d=f(r(3)),l=f(r(5));function f(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var p,m=r(33),h=(p=r(9))&&p.__esModule?p:{default:p},v=r(56);function _(e){return(_=\"function\"==typeof l.default&&\"symbol\"===(0,d.default)(u.default)?function(e){return void 0===e?\"undefined\":(0,d.default)(e)}:function(e){return e&&\"function\"==typeof l.default&&e.constructor===l.default&&e!==l.default.prototype?\"symbol\":void 0===e?\"undefined\":(0,d.default)(e)})(e)}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),(0,c.default)(e,n.key,n)}}function g(e,t){return!t||\"object\"!==_(t)&&\"function\"!=typeof t?function(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}(e):t}function b(e){return(b=s.default?i.default:function(e){return e.__proto__||(0,i.default)(e)})(e)}function w(e,t){return(w=s.default||function(e,t){return e.__proto__=t,e})(e,t)}var k=new h.default(\"CommandQueue\"),P=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,t),(e=g(this,b(t).call(this))).setMaxListeners(1/0),e._closed=!1,e._busy=!1,e._queue=[],e}var r,i,s;return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=(0,a.default)(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,e),r=t,(i=[{key:\"close\",value:function(){this._closed=!0}},{key:\"push\",value:function(e,t){var r=this,a=(0,o.default)({method:e},t);return k.debug(\"push() [method:%s]\",e),new n.default((function(e,t){var n=r._queue;a.resolve=e,a.reject=t,n.push(a),r._handlePendingCommands()}))}},{key:\"_handlePendingCommands\",value:function(){var e=this;if(!this._busy){var t=this._queue,r=t[0];r&&(this._busy=!0,this._handleCommand(r).then((function(){e._busy=!1,t.shift(),e._handlePendingCommands()})))}}},{key:\"_handleCommand\",value:function(e){var t=this;if(k.debug(\"_handleCommand() [method:%s]\",e.method),this._closed)return e.reject(new v.InvalidStateError(\"closed\")),n.default.resolve();var r={promise:null};return this.emit(\"exec\",e,r),n.default.resolve().then((function(){return r.promise})).then((function(r){k.debug(\"_handleCommand() | command succeeded [method:%s]\",e.method),t._closed?e.reject(new v.InvalidStateError(\"closed\")):e.resolve(r)})).catch((function(t){k.error(\"_handleCommand() | command failed [method:%s]: %o\",e.method,t),e.reject(t)}))}}])&&y(r.prototype,i),s&&y(r,s),t}(m.EventEmitter);t.default=P},function(e,t,r){\"use strict\";var n=p(r(8)),o=p(r(86)),a=p(r(7)),i=p(r(0)),s=p(r(6)),c=p(r(4)),u=p(r(3)),d=p(r(5)),l=p(r(11)),f=p(r(1));function p(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var m=y(r(9)),h=y(r(14)),v=r(56),_=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=f.default&&l.default?(0,l.default)(e,r):{};n.get||n.set?(0,f.default)(t,r,n):t[r]=e[r]}return t.default=e,t}(r(12));function y(e){return e&&e.__esModule?e:{default:e}}function g(e){return(g=\"function\"==typeof d.default&&\"symbol\"===(0,u.default)(c.default)?function(e){return void 0===e?\"undefined\":(0,u.default)(e)}:function(e){return e&&\"function\"==typeof d.default&&e.constructor===d.default&&e!==d.default.prototype?\"symbol\":void 0===e?\"undefined\":(0,u.default)(e)})(e)}function b(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),(0,f.default)(e,n.key,n)}}function w(e,t){return!t||\"object\"!==g(t)&&\"function\"!=typeof t?function(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}(e):t}function k(e){return(k=s.default?i.default:function(e){return e.__proto__||(0,i.default)(e)})(e)}function P(e,t){return(P=s.default||function(e,t){return e.__proto__=t,e})(e,t)}var T={low:1e5,medium:3e5,high:15e5},S=new m.default(\"Producer\"),R=function(e){function t(e,r,n){var a;!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,t),(a=w(this,k(t).call(this,S)))._id=_.randomNumber(),a._closed=!1,a._originalTrack=e;try{a._track=e.clone()}catch(t){a._track=e}return a._appData=n,a._simulcast=!1,\"object\"===g(r.simulcast)?a._simulcast=(0,o.default)({},T,r.simulcast):!0===r.simulcast&&(a._simulcast=(0,o.default)({},T)),a._transport=null,a._rtpParameters=null,a._locallyPaused=!a._track.enabled,a._remotelyPaused=!1,a._statsEnabled=!1,a._statsInterval=1e3,a._handleTrack(),a}var r,i,s;return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=(0,a.default)(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(t,e),r=t,(i=[{key:\"close\",value:function(e){S.debug(\"close()\"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.transport&&this.transport.disableProducerStats(this)),this._transport&&this._transport.removeProducer(this,\"local\",e),this._destroy(),this.emit(\"@close\",\"local\",e),this.safeEmit(\"close\",\"local\",e))}},{key:\"remoteClose\",value:function(e){S.debug(\"remoteClose()\"),this._closed||(this._closed=!0,this._transport&&this._transport.removeProducer(this,\"remote\",e),this._destroy(),this.emit(\"@close\",\"remote\",e),this.safeEmit(\"close\",\"remote\",e))}},{key:\"_destroy\",value:function(){this._transport=!1,this._rtpParameters=null;try{this._track.stop()}catch(e){}}},{key:\"send\",value:function(e){var t=this;return S.debug(\"send() [transport:%o]\",e),this._closed?n.default.reject(new v.InvalidStateError(\"Producer closed\")):this._transport?n.default.reject(new Error(\"already handled by a Transport\")):\"object\"!==g(e)?n.default.reject(new TypeError(\"invalid Transport\")):(this._transport=e,e.addProducer(this).then((function(){e.once(\"@close\",(function(){t._closed||t._transport!==e||(t._transport.removeProducer(t,\"local\"),t._transport=null,t._rtpParameters=null,t.safeEmit(\"unhandled\"))})),t.safeEmit(\"handled\"),t._statsEnabled&&e.enableProducerStats(t,t._statsInterval)})).catch((function(e){throw t._transport=null,e})))}},{key:\"pause\",value:function(e){return S.debug(\"pause()\"),this._closed?(S.error(\"pause() | Producer closed\"),!1):!!this._locallyPaused||(this._locallyPaused=!0,this._track.enabled=!1,this._transport&&this._transport.pauseProducer(this,e),this.safeEmit(\"pause\",\"local\",e),this.paused)}},{key:\"remotePause\",value:function(e){S.debug(\"remotePause()\"),this._closed||this._remotelyPaused||(this._remotelyPaused=!0,this._track.enabled=!1,this.safeEmit(\"pause\",\"remote\",e))}},{key:\"resume\",value:function(e){return S.debug(\"resume()\"),this._closed?(S.error(\"resume() | Producer closed\"),!1):!this._locallyPaused||(this._locallyPaused=!1,this._remotelyPaused||(this._track.enabled=!0),this._transport&&this._transport.resumeProducer(this,e),this.safeEmit(\"resume\",\"local\",e),!this.paused)}},{key:\"remoteResume\",value:function(e){S.debug(\"remoteResume()\"),!this._closed&&this._remotelyPaused&&(this._remotelyPaused=!1,this._locallyPaused||(this._track.enabled=!0),this.safeEmit(\"resume\",\"remote\",e))}},{key:\"replaceTrack\",value:function(e){var t,r=this;if(S.debug(\"replaceTrack() [track:%o]\",e),this._closed)return n.default.reject(new v.InvalidStateError(\"Producer closed\"));if(!e)return n.default.reject(new TypeError(\"no track given\"));if(\"ended\"===e.readyState)return n.default.reject(new Error('track.readyState is \"ended\"'));try{t=e.clone()}catch(r){t=e}return n.default.resolve().then((function(){if(r._transport)return r._transport.replaceProducerTrack(r,t)})).then((function(){try{r._track.onended=null,r._track.stop()}catch(e){}return r.paused?t.enabled=!1:t.enabled=!0,r._originalTrack=e,r._track=t,r._handleTrack(),r._track}))}},{key:\"setRtpParameters\",value:function(e){this._rtpParameters=e}},{key:\"enableStats\",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;S.debug(\"enableStats() [interval:%s]\",e),this._closed?S.error(\"enableStats() | Producer closed\"):this._statsEnabled||(this._statsInterval=\"number\"!=typeof e||e<1e3?1e3:e,this._statsEnabled=!0,this._transport&&this._transport.enableProducerStats(this,this._statsInterval))}},{key:\"disableStats\",value:function(){S.debug(\"disableStats()\"),this._closed?S.error(\"disableStats() | Producer closed\"):this._statsEnabled&&(this._statsEnabled=!1,this._transport&&this._transport.disableProducerStats(this))}},{key:\"remoteStats\",value:function(e){this.safeEmit(\"stats\",e)}},{key:\"_handleTrack\",value:function(){var e=this;this._track.onended=function(){e._closed||(S.warn('track \"ended\" event'),e.safeEmit(\"trackended\"))}}},{key:\"id\",get:function(){return this._id}},{key:\"closed\",get:function(){return this._closed}},{key:\"kind\",get:function(){return this._track.kind}},{key:\"track\",get:function(){return this._track}},{key:\"originalTrack\",get:function(){return this._originalTrack}},{key:\"simulcast\",get:function(){return this._simulcast}},{key:\"appData\",get:function(){return this._appData}},{key:\"transport\",get:function(){return this._transport}},{key:\"rtpParameters\",get:function(){return this._rtpParameters}},{key:\"locallyPaused\",get:function(){return this._locallyPaused}},{key:\"remotelyPaused\",get:function(){return this._remotelyPaused}},{key:\"paused\",get:function(){return this._locallyPaused||this._remotelyPaused}}])&&b(r.prototype,i),s&&b(r,s),t}(h.default);t.default=R},function(e,t,r){\"use strict\";var n=p(r(20)),o=p(r(21)),a=p(r(10)),i=p(r(7)),s=p(r(0)),c=p(r(6)),u=p(r(1)),d=p(r(4)),l=p(r(3)),f=p(r(5));function p(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var m=v(r(9)),h=v(r(14));function v(e){return e&&e.__esModule?e:{default:e}}function _(e){return(_=\"function\"==typeof f.default&&\"symbol\"===(0,l.default)(d.default)?function(e){return void 0===e?\"undefined\":(0,l.default)(e)}:function(e){return e&&\"function\"==typeof f.default&&e.constructor===f.default&&e!==f.default.prototype?\"symbol\":void 0===e?\"undefined\":(0,l.default)(e)})(e)}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),(0,u.default)(e,n.key,n)}}function g(e,t){return!t||\"object\"!==_(t)&&\"function\"!=typeof t?function(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}(e):t}function b(e){return(b=c.default?s.default:function(e){return e.__proto__||(0,s.default)(e)})(e)}function w(e,t){return(w=c.default||function(e,t){return e.__proto__=t,e})(e,t)}var k=new m.default(\"Peer\"),P=function(e){function t(e,r){var n;return function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,t),(n=g(this,b(t).call(this,k)))._name=e,n._closed=!1,n._appData=r,n._consumers=new a.default,n}var r,s,c;return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=(0,i.default)(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,e),r=t,(s=[{key:\"close\",value:function(){if(k.debug(\"close()\"),!this._closed){this._closed=!0,this.emit(\"@close\"),this.safeEmit(\"close\",\"local\");var e=!0,t=!1,r=void 0;try{for(var n,a=(0,o.default)(this._consumers.values());!(e=(n=a.next()).done);e=!0)n.value.close()}catch(e){t=!0,r=e}finally{try{e||null==a.return||a.return()}finally{if(t)throw r}}}}},{key:\"remoteClose\",value:function(e){if(k.debug(\"remoteClose()\"),!this._closed){this._closed=!0,this.emit(\"@close\"),this.safeEmit(\"close\",\"remote\",e);var t=!0,r=!1,n=void 0;try{for(var a,i=(0,o.default)(this._consumers.values());!(t=(a=i.next()).done);t=!0)a.value.remoteClose()}catch(e){r=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}}}},{key:\"getConsumerById\",value:function(e){return this._consumers.get(e)}},{key:\"addConsumer\",value:function(e){var t=this;if(this._consumers.has(e.id))throw new Error(\"Consumer already exists [id:\".concat(e.id,\"]\"));this._consumers.set(e.id,e),e.on(\"@close\",(function(){t._consumers.delete(e.id)})),this.safeEmit(\"newconsumer\",e)}},{key:\"name\",get:function(){return this._name}},{key:\"closed\",get:function(){return this._closed}},{key:\"appData\",get:function(){return this._appData}},{key:\"consumers\",get:function(){return(0,n.default)(this._consumers.values())}}])&&y(r.prototype,s),c&&y(r,c),t}(h.default);t.default=P},function(e,t,r){\"use strict\";var n=f(r(8)),o=f(r(25)),a=f(r(7)),i=f(r(0)),s=f(r(6)),c=f(r(1)),u=f(r(4)),d=f(r(3)),l=f(r(5));function f(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var p=v(r(9)),m=v(r(14)),h=r(56);function v(e){return e&&e.__esModule?e:{default:e}}function _(e){return(_=\"function\"==typeof l.default&&\"symbol\"===(0,d.default)(u.default)?function(e){return void 0===e?\"undefined\":(0,d.default)(e)}:function(e){return e&&\"function\"==typeof l.default&&e.constructor===l.default&&e!==l.default.prototype?\"symbol\":void 0===e?\"undefined\":(0,d.default)(e)})(e)}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),(0,c.default)(e,n.key,n)}}function g(e,t){return!t||\"object\"!==_(t)&&\"function\"!=typeof t?function(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}(e):t}function b(e){return(b=s.default?i.default:function(e){return e.__proto__||(0,i.default)(e)})(e)}function w(e,t){return(w=s.default||function(e,t){return e.__proto__=t,e})(e,t)}var k=new o.default([\"default\",\"low\",\"medium\",\"high\"]),P=new p.default(\"Consumer\"),T=function(e){function t(e,r,n,o,a){var i;return function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,t),(i=g(this,b(t).call(this,P)))._id=e,i._closed=!1,i._kind=r,i._rtpParameters=n,i._peer=o,i._appData=a,i._supported=!1,i._transport=null,i._track=null,i._locallyPaused=!1,i._remotelyPaused=!1,i._statsEnabled=!1,i._statsInterval=1e3,i._preferredProfile=\"default\",i._effectiveProfile=null,i}var r,o,i;return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=(0,a.default)(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,e),r=t,(o=[{key:\"close\",value:function(){P.debug(\"close()\"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.transport&&this.transport.disableConsumerStats(this)),this.emit(\"@close\"),this.safeEmit(\"close\",\"local\"),this._destroy())}},{key:\"remoteClose\",value:function(){P.debug(\"remoteClose()\"),this._closed||(this._closed=!0,this._transport&&this._transport.removeConsumer(this),this._destroy(),this.emit(\"@close\"),this.safeEmit(\"close\",\"remote\"))}},{key:\"_destroy\",value:function(){this._transport=null;try{this._track.stop()}catch(e){}this._track=null}},{key:\"receive\",value:function(e){var t=this;return P.debug(\"receive() [transport:%o]\",e),this._closed?n.default.reject(new h.InvalidStateError(\"Consumer closed\")):this._supported?this._transport?n.default.reject(new Error(\"already handled by a Transport\")):\"object\"!==_(e)?n.default.reject(new TypeError(\"invalid Transport\")):(this._transport=e,e.addConsumer(this).then((function(r){return t._track=r,t.paused&&(r.enabled=!1),e.once(\"@close\",(function(){if(!t._closed&&t._transport===e){t._transport=null;try{t._track.stop()}catch(e){}t._track=null,t.safeEmit(\"unhandled\")}})),t.safeEmit(\"handled\"),t._statsEnabled&&e.enableConsumerStats(t,t._statsInterval),r})).catch((function(e){throw t._transport=null,e}))):n.default.reject(new Error(\"unsupported codecs\"))}},{key:\"pause\",value:function(e){return P.debug(\"pause()\"),this._closed?(P.error(\"pause() | Consumer closed\"),!1):!!this._locallyPaused||(this._locallyPaused=!0,this._track&&(this._track.enabled=!1),this._transport&&this._transport.pauseConsumer(this,e),this.safeEmit(\"pause\",\"local\",e),this.paused)}},{key:\"remotePause\",value:function(e){P.debug(\"remotePause()\"),this._closed||this._remotelyPaused||(this._remotelyPaused=!0,this._track&&(this._track.enabled=!1),this.safeEmit(\"pause\",\"remote\",e))}},{key:\"resume\",value:function(e){return P.debug(\"resume()\"),this._closed?(P.error(\"resume() | Consumer closed\"),!1):!this._locallyPaused||(this._locallyPaused=!1,this._track&&!this._remotelyPaused&&(this._track.enabled=!0),this._transport&&this._transport.resumeConsumer(this,e),this.safeEmit(\"resume\",\"local\",e),!this.paused)}},{key:\"remoteResume\",value:function(e){P.debug(\"remoteResume()\"),!this._closed&&this._remotelyPaused&&(this._remotelyPaused=!1,this._track&&!this._locallyPaused&&(this._track.enabled=!0),this.safeEmit(\"resume\",\"remote\",e))}},{key:\"setPreferredProfile\",value:function(e){P.debug(\"setPreferredProfile() [profile:%s]\",e),this._closed?P.error(\"setPreferredProfile() | Consumer closed\"):e!==this._preferredProfile&&(k.has(e)?(this._preferredProfile=e,this._transport&&this._transport.setConsumerPreferredProfile(this,this._preferredProfile)):P.error('setPreferredProfile() | invalid profile \"%s\"',e))}},{key:\"remoteSetPreferredProfile\",value:function(e){P.debug(\"remoteSetPreferredProfile() [profile:%s]\",e),this._closed||e===this._preferredProfile||(this._preferredProfile=e)}},{key:\"remoteEffectiveProfileChanged\",value:function(e){P.debug(\"remoteEffectiveProfileChanged() [profile:%s]\",e),this._closed||e===this._effectiveProfile||(this._effectiveProfile=e,this.safeEmit(\"effectiveprofilechange\",this._effectiveProfile))}},{key:\"enableStats\",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;P.debug(\"enableStats() [interval:%s]\",e),this._closed?P.error(\"enableStats() | Consumer closed\"):this._statsEnabled||(this._statsInterval=\"number\"!=typeof e||e<1e3?1e3:e,this._statsEnabled=!0,this._transport&&this._transport.enableConsumerStats(this,this._statsInterval))}},{key:\"disableStats\",value:function(){P.debug(\"disableStats()\"),this._closed?P.error(\"disableStats() | Consumer closed\"):this._statsEnabled&&(this._statsEnabled=!1,this._transport&&this._transport.disableConsumerStats(this))}},{key:\"setSupported\",value:function(e){this._supported=e}},{key:\"remoteStats\",value:function(e){this.safeEmit(\"stats\",e)}},{key:\"id\",get:function(){return this._id}},{key:\"closed\",get:function(){return this._closed}},{key:\"kind\",get:function(){return this._kind}},{key:\"rtpParameters\",get:function(){return this._rtpParameters}},{key:\"peer\",get:function(){return this._peer}},{key:\"appData\",get:function(){return this._appData}},{key:\"supported\",get:function(){return this._supported}},{key:\"transport\",get:function(){return this._transport}},{key:\"track\",get:function(){return this._track}},{key:\"locallyPaused\",get:function(){return this._locallyPaused}},{key:\"remotelyPaused\",get:function(){return this._remotelyPaused}},{key:\"paused\",get:function(){return this._locallyPaused||this._remotelyPaused}},{key:\"preferredProfile\",get:function(){return this._preferredProfile}},{key:\"effectiveProfile\",get:function(){return this._effectiveProfile}},{key:\"getStats\",value:function(e){return this.transport.getStats(e)}}])&&y(r.prototype,o),i&&y(r,i),t}(m.default);t.default=T},function(e,t,r){\"use strict\";var n=a(r(11)),o=a(r(1));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,\"__esModule\",{value:!0}),Object.defineProperty(t,\"Logger\",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,\"EnhancedEventEmitter\",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,\"RemoteUnifiedPlanSdp\",{enumerable:!0,get:function(){return m.default}}),Object.defineProperty(t,\"RemotePlanBSdp\",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(t,\"RemotePlainRtpSdp\",{enumerable:!0,get:function(){return v.default}}),t.sdpPlainRtpUtils=t.sdpPlanBUtils=t.sdpUnifiedPlanUtils=t.sdpCommonUtils=t.ortc=t.utils=void 0;var i=y(r(9)),s=y(r(14)),c=_(r(12));t.utils=c;var u=_(r(18));t.ortc=u;var d=_(r(26));t.sdpCommonUtils=d;var l=_(r(43));t.sdpUnifiedPlanUtils=l;var f=_(r(45));t.sdpPlanBUtils=f;var p=_(r(215));t.sdpPlainRtpUtils=p;var m=y(r(44)),h=y(r(46)),v=y(r(216));function _(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var a=o.default&&n.default?(0,n.default)(e,r):{};a.get||a.set?(0,o.default)(t,r,a):t[r]=e[r]}return t.default=e,t}function y(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.extractPlainRtpParametersByKind=function(e,t){var r=(e.media||[]).find((function(e){return e.type===t}));if(!r)throw new Error(\"m=\".concat(t,\" section not found\"));return{ip:e.connection.ip,port:r.port}},t.fillRtpParametersForKind=function(e,t,r){var n={cname:null,reducedSize:!0,mux:!0},o=(t.media||[]).find((function(e){return e.type===r}));if(!o)throw new Error(\"m=\".concat(r,\" section not found\"));var a,i=(o.ssrcs||[]).find((function(e){return\"cname\"===e.attribute}));i&&(a=i.id,n.cname=i.value);e.rtcp=n,e.encodings=[];var s={ssrc:a};e.encodings.push(s)}},function(e,t,r){\"use strict\";var n=p(r(35)),o=p(r(21)),a=p(r(7)),i=p(r(0)),s=p(r(6)),c=p(r(4)),u=p(r(3)),d=p(r(5)),l=p(r(11)),f=p(r(1));function p(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var m=_(r(19)),h=_(r(9)),v=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=f.default&&l.default?(0,l.default)(e,r):{};n.get||n.set?(0,f.default)(t,r,n):t[r]=e[r]}return t.default=e,t}(r(12));function _(e){return e&&e.__esModule?e:{default:e}}function y(e){return(y=\"function\"==typeof d.default&&\"symbol\"===(0,u.default)(c.default)?function(e){return void 0===e?\"undefined\":(0,u.default)(e)}:function(e){return e&&\"function\"==typeof d.default&&e.constructor===d.default&&e!==d.default.prototype?\"symbol\":void 0===e?\"undefined\":(0,u.default)(e)})(e)}function g(e,t){return!t||\"object\"!==y(t)&&\"function\"!=typeof t?function(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}(e):t}function b(e){return(b=s.default?i.default:function(e){return e.__proto__||(0,i.default)(e)})(e)}function w(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=(0,a.default)(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}function k(e,t){return(k=s.default||function(e,t){return e.__proto__=t,e})(e,t)}function P(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function T(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),(0,f.default)(e,n.key,n)}}function S(e,t,r){return t&&T(e.prototype,t),r&&T(e,r),e}var R=new h.default(\"RemotePlainRtpSdp\"),C=function(){function e(t){P(this,e),this._rtpParametersByKind=t,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:v.randomNumber(),version:0}}return S(e,[{key:\"setTransportLocalParameters\",value:function(e){R.debug(\"setTransportLocalParameters() [transportLocalParameters:%o]\",e),this._transportLocalParameters=e}},{key:\"setTransportRemoteParameters\",value:function(e){R.debug(\"setTransportRemoteParameters() [transportRemoteParameters:%o]\",e),this._transportRemoteParameters=e}}]),e}(),x=function(e){function t(e){return P(this,t),g(this,b(t).call(this,e))}return w(t,e),S(t,[{key:\"createAnswerSdp\",value:function(e){if(R.debug(\"createAnswerSdp()\"),!this._transportLocalParameters)throw new Error(\"no transport local parameters\");if(!this._transportRemoteParameters)throw new Error(\"no transport remote parameters\");var t=this._transportRemoteParameters.plainRtpParameters,r={},a=(e.media||[]).filter((function(e){return e.hasOwnProperty(\"mid\")})).map((function(e){return String(e.mid)}));this._sdpGlobalFields.version++,r.version=0,r.origin={address:t.ip,ipVer:t.version,netType:\"IN\",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:\"mediasoup-client\"},r.name=\"-\",r.timing={start:0,stop:0},r.msidSemantic={semantic:\"WMS\",token:\"*\"},a.length>0&&(r.groups=[{type:\"BUNDLE\",mids:a.join(\" \")}]),r.media=[];var i=!0,s=!1,c=void 0;try{for(var u,d=(0,o.default)(e.media||[]);!(i=(u=d.next()).done);i=!0){var l=u.value,f=\"inactive\"===l.direction,p=l.type,h=this._rtpParametersByKind[p].codecs,v=this._rtpParametersByKind[p].headerExtensions,_={};switch(_.type=l.type,_.port=t.port,_.protocol=\"RTP/AVP\",_.connection={ip:t.ip,version:t.version},_.mid=l.mid,l.direction){case\"sendrecv\":case\"sendonly\":_.direction=\"recvonly\";break;case\"recvonly\":case\"inactive\":_.direction=\"inactive\"}_.rtp=[],_.rtcpFb=[],_.fmtp=[];var y=!0,g=!1,b=void 0;try{for(var w,k=(0,o.default)(h);!(y=(w=k.next()).done);y=!0){var P=w.value,T={payload:P.payloadType,codec:P.name,rate:P.clockRate};if(P.channels>1&&(T.encoding=P.channels),_.rtp.push(T),P.parameters){for(var S={payload:P.payloadType,config:\"\"},C=(0,n.default)(P.parameters),x=0;x<C.length;x++){var E=C[x];S.config&&(S.config+=\";\"),S.config+=\"\".concat(E,\"=\").concat(P.parameters[E])}S.config&&_.fmtp.push(S)}if(P.rtcpFeedback){var I=!0,D=!1,O=void 0;try{for(var L,j=(0,o.default)(P.rtcpFeedback);!(I=(L=j.next()).done);I=!0){var M=L.value;_.rtcpFb.push({payload:P.payloadType,type:M.type,subtype:M.parameter||\"\"})}}catch(e){D=!0,O=e}finally{try{I||null==j.return||j.return()}finally{if(D)throw O}}}}}catch(e){g=!0,b=e}finally{try{y||null==k.return||k.return()}finally{if(g)throw b}}if(_.payloads=h.map((function(e){return e.payloadType})).join(\" \"),!f){_.ext=[];var A=!0,F=!1,N=void 0;try{for(var U,V=function(){var e=U.value;if(!(l.ext||[]).find((function(t){return t.uri===e.uri})))return\"continue\";_.ext.push({uri:e.uri,value:e.id})},B=(0,o.default)(v);!(A=(U=B.next()).done);A=!0)V()}catch(e){F=!0,N=e}finally{try{A||null==B.return||B.return()}finally{if(F)throw N}}}if(l.simulcast_03){_.simulcast_03={value:l.simulcast_03.value.replace(/send/g,\"recv\")},_.rids=[];var G=!0,W=!1,q=void 0;try{for(var z,K=(0,o.default)(l.rids||[]);!(G=(z=K.next()).done);G=!0){var H=z.value;\"send\"===H.direction&&_.rids.push({id:H.id,direction:\"recv\"})}}catch(e){W=!0,q=e}finally{try{G||null==K.return||K.return()}finally{if(W)throw q}}}_.rtcpMux=\"rtcp-mux\",_.rtcpRsize=\"rtcp-rsize\",r.media.push(_)}}catch(e){s=!0,c=e}finally{try{i||null==d.return||d.return()}finally{if(s)throw c}}return m.default.write(r)}}]),t}(C),E=function(e){function t(e){return P(this,t),g(this,b(t).call(this,e))}return w(t,e),S(t,[{key:\"createOfferSdp\",value:function(e){if(R.debug(\"createOfferSdp()\"),!this._transportRemoteParameters)throw new Error(\"no transport remote parameters\");var t=this._transportRemoteParameters.plainRtpParameters,r={},a=e.map((function(e){return String(e.mid)}));this._sdpGlobalFields.version++,r.version=0,r.origin={address:t.ip,ipVer:t.version,netType:\"IN\",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:\"mediasoup-client\"},r.name=\"-\",r.timing={start:0,stop:0},r.msidSemantic={semantic:\"WMS\",token:\"*\"},a.length>0&&(r.groups=[{type:\"BUNDLE\",mids:a.join(\" \")}]),r.media=[];var i=!0,s=!1,c=void 0;try{for(var u,d=(0,o.default)(e);!(i=(u=d.next()).done);i=!0){var l=u.value,f=l.closed,p=l.kind,h=this._rtpParametersByKind[p].codecs,v=this._rtpParametersByKind[p].headerExtensions,_={};_.type=p,_.mid=l.mid,_.msid=\"\".concat(l.streamId,\" \").concat(l.trackId),_.port=t.port,_.protocol=\"RTP/AVP\",_.connection={ip:t.ip,version:t.version},_.direction=f?\"inactive\":\"sendonly\",_.rtp=[],_.rtcpFb=[],_.fmtp=[];var y=!0,g=!1,b=void 0;try{for(var w,k=(0,o.default)(h);!(y=(w=k.next()).done);y=!0){var P=w.value,T={payload:P.payloadType,codec:P.name,rate:P.clockRate};if(P.channels>1&&(T.encoding=P.channels),_.rtp.push(T),P.parameters){for(var S={payload:P.payloadType,config:\"\"},C=(0,n.default)(P.parameters),x=0;x<C.length;x++){var E=C[x];S.config&&(S.config+=\";\"),S.config+=\"\".concat(E,\"=\").concat(P.parameters[E])}S.config&&_.fmtp.push(S)}if(P.rtcpFeedback){var I=!0,D=!1,O=void 0;try{for(var L,j=(0,o.default)(P.rtcpFeedback);!(I=(L=j.next()).done);I=!0){var M=L.value;_.rtcpFb.push({payload:P.payloadType,type:M.type,subtype:M.parameter||\"\"})}}catch(e){D=!0,O=e}finally{try{I||null==j.return||j.return()}finally{if(D)throw O}}}}}catch(e){g=!0,b=e}finally{try{y||null==k.return||k.return()}finally{if(g)throw b}}if(_.payloads=h.map((function(e){return e.payloadType})).join(\" \"),!f){_.ext=[];var A=!0,F=!1,N=void 0;try{for(var U,V=(0,o.default)(v);!(A=(U=V.next()).done);A=!0){var B=U.value;\"urn:ietf:params:rtp-hdrext:sdes:mid\"!==B.uri&&_.ext.push({uri:B.uri,value:B.id})}}catch(e){F=!0,N=e}finally{try{A||null==V.return||V.return()}finally{if(F)throw N}}}_.rtcpMux=\"rtcp-mux\",_.rtcpRsize=\"rtcp-rsize\",f||(_.ssrcs=[],_.ssrcGroups=[],_.ssrcs.push({id:l.ssrc,attribute:\"cname\",value:l.cname}),l.rtxSsrc&&(_.ssrcs.push({id:l.rtxSsrc,attribute:\"cname\",value:l.cname}),_.ssrcGroups.push({semantics:\"FID\",ssrcs:\"\".concat(l.ssrc,\" \").concat(l.rtxSsrc)}))),r.media.push(_)}}catch(e){s=!0,c=e}finally{try{i||null==d.return||d.return()}finally{if(s)throw c}}return m.default.write(r)}}]),t}(C);t.default=function e(t,r){switch(P(this,e),R.debug(\"constructor() [direction:%s, rtpParametersByKind:%o]\",t,r),t){case\"send\":return new x(r);case\"recv\":return new E(r)}}},function(e,t,r){\"use strict\";var n=r(218),o=r(220);e.exports={Peer:n,WebSocketTransport:o.WebSocketTransport}},function(e,t,r){\"use strict\";var n=d(r(8)),o=d(r(10)),a=d(r(0)),i=d(r(28)),s=d(r(29)),c=d(r(40)),u=d(r(42));function d(e){return e&&e.__esModule?e:{default:e}}var l=r(33).EventEmitter,f=r(34)(\"Peer\"),p=r(120),m=function(e){function t(e){(0,i.default)(this,t),f.debug(\"constructor()\");var r=(0,c.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return r.setMaxListeners(1/0),r._transport=e,r._closed=!1,r._data={},r._requestHandlers=new o.default,r._handleTransport(),r}return(0,u.default)(t,e),(0,s.default)(t,[{key:\"send\",value:function(e,t){var r=this,o=p.requestFactory(e,t);return this._transport.send(o).then((function(){return new n.default((function(e,t){var n={resolve:function(t){r._requestHandlers.delete(o.id)&&(clearTimeout(n.timer),e(t))},reject:function(e){r._requestHandlers.delete(o.id)&&(clearTimeout(n.timer),t(e))},timer:setTimeout((function(){r._requestHandlers.delete(o.id)&&t(new Error(\"request timeout\"))}),2e4),close:function(){clearTimeout(n.timer),t(new Error(\"peer closed\"))}};r._requestHandlers.set(o.id,n)}))}))}},{key:\"notify\",value:function(e,t){var r=p.notificationFactory(e,t);return this._transport.send(r)}},{key:\"close\",value:function(){f.debug(\"close()\"),this._closed||(this._closed=!0,this._transport.close(),this._requestHandlers.forEach((function(e){return e.close()})),this.emit(\"close\"))}},{key:\"_handleTransport\",value:function(){var e=this;if(this._transport.closed)return this._closed=!0,void setTimeout((function(){return e.emit(\"close\")}));this._transport.on(\"connecting\",(function(t){f.debug('emit \"connecting\" [currentAttempt:%s]',t),e.emit(\"connecting\",t)})),this._transport.on(\"open\",(function(){e._closed||(f.debug('emit \"open\"'),e.emit(\"open\"))})),this._transport.on(\"disconnected\",(function(){f.debug('emit \"disconnected\"'),e.emit(\"disconnected\")})),this._transport.on(\"failed\",(function(t){f.debug('emit \"failed\" [currentAttempt:%s]',t),e.emit(\"failed\",t)})),this._transport.on(\"close\",(function(){e._closed||(e._closed=!0,f.debug('emit \"close\"'),e.emit(\"close\"))})),this._transport.on(\"message\",(function(t){t.request?e._handleRequest(t):t.response?e._handleResponse(t):t.notification&&e._handleNotification(t)}))}},{key:\"_handleRequest\",value:function(e){var t=this;this.emit(\"request\",e,(function(r){var n=p.successResponseFactory(e,r);t._transport.send(n).catch((function(e){f.warn(\"accept() failed, response could not be sent: %o\",e)}))}),(function(r,n){r instanceof Error?(n=r.toString(),r=500):\"number\"==typeof r&&n instanceof Error&&(n=n.toString());var o=p.errorResponseFactory(e,r,n);t._transport.send(o).catch((function(e){f.warn(\"reject() failed, response could not be sent: %o\",e)}))}))}},{key:\"_handleResponse\",value:function(e){var t=this._requestHandlers.get(e.id);if(t)if(e.ok)t.resolve(e.data);else{var r=new Error(e.errorReason);r.code=e.errorCode,t.reject(r)}else f.error(\"received response does not match any sent request\")}},{key:\"_handleNotification\",value:function(e){this.emit(\"notification\",e)}},{key:\"data\",get:function(){return this._data},set:function(e){this._data=e||{}}},{key:\"closed\",get:function(){return this._closed}}]),t}(l);e.exports=m},function(e,t,r){\"use strict\";var n=r(119).generator({min:1e6,max:9999999,integer:!0});e.exports={randomNumber:n}},function(e,t,r){\"use strict\";var n=r(221);e.exports={WebSocketTransport:n}},function(e,t,r){\"use strict\";var n=d(r(64)),o=d(r(8)),a=d(r(0)),i=d(r(28)),s=d(r(29)),c=d(r(40)),u=d(r(42));function d(e){return e&&e.__esModule?e:{default:e}}var l=r(33).EventEmitter,f=r(222).w3cwebsocket,p=r(115),m=r(34)(\"WebSocketTransport\"),h=r(120),v={retries:10,factor:2,minTimeout:1e3,maxTimeout:8e3},_=function(e){function t(e,r){(0,i.default)(this,t),m.debug('constructor() [url:\"%s\", options:%o]',e,r);var n=(0,c.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return n.setMaxListeners(1/0),n._url=e,n._options=r||{},n._ws=null,n._closed=!1,n._setWebSocket(),n}return(0,u.default)(t,e),(0,s.default)(t,[{key:\"send\",value:function(e){if(this._closed)return o.default.reject(new Error(\"transport closed\"));try{return this._ws.send((0,n.default)(e)),o.default.resolve()}catch(e){return m.error(\"send() | error sending message: %o\",e),o.default.reject(e)}}},{key:\"close\",value:function(){if(m.debug(\"close()\"),!this._closed){this._closed=!0,this.emit(\"close\");try{this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.close()}catch(e){m.error(\"close() | error closing the WebSocket: %o\",e)}}}},{key:\"_setWebSocket\",value:function(){var e=this,t=this._options,r=p.operation(this._options.retry||v),n=!1;r.attempt((function(o){e._closed?r.stop():(m.debug(\"_setWebSocket() [currentAttempt:%s]\",o),e._ws=new f(e._url,\"protoo\",t.origin,t.headers,t.requestOptions,t.clientConfig),e.emit(\"connecting\",o),e._ws.onopen=function(){e._closed||(n=!0,e.emit(\"open\"))},e._ws.onclose=function(t){if(!e._closed){if(m.warn('WebSocket \"close\" event [wasClean:%s, code:%s, reason:\"%s\"]',t.wasClean,t.code,t.reason),4e3!==t.code){if(n){if(r.stop(),e.emit(\"disconnected\"),e._closed)return;return void e._setWebSocket()}if(e.emit(\"failed\",o),e._closed)return;if(r.retry(!0))return}e._closed=!0,e.emit(\"close\")}},e._ws.onerror=function(){e._closed||m.error('WebSocket \"error\" event')},e._ws.onmessage=function(t){if(!e._closed){var r=h.parse(t.data);r&&(0!==e.listenerCount(\"message\")?e.emit(\"message\",r):m.error('no listeners for WebSocket \"message\" event, ignoring received message'))}})}))}},{key:\"closed\",get:function(){return this._closed}}]),t}(l);e.exports=_},function(e,t,r){var n;try{n=r(223)}catch(e){}finally{if(n||\"undefined\"==typeof window||(n=window),!n)throw new Error(\"Could not determine global this\")}var o=n.WebSocket||n.MozWebSocket,a=r(224);function i(e,t){return t?new o(e,t):new o(e)}o&&[\"CONNECTING\",\"OPEN\",\"CLOSING\",\"CLOSED\"].forEach((function(e){Object.defineProperty(i,e,{get:function(){return o[e]}})})),e.exports={w3cwebsocket:o?i:null,version:a}},function(e,t){var r=function(){if(\"object\"==typeof self&&self)return self;if(\"object\"==typeof window&&window)return window;throw new Error(\"Unable to resolve global `this`\")};e.exports=function(){if(this)return this;if(\"object\"==typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,\"__global__\",{get:function(){return this},configurable:!0})}catch(e){return r()}try{return __global__||r()}finally{delete Object.prototype.__global__}}()},function(e,t,r){e.exports=r(225).version},function(e){e.exports=JSON.parse('{\"name\":\"websocket\",\"description\":\"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.\",\"keywords\":[\"websocket\",\"websockets\",\"socket\",\"networking\",\"comet\",\"push\",\"RFC-6455\",\"realtime\",\"server\",\"client\"],\"author\":\"Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)\",\"contributors\":[\"Iaki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)\"],\"version\":\"1.0.31\",\"repository\":{\"type\":\"git\",\"url\":\"https://github.com/theturtle32/WebSocket-Node.git\"},\"homepage\":\"https://github.com/theturtle32/WebSocket-Node\",\"engines\":{\"node\":\">=0.10.0\"},\"dependencies\":{\"debug\":\"^2.2.0\",\"es5-ext\":\"^0.10.50\",\"nan\":\"^2.14.0\",\"typedarray-to-buffer\":\"^3.1.5\",\"yaeti\":\"^0.0.6\"},\"devDependencies\":{\"buffer-equal\":\"^1.0.0\",\"faucet\":\"^0.0.1\",\"gulp\":\"^4.0.2\",\"gulp-jshint\":\"^2.0.4\",\"jshint-stylish\":\"^2.2.1\",\"jshint\":\"^2.0.0\",\"tape\":\"^4.9.1\"},\"config\":{\"verbose\":false},\"scripts\":{\"install\":\"(node-gyp rebuild 2> builderror.log) || (exit 0)\",\"test\":\"faucet test/unit\",\"gulp\":\"gulp\"},\"main\":\"index\",\"directories\":{\"lib\":\"./lib\"},\"browser\":\"lib/browser.js\",\"license\":\"Apache-2.0\",\"__npminstall_done\":\"Fri Feb 28 2020 14:40:09 GMT+0800 (GMT+08:00)\",\"_from\":\"websocket@1.0.31\",\"_resolved\":\"https://registry.npm.taobao.org/websocket/download/websocket-1.0.31.tgz\"}')},function(e,t,r){\"use strict\";var n=i(r(28)),o=i(r(29)),a=i(r(227));function i(e){return e&&e.__esModule?e:{default:e}}var s=r(34)(\"Stats\"),c=(r(30),(0,a.default)({HEAT_BEAT:\"event=sdkHeartbeat\",ENTER_FAIL:\"event=ENTER_FAIL\",ENTER_TIMEOUT:\"event=ENTER_TIMEOUT\"})),u=function(){function e(){(0,n.default)(this,e),this.stats=[{appId:\"\",roomId:\"\",sessionId:\"\",userId:\"\",logtype:\"1\",connectionId:\"\",roleType:\"\",logTime:\"\",equipInfo:{sdkVersion:\"3.1.0\",netType:\"0\",equipModel:\"web\"},videoInfo:{V_SENT:[{DEVID:\"\",V_VBR:0,V_RBR:0,V_FPS:0,V_SENDBYTES:0,V_SENDCOUNT:0,V_SENDFRACTIONLOST:0,V_RTT:0}],V_RECV:[{RECVUID:\"\",RECVID:\"\",V_RECVBR:0,V_RECVBYTES:0,V_RECVCOUNT:0,V_LOSTRATE:0,V_RTT:0,V_JITTER:0,V_RDELAY:0,V_LOSTDELAY:0,V_CARTON:0,V_FPS:0,V_WIDTH:0,V_HEIGHT:0}]},audioInfo:{A_SENT:{A_BR:0,A_RBR:0,A_RTT:0,A_MUTED:0,A_CAP:0,A_ENC:0,A_LOSTRATE:0},A_RECV:[{RECVUID:\"\",A_DEVID:\"\",A_RECVBR:0,A_RECVBYTES:0,A_LOSTRATE:0,A_DELAY:0,A_BUFFERDURATION:0,A_RCARTON:0}]},systemEnvironments:{sysCpu:2,appCpu:1,sysRam:1024,appRam:1024}}],this._netstat={fractionLost:0,roundTripTime:0,quality:0,wsState:\"\",sendIceState:\"\",recvIceState:\"\",audioUp:{timestamp:0,bitrate:0,packetCount:0,packetsLost:0,nackCount:0,jitter:0,pliCount:0,sliCount:0,fractionLost:0,roundTripTime:0},audioDown:{timestamp:0,bitrate:0,packetCount:0,packetsLost:0,nackCount:0,pliCount:0,sliCount:0,fractionLost:0,roundTripTime:0},videoUp:{timestamp:0,bitrate:0,packetCount:0,packetsLost:0,nackCount:0,jitter:0,pliCount:0,sliCount:0,fractionLost:0,roundTripTime:0},videoDown:{timestamp:0,bitrate:0,packetCount:0,packetsLost:0,nackCount:0,pliCount:0,sliCount:0,fractionLost:0,roundTripTime:0}},this._cstat={peerId:\"\",appId:\"\",connectionId:\"\",roomId:\"\",consumer:\"\",stat:[]},this.enter_timeout={glbId:\"uuid\",appId:\"appid\",userId:\"\",roomId:\"\",connectId:\"\",os:\"WEB\",logTime:\"2019-07-26 11:54:18.104\",timesOfLinkIplocal:1,timesOfLinkGW:1,linkIplocalTime:1,sendIplocalTime:1,linkGWTime:1,sendGWTime:1,sendEnterTime:1,gwIp:\"0.0.0.0\"},this.event_fail={glbId:\"uuid\",appId:\"appid\",userId:\"\",roomId:\"\",connectId:\"\",os:\"WEB\",role:1,result:123,logTime:\"2019-07-26 11:54:18.104\",timesOfLinkIplocal:123,timesOfLinkGW:123,linkIplocalTime:245,linkGWTime:22,sendIplocalTime:123,sendGWTime:123,sendEnterTime:123,innerDiff:123,totalDiff:13,gwIp:\"123.123.123.123\"},this.STATS_INTERVAL=4e3,this.STATS_INTERVAL_S=2e3,this.setNetworkType()}return(0,o.default)(e,[{key:\"setWsState\",value:function(e){this._netstat.wsState=e}},{key:\"setSendIceState\",value:function(e){this._netstat.sendIceState=e}},{key:\"setRecvIceState\",value:function(e){this._netstat.recvIceState=e}},{key:\"setAppid\",value:function(e){this.stats[0].appId=e,this._cstat.appId=e,this._appId=e}},{key:\"setRoomId\",value:function(e){this.stats[0].roomId=e,this._cstat.roomId=e,this._roomId=e}},{key:\"setSessionId\",value:function(e){this.stats[0].sessionId=e,this._sessionId=e}},{key:\"setUserId\",value:function(e){this.stats[0].userId=e,this._cstat.peerId=e}},{key:\"setLogType\",value:function(e){this.stats[0].logtype=e}},{key:\"setConnectionId\",value:function(e){this.stats[0].connectionId=e,this._cstat.connectionId=e,this._connectionId=e}},{key:\"setEquipInfo\",value:function(e){this.stats[0].equipInfo=e}},{key:\"setRoleType\",value:function(e){this.stats[0].roleType=e}},{key:\"setDeviceInfo\",value:function(e){}},{key:\"setDomain\",value:function(e){this._domain=e}},{key:\"setNetworkType\",value:function(){try{switch((navigator.connection||navigator.mozConnection||navigator.webkitConnection).type){case\"wifi\":this.stats.netType=0;break;case\"ethernet\":default:this.stats.netType=4}}catch(e){}}},{key:\"setConsumeStats\",value:function(e,t,r,n){var o=this;this._cstat.consumer=n,this._cstat.stat=e,e.forEach((function(e){o.stats[0].videoInfo.V_RECV[0].RECVUID=r,o.stats[0].videoInfo.V_RECV[0].RECVUID=r,\"video\"===e.kind&&\"outbound-rtp\"===e.type&&(o.stats[0].videoInfo.V_RECV[0].RECVUID=r,o.stats[0].videoInfo.V_RECV[0].RECVID=e.inboundRtpId,o.stats[0].videoInfo.V_RECV[0].V_RECVBR=e.bitrate/1e3,o.stats[0].videoInfo.V_RECV[0].V_LOSTRATE=e.fractionLost,o.stats[0].videoInfo.V_RECV[0].V_RTT=e.roundTripTime,o.stats[0].videoInfo.V_RECV[0].V_RECVBYTES=e.byteCount,o.stats[0].videoInfo.V_RECV[0].V_RECVCOUNT=e.packetCount,o.stats[0].videoInfo.V_RECV[0].V_WIDTH=t.frameWidth,o.stats[0].videoInfo.V_RECV[0].V_HEIGHT=t.frameHeight,o._netstat.videoDown.timestamp=e.timestamp,o._netstat.videoDown.bitrate=e.bitrate,o._netstat.videoDown.packetCount=e.packetCount,o._netstat.videoDown.packageLost=e.packetsLost,o._netstat.videoDown.nackCount=e.nackCount,o._netstat.videoDown.pliCount=e.pliCount,o._netstat.videoDown.sliCount=e.sliCount,o._netstat.videoDown.fractionLost=e.fractionLost,e.roundTripTime&&(o._netstat.videoDown.roundTripTime=e.roundTripTime)),\"audio\"===e.kind&&\"outbound-rtp\"===e.type&&(o.stats[0].audioInfo.A_RECV[0].RECVUID=r,o.stats[0].audioInfo.A_RECV[0].A_DEVID=e.inboundRtpId,o.stats[0].audioInfo.A_RECV[0].A_RECVBR=e.bitrate/1e3,o.stats[0].audioInfo.A_RECV[0].A_LOSTRATE=e.fractionLost,o.stats[0].audioInfo.A_RECV[0].A_RTT=e.roundTripTime,o.stats[0].audioInfo.A_RECV[0].A_RECVBYTES=e.byteCount,o.stats[0].audioInfo.A_RECV[0].A_RECVCOUNT=e.packetCount,o._netstat.audioDown.timestamp=e.timestamp,o._netstat.audioDown.bitrate=e.bitrate,o._netstat.audioDown.packetCount=e.packetCount,o._netstat.audioDown.packetsLost=e.packetsLost,o._netstat.audioDown.nackCount=e.nackCount,o._netstat.audioDown.pliCount=e.pliCount,o._netstat.audioDown.sliCount=e.sliCount,o._netstat.audioDown.fractionLost=e.fractionLost,e.roundTripTime&&(o._netstat.audioDown.roundTripTime=e.roundTripTime))})),this._setNetQulity(),s.debug({type:\"netStats\",consumerPeerId:r,stats:e,consumer:n}),this._cstat.stat.forEach((function(e){\"video\"===e.kind&&\"outbound-rtp\"===e.type&&(e.resolution=t)})),this.consumerState(this._cstat)}},{key:\"setMicStats\",value:function(e){var t=this;e.forEach((function(e){t.stats[0].audioInfo.A_SENT.A_BR=e.bitrate/1e3,t.stats[0].audioInfo.A_SENT.A_ENC=e.packetCount,t.stats[0].audioInfo.A_SENT.A_LOSTRATE=e.packetsLost,t._netstat.audioUp.timestamp=e.timestamp,t._netstat.audioUp.bitrate=e.bitrate,t._netstat.audioUp.packetCount=e.packetCount,t._netstat.audioUp.packetsLost=e.packetsLost,t._netstat.audioUp.nackCount=e.nackCount,t._netstat.audioUp.jitter=e.jitter,t._netstat.audioUp.pliCount=e.pliCount,t._netstat.audioUp.fractionLost=e.fractionLost,e.roundTripTime&&(t._netstat.audioUp.roundTripTime=e.roundTripTime)})),this._setNetQulity(),s.debug({type:\"netStats\",producer:\"mic\",stats:e})}},{key:\"setWebcamStats\",value:function(e){var t=this;e.forEach((function(e){t.stats[0].videoInfo.V_SENT[0].DEVID=e.id,t.stats[0].videoInfo.V_SENT[0].V_VBR=e.bitrate/1e3,t.stats[0].videoInfo.V_SENT[0].V_SENDCOUNT=e.packetCount,t.stats[0].videoInfo.V_SENT[0].V_SENDFRACTIONLOST=e.packetsLost,t._netstat.videoUp.timestamp=e.timestamp,t._netstat.videoUp.bitrate=e.bitrate,t._netstat.videoUp.packetCount=e.packetCount,t._netstat.videoUp.packetsLost=e.packetsLost,t._netstat.videoUp.nackCount=e.nackCount,t._netstat.videoUp.jitter=e.jitter,t._netstat.videoUp.pliCount=e.pliCount,t._netstat.videoUp.fractionLost=e.fractionLost,e.roundTripTime&&(t._netstat.videoUp.roundTripTime=e.roundTripTime)})),this._setNetQulity(),s.debug({type:\"netStats\",producer:\"webcam\",stats:e})}},{key:\"startPushing\",value:function(){var e=this;this._timerId=setInterval((function(){e.stats[0].logTime=\"\"+Math.floor(Date.now()),e.pushLoggerToServer(c.HEAT_BEAT,e.stats)}),this.STATS_INTERVAL_S)}},{key:\"pushLoggerToServer\",value:function(e,t){}},{key:\"consumerState\",value:function(e){}},{key:\"stopPushing\",value:function(){clearInterval(this._timerId)}},{key:\"getNetState\",value:function(){return this._netstat}},{key:\"_setNetQulity\",value:function(){var e=0,t=0,r=0;0!==this._netstat.audioUp.packetCount&&(t++,this._netstat.audioUp.roundTripTime,e+=this._netstat.audioUp.packetsLost/this._netstat.audioUp.packetCount),0!==this._netstat.audioDown.packetCount&&(t++,this._netstat.audioDown.roundTripTime,e+=this._netstat.audioDown.packetsLost/this._netstat.audioDown.packetCount),0!==this._netstat.videoUp.packetCount&&(t++,this._netstat.videoUp.roundTripTime,e+=this._netstat.videoUp.packetsLost/this._netstat.videoUp.packetCount),0!==this._netstat.videoDown.packetCount&&(t++,this._netstat.videoDown.roundTripTime,e+=this._netstat.videoDown.packetsLost/this._netstat.videoDown.packetCount),0!==t&&(r/=t,this._netstat.fractionLost=e/t,this._netstat.roundTripTime=r,this._netstat.quality=1-this._netstat.fractionLost)}}],[{key:\"LOGGER_SERVER_URL\",get:function(){return\"https://log.wushuangtech.com:15100\"}}]),e}();e.exports=u},function(e,t,r){e.exports={default:r(228),__esModule:!0}},function(e,t,r){r(229),e.exports=r(2).Object.freeze},function(e,t,r){var n=r(16),o=r(61).onFreeze;r(59)(\"freeze\",(function(e){return function(t){return e&&n(t)?e(o(t)):t}}))},function(e){e.exports=JSON.parse('{\"name\":\"tttwebsdk\",\"version\":\"3.1.2\",\"description\":\"websdk for 3ttech.cn - taiyue\",\"buildDate\":\"Feb_28_2020-1\",\"main\":\"lib/TTTRtcWeb.js\",\"scripts\":{\"test\":\"jest\",\"start\":\"webpack-dev-server --open\",\"build:prod\":\"webpack --config webpack.config/webpack.config.js\"},\"author\":\"3ttech.cn\",\"license\":\"ISC\",\"dependencies\":{\"babel-runtime\":\"^6.26.0\",\"bowser\":\"^1.9.3\",\"debug\":\"^4.1.1\",\"hark\":\"^1.2.3\",\"random-number\":\"^0.0.9\",\"retry\":\"^0.12.0\",\"websocket\":\"^1.0.28\"},\"devDependencies\":{\"babel-core\":\"^6.26.3\",\"babel-loader\":\"^7.1.1\",\"babel-plugin-transform-runtime\":\"^6.23.0\",\"babel-polyfill\":\"^6.26.0\",\"babel-preset-env\":\"^1.7.0\",\"babel-preset-es2015\":\"^6.24.1\",\"babel-preset-stage-0\":\"^6.24.1\",\"copy-webpack-plugin\":\"^5.0.4\",\"eslint\":\"^5.16.0\",\"eslint-plugin-react\":\"^7.13.0\",\"html-webpack-plugin\":\"^3.2.0\",\"http-server\":\"^0.11.1\",\"jest\":\"^24.9.0\",\"jest-websocket-mock\":\"^1.5.0\",\"mock-socket\":\"^9.0.0\",\"sweetalert2\":\"^8.11.4\",\"webpack\":\"^4.41.0\",\"webpack-cli\":\"^3.2.3\",\"webpack-dev-server\":\"^3.1.14\"}}')}])}));\n//# sourceMappingURL=tttwebsdk.js.map\n\n//# sourceURL=webpack:///./lib/tttwebsdk.js?");

/***/ }),

/***/ "./package.json":
/*!**********************!*\
  !*** ./package.json ***!
  \**********************/
/*! exports provided: name, version, description, main, scripts, author, license, dependencies, devDependencies, default */
/***/ (function(module) {

eval("module.exports = JSON.parse(\"{\\\"name\\\":\\\"tttwebsdkdemo\\\",\\\"version\\\":\\\"1.1.1\\\",\\\"description\\\":\\\"\\\",\\\"main\\\":\\\"index.js\\\",\\\"scripts\\\":{\\\"test\\\":\\\"echo \\\\\\\"Error: no test specified\\\\\\\" && exit 1\\\",\\\"start\\\":\\\"webpack-dev-server --open\\\",\\\"host\\\":\\\"webpack-dev-server --https --host=0.0.0.0 --open --watch --inline --mode=development\\\",\\\"build\\\":\\\"webpack --config webpack.config.js\\\"},\\\"author\\\":\\\"\\\",\\\"license\\\":\\\"ISC\\\",\\\"dependencies\\\":{\\\"tttwebsdk\\\":\\\"^3.4.7\\\"},\\\"devDependencies\\\":{\\\"webpack\\\":\\\"^4.41.0\\\",\\\"webpack-cli\\\":\\\"^3.3.9\\\",\\\"webpack-dev-server\\\":\\\"^3.1.14\\\",\\\"webpack-jquery-ui\\\":\\\"^2.0.1\\\"}}\");\n\n//# sourceURL=webpack:///./package.json?");

/***/ }),

/***/ "./src/demo.js":
/*!*********************!*\
  !*** ./src/demo.js ***!
  \*********************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/tttwebsdk */ \"./lib/tttwebsdk.js\");\n/* harmony import */ var _lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0__);\n\n// import TTTRtcWeb from 'tttwebsdk'\n\nlet RTCObj = new _lib_tttwebsdk__WEBPACK_IMPORTED_MODULE_0___default.a();\n\nconst pkg = __webpack_require__(/*! ../package.json */ \"./package.json\");\n\n// \nlet demoVersion = pkg.version;\n\nlet sdkVersion = RTCObj.getVersion();\n\ndocument.getElementById('sysVersion').innerHTML = `ver: ${demoVersion} - ${sdkVersion}`;\n\n// \nlet client = null;\nlet streams = new Map();\n\nlet hasPublishStream = false;\nlet hasPublishScreen = false;\n\nlet gStream = null;\nlet gScreenStream = null;\n\nlet remote_stream = new Map();\n\nconst text_info = document.getElementById('text_info');\n\nconst userRoleSelect = document.getElementById('userRole');\n\nlet cameraDevId = 'default';\nlet micDevId = 'default';\nlet speakerDevId = 'default';\n\nconst appIdEle = document.getElementById('appID');\n\n// \nconst rSeed = (Math.random() * 100000000);\nconst userId = Math.floor(rSeed) + 1;\nconst userIdEle = document.getElementById('userid');\nif (!!userIdEle)\n{\n\tuserIdEle.value = userId;\n}\n\nconst roomIdEle = document.getElementById('chanid');\n\n// \nlet screenEle = document.getElementById('screen');\nlet videoEle = document.getElementById('video');\n// \nlet userRole = 2;\n\n// \nlet sei = {\n    'ts': '',\n    'ver': '20161227',\n    'canvas': {\n        'bgrad': [\n            232,\n            230,\n            232\n        ],\n        'h': 480,\n        'w': 640\n    },\n    'mid': '',\n    'pos': []\n}\n// \nlet tttStatus = 0;\n\n// \n// url: https://...../?auto=1&r=666777&u=111111&h=webmedia4.3ttech.cn\nlet isAutoPub = getQueryVariable('auto');\nlet xRoomId = getQueryVariable('r');\nlet xUserId = getQueryVariable('u') || userId;\nlet xAppId = 'a967ac491e3acf92eed5e1b5ba641ab7'; // test900572e02867fab8131651339518\nlet xSpecMic = getQueryVariable('m');\nlet xSpecServer = getQueryVariable('h');\nlet xSpecIploc = getQueryVariable('l');\nlet xSpecIplocPort = getQueryVariable('p');\n// \nif (!!xSpecIploc)\n{\n\tif (xSpecIploc !== '')\n\t{\n\t\tRTCObj.setIpLocationAddress(xSpecIploc); // 'v7.jkim.ccb.com'\n\t}\n}\n// \nif (!!xSpecIplocPort)\n{\n\tconst port = parseInt(xSpecIplocPort, 10);\n\tif (!!port)\n\t{\n\t\tRTCObj.setIpLocationPort(port);\n\t}\n}\n\n// \ngetDevices();\n\nautoPublish();\n\nfunction autoPublish()\n{\n\tconsole.log(`<demo> Load. isAutoPub: ${isAutoPub} xRoomId: ${xRoomId} xUserId: ${xUserId}`);\n\n\tif (!!xRoomId && !!xUserId && isAutoPub)\n\t{\n\t\tif (!!roomIdEle)\n\t\t{\n\t\t\troomIdEle.value = xRoomId;\n\t\t}\n\t\tif (!!userIdEle)\n\t\t{\n\t\t\tuserIdEle.value = xUserId;\n\t\t}\n\n\t\tjoinChan(xAppId, xRoomId, xUserId);\n\t}\n\telse\n\t{\n\t\tisAutoPub = false;\n\t}\n}\n\nfunction getQueryVariable(variable)\n{\n\tvar query = window.location.search.substring(1);\n\tvar vars = query.split('&');\n\tfor (var i = 0; i < vars.length; i++)\n\t{\n\t\tvar pair = vars[i].split('=');\n\t\tif (pair[0] == variable)\n\t\t{\n\t\t\treturn pair[1];\n\t\t}\n\t}\n\treturn(false);\n}\n\nfunction joinChan(appid, chanid, userid)\n{\n\t// \n\tif (tttStatus === 1)\n\t{\n\t\ttext_info.value = text_info.value + '' + '\\n';\n\n\t\treturn;\n    }\n\n\t// \n\tif (!!xSpecServer)\n\t{\n\t\tif (xSpecServer !== '')\n\t\t{\n\t\t\tRTCObj.setServerUrl(xSpecServer);\n\t\t}\n\t}\n\n    client = RTCObj.createClient({\n\t\trole: userRole,\n\t\trtmpUrl: ''\n\t});\n \n    client.init(appid, userid, () => {\n        client.join(chanid, () => {\n\t\t\ttext_info.value = `<demo> !! userid: ${userid}` + '\\n';\n\n\t\t\tconsole.log(`<demo> !! userid: ${userid}`);\n\n\t\t\ttttStatus = 1; // : \n\n\t\t\tdocument.getElementById('loginStatus').innerHTML = `<font color=\"green\"></font>`;\n\t\t\tdocument.getElementById('loginInfo').innerHTML = `-- role: ${userRole}<br>`;\n\n\t\t\t// \n\t\t\tif (isAutoPub)\n\t\t\t{\n\t\t\t\tpublishStream({\n\t\t\t\t\tuserid : xUserId,\n\t\t\t\t\taudio  : true,\n\t\t\t\t\tvideo  : true,\n\t\t\t\t\tscreen : false\n\t\t\t\t});\n\t\t\t}\n\t\t\t// \n        }, (err) => {\n\t\t\ttttStatus = 0;\n\n\t\t\ttext_info.value = text_info.value + `<demo> login failed. - error: ${JSON.stringify(err)}` + '\\n';\n\n\t\t\tconsole.log(`<demo> login failed. - error: ${JSON.stringify(err)}`);\n\n\t\t\tdocument.getElementById('loginStatus').innerHTML = '<font color=\"red\"></font>';\n\t\t\tdocument.getElementById('loginInfo').innerHTML = '';\n        });\n    }, (err) => {\n\t\ttext_info.value = text_info.value + `<demo> init failed. - error: ${JSON.stringify(err)}` + '\\n';\n\t\tconsole.log(`<demo> init failed. - error: ${JSON.stringify(err)}`);\n\t});\n\n\tclient.on('disconnected', () => {\n\t\ttttStatus = 0;\n\n\t\ttext_info.value = text_info.value + '<demo> - event [disconnected]' + '\\n';\n\t\tconsole.log('<demo> - event [disconnected]');\n\t\t\n\t\t_onClose();\n\t});\n\n\tclient.on('kickout', (evt) => {\n\t\ttttStatus = 0;\n\n\t\ttext_info.value = text_info.value + `<demo> - event [kickout] ${JSON.stringify(evt)}` + '\\n';\n\t\tconsole.log(`<demo> - event [kickout] ${JSON.stringify(evt)}`);\n\t\t\n\t\t_onClose();\n\t});\n\n    client.on('peer-join', (peer) => {\n\t\ttext_info.value = text_info.value + `<demo> - event [peer-join] uid: ${peer.name}` + '\\n';\n\n        console.log(`<demo> - event [peer-join] uid: ${peer.name}`);\n    });\n\n    client.on('peer-leave', (peer) => {\n\t\ttext_info.value = text_info.value + `<demo> - event [peer-leave] uid: ${peer.name}` + '\\n';\n        console.log(`<demo> - event [peer-leave] uid: ${peer.name}`);\n\n        peer.streams.forEach(stream => {\n\t\t\tif (!stream)\n\t\t\t\treturn;\n\n\t\t\tlet obj = document.getElementById('3t_remote' + stream.streamID);\n\t\t\tif (obj)\n\t\t\t{\n\t\t\t\tobj.remove();\n\t\t\t}\n\n            // remove stream from map\n            remote_stream.delete(stream.streamID);\n\n\t\t\tstream.close();\n        });\n\t});\n\t\n\tclient.on('stream-added', (evt) => {\n\t\tlet stream = evt.stream;\n\t\tif (!stream)\n\t\t\treturn;\n\t\t\t\n\t\ttext_info.value = text_info.value + `<demo> - event [stream-added] streamId: ${evt.stream.streamID}` + '\\n';\n\n\t\tconsole.log('<demo> - event [stream-added] %o', evt.stream);\n\n\t\tremote_stream.set(stream.streamID, stream);\n        client.subscribe(stream, (event) => {\n\t\t\ttext_info.value = text_info.value + `<demo> subscribe ${evt.stream.streamID} succ.` + '\\n';\n        }, (err) => {\n\t\t\ttext_info.value = text_info.value + `<demo> subscribe ${evt.stream.streamID} failed. - error: ${JSON.stringify(err)}` + '\\n';\n        });\n\t})\n\n    client.on('stream-subscribed', (evt) => {\n        let stream = evt.stream;\n\t\tif (!stream)\n\t\t\treturn;\n\t\ttext_info.value = text_info.value + `<demo> - event [stream-subscribed] streamId: ${stream.streamID}` + '\\n';\n\t\tconsole.log(`<demo> - event [stream-subscribed] streamId: ${stream.streamID}`);\n\n\t\tif (stream.hasAudio())\n\t\t{\n\t\t\tstream.on('volume-change', e => {\n\t\t\t\t; // console.log(`<AUDIO-VOLUME> - volume-change -- userID: ${e.userID} volume: ${e.volume}`);\n\t\t\t});\n\t\t}\n\t\t\n\t\t{\n            var videoId = '3t_remote' + stream.streamID;\n\t\t\tif(!!videoEle && !document.getElementById(videoId))\n\t\t\t{\n                let video = document.createElement('video');\n\t\t\t\tvideo.id = videoId;\n\t\t\t\tvideo.muted = false;\n\t\t\t\tvideo.autoplay = true;\n\t\t\t\tvideo.controls = true;\n\t\t\t\tvideo.setAttribute('playsinline', '');\n                video.style.cssText = 'height: 300px; width: 300px; background: black; position:relative; display:inline-block;'\n\t\t\t\tvideoEle.append(video);\n            }\n\n            stream.play('3t_remote' + stream.streamID, true);\n        }\n    });\n\n    client.on('video-mute', (evt) => {\n\t\tvar stream = evt.stream;\n\t\tif (!stream)\n\t\t\treturn;\n\n\t\ttext_info.value = text_info.value + `<demo> - event [video-mute] streamId: ${stream.streamID}` + '\\n';\n\t\tconsole.log(`<demo> - event [video-mute] streamId: ${stream.streamID}`);\n\n\t\tstream._video.style.backgroundColor = 'transparent';\n\t\tstream._video.poster = 'http://www.3ttech.cn/favicon.ico';\n\t});\n\t\n\tclient.on('video-unmute', (evt) => {\n\t\tvar stream = evt.stream;\n\t\tif (!stream)\n\t\t\treturn;\n\t\t\t\n\t\ttext_info.value = text_info.value + `<demo> - event [video-unmute] streamId: ${stream.streamID}` + '\\n';\n\t\tconsole.log(`<demo> - event [video-unmute] streamId: ${stream.streamID}`);\n\t\t\n\t\tstream._video.style.backgroundColor = '#000';\n\t\tstream._video.srcObject = stream._streamObj;\n\t\tstream._video.poster = '';\n\t});\n}\n\nfunction leaveChan()\n{\n\tif (tttStatus !== 1)\n\t{\n\t\ttext_info.value = text_info.value + 'leaveChan while tttStatus is not 1?' + '\\n';\n\t\treturn;\n\t}\n\t\n\t_onClose();\n\n\tif (client)\n\t{\n        client.leave(() => { }, () => { });\n        client.close();\n\t}\n\n\ttext_info.value = text_info.value + 'leaveChan OK' + '\\n';\n}\n\nfunction _onClose()\n{\n\t// \n\tremote_stream.forEach((item) =>\n\t{\n\t\tif (!!item)\n\t\t{\n\t\t\t// \n\t\t\tlet obj = document.getElementById('3t_remote' + item.streamID);\n\t\t\tif (obj)\n\t\t\t{\n\t\t\t\tobj.remove();\n\t\t\t}\n\t\t\t// \n\t\t\titem.close();\n\t\t}\n\t});\n\tremote_stream.clear();\n\n\t// \n\tunpublishStream({\n\t\tvideo       : true,\n\t\tscreen      : false\n\t\t});\n\tunpublishStream({\n\t\tvideo       : false,\n\t\tscreen      : true\n\t\t});\n\n\t// \n\t{\n\t\tlet obj = document.getElementById('3t_local_screen');\n\t\tif (obj)\n\t\t{\n\t\t\tobj.remove();\n\t\t}\n\n\t\t// \n\t\tif (!!gScreenStream)\n\t\t{\n\t\t\tstreams.delete(gScreenStream.innerStreamID);\n\t\t\t\n\t\t\tgScreenStream.close();\n\t\t\tgScreenStream = null;\n\t\t}\n\t}\n\n\t// \n\t{\n\t\tlet obj = document.getElementById('3t_local');\n\t\tif (obj)\n\t\t{\n\t\t\tobj.remove();\n\t\t}\n\n\t\t// \n\t\tif (!!gStream)\n\t\t{\n\t\t\tstreams.delete(gStream.innerStreamID);\n\t\t\t\n\t\t\tgStream.close();\n\t\t\tgStream = null;\n\t\t}\n\t}\n\t// \n\t\n\ttttStatus = 0;\n\n\t// \n\tdocument.getElementById('loginStatus').innerHTML = '<font color=\"red\"></font>';\n\tdocument.getElementById('loginInfo').innerHTML = '';\n}\n\nlet joinChanEle = document.getElementById('joinChan');\nif (!!joinChanEle)\n{\n\tjoinChanEle.addEventListener('click', () => {\n\t\tlet appId = appIdEle.value;\n\t\tlet rid = roomIdEle.value;\n\t\tlet uid = userIdEle.value;\n\t\tjoinChan(appId, rid, uid);\n\t})\n}\n\nlet leaveChanEle = document.getElementById('leaveChan');\nif (!!leaveChanEle)\n{\n\tleaveChanEle.addEventListener('click', () => {\n\t\tleaveChan();\n\t})\n}\n\nfunction setStreamSEI(userid, mid, type, isScreen)\n {\n\tif(client._role !== \"1\")\n\t\treturn;\n\n    let position = {\n        \"id\": 0,\n        \"h\": 0,\n        \"w\": 0,\n        \"x\": 0,\n        \"y\": 0,\n        \"z\": 1\n    };\n\n    sei.mid = mid;\n    sei.ts = + new Date();\n    position.id = mid;\n    position.x = 0;\n    position.y = 0;\n    position.w = 1;\n    position.h = 1;\n\tposition.z = 0;\n\t/*\n\tif (type === 'add')\n\t{\n        sei.pos.push(position);\n\t}\n\telse\n\t{\n        sei.pos.pop();\n\t}\n\t*/\n\tsei.pos = [];\n\tsei.pos.push(position);\n\n    client.setSEI(userid, type, isScreen, sei);\n};\n\nfunction setVideoProfile(prof)\n{\n\tif (gStream === null)\n\t{\n\t\treturn;\n\t}\n\n\t// set video profile\n\tgStream.setVideoProfile(prof, (msg) => {\n\t\ttext_info.value = text_info.value + `<demo> setVideoProfile - gStream.setVideoProfile succ. ${prof}` + '\\n';\n\t\tconsole.log(`<demo> setVideoProfile - gStream.setVideoProfile succ: ${prof}`);\n\t}, (e) => {\n\t\ttext_info.value = text_info.value + `<demo> setVideoProfile - gStream.setVideoProfile failed. - error: ${JSON.stringify(e)}` + '\\n';\n\t\tconsole.log('<demo> setVideoProfile - gStream.setVideoProfile - error: ' + e);\n\t});\n}\n\n// \nfunction publishStream(opts)\n{\n\t// \n\tif (tttStatus !== 1)\n\t{\n\t\ttext_info.value = text_info.value + '<demo> publishStream - []' + '\\n';\n\t\treturn;\n\t}\n\n\tconst {\n\t\tuserid,\n\t\taudio,\n\t\tvideo,\n\t\tscreen\n\t} = opts;\n\n\tlet v = (+video) + (+screen);\n\tif (v > 1)\n\t{\n\t\ttext_info.value = text_info.value + '<demo> publishStream - video/screen/mediasouce  true' + '\\n';\n\t\treturn;\n\t}\n\n\tlet mediaStream = null;\n\t\n\tif (Boolean(screen))\n\t{\n\t\tmediaStream = gScreenStream;\n\t}\n\telse if (Boolean(video) || Boolean(audio))\n\t{\n\t\tmediaStream = gStream;\n\t}\n\n\tif (mediaStream === null)\n\t{\n\t\tlet resolutionEle = document.getElementById('resolution');\n\t\tlet specRes = (!!resolutionEle) ? resolutionEle.value : '480p';\n\t\tlet resolution = Boolean(screen) ? '1080p' : specRes;\n\n\t\tconst streamID = Boolean(screen) ? `${userid}-screen` : `${userid}`;\n\n\t\tconsole.log(`<demo> publishStream() userid: ${userid} cameraDevId: ${cameraDevId} micDevId: ${micDevId} resolution: ${resolution}`);\n\n\t\t// \n\t\tmediaStream = RTCObj.createStream({\n\t\t\tstreamID,\n\t\t\tuserID: userid,\n\t\t\taudio: Boolean(audio),\n\t\t\tvideo: Boolean(video),\n\t\t\tscreen: Boolean(screen),\n\t\t\tcameraId: cameraDevId === 'default' ? null : cameraDevId,\n\t\t\tmicrophoneId: micDevId === 'default' ? null : micDevId,\n\t\t\tattributes: { videoProfile : resolution }\n\t\t});\n\n\t\tif (!mediaStream)\n\t\t\treturn;\n\n\t\twindow.ls = mediaStream;\n\n\t\tmediaStream.init(() => {\n\t\t\tif (Boolean(video) || Boolean(screen))\n\t\t\t{\n\t\t\t\tconst videoId = Boolean(screen) ? '3t_local_screen' : '3t_local';\n\t\t\t\tlet videoE = document.createElement('video');\n\t\t\t\tvideoE.id = videoId;\n\t\t\t\tvideoE.muted = true;\n\t\t\t\tvideoE.autoplay = true;\n\t\t\t\tvideoE.controls = true;\n\t\t\t\tvideoE.setAttribute('playsinline', '');\n\t\t\t\tvideoE.style.cssText = 'height: 300px; width: 300px; background: black; position: relative; display: inline-block;'\n\n\t\t\t\tif (Boolean(screen))\n\t\t\t\t{\n\t\t\t\t\tif (!!screenEle)\n\t\t\t\t\t{\n\t\t\t\t\t\tscreenEle.append(videoE);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (!!videoEle)\n\t\t\t\t\t{\n\t\t\t\t\t\tvideoEle.append(videoE);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tmediaStream.play(videoId, true);\n\t\t\t}\n\t\t\t// \n\n\t\t\tstreams.set(mediaStream.innerStreamID, mediaStream);\n\n\t\t\tif (Boolean(screen))\n\t\t\t{\n\t\t\t\tgScreenStream = mediaStream;\n\t\t\t}\n\t\t\telse if (Boolean(video) || Boolean(audio))\n\t\t\t{\n\t\t\t\tgStream = mediaStream;\n\t\t\t}\n\n\t\t\t_publishStream(userid, mediaStream, () => {\n\t\t\t\tif (Boolean(screen))\n\t\t\t\t{\n\t\t\t\t\tdocument.getElementById('publishScreenStatus').innerHTML = `<font color=\"green\"></font>`;\n\t\t\t\t\thasPublishScreen = true;\n\t\t\t\t}\n\t\t\t\telse if (Boolean(video) || Boolean(audio))\n\t\t\t\t{\n\t\t\t\t\tdocument.getElementById('publishStreamStatus').innerHTML = `<font color=\"green\"></font>`;\n\t\t\t\t\thasPublishStream = true;\n\t\t\t\t}\n\t\t\t}, () => {\n\t\t\t\tif (Boolean(screen))\n\t\t\t\t{\n\t\t\t\t\tdocument.getElementById('publishScreenStatus').innerHTML = `<font color=\"black\"></font>`;\n\t\t\t\t}\n\t\t\t\telse if (Boolean(video) || Boolean(audio))\n\t\t\t\t{\n\t\t\t\t\tdocument.getElementById('publishStreamStatus').innerHTML = `<font color=\"black\"></font>`;\n\t\t\t\t}\n\t\t\t});\n\t\t\t// \n\t\t}, (evt) => {\n\t\t\ttext_info.value = text_info.value + `<demo> publishStream - Stream.init failed. - error: ${JSON.stringify(evt)}` + '\\n';\n\t\t\tconsole.log('<demo> publishStream - Stream.init failed. - error: ' + evt);\n\t\t});\n\t}\n\telse\n\t{\n\t\tif (Boolean(screen) && hasPublishScreen)\n\t\t{\n\t\t\ttext_info.value = text_info.value + `<demo> publishStream - hasPublishScreen: ${hasPublishScreen} mediaStream: ${mediaStream.innerStreamID}` + '\\n';\n\t\t\tconsole.log(`<demo> publishStream - hasPublishScreen: ${hasPublishScreen}  mediaStream: ${mediaStream.innerStreamID}`);\n\n\t\t\treturn;\n\t\t}\n\t\telse if ((Boolean(video) || Boolean(audio)) && hasPublishStream)\n\t\t{\n\t\t\ttext_info.value = text_info.value + `<demo> publishStream - hasPublishStream: ${hasPublishStream} mediaStream: ${mediaStream.innerStreamID}` + '\\n';\n\t\t\tconsole.log(`<demo> publishStream - hasPublishStream: ${hasPublishStream}  mediaStream: ${mediaStream.innerStreamID}`);\n\t\n\t\t\treturn;\n\t\t}\n\n\t\t// \n\t\t_publishStream(userid, mediaStream, () => {\n\t\t\tif (Boolean(screen))\n\t\t\t{\n\t\t\t\tdocument.getElementById('publishScreenStatus').innerHTML = `<font color=\"green\"></font>`;\n\t\t\t\thasPublishScreen = true;\n\t\t\t}\n\t\t\telse if (Boolean(video) || Boolean(audio))\n\t\t\t{\n\t\t\t\tdocument.getElementById('publishStreamStatus').innerHTML = `<font color=\"green\"></font>`;\n\t\t\t\thasPublishStream = true;\n\t\t\t}\n\t\t}, () => {\n\t\t\tif (Boolean(screen))\n\t\t\t{\n\t\t\t\tdocument.getElementById('publishScreenStatus').innerHTML = `<font color=\"black\"></font>`;\n\t\t\t}\n\t\t\telse if (Boolean(video) || Boolean(audio))\n\t\t\t{\n\t\t\t\tdocument.getElementById('publishStreamStatus').innerHTML = `<font color=\"black\"></font>`;\n\t\t\t}\n\t\t});\n\t}\n\t// \n}\n\nfunction _publishStream(userid, mediaStream, onSuccess, onFailure)\n{\n\tif (!mediaStream)\n\t{\n\t\ttext_info.value = text_info.value + '<demo> _publishStream error - mediaStream is null' + '\\n';\n\t\tconsole.log('<demo> _publishStream error - mediaStream is null');\n\n\t\treturn;\n\t}\n\n\t// \n\tclient.publish(mediaStream, () => {\n\t\t// \n\t\ttext_info.value = text_info.value + `<demo> _publishStream - client.publish succ. mediaStream: ${mediaStream.innerStreamID}` + '\\n';\n\t\tconsole.log(`<demo> _publishStream - client.publish succ. mediaStream: ${mediaStream.innerStreamID}`);\n\n\t\t// \n\t\tonSuccess && onSuccess();\n\n\t\t// cdn \n\t\tconst mid = mediaStream.innerStreamID;\n\t\tsetStreamSEI(userid, mid, 'add', false);\n\n\t\t// \n\t\tif (mediaStream.hasAudio())\n\t\t{\n\t\t\tmediaStream.on('volume-change', e => {\n\t\t\t\t; // console.log(`<AUDIO-VOLUME> - volume-change -- userID: ${e.userID} volume: ${e.volume}`);\n\t\t\t});\n\t\t}\n\t}, (evt) => {\n\t\ttext_info.value = text_info.value + `_publishStream - client.publish failed. - error: ${JSON.stringify(evt)}` + '\\n';\n\t\tconsole.log(`<demo> _publishStream - client.publish failed. - error: ${JSON.stringify(evt)}`);\n\n\t\tonFailure && onFailure();\n\t});\n}\n\nfunction unpublishStream(opts)\n{\n\t_innerUnpublishStream(opts);\n}\n\nfunction _innerUnpublishStream(opts)\n{\n\tconst { video, screen } = opts;\n\tlet mediaStream = null;\n\n\tif (Boolean(screen))\n\t{\n\t\tmediaStream = gScreenStream;\n\t\thasPublishScreen = false;\n\t}\n\telse if (Boolean(video) || Boolean(audio))\n\t{\n\t\tmediaStream = gStream;\n\t\thasPublishStream = false;\n\t}\n\n\tif (mediaStream === null)\n\t{\n\t\ttext_info.value = text_info.value + 'unpublishStream -  mediaStream' + '\\n';\n\t\tconsole.log('<demo>  mediaStream');\n\t\treturn;\n\t}\n\n    client.unpublish(mediaStream, () => {\n\t\ttext_info.value = text_info.value + `<demo> unpublishStream - client.unpublish local stream ${mediaStream.innerStreamID} success.` + '\\n';\n        console.log(`<demo> unpublishStream - client.unpublish local stream ${mediaStream.innerStreamID} success.`);\n    }, () => {\n\t\ttext_info.value = text_info.value + '<demo> unpublishStream - client.unpublish local stream failed' + '\\n';\n\t\tconsole.log('<demo> unpublishStream - client.unpublish local stream failed');\n\t}, true);\n\n\t//\n\tif (Boolean(screen))\n\t{\n\t\tdocument.getElementById('publishScreenStatus').innerHTML = `<font color=\"black\"></font>`;\n\t}\n\telse if (Boolean(video) || Boolean(audio))\n\t{\n\t\tdocument.getElementById('publishStreamStatus').innerHTML = `<font color=\"black\"></font>`;\n\t}\n}\n\n//\nlet publishAudioStreamEle = document.getElementById('publishAudioStream');\nif (!!publishAudioStreamEle)\n{\n\tpublishAudioStreamEle.addEventListener('click', () => {\n\t\tpublishStream({\n\t\t\tuserid : xUserId,\n\t\t\taudio  : true,\n\t\t\tvideo  : false,\n\t\t\tscreen : false\n\t\t});\n\t})\n}\n\n// \nlet publishStreamEle = document.getElementById('publishStream');\nif (!!publishStreamEle)\n{\n\tpublishStreamEle.addEventListener('click', () => {\n\t\tpublishStream({\n\t\t\tuserid : xUserId,\n\t\t\taudio  : true,\n\t\t\tvideo  : true,\n\t\t\tscreen : false\n\t\t});\n\t})\n}\n\nlet unpublishStreamEle = document.getElementById('unpublishStream');\nif (!!unpublishStreamEle)\n{\n\tunpublishStreamEle.addEventListener('click', () => {\n\t\tunpublishStream({\n\t\t\tvideo       : true,\n\t\t\tscreen      : false\n\t\t});\n\t})\n}\n\nlet isVideoPaused = false;\nlet pauseVideoEle = document.getElementById('pauseVideo');\nif (!!pauseVideoEle)\n{\n\tpauseVideoEle.addEventListener('click', () => {\n\t\tif (!client)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!gStream)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (isVideoPaused)\n\t\t{\n\t\t\tclient.resumeWebcam(gStream);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tclient.pauseWebcam(gStream, true);\n\t\t}\n\n\t\tisVideoPaused = !isVideoPaused;\n\n\t\tpauseVideoEle.innerHTML = isVideoPaused ? 'resumeVideo' : 'pauseVideo';\n\t})\n}\n\nlet isAudioPaused = false;\nlet pauseAudioEle = document.getElementById('pauseAudio');\nif (!!pauseAudioEle)\n{\n\tpauseAudioEle.addEventListener('click', () => {\n\t\tif (!client)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!gStream)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\n\t\tif (isAudioPaused)\n\t\t{\n\t\t\tclient.resumeMic(gStream);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tclient.pauseMic(gStream);\n\t\t}\n\t\n\t\tisAudioPaused = !isAudioPaused;\n\t\n\t\tpauseAudioEle.innerHTML = isAudioPaused ? 'resumeAudio' : 'pauseAudio';\n\t})\t\n}\n\nlet resolutionEle = document.getElementById('resolution');\nif (!!resolutionEle)\n{\n\tresolutionEle.addEventListener('change', () => {\n\t\tlet prof = resolutionEle.value;\n\t\n\t\tsetVideoProfile(prof);\n\t})\n}\n\nfunction getDevices()\n{\n\tlet message = '';\n\t\n    RTCObj.getDevices((devices) => {\n\t\t// \n        devices.forEach((deviceInfo) => {\n            message = '<demo> getDevices - ' + deviceInfo.kind + ': ' + deviceInfo.label + ' id: ' + deviceInfo.deviceId + '\\n';\n\t\t\ttext_info.value = text_info.value + message;\n\t\t\tconsole.log(message);\n\t\t});\n    }, (err) => {\n\t\tconst errMsg = err.name + err.message + '\\n';\n\t\ttext_info.value = text_info.value + errMsg;\n    });\n}\n\nlet userRoleEle = document.getElementById('userRole');\nif (!!userRoleEle)\n{\n\tuserRoleEle.addEventListener('change', () => {\n\t\tlet index = userRoleSelect.selectedIndex;\n\n\t\tuserRole = userRoleSelect.options[index].value;\n\t\t\n\t\tconsole.log(`<demo> userRole change - userRole: ${userRole}`);\n\t})\n}\n\n\n//# sourceURL=webpack:///./src/demo.js?");

/***/ })

/******/ });